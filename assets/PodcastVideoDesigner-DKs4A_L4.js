import{r as n,j as e}from"./index-DX2mtma_.js";import{u as j,U as je,s as Ca,r as le,c as Aa,t as _e,d as Ga,a as Pa,O as Ta,S as Ea}from"./telegramService-DklkJaQq.js";import{A as Fa}from"./config-PJqXRuVJ.js";import{I as Ie}from"./ImageUpload-mUB4HcDX.js";import{h as Ua,i as Ha,m as qe,c as Oa,j as Da,I as $a}from"./lehuyducanhService-BqsWtKXJ.js";import{g as We,u as Ba,a as La}from"./mediaService-1p3th5hq.js";import{r as Ve,i as Ma,f as Ne,d as ke}from"./media-CDZXYBSY.js";import{s as Ye}from"./settingsService-Tte2DU1T.js";const Ce=[{value:"Kore",label:"Kore (Female)"},{value:"Puck",label:"Puck (Male)"},{value:"Charon",label:"Charon (Male)"},{value:"Fenrir",label:"Fenrir (Male)"},{value:"Zephyr",label:"Zephyr (Male)"}],Ra=h=>{const{numHosts:y,setNumHosts:p,hostOneImage:I,setHostOneImage:f,hostTwoImage:G,setHostTwoImage:b,podcastTopic:$,setPodcastTopic:V,pastedScript:B,setPastedScript:N,onGenerateScript:P,isGeneratingScript:l,onAnalyzeScript:c,isAnalyzingScript:L,reporterVoice:J,setReporterVoice:Q,intervieweeVoice:m,setIntervieweeVoice:C,environmentImage:T,setEnvironmentImage:X,environmentVariationsCount:ee,setEnvironmentVariationsCount:ae,onGenerateEnvironments:te,isGeneratingEnvironments:k,globalVoiceInstruction:oe,setGlobalVoiceInstruction:se,videoAspectRatio:M,setVideoAspectRatio:ce,singleHostSetting:E,setSingleHostSetting:ne,backgroundPrompt:de,setBackgroundPrompt:ge,onViewImage:R}=h,[S,re]=n.useState("custom"),[F,z]=n.useState("generate"),me=!!I&&(y===1||!!G)&&!!$,_=(!!I&&(y===1||!!G)||!!T)&&!!B,U=y===1&&E==="stage"?"Stage":"Studio";return e.jsxs("div",{className:"bg-gray-800 p-6 rounded-2xl border border-gray-700 shadow-lg flex flex-col gap-6",children:[e.jsxs("div",{className:"flex mb-2 border-b-2 border-gray-700",children:[e.jsxs("button",{onClick:()=>re("custom"),className:`flex-1 text-center font-bold py-3 transition-all duration-300 flex items-center justify-center gap-2 ${S==="custom"?"text-blue-400 border-b-4 border-blue-500":"text-gray-400 hover:text-white"}`,children:[e.jsx("i",{className:"fas fa-tools"})," Custom Setup"]}),e.jsxs("button",{onClick:()=>re("quick-start"),className:`flex-1 text-center font-bold py-3 transition-all duration-300 flex items-center justify-center gap-2 ${S==="quick-start"?"text-yellow-400 border-b-4 border-yellow-500":"text-gray-400 hover:text-white"}`,children:[e.jsx("i",{className:"fas fa-bolt"})," Quick Start"]})]}),S==="custom"&&e.jsxs("div",{className:"flex flex-col gap-6 animate-fade-in",children:[e.jsxs("h3",{className:"text-xl font-bold text-blue-400 -mb-2",children:[e.jsx("i",{className:"fas fa-users mr-2"}),"Cast"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-md font-bold text-gray-300 mb-2",children:"Number of Hosts"}),e.jsxs("div",{className:"flex gap-2 bg-gray-900 border-2 border-gray-600 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>p(1),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${y===1?"bg-blue-600":"bg-transparent text-gray-400 hover:bg-gray-700"}`,children:"1 Host"}),e.jsx("button",{onClick:()=>p(2),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${y===2?"bg-blue-600":"bg-transparent text-gray-400 hover:bg-gray-700"}`,children:"2 Hosts"})]})]}),y===1&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-md font-bold text-gray-300 mb-2",children:"Host Setting"}),e.jsxs("div",{className:"flex gap-2 bg-gray-900 border-2 border-gray-600 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>ne("studio"),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${E==="studio"?"bg-blue-600":"bg-transparent text-gray-400 hover:bg-gray-700"}`,children:"In Studio"}),e.jsx("button",{onClick:()=>ne("stage"),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${E==="stage"?"bg-blue-600":"bg-transparent text-gray-400 hover:bg-gray-700"}`,children:"On Stage"})]})]}),e.jsx(Ie,{id:"podcast-host-1-image",label:y===1?"Host Image":"Host 1 Image",file:I,onFileChange:f,onViewImage:R}),y===2&&e.jsx(Ie,{id:"podcast-host-2-image",label:"Host 2 Image",file:G,onFileChange:b,onViewImage:R}),e.jsx("div",{className:"border-t-2 border-gray-700 -mx-6"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-400 mb-2",children:[e.jsx("i",{className:"fas fa-image mr-2"}),U," / Set"]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"background-prompt",className:"block text-sm font-bold text-gray-300 mb-1",children:"Generate with AI using a prompt"}),e.jsx("input",{id:"background-prompt",type:"text",value:de,onChange:d=>ge(d.target.value),placeholder:"e.g., minimalist, wooden textures...",className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-2 text-gray-200"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"env-count",className:"block text-sm font-bold text-gray-300 mb-1",children:"Number of Camera Angles"}),e.jsx("input",{id:"env-count",type:"number",min:"1",max:"10",value:ee,onChange:d=>ae(parseInt(d.target.value,10)),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-2 text-gray-200"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"aspect-ratio-podcast",className:"block text-sm font-bold text-gray-300 mb-1",children:"Video Aspect Ratio"}),e.jsxs("select",{id:"aspect-ratio-podcast",value:M,onChange:d=>ce(d.target.value),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-2 text-gray-200",children:[e.jsx("option",{value:"16:9",children:"16:9 (Landscape)"}),e.jsx("option",{value:"9:16",children:"9:16 (Portrait)"})]})]}),e.jsx("button",{onClick:te,disabled:k||!I,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-full disabled:opacity-50",title:I?`Generate ${U} Scene Variations`:"Please upload at least one host image",children:k?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"})," Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-camera-retro"})," Generate ",U," Scenes"]})})]})]}),S==="quick-start"&&e.jsxs("div",{className:"flex flex-col gap-6 animate-fade-in",children:[e.jsx("div",{className:"bg-yellow-900/30 border border-yellow-700/50 p-3 rounded-lg text-center text-yellow-200 text-sm",children:e.jsxs("p",{children:[e.jsx("i",{className:"fas fa-bolt mr-2"}),"Upload a finalized photo of you in the studio. We'll use it for everything."]})}),e.jsx(Ie,{id:"environment-image",label:"Master Shot (You in Studio)",file:T,onFileChange:X,onViewImage:R})]}),e.jsx("div",{className:"border-t-2 border-gray-700 -mx-6"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-400 mb-2",children:[e.jsx("i",{className:"fas fa-cog mr-2"}),"Audio & Video"]}),y===1?e.jsxs("div",{children:[e.jsx("label",{htmlFor:"podcast-tts-voice",className:"block text-md font-bold text-gray-300 mb-2",children:"Host's Voice"}),e.jsx("select",{id:"podcast-tts-voice",value:J,onChange:d=>Q(d.target.value),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200",children:Ce.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"reporter-voice",className:"block text-md font-bold text-gray-300 mb-2",children:"Host 1's Voice"}),e.jsx("select",{id:"reporter-voice",value:J,onChange:d=>Q(d.target.value),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200",children:Ce.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"interviewee-voice",className:"block text-md font-bold text-gray-300 mb-2",children:"Host 2's Voice"}),e.jsx("select",{id:"interviewee-voice",value:m,onChange:d=>C(d.target.value),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200",children:Ce.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"global-voice-instruction",className:"block text-md font-bold text-gray-300 mb-2",children:"Global Voice Instruction (Optional)"}),e.jsx("textarea",{id:"global-voice-instruction",value:oe,onChange:d=>se(d.target.value),placeholder:"e.g., Speak in a warm, friendly, and engaging tone.",className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200",rows:2})]})]}),e.jsx("div",{className:"border-t-2 border-gray-700 -mx-6"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-400 mb-4",children:[e.jsx("i",{className:"fas fa-file-alt mr-2"}),"Scripting"]}),e.jsxs("div",{className:"flex gap-1 bg-gray-900 border-2 border-gray-600 rounded-lg p-1 mb-4",children:[e.jsx("button",{onClick:()=>z("generate"),disabled:S==="quick-start",className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${F==="generate"&&S!=="quick-start"?"bg-blue-600":"bg-transparent text-gray-400 hover:bg-gray-700"} ${S==="quick-start"?"opacity-50 cursor-not-allowed":""}`,children:"Generate"}),e.jsx("button",{onClick:()=>z("paste"),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${F==="paste"?"bg-blue-600":"bg-transparent text-gray-400 hover:bg-gray-700"}`,children:"Paste"})]}),F==="generate"&&S==="custom"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{htmlFor:"podcast-topic",className:"block text-md font-bold text-gray-300",children:"Podcast Topic"}),e.jsx("input",{id:"podcast-topic",type:"text",value:$,onChange:d=>V(d.target.value),placeholder:"e.g., The future of AI",className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200"}),e.jsx("button",{onClick:P,disabled:l||!me,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-full disabled:opacity-50 flex items-center justify-center gap-2",children:l?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"})," Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-wand-magic-sparkles"})," Generate Script"]})})]}),F==="paste"&&e.jsx("textarea",{id:"pasted-script",value:B,onChange:d=>N(d.target.value),placeholder:"Paste your full podcast script here. Each new line or paragraph will be treated as a scene.",className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200",rows:8})]}),e.jsx("div",{className:"border-t-2 border-gray-700 -mx-6 pt-6",children:e.jsx("button",{onClick:c,disabled:L||!_,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-full disabled:opacity-50 text-lg flex items-center justify-center gap-2",title:_?"Generate Storyboard":"Please provide required inputs",children:L?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"})," Analyzing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-cogs"})," Generate Storyboard"]})})})]})},Qa=({currentUser:h,onLogout:y})=>{const[p,I]=n.useState(1),[f,G]=n.useState(null),[b,$]=n.useState(null),[V,B]=n.useState(""),[N,P]=n.useState(""),[l,c]=n.useState([]),[L,J]=n.useState(null),[Q,m]=n.useState(null),[C,T]=n.useState("input"),[X,ee]=n.useState(!1),[ae,te]=n.useState(!1),[k,oe]=n.useState({}),[se,M]=n.useState(null),[ce,E]=n.useState(!1),[ne,de]=n.useState(!1),[ge,R]=n.useState(!1),[S,re]=n.useState(!1),[F,z]=n.useState(!1),[me,_]=n.useState(!1),[Ae,U]=n.useState(!1),[d,Ke]=n.useState({storyboard:0,image:0,video:0}),[Ge,Pe]=n.useState(!1),[ue,Te]=n.useState(!1),[q,Ee]=n.useState("Puck"),[H,Fe]=n.useState("Kore"),[W,Ue]=n.useState(""),[v,He]=n.useState("16:9"),[A,Oe]=n.useState("studio"),[Y,De]=n.useState(null),[K,$e]=n.useState("a modern, professional podcast studio interior"),[pe,Be]=n.useState([]),[Z,he]=n.useState(),[fe,Ze]=n.useState(4),[Je,Le]=n.useState(!1),[Qe,Me]=n.useState(!1),[Xe,Re]=n.useState(!1),w=n.useCallback(()=>{const a=j.getUsage(h);Ke({storyboard:a.generateStoryboard.count,image:a.generateImage.count,video:a.generateVideo.count})},[h]);n.useEffect(()=>{w()},[w]);const O=n.useCallback(async()=>{const a=[];return f&&a.push(await Ve(f)),p===2&&b&&a.push(await Ve(b)),a},[f,b,p]),ea=n.useCallback(async()=>{if(!j.canPerformAction(h,"generateStoryboard")){alert(`You have reached your daily limit of ${je.generateStoryboard} storyboard generations.`);return}ee(!0),m(null);try{const a=await O();if(a.length!==p)throw new Error("Missing host images.");const o=await Ua(V,p,a);P(o),T("script_generated"),j.logAction(h,"generateStoryboard"),w()}catch(a){m(a instanceof Error?a.message:"An unknown error occurred.")}finally{ee(!1)}},[h,O,p,V,w]),ze=n.useCallback(async()=>{te(!0),m(null),c([]);try{const a=await O();if(a.length!==p)throw new Error("Missing host images.");if(!j.canPerformAction(h,"generateImage"))throw new Error("You have reached your daily limit for image generations and cannot create the initial studio image.");const o=p===1?"A realistic photo of a person in a modern podcast studio, sitting at a table with a professional microphone. The shot is a medium wide shot.":"A realistic photo of two people sitting across from each other in a modern podcast studio, at a table with professional microphones. The shot is a medium wide shot.",[s]=await We({provider:"gemini",prompt:o,subjectUrls:a,aspectRatio:v});J(s),j.logAction(h,"generateImage"),w();const t=await Ha(N,a,A);c(t),T("prompts_generated")}catch(a){m(a instanceof Error?a.message:"An unknown error occurred.")}finally{te(!1)}},[O,p,N,h,w,v,A]),be=n.useCallback(async a=>{if(!j.canPerformAction(h,"generateImage"))throw new Error(`You have reached your daily limit of ${je.generateImage} image generations.`);const o=l.find(s=>s.id===a);if(o){c(s=>s.map(t=>t.id===a?{...t,isGeneratingImage:!0,imageGenerationError:null}:t));try{const s=k[a]||{},t=s.imageProvider||"lehuyducanh",i=s.selectedHost,r=[];i==="host1"?f&&r.push(f):i==="host2"?b&&r.push(b):(f&&r.push(f),p===2&&b&&r.push(b));const g=await Promise.all(r.map(we=>Ve(we))),u=o.imagePrompt.toLowerCase().includes("studio"),x=u?g:[],Se=u?L??void 0:void 0,D=await We({provider:t,prompt:o.imagePrompt,subjectUrls:x,sceneUrl:Se,aspectRatio:v});c(we=>we.map(ie=>ie.id===a?{...ie,images:[...ie.images,...D],isGeneratingImage:!1}:ie)),j.logAction(h,"generateImage"),w()}catch(s){throw c(t=>t.map(i=>i.id===a?{...i,isGeneratingImage:!1,imageGenerationError:s instanceof Error?s.message:"Unknown error"}:i)),s}}},[l,h,w,k,f,b,p,L,v]),xe=n.useCallback(async(a,o)=>{const s=l.find(i=>i.id===a),t=s==null?void 0:s.videos[o];if(t){c(i=>i.map(r=>r.id===a?{...r,videos:r.videos.map((g,u)=>u===o?{...g,isUpscaling:!0,upscaleError:null}:g)}:r));try{const i=await Ba({provider:"lehuyducanh",mediaGenerationId:t.mediaGenerationId,seed:t.seed});c(r=>r.map(g=>g.id===a?{...g,videos:g.videos.map((u,x)=>x===o?{...u,upscaledUrl:i,isUpscaling:!1}:u)}:g))}catch(i){throw c(r=>r.map(g=>g.id===a?{...g,videos:g.videos.map((u,x)=>x===o?{...u,isUpscaling:!1,upscaleError:i instanceof Error?i.message:"Unknown error"}:u)}:g)),i}}},[l]),aa=(a,o)=>{c(s=>s.map(t=>{if(t.id!==a)return t;const i=[...t.videos];return i.splice(o,1),{...t,videos:i}}))},ve=n.useCallback(async a=>{if(!j.canPerformAction(h,"generateVideo"))throw new Error(`You have reached your daily limit of ${je.generateVideo} video generations.`);const o=l.find(s=>s.id===a);if(!o||!o.selectedImageForVideo)throw new Error("No image selected for video generation.");c(s=>s.map(t=>t.id===a?{...t,isGeneratingVideo:!0,videoGenerationError:null}:t));try{const s=await Ma(o.selectedImageForVideo),t=`Voiceover: "${o.voiceoverScript}".
Motion: ${o.videoPrompt}`,{videoUrl:i,upscaledUrl:r,mediaGenerationId:g,seed:u}=await La({provider:"lehuyducanh",prompt:t,imageUrl:s,upscale:o.shouldUpscaleVideo,aspectRatio:v}),x={url:i,upscaledUrl:r,mediaGenerationId:g,seed:u};c(Se=>Se.map(D=>D.id!==a?D:{...D,videos:[...D.videos||[],x],isGeneratingVideo:!1})),j.logAction(h,"generateVideo"),w()}catch(s){throw c(t=>t.map(i=>i.id===a?{...i,isGeneratingVideo:!1,videoGenerationError:s instanceof Error?s.message:"Unknown error"}:i)),s}},[l,h,w,v]),ta=n.useCallback(async()=>{if(C==="input"){alert("Please generate a script or storyboard before saving.");return}Pe(!0),m(null);try{const a=f?{name:f.name,data:await Ne(f)}:void 0,o=b?{name:b.name,data:await Ne(b)}:void 0,s=Y?{name:Y.name,data:await Ne(Y)}:void 0,t={version:"1.0.0-podcast",numHosts:p,hostOneImage:a,hostTwoImage:o,podcastTopic:V,pastedScript:N,reporterVoice:q,intervieweeVoice:H,globalVoiceInstruction:W,videoAspectRatio:v,singleHostSetting:A,environmentImage:s,backgroundPrompt:K,generatedEnvironments:pe,selectedBackground:Z,scenes:l,sceneOverrides:k,generationStep:C},i=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),r=(V.trim().replace(/\s+/g,"-").substring(0,20)||"podcast-project").toLowerCase();Ca(i,`${r}.pvdproj`)}catch(a){m(a instanceof Error?a.message:"An unknown error occurred during saving.")}finally{Pe(!1)}},[C,p,f,b,V,N,q,H,W,v,A,Y,K,pe,Z,l,k]),oa=n.useCallback(async a=>{var s,t;const o=(s=a.target.files)==null?void 0:s[0];if(o){Te(!0),m(null);try{const i=await o.text(),r=JSON.parse(i);if(!((t=r.version)!=null&&t.includes("-podcast")))throw new Error("Invalid project file. Please import a .pvdproj file.");I(r.numHosts||1),G(r.hostOneImage?await ke(r.hostOneImage.data,r.hostOneImage.name):null),$(r.hostTwoImage?await ke(r.hostTwoImage.data,r.hostTwoImage.name):null),B(r.podcastTopic||""),P(r.pastedScript||""),Ee(r.reporterVoice||"Puck"),Fe(r.intervieweeVoice||"Kore"),Ue(r.globalVoiceInstruction||""),He(r.videoAspectRatio||"16:9"),Oe(r.singleHostSetting||"studio"),De(r.environmentImage?await ke(r.environmentImage.data,r.environmentImage.name):null),$e(r.backgroundPrompt||"a modern, professional podcast studio interior"),Be(r.generatedEnvironments||[]),he(r.selectedBackground||void 0),oe(r.sceneOverrides||{});const u=(r.scenes||[]).map(x=>({...qe({}),...x,videos:x.videos||[]}));c(u),T(r.generationStep||"input"),alert("Project imported successfully!")}catch(i){m(i instanceof Error?i.message:"An unknown error occurred during import.")}finally{Te(!1),a.target.value=""}}},[]),sa=n.useCallback((a,o,s)=>{oe(t=>{const r={...t[a]||{},[o]:s};if((o==="selectedHost"&&s==="auto"||o==="imageProvider"&&s==="lehuyducanh")&&delete r[o],Object.keys(r).length===0){const{[a]:g,...u}=t;return u}return{...t,[a]:r}})},[]),na=(a,o)=>c(s=>s.map(t=>t.id===a?{...t,imagePrompt:o}:t)),ra=(a,o)=>c(s=>s.map(t=>t.id===a?{...t,videoPrompt:o}:t)),ia=(a,o)=>c(s=>s.map(t=>t.id===a?{...t,voiceoverGuide:o}:t)),la=(a,o,s)=>c(t=>t.map(i=>i.id===a?{...i,[o]:s}:i)),ca=(a,o)=>c(s=>s.map(t=>t.id!==a?t:{...t,images:t.images.filter(i=>i!==o),selectedImageForVideo:t.selectedImageForVideo===o?void 0:t.selectedImageForVideo})),da=(a,o)=>c(s=>s.map(t=>t.id===a?{...t,selectedImageForVideo:o,videos:[],videoGenerationError:null}:t)),ga=a=>c(o=>o.map(s=>s.id===a?{...s,shouldUpscaleVideo:!s.shouldUpscaleVideo}:s)),ma=async(a,o)=>{},ua=n.useCallback(async()=>le(l.filter(a=>a.images.length===0&&!a.imagePrompt.toLowerCase().includes("studio")).map(a=>()=>be(a.id)),5).finally(()=>de(!1)),[l,be]),pa=n.useCallback(async()=>le(l.filter(a=>a.selectedImageForVideo&&(!a.videos||a.videos.length===0)).map(a=>()=>ve(a.id)),5).finally(()=>R(!1)),[l,ve]),ha=n.useCallback(async()=>le(l.flatMap(a=>(a.videos||[]).map((o,s)=>({scene:a,video:o,index:s})).filter(o=>o.video.url&&o.video.mediaGenerationId&&!o.video.upscaledUrl).map(o=>()=>xe(o.scene.id,o.index))),5).finally(()=>re(!1)),[l,xe]),ye=n.useCallback(async a=>{const o=l.find(s=>s.id===a);if(o){c(s=>s.map(t=>t.id===a?{...t,isGeneratingAudio:!0,audioGenerationError:null}:t));try{let s=H,t=o.voiceoverScript;t.toLowerCase().startsWith("host 1:")||t.toLowerCase().startsWith("reporter:")?(s=q,t=t.replace(/^(host 1:|reporter:)\s*/i,"")):(t.toLowerCase().startsWith("host 2:")||t.toLowerCase().startsWith("interviewee:"))&&(s=H,t=t.replace(/^(host 2:|interviewee:)\s*/i,""));const i=await Oa(t,o.voiceoverGuide,s,W),r=Aa(i),g=URL.createObjectURL(r);c(u=>u.map(x=>x.id===a?{...x,audioUrl:g,isGeneratingAudio:!1}:x))}catch(s){const t=s instanceof Error?s.message:"An unknown audio generation error occurred.";c(i=>i.map(r=>r.id===a?{...r,isGeneratingAudio:!1,audioGenerationError:t}:r))}}},[l,q,H,W]),fa=n.useCallback(async()=>{U(!0);const a=l.filter(o=>!o.audioUrl).map(o=>()=>ye(o.id));await le(a,5),U(!1)},[l,ye]),ba=a=>{const o=qe({voiceoverScript:"New scene..."});c(s=>{const t=[...s];return t.splice(a,0,o),t})},xa=n.useCallback(()=>{c(a=>a.map(o=>o.imagePrompt.toLowerCase().includes("studio")||o.imagePrompt.toLowerCase().includes("stage")?{...o,selectedImageForVideo:Z}:o.images.length>0?{...o,selectedImageForVideo:o.images[0]}:o)),alert("Set studio scenes to the selected background and picked the first image for all B-roll scenes!")},[Z]),va=n.useCallback(async()=>{const{botToken:a,chatId:o}=Ye.getTelegramConfig();if(!a||!o){alert("Please configure Telegram settings first in the Settings page.");return}const s=l.flatMap((t,i)=>t.images.map((r,g)=>({type:"photo",url:r,caption:`Scene ${i+1}: ${t.voiceoverScript}`,fileName:`${String(i+1).padStart(3,"0")}_image_${String(g+1).padStart(2,"0")}.jpg`})));if(s.length===0){alert("No generated images found to send.");return}Me(!0),m(null);try{await _e.sendMedia(s),alert("All images sent to Telegram successfully!")}catch(t){const i=t instanceof Error?t.message:"Failed to send images to Telegram.";m(i),alert(i)}finally{Me(!1)}},[l]),ya=n.useCallback(async()=>{const{botToken:a,chatId:o}=Ye.getTelegramConfig();if(!a||!o){alert("Please configure Telegram settings first in the Settings page.");return}const s=l.flatMap((t,i)=>(t.videos||[]).map((r,g)=>({type:"video",url:r.upscaledUrl||r.url,caption:`Scene ${i+1}: ${t.voiceoverScript}`,fileName:`${String(i+1).padStart(3,"0")}_video_${String(g+1).padStart(2,"0")}.mp4`}))).filter(t=>t.url);if(s.length===0){alert("No videos found to send.");return}Re(!0),m(null);try{await _e.sendMedia(s),alert("All videos sent to Telegram successfully!")}catch(t){const i=t instanceof Error?t.message:"Failed to send videos to Telegram.";m(i),alert(i)}finally{Re(!1)}},[l]),Sa=n.useCallback(async()=>{z(!0);try{await Ga(l)}catch(a){m(a instanceof Error?a.message:"Failed to download images.")}finally{z(!1)}},[l]),wa=n.useCallback(async()=>{_(!0);try{await Pa(l)}catch(a){m(a instanceof Error?a.message:"Failed to download videos.")}finally{_(!1)}},[l]),ja=(a,o)=>{c(s=>s.map(t=>t.id===a?{...t,includeDialogueInPrompt:o}:t))},Ia=async(a,o)=>{alert("Enhanced prompt generation is not yet implemented for the Podcast module.")},Va=a=>{window.confirm("Are you sure you want to delete this scene?")&&c(o=>o.filter(s=>s.id!==a))},Na=(a,o)=>{c(s=>s.map(t=>t.id===a?{...t,voiceoverScript:o}:t))},ka=n.useCallback(async()=>{Le(!0),m(null);try{const a=await O();if(a.length===0)throw new Error("Please upload at least one host image.");const o=await Da(a,K,fe,A,v);Be(o),o.length>0&&he(o[0])}catch(a){m(a instanceof Error?a.message:"Failed to generate background scenes.")}finally{Le(!1)}},[O,K,fe,A,v]);return e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"py-4 px-8 bg-gray-800 shadow-lg border-b border-gray-700 shrink-0 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-blue-400",children:[e.jsx("i",{className:"fas fa-podcast mr-3"}),"Podcast Video Designer"]}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Turn your podcast into visually engaging videos."})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("label",{htmlFor:"import-project-podcast",className:`text-center bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-full transition-all duration-300 flex items-center justify-center gap-2 text-sm shadow-sm ${ue?"cursor-not-allowed opacity-50":"cursor-pointer"}`,children:ue?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"}),"Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-folder-open"}),"Import"]})}),e.jsx("input",{id:"import-project-podcast",type:"file",accept:".pvdproj",className:"hidden",onChange:oa,disabled:ue}),e.jsx("button",{onClick:ta,disabled:Ge||C==="input",className:"bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-sm shadow-sm",children:Ge?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-save"}),"Save"]})})]}),Fa.LOGIN_REQUIRED]})]}),e.jsx("main",{className:"flex-1 overflow-x-hidden overflow-y-auto p-4 md:p-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 xl:grid-cols-4 gap-8 items-start",children:[e.jsx("div",{className:"lg:sticky lg:top-8 xl:col-span-1",children:e.jsx(Ra,{numHosts:p,setNumHosts:I,hostOneImage:f,setHostOneImage:G,hostTwoImage:b,setHostTwoImage:$,podcastTopic:V,setPodcastTopic:B,pastedScript:N,setPastedScript:P,onGenerateScript:ea,isGeneratingScript:X,onAnalyzeScript:ze,isAnalyzingScript:ae,reporterVoice:q,setReporterVoice:Ee,intervieweeVoice:H,setIntervieweeVoice:Fe,environmentImage:Y,setEnvironmentImage:De,environmentVariationsCount:fe,setEnvironmentVariationsCount:Ze,onGenerateEnvironments:ka,isGeneratingEnvironments:Je,globalVoiceInstruction:W,setGlobalVoiceInstruction:Ue,videoAspectRatio:v,setVideoAspectRatio:He,singleHostSetting:A,setSingleHostSetting:Oe,backgroundPrompt:K,setBackgroundPrompt:$e,onViewImage:M})}),e.jsx("div",{className:"lg:col-span-2 xl:col-span-3",children:e.jsx(Ta,{generationStep:C,scenes:l,isLoading:X||ae,isGeneratingPrompts:!1,error:Q,voiceoverScript:N,onVoiceoverScriptChange:P,onGeneratePrompts:ze,sceneOverrides:k,onGenerateImage:be,onSceneImagePromptChange:na,onSceneVideoPromptChange:ra,onSceneVoiceoverGuideChange:ia,onSceneEnhancementChange:la,onSceneOverrideChange:sa,onDeleteImage:ca,onViewImage:M,onUploadImageForVideo:ma,onGenerateAllImages:ua,isBatchGenerating:ne,onViewStoryboard:()=>E(!0),onDownloadAllImages:Sa,isDownloadingImages:F,onDownloadAllVideos:wa,isDownloadingVideos:me,onSelectImageForVideo:da,onGenerateVideo:ve,onToggleVideoUpscale:ga,onUpscaleVideo:xe,onGenerateAllVideos:pa,isBatchGeneratingVideos:ge,onUpscaleAllVideos:ha,isBatchUpscalingVideos:S,generatedEnvironments:pe,activeModule:"podcast",numHosts:p,onGenerateAudio:ye,onGenerateAllAudio:fa,isBatchGeneratingAudio:Ae,onAddScene:ba,onPickAllImages:xa,onSelectEnvironment:he,selectedEnvironment:Z,onSendAllImagesToTelegram:va,isSendingImagesToTelegram:Qe,onSendAllVideosToTelegram:ya,isSendingVideosToTelegram:Xe,videoAspectRatio:v,onToggleDialogueInPrompt:ja,onGenerateEnhancedPrompt:Ia,onSceneVoiceoverScriptChange:Na,onDeleteScene:Va,onDeleteVideo:aa})})]})}),se&&e.jsx($a,{imageUrl:se,onClose:()=>M(null)}),ce&&e.jsx(Ea,{scenes:l,onClose:()=>E(!1),videoAspectRatio:v})]})};export{Qa as default};

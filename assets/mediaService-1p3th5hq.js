import{k as u,M as g,l as f,y}from"./lehuyducanhService-BqsWtKXJ.js";const A=o=>{var n;const[a,e]=o.split(",");if(!a||!e)throw new Error("Invalid Data URL format");const r=(n=a.split(":")[1])==null?void 0:n.split(";")[0];if(!r)throw new Error("Could not determine MIME type from Data URL");return{inlineData:{mimeType:r,data:e}}},E=async({prompt:o,subjectUrls:a=[],styleUrl:e,sceneUrl:r,referenceUrls:n=[],aspectRatio:l})=>{const h=u();try{const i=[];let c=`Generate a high-quality, photorealistic image based on this creative brief: "${o}".`;l&&(c+=` The final image MUST have a strict ${l} aspect ratio. Do not deviate from this aspect ratio.`);const d=[...e?[{type:"Style",url:e}]:[],...r?[{type:"Scene",url:r}]:[],...a.map((t,s)=>({type:`Subject ${s+1}`,url:t})),...n.map((t,s)=>({type:`Scene Reference ${s+1}`,url:t}))];d.length>0&&(c+=`

Use the following images as crucial references for the final output. Adhere to their visual characteristics closely.`,d.forEach(t=>{i.push(A(t.url)),c+=`
- Reference for ${t.type}: [IMAGE]`})),i.push({text:c});const p=await h.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:i},config:{responseModalities:[g.IMAGE]}}),m=[];for(const t of p.candidates[0].content.parts)if(t.inlineData){const s=t.inlineData.data;m.push(`data:${t.inlineData.mimeType};base64,${s}`)}if(m.length===0)throw new Error("Gemini API did not return any image data.");return m}catch(i){throw console.error("Error generating image with Gemini API:",i),new Error(`Failed to generate image with Gemini: ${i instanceof Error?i.message:"Unknown error"}`)}},w=async o=>{const{provider:a,aspectRatio:e,model:r,...n}=o;if(a==="gemini"){const i={...n,aspectRatio:e};return E(i)}const h={...n,aspectRatio:{"16:9":"IMAGE_ASPECT_RATIO_LANDSCAPE","9:16":"IMAGE_ASPECT_RATIO_PORTRAIT","1:1":"IMAGE_ASPECT_RATIO_SQUARE"}[e],model:r};return f(h)},R=async o=>{const{provider:a,imageUrl:e,...r}=o;if(a==="lehuyducanh"){const n={...r,startImageUrl:e};return y(n)}throw new Error(`Video provider '${a}' is not supported.`)},M=async()=>{throw new Error("Video upscaling is disabled in this build.")};export{R as a,w as g,M as u};

import{j as r,r as i}from"./index-WZ944UgW.js";import{u as S,U as j,g as Be,c as Oe,r as N,a as Re,b as Le,t as te,s as _e,O as Ke,e as Ze,d as Je,S as We}from"./telegramService-Ba9-Zoq2.js";import{s as ze,c as Ye,m as oe,I as qe}from"./lehuyducanhService-p9mbsEAy.js";import{r as re,i as He}from"./media-CDZXYBSY.js";import{s as ne}from"./settingsService-CbIZ9NBp.js";import"./streetInterviewPrompts-Dzu83YwK.js";const Qe=[{value:"Kore",label:"Kore (Female)"},{value:"Puck",label:"Puck (Male)"},{value:"Charon",label:"Charon (Male)"},{value:"Fenrir",label:"Fenrir (Male)"},{value:"Zephyr",label:"Zephyr (Male)"}],Xe=({script:g,setScript:E,visualStyle:h,setVisualStyle:V,onGenerate:b,isGenerating:w,videoAspectRatio:d,setVideoAspectRatio:l,ttsVoice:k,setTtsVoice:u})=>r.jsxs("div",{className:"bg-gray-800 p-6 rounded-2xl border border-gray-700 shadow-lg flex flex-col gap-6",children:[r.jsxs("h3",{className:"text-xl font-bold text-blue-400 -mb-2",children:[r.jsx("i",{className:"fas fa-file-alt mr-2"}),"Explainer Content"]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"explainer-script",className:"block text-md font-bold text-blue-400 mb-2",children:"Script or Topic"}),r.jsx("textarea",{id:"explainer-script",value:g,onChange:p=>E(p.target.value),placeholder:"Paste your full explainer script here...",className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200 focus:ring-2 focus:ring-blue-500 transition duration-200",rows:12})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"visual-style",className:"block text-md font-bold text-blue-400 mb-2",children:"Global Visual Style"}),r.jsx("input",{id:"visual-style",type:"text",value:h,onChange:p=>V(p.target.value),placeholder:"e.g., minimalist 2D animation, claymation style, photorealistic stock footage",className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200 focus:ring-2 focus:ring-blue-500 transition duration-200"})]}),r.jsx("div",{className:"border-t-2 border-gray-700 -mx-6"}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("h3",{className:"text-lg font-bold text-blue-400 mb-2",children:[r.jsx("i",{className:"fas fa-cog mr-2"}),"Audio & Video Settings"]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"aspect-ratio-explainer",className:"block text-md font-bold text-blue-400 mb-2",children:[r.jsx("i",{className:"fas fa-ruler-combined mr-2"}),"Video Aspect Ratio"]}),r.jsxs("select",{id:"aspect-ratio-explainer",value:d,onChange:p=>l(p.target.value),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200",children:[r.jsx("option",{value:"16:9",children:"16:9 (Landscape)"}),r.jsx("option",{value:"9:16",children:"9:16 (Portrait)"})]})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"tts-voice-explainer",className:"block text-md font-bold text-blue-400 mb-2",children:"Voiceover Model"}),r.jsx("select",{id:"tts-voice-explainer",value:k,onChange:p=>u(p.target.value),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200",children:Qe.map(p=>r.jsx("option",{value:p.value,children:p.label},p.value))})]})]}),r.jsx("div",{className:"border-t-2 border-gray-700 -mx-6 pt-6",children:r.jsx("button",{onClick:b,disabled:w||!g||!h,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all text-lg flex items-center justify-center gap-2",title:!g||!h?"Please provide a script and visual style":"Generate Storyboard",children:w?r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"fas fa-spinner fa-spin"}),"Generating Storyboard..."]}):r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"fas fa-wand-magic-sparkles"}),"Generate Storyboard"]})})})]}),sa=({currentUser:g,onLogout:E})=>{const[h,V]=i.useState(""),[b,w]=i.useState(""),[d,l]=i.useState([]),[k,u]=i.useState(null),[p,B]=i.useState(!1),[G,O]=i.useState("Kore"),[v,R]=i.useState("16:9"),[I,L]=i.useState({}),[_,K]=i.useState(null),[se,Z]=i.useState(!1),[ie,J]=i.useState(!1),[le,W]=i.useState(!1),[de,z]=i.useState(!1),[ce,Y]=i.useState(!1),[q,H]=i.useState(!1),[C,Q]=i.useState(!1),[ge,X]=i.useState(!1),[me,ee]=i.useState(!1),[P,ue]=i.useState({storyboard:0,image:0,video:0}),y=i.useCallback(()=>{if(g){const o=S.getUsage(g);ue({storyboard:o.generateStoryboard.count,image:o.generateImage.count,video:o.generateVideo.count})}},[g]);i.useEffect(()=>{y()},[g,y]);const ae=i.useCallback(async()=>{if(!S.canPerformAction(g,"generateStoryboard")){alert(`Daily limit of ${j.generateStoryboard} storyboard generations reached.`);return}if(!h||!b){u("Please provide a script/topic and a visual style.");return}B(!0),u(null),l([]);try{const o=await ze(h,b);l(o),S.logAction(g,"generateStoryboard"),y()}catch(o){u(o instanceof Error?o.message:"An unknown error occurred.")}finally{B(!1)}},[h,b,g,y]),U=i.useCallback(async o=>{if(!S.canPerformAction(g,"generateImage"))throw new Error(`Daily image generation limit of ${j.generateImage} reached.`);const t=d.find(e=>e.id===o);if(t){l(e=>e.map(a=>a.id===o?{...a,isGeneratingImage:!0,imageGenerationError:null}:a));try{const e=I[o]||{},a=e.imageProvider||"lehuyducanh",n=e.referenceImages||[],s=await Promise.all(n.map(m=>re(m))),c=`${t.imagePrompt}, in the style of ${b}`,f=await Be({provider:a,prompt:c,referenceUrls:s,aspectRatio:v});l(m=>m.map(x=>x.id===o?{...x,images:[...x.images,...f],isGeneratingImage:!1}:x)),S.logAction(g,"generateImage"),y()}catch(e){const a=e instanceof Error?e.message:"Unknown image generation error.";throw l(n=>n.map(s=>s.id===o?{...s,isGeneratingImage:!1,imageGenerationError:a}:s)),e}}},[d,I,g,y,b,v]),pe=o=>{l(t=>{const e=t.length?t[Math.max(0,Math.min(o-1,t.length-1))]:void 0,a=e?{...e,id:crypto.randomUUID?crypto.randomUUID():`scene-${Date.now()}`,images:[...e.images],videos:(e.videos||[]).map(s=>({...s,isUpscaling:!1,upscaleError:null})),isGeneratingImage:!1,imageGenerationError:null,isGeneratingVideo:!1,videoGenerationError:null,isGeneratingAudio:!1,audioGenerationError:null,audioUrl:e.audioUrl}:oe({voiceoverScript:"New scene",voiceoverGuide:"Neutral tone",imagePrompt:"",videoPrompt:""}),n=[...t];return n.splice(o,0,a),n})},T=i.useCallback(async o=>{const t=d.find(e=>e.id===o);if(t){l(e=>e.map(a=>a.id===o?{...a,isGeneratingAudio:!0,audioGenerationError:null}:a));try{const e=await Ye(t.voiceoverScript,t.voiceoverGuide,G),a=Oe(e),n=URL.createObjectURL(a);l(s=>s.map(c=>c.id===o?{...c,audioUrl:n,isGeneratingAudio:!1}:c))}catch(e){const a=e instanceof Error?e.message:"An unknown audio generation error occurred.";l(n=>n.map(s=>s.id===o?{...s,isGeneratingAudio:!1,audioGenerationError:a}:s))}}},[d,G]),fe=i.useCallback(async()=>{const o=d.filter(e=>!e.audioUrl);if(o.length===0){alert("All scenes already have generated audio.");return}J(!0);const t=o.map(e=>()=>T(e.id));await N(t,5),J(!1)},[d,T]),F=i.useCallback(async(o,t)=>{const e=d.find(n=>n.id===o),a=e==null?void 0:e.videos[t];if(!a){console.error("handleUpscaleVideo could not find the video in state:",o,t);return}l(n=>n.map(s=>s.id===o?{...s,videos:s.videos.map((c,f)=>f===t?{...c,isUpscaling:!0,upscaleError:null}:c)}:s));try{const{videoUrl:n,publicUrl:s}=await Re({provider:"lehuyducanh",mediaGenerationId:a.mediaGenerationId,seed:a.seed}),c=s||n;l(f=>f.map(m=>m.id===o?{...m,videos:m.videos.map((x,$)=>$===t?{...x,upscaledUrl:c,isUpscaling:!1}:x)}:m))}catch(n){const s=n instanceof Error?n.message:"An unknown error occurred during upscale.";throw l(c=>c.map(f=>f.id===o?{...f,videos:f.videos.map((m,x)=>x===t?{...m,isUpscaling:!1,upscaleError:s}:m)}:f)),n}},[d]),he=(o,t)=>{l(e=>e.map(a=>{if(a.id!==o)return a;const n=[...a.videos];return n.splice(t,1),{...a,videos:n}}))},D=i.useCallback(async o=>{if(!S.canPerformAction(g,"generateVideo")){const e=`You have reached your daily limit of ${j.generateVideo} video generations.`;throw l(a=>a.map(n=>n.id===o?{...n,isGeneratingVideo:!1,videoGenerationError:e}:n)),new Error(e)}const t=d.find(e=>e.id===o);if(!t||!t.selectedImageForVideo){const e="Attempted to generate video without a selected image.";throw l(a=>a.map(n=>n.id===o?{...n,isGeneratingVideo:!1,videoGenerationError:e}:n)),new Error(e)}l(e=>e.map(a=>a.id===o?{...a,isGeneratingVideo:!0,videoGenerationError:null}:a));try{const e=await He(t.selectedImageForVideo);let a=`Global Visual Style: ${b}.

Voiceover: "${t.voiceoverScript}".

Motion/Action: ${t.videoPrompt}

No Music Background`;const{videoUrl:n,upscaledUrl:s,mediaGenerationId:c,seed:f,publicUrl:m,upscaledPublicUrl:x}=await Le({provider:"lehuyducanh",prompt:a,imageUrl:e,upscale:t.shouldUpscaleVideo,aspectRatio:v}),$={url:m||n,mediaGenerationId:c,seed:f,upscaledUrl:x||s};l(Me=>Me.map(A=>{if(A.id!==o)return A;const $e=[...A.videos||[],$];return{...A,videos:$e,isGeneratingVideo:!1}})),S.logAction(g,"generateVideo"),y()}catch(e){if(!(e instanceof Error&&e.message.includes("daily limit"))){const a=e instanceof Error?e.message:"An unknown error occurred.";l(n=>n.map(s=>s.id===o?{...s,isGeneratingVideo:!1,videoGenerationError:a}:s))}throw e}},[d,g,y,b,v]),be=i.useCallback(()=>{l(o=>o.map(t=>t.images.length>0?{...t,selectedImageForVideo:t.images[0]}:t)),alert("Picked the first available image for each scene as the video base!")},[]),xe=i.useCallback(async()=>{Z(!0);const o=d.filter(t=>t.images.length===0).map(t=>()=>U(t.id));await N(o,5),Z(!1)},[d,U]),ve=i.useCallback(async()=>{W(!0);const o=d.filter(t=>t.selectedImageForVideo&&(!t.videos||t.videos.length===0)).map(t=>()=>D(t.id));await N(o,5),W(!1)},[d,D]),ye=i.useCallback(async()=>{z(!0);const o=d.flatMap(t=>(t.videos||[]).map((e,a)=>({scene:t,video:e,index:a}))).filter(t=>t.video.url&&t.video.mediaGenerationId&&!t.video.upscaledUrl).map(t=>()=>F(t.scene.id,t.index));await N(o,5),z(!1)},[d,F]),Se=i.useCallback(async()=>{const{botToken:o,chatId:t}=ne.getTelegramConfig();if(!o||!t){alert("Please configure Telegram settings first in the Settings page.");return}const e=d.flatMap((a,n)=>a.images.map((s,c)=>({type:"photo",url:s,caption:`Scene ${n+1}: ${a.voiceoverScript}`,fileName:`${String(n+1).padStart(3,"0")}_image_${String(c+1).padStart(2,"0")}.jpg`})));if(e.length===0){alert("No generated images found to send.");return}X(!0),u(null);try{await te.sendMedia(e),alert("All images sent to Telegram successfully!")}catch(a){const n=a instanceof Error?a.message:"Failed to send images to Telegram.";u(n),alert(n)}finally{X(!1)}},[d]),je=i.useCallback(async()=>{const{botToken:o,chatId:t}=ne.getTelegramConfig();if(!o||!t){alert("Please configure Telegram settings first in the Settings page.");return}const e=d.flatMap((a,n)=>(a.videos||[]).map((s,c)=>({type:"video",url:s.upscaledUrl||s.url,caption:`Scene ${n+1}: ${a.voiceoverScript}`,fileName:`${String(n+1).padStart(3,"0")}_video_${String(c+1).padStart(2,"0")}.mp4`}))).filter(a=>a.url);if(e.length===0){alert("No videos found to send.");return}ee(!0),u(null);try{await te.sendMedia(e),alert("All videos sent to Telegram successfully!")}catch(a){const n=a instanceof Error?a.message:"Failed to send videos to Telegram.";u(n),alert(n)}finally{ee(!1)}},[d]),M=d.length>0,Ve=i.useCallback(async()=>{if(!M){alert("Please generate a storyboard before saving.");return}H(!0),u(null);try{const t=JSON.stringify({version:"1.2.0-explainer",script:h,visualStyle:b,scenes:d,sceneOverrides:I,ttsVoice:G,videoAspectRatio:v},null,2),e=new Blob([t],{type:"application/json"}),a=(h.substring(0,20).trim().replace(/[\s/]+/g,"-")||"explainer-project").toLowerCase();_e(e,`${a}.evdproj`)}catch(o){const t=o instanceof Error?o.message:"An unknown error occurred during saving.";u(t),alert(`Failed to save project: ${t}`)}finally{H(!1)}},[d,h,b,I,G,M,v]),we=i.useCallback(async o=>{var e,a;const t=(e=o.target.files)==null?void 0:e[0];if(t){Q(!0),u(null);try{const n=await t.text(),s=JSON.parse(n);if(!((a=s.version)!=null&&a.includes("-explainer")))throw new Error("Invalid or incompatible project file. Please import a .evdproj file.");V(s.script||""),w(s.visualStyle||""),O(s.ttsVoice||"Kore"),L(s.sceneOverrides||{}),R(s.videoAspectRatio||"16:9");const f=(s.scenes||[]).map(m=>({...oe({}),...m,videos:m.videos||[]}));l(f),alert("Project imported successfully!")}catch(n){const s=n instanceof Error?n.message:"An unknown error occurred during import.";u(s),alert(`Failed to import project: ${s}`)}finally{Q(!1)}}},[]),Ge=o=>{window.confirm("Are you sure you want to delete this scene? This action cannot be undone.")&&l(t=>t.filter(e=>e.id!==o))},Ie=(o,t)=>{l(e=>e.map(a=>a.id===o?{...a,includeDialogueInPrompt:t}:a))},Ae=i.useCallback(async(o,t)=>{alert("Enhanced prompt generation is coming soon for Explainer videos!")},[]),Ne=(o,t,e)=>L(a=>({...a,[o]:{...a[o],[t]:e}})),Ee=(o,t)=>l(e=>e.map(a=>a.id===o?{...a,imagePrompt:t}:a)),ke=(o,t)=>l(e=>e.map(a=>a.id===o?{...a,videoPrompt:t}:a)),Ce=(o,t)=>l(e=>e.map(a=>a.id===o?{...a,voiceoverGuide:t}:a)),Pe=(o,t,e)=>l(a=>a.map(n=>n.id===o?{...n,[t]:e}:n)),Ue=(o,t)=>l(e=>e.map(a=>a.id!==o?a:{...a,images:a.images.filter(n=>n!==t),selectedImageForVideo:a.selectedImageForVideo===t?void 0:a.selectedImageForVideo})),Te=(o,t)=>l(e=>e.map(a=>a.id===o?{...a,selectedImageForVideo:t,videos:[],videoGenerationError:null}:a)),Fe=async(o,t)=>{try{const e=await re(t);l(a=>a.map(n=>n.id===o?{...n,images:[...n.images,e],selectedImageForVideo:e,videos:[],videoGenerationError:null}:n))}catch{u("Failed to process the uploaded image.")}},De=o=>l(t=>t.map(e=>e.id===o?{...e,shouldUpscaleVideo:!e.shouldUpscaleVideo}:e));return r.jsxs(r.Fragment,{children:[r.jsxs("header",{className:"py-4 px-8 bg-gray-800 shadow-lg border-b border-gray-700 shrink-0 flex justify-between items-center",children:[r.jsxs("div",{children:[r.jsxs("h1",{className:"text-3xl font-bold text-blue-400",children:[r.jsx("i",{className:"fas fa-chalkboard-teacher mr-3"}),"Explainer Video Footage"]}),r.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Generate libraries of stylistically consistent B-roll footage."})]}),r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("div",{className:"flex gap-2",children:[r.jsx("label",{htmlFor:"import-explainer-project",className:`text-center bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-full transition-all duration-300 flex items-center justify-center gap-2 text-sm shadow-sm ${C?"cursor-not-allowed opacity-50":"cursor-pointer"}`,children:C?r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"fas fa-spinner fa-spin"}),"..."]}):r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"fas fa-folder-open"}),"Import"]})}),r.jsx("input",{id:"import-explainer-project",type:"file",accept:".evdproj",className:"hidden",onChange:we,disabled:C}),r.jsx("button",{onClick:Ve,disabled:q||!M,className:"bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-sm shadow-sm",children:q?r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"fas fa-spinner fa-spin"}),"..."]}):r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"fas fa-save"}),"Save"]})})]}),r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("div",{className:"text-right",children:[r.jsxs("span",{className:"text-gray-300 font-medium",children:["Welcome, ",r.jsx("span",{className:"font-bold text-blue-400",children:g}),"!"]}),r.jsxs("div",{className:"text-xs text-gray-400 bg-gray-700 px-2 py-1 rounded-md mt-1 flex gap-x-2",children:["Usage: ",r.jsxs("span",{title:"Storyboards",children:[r.jsx("i",{className:"fas fa-file-alt"})," ",P.storyboard,"/",j.generateStoryboard]})," |",r.jsxs("span",{title:"Images",children:[r.jsx("i",{className:"fas fa-image"})," ",P.image,"/",j.generateImage]})," |",r.jsxs("span",{title:"Videos",children:[r.jsx("i",{className:"fas fa-video"})," ",P.video,"/",j.generateVideo]})]})]}),r.jsx("button",{onClick:E,className:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-full",children:"Logout"})]})]})]}),r.jsx("main",{className:"flex-1 overflow-y-auto p-4 md:p-8",children:r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 xl:grid-cols-4 gap-8 items-start",children:[r.jsx("div",{className:"lg:sticky lg:top-8 xl:col-span-1",children:r.jsx(Xe,{script:h,setScript:V,visualStyle:b,setVisualStyle:w,onGenerate:ae,isGenerating:p,videoAspectRatio:v,setVideoAspectRatio:R,ttsVoice:G,setTtsVoice:O})}),r.jsx("div",{className:"lg:col-span-2 xl:col-span-3",children:r.jsx(Ke,{generationStep:d.length>0?"prompts_generated":"input",scenes:d,isLoading:p,isGeneratingPrompts:!1,error:k,voiceoverScript:h,onVoiceoverScriptChange:V,onGeneratePrompts:ae,sceneOverrides:I,onGenerateImage:U,onSceneImagePromptChange:Ee,onSceneVideoPromptChange:ke,onSceneVoiceoverGuideChange:Ce,onSceneEnhancementChange:Pe,onSceneOverrideChange:Ne,onDeleteImage:Ue,onViewImage:K,onUploadImageForVideo:Fe,onGenerateAllImages:xe,isBatchGenerating:se,onViewStoryboard:()=>Y(!0),onDownloadAllImages:()=>Je(d),isDownloadingImages:!1,onDownloadAllVideos:()=>Ze(d),isDownloadingVideos:!1,onSelectImageForVideo:Te,onGenerateVideo:D,onToggleVideoUpscale:De,onUpscaleVideo:F,onGenerateAllVideos:ve,isBatchGeneratingVideos:le,onUpscaleAllVideos:ye,isBatchUpscalingVideos:de,generatedEnvironments:[],onGenerateAudio:T,onGenerateAllAudio:fe,isBatchGeneratingAudio:ie,activeModule:"explainer",onAddScene:pe,onPickAllImages:be,onSendAllImagesToTelegram:Se,isSendingImagesToTelegram:ge,onSendAllVideosToTelegram:je,isSendingVideosToTelegram:me,videoAspectRatio:v,onToggleDialogueInPrompt:Ie,onDeleteScene:Ge,onGenerateEnhancedPrompt:Ae,onDeleteVideo:he})})]})}),_&&r.jsx(qe,{imageUrl:_,onClose:()=>K(null)}),ce&&r.jsx(We,{scenes:d,onClose:()=>Y(!1),videoAspectRatio:v})]})};export{sa as default};

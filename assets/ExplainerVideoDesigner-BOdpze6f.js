import{j as r,r as i}from"./index-CRGght61.js";import{u as S,U as j,g as Me,c as $e,r as N,a as Be,b as Oe,t as ae,s as Re,O as Le,e as _e,d as Ke,S as Ze}from"./telegramService-wrTyrj_M.js";import{s as Je,c as We,m as te,I as ze}from"./lehuyducanhService-BuhKn-w0.js";import{r as oe,i as Ye}from"./media-CDZXYBSY.js";import{s as re}from"./settingsService-CbIZ9NBp.js";import"./streetInterviewPrompts-Dzu83YwK.js";const qe=[{value:"Kore",label:"Kore (Female)"},{value:"Puck",label:"Puck (Male)"},{value:"Charon",label:"Charon (Male)"},{value:"Fenrir",label:"Fenrir (Male)"},{value:"Zephyr",label:"Zephyr (Male)"}],He=({script:g,setScript:k,visualStyle:h,setVisualStyle:V,onGenerate:b,isGenerating:w,videoAspectRatio:d,setVideoAspectRatio:l,ttsVoice:C,setTtsVoice:p})=>r.jsxs("div",{className:"bg-gray-800 p-6 rounded-2xl border border-gray-700 shadow-lg flex flex-col gap-6",children:[r.jsxs("h3",{className:"text-xl font-bold text-blue-400 -mb-2",children:[r.jsx("i",{className:"fas fa-file-alt mr-2"}),"Explainer Content"]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"explainer-script",className:"block text-md font-bold text-blue-400 mb-2",children:"Script or Topic"}),r.jsx("textarea",{id:"explainer-script",value:g,onChange:u=>k(u.target.value),placeholder:"Paste your full explainer script here...",className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200 focus:ring-2 focus:ring-blue-500 transition duration-200",rows:12})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"visual-style",className:"block text-md font-bold text-blue-400 mb-2",children:"Global Visual Style"}),r.jsx("input",{id:"visual-style",type:"text",value:h,onChange:u=>V(u.target.value),placeholder:"e.g., minimalist 2D animation, claymation style, photorealistic stock footage",className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200 focus:ring-2 focus:ring-blue-500 transition duration-200"})]}),r.jsx("div",{className:"border-t-2 border-gray-700 -mx-6"}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("h3",{className:"text-lg font-bold text-blue-400 mb-2",children:[r.jsx("i",{className:"fas fa-cog mr-2"}),"Audio & Video Settings"]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"aspect-ratio-explainer",className:"block text-md font-bold text-blue-400 mb-2",children:[r.jsx("i",{className:"fas fa-ruler-combined mr-2"}),"Video Aspect Ratio"]}),r.jsxs("select",{id:"aspect-ratio-explainer",value:d,onChange:u=>l(u.target.value),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200",children:[r.jsx("option",{value:"16:9",children:"16:9 (Landscape)"}),r.jsx("option",{value:"9:16",children:"9:16 (Portrait)"})]})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"tts-voice-explainer",className:"block text-md font-bold text-blue-400 mb-2",children:"Voiceover Model"}),r.jsx("select",{id:"tts-voice-explainer",value:C,onChange:u=>p(u.target.value),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200",children:qe.map(u=>r.jsx("option",{value:u.value,children:u.label},u.value))})]})]}),r.jsx("div",{className:"border-t-2 border-gray-700 -mx-6 pt-6",children:r.jsx("button",{onClick:b,disabled:w||!g||!h,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all text-lg flex items-center justify-center gap-2",title:!g||!h?"Please provide a script and visual style":"Generate Storyboard",children:w?r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"fas fa-spinner fa-spin"}),"Generating Storyboard..."]}):r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"fas fa-wand-magic-sparkles"}),"Generate Storyboard"]})})})]}),ra=({currentUser:g,onLogout:k})=>{const[h,V]=i.useState(""),[b,w]=i.useState(""),[d,l]=i.useState([]),[C,p]=i.useState(null),[u,$]=i.useState(!1),[G,B]=i.useState("Kore"),[x,O]=i.useState("16:9"),[A,R]=i.useState({}),[L,_]=i.useState(null),[se,K]=i.useState(!1),[ne,Z]=i.useState(!1),[ie,J]=i.useState(!1),[le,W]=i.useState(!1),[de,z]=i.useState(!1),[Y,q]=i.useState(!1),[E,H]=i.useState(!1),[ce,Q]=i.useState(!1),[ge,X]=i.useState(!1),[P,me]=i.useState({storyboard:0,image:0,video:0}),v=i.useCallback(()=>{if(g){const o=S.getUsage(g);me({storyboard:o.generateStoryboard.count,image:o.generateImage.count,video:o.generateVideo.count})}},[g]);i.useEffect(()=>{v()},[g,v]);const ee=i.useCallback(async()=>{if(!S.canPerformAction(g,"generateStoryboard")){alert(`Daily limit of ${j.generateStoryboard} storyboard generations reached.`);return}if(!h||!b){p("Please provide a script/topic and a visual style.");return}$(!0),p(null),l([]);try{const o=await Je(h,b);l(o),S.logAction(g,"generateStoryboard"),v()}catch(o){p(o instanceof Error?o.message:"An unknown error occurred.")}finally{$(!1)}},[h,b,g,v]),T=i.useCallback(async o=>{if(!S.canPerformAction(g,"generateImage"))throw new Error(`Daily image generation limit of ${j.generateImage} reached.`);const t=d.find(a=>a.id===o);if(t){l(a=>a.map(e=>e.id===o?{...e,isGeneratingImage:!0,imageGenerationError:null}:e));try{const a=A[o]||{},e=a.imageProvider||"lehuyducanh",s=a.referenceImages||[],n=await Promise.all(s.map(f=>oe(f))),c=`${t.imagePrompt}, in the style of ${b}`,m=await Me({provider:e,prompt:c,referenceUrls:n,aspectRatio:x});l(f=>f.map(y=>y.id===o?{...y,images:[...y.images,...m],isGeneratingImage:!1}:y)),S.logAction(g,"generateImage"),v()}catch(a){const e=a instanceof Error?a.message:"Unknown image generation error.";throw l(s=>s.map(n=>n.id===o?{...n,isGeneratingImage:!1,imageGenerationError:e}:n)),a}}},[d,A,g,v,b,x]),pe=o=>{const t=te({voiceoverScript:"New scene",voiceoverGuide:"Neutral tone",imagePrompt:"",videoPrompt:""});l(a=>{const e=[...a];return e.splice(o,0,t),e})},F=i.useCallback(async o=>{const t=d.find(a=>a.id===o);if(t){l(a=>a.map(e=>e.id===o?{...e,isGeneratingAudio:!0,audioGenerationError:null}:e));try{const a=await We(t.voiceoverScript,t.voiceoverGuide,G),e=$e(a),s=URL.createObjectURL(e);l(n=>n.map(c=>c.id===o?{...c,audioUrl:s,isGeneratingAudio:!1}:c))}catch(a){const e=a instanceof Error?a.message:"An unknown audio generation error occurred.";l(s=>s.map(n=>n.id===o?{...n,isGeneratingAudio:!1,audioGenerationError:e}:n))}}},[d,G]),ue=i.useCallback(async()=>{const o=d.filter(a=>!a.audioUrl);if(o.length===0){alert("All scenes already have generated audio.");return}Z(!0);const t=o.map(a=>()=>F(a.id));await N(t,5),Z(!1)},[d,F]),U=i.useCallback(async(o,t)=>{const a=d.find(s=>s.id===o),e=a==null?void 0:a.videos[t];if(!e){console.error("handleUpscaleVideo could not find the video in state:",o,t);return}l(s=>s.map(n=>n.id===o?{...n,videos:n.videos.map((c,m)=>m===t?{...c,isUpscaling:!0,upscaleError:null}:c)}:n));try{const s=await Be({provider:"lehuyducanh",mediaGenerationId:e.mediaGenerationId,seed:e.seed});l(n=>n.map(c=>c.id===o?{...c,videos:c.videos.map((m,f)=>f===t?{...m,upscaledUrl:s,isUpscaling:!1}:m)}:c))}catch(s){const n=s instanceof Error?s.message:"An unknown error occurred during upscale.";throw l(c=>c.map(m=>m.id===o?{...m,videos:m.videos.map((f,y)=>y===t?{...f,isUpscaling:!1,upscaleError:n}:f)}:m)),s}},[d]),fe=(o,t)=>{l(a=>a.map(e=>{if(e.id!==o)return e;const s=[...e.videos];return s.splice(t,1),{...e,videos:s}}))},D=i.useCallback(async o=>{if(!S.canPerformAction(g,"generateVideo")){const a=`You have reached your daily limit of ${j.generateVideo} video generations.`;throw l(e=>e.map(s=>s.id===o?{...s,isGeneratingVideo:!1,videoGenerationError:a}:s)),new Error(a)}const t=d.find(a=>a.id===o);if(!t||!t.selectedImageForVideo){const a="Attempted to generate video without a selected image.";throw l(e=>e.map(s=>s.id===o?{...s,isGeneratingVideo:!1,videoGenerationError:a}:s)),new Error(a)}l(a=>a.map(e=>e.id===o?{...e,isGeneratingVideo:!0,videoGenerationError:null}:e));try{const a=await Ye(t.selectedImageForVideo);let e=`Global Visual Style: ${b}.

Voiceover: "${t.voiceoverScript}".

Motion/Action: ${t.videoPrompt}

No Music Background`;const{videoUrl:s,upscaledUrl:n,mediaGenerationId:c,seed:m}=await Oe({provider:"lehuyducanh",prompt:e,imageUrl:a,upscale:t.shouldUpscaleVideo,aspectRatio:x}),f={url:s,mediaGenerationId:c,seed:m,upscaledUrl:n};l(y=>y.map(I=>{if(I.id!==o)return I;const De=[...I.videos||[],f];return{...I,videos:De,isGeneratingVideo:!1}})),S.logAction(g,"generateVideo"),v()}catch(a){if(!(a instanceof Error&&a.message.includes("daily limit"))){const e=a instanceof Error?a.message:"An unknown error occurred.";l(s=>s.map(n=>n.id===o?{...n,isGeneratingVideo:!1,videoGenerationError:e}:n))}throw a}},[d,g,v,b,x]),he=i.useCallback(()=>{l(o=>o.map(t=>t.images.length>0?{...t,selectedImageForVideo:t.images[0]}:t)),alert("Picked the first available image for each scene as the video base!")},[]),be=i.useCallback(async()=>{K(!0);const o=d.filter(t=>t.images.length===0).map(t=>()=>T(t.id));await N(o,5),K(!1)},[d,T]),xe=i.useCallback(async()=>{J(!0);const o=d.filter(t=>t.selectedImageForVideo&&(!t.videos||t.videos.length===0)).map(t=>()=>D(t.id));await N(o,5),J(!1)},[d,D]),ve=i.useCallback(async()=>{W(!0);const o=d.flatMap(t=>(t.videos||[]).map((a,e)=>({scene:t,video:a,index:e}))).filter(t=>t.video.url&&t.video.mediaGenerationId&&!t.video.upscaledUrl).map(t=>()=>U(t.scene.id,t.index));await N(o,5),W(!1)},[d,U]),ye=i.useCallback(async()=>{const{botToken:o,chatId:t}=re.getTelegramConfig();if(!o||!t){alert("Please configure Telegram settings first in the Settings page.");return}const a=d.flatMap((e,s)=>e.images.map((n,c)=>({type:"photo",url:n,caption:`Scene ${s+1}: ${e.voiceoverScript}`,fileName:`${String(s+1).padStart(3,"0")}_image_${String(c+1).padStart(2,"0")}.jpg`})));if(a.length===0){alert("No generated images found to send.");return}Q(!0),p(null);try{await ae.sendMedia(a),alert("All images sent to Telegram successfully!")}catch(e){const s=e instanceof Error?e.message:"Failed to send images to Telegram.";p(s),alert(s)}finally{Q(!1)}},[d]),Se=i.useCallback(async()=>{const{botToken:o,chatId:t}=re.getTelegramConfig();if(!o||!t){alert("Please configure Telegram settings first in the Settings page.");return}const a=d.flatMap((e,s)=>(e.videos||[]).map((n,c)=>({type:"video",url:n.upscaledUrl||n.url,caption:`Scene ${s+1}: ${e.voiceoverScript}`,fileName:`${String(s+1).padStart(3,"0")}_video_${String(c+1).padStart(2,"0")}.mp4`}))).filter(e=>e.url);if(a.length===0){alert("No videos found to send.");return}X(!0),p(null);try{await ae.sendMedia(a),alert("All videos sent to Telegram successfully!")}catch(e){const s=e instanceof Error?e.message:"Failed to send videos to Telegram.";p(s),alert(s)}finally{X(!1)}},[d]),M=d.length>0,je=i.useCallback(async()=>{if(!M){alert("Please generate a storyboard before saving.");return}q(!0),p(null);try{const t=JSON.stringify({version:"1.2.0-explainer",script:h,visualStyle:b,scenes:d,sceneOverrides:A,ttsVoice:G,videoAspectRatio:x},null,2),a=new Blob([t],{type:"application/json"}),e=(h.substring(0,20).trim().replace(/[\s/]+/g,"-")||"explainer-project").toLowerCase();Re(a,`${e}.evdproj`)}catch(o){const t=o instanceof Error?o.message:"An unknown error occurred during saving.";p(t),alert(`Failed to save project: ${t}`)}finally{q(!1)}},[d,h,b,A,G,M,x]),Ve=i.useCallback(async o=>{var a,e;const t=(a=o.target.files)==null?void 0:a[0];if(t){H(!0),p(null);try{const s=await t.text(),n=JSON.parse(s);if(!((e=n.version)!=null&&e.includes("-explainer")))throw new Error("Invalid or incompatible project file. Please import a .evdproj file.");V(n.script||""),w(n.visualStyle||""),B(n.ttsVoice||"Kore"),R(n.sceneOverrides||{}),O(n.videoAspectRatio||"16:9");const m=(n.scenes||[]).map(f=>({...te({}),...f,videos:f.videos||[]}));l(m),alert("Project imported successfully!")}catch(s){const n=s instanceof Error?s.message:"An unknown error occurred during import.";p(n),alert(`Failed to import project: ${n}`)}finally{H(!1)}}},[]),we=o=>{window.confirm("Are you sure you want to delete this scene? This action cannot be undone.")&&l(t=>t.filter(a=>a.id!==o))},Ge=(o,t)=>{l(a=>a.map(e=>e.id===o?{...e,includeDialogueInPrompt:t}:e))},Ae=i.useCallback(async(o,t)=>{alert("Enhanced prompt generation is coming soon for Explainer videos!")},[]),Ie=(o,t,a)=>R(e=>({...e,[o]:{...e[o],[t]:a}})),Ne=(o,t)=>l(a=>a.map(e=>e.id===o?{...e,imagePrompt:t}:e)),ke=(o,t)=>l(a=>a.map(e=>e.id===o?{...e,videoPrompt:t}:e)),Ce=(o,t)=>l(a=>a.map(e=>e.id===o?{...e,voiceoverGuide:t}:e)),Ee=(o,t,a)=>l(e=>e.map(s=>s.id===o?{...s,[t]:a}:s)),Pe=(o,t)=>l(a=>a.map(e=>e.id!==o?e:{...e,images:e.images.filter(s=>s!==t),selectedImageForVideo:e.selectedImageForVideo===t?void 0:e.selectedImageForVideo})),Te=(o,t)=>l(a=>a.map(e=>e.id===o?{...e,selectedImageForVideo:t,videos:[],videoGenerationError:null}:e)),Fe=async(o,t)=>{try{const a=await oe(t);l(e=>e.map(s=>s.id===o?{...s,images:[...s.images,a],selectedImageForVideo:a,videos:[],videoGenerationError:null}:s))}catch{p("Failed to process the uploaded image.")}},Ue=o=>l(t=>t.map(a=>a.id===o?{...a,shouldUpscaleVideo:!a.shouldUpscaleVideo}:a));return r.jsxs(r.Fragment,{children:[r.jsxs("header",{className:"py-4 px-8 bg-gray-800 shadow-lg border-b border-gray-700 shrink-0 flex justify-between items-center",children:[r.jsxs("div",{children:[r.jsxs("h1",{className:"text-3xl font-bold text-blue-400",children:[r.jsx("i",{className:"fas fa-chalkboard-teacher mr-3"}),"Explainer Video Footage"]}),r.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Generate libraries of stylistically consistent B-roll footage."})]}),r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("div",{className:"flex gap-2",children:[r.jsx("label",{htmlFor:"import-explainer-project",className:`text-center bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-full transition-all duration-300 flex items-center justify-center gap-2 text-sm shadow-sm ${E?"cursor-not-allowed opacity-50":"cursor-pointer"}`,children:E?r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"fas fa-spinner fa-spin"}),"..."]}):r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"fas fa-folder-open"}),"Import"]})}),r.jsx("input",{id:"import-explainer-project",type:"file",accept:".evdproj",className:"hidden",onChange:Ve,disabled:E}),r.jsx("button",{onClick:je,disabled:Y||!M,className:"bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-sm shadow-sm",children:Y?r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"fas fa-spinner fa-spin"}),"..."]}):r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"fas fa-save"}),"Save"]})})]}),r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("div",{className:"text-right",children:[r.jsxs("span",{className:"text-gray-300 font-medium",children:["Welcome, ",r.jsx("span",{className:"font-bold text-blue-400",children:g}),"!"]}),r.jsxs("div",{className:"text-xs text-gray-400 bg-gray-700 px-2 py-1 rounded-md mt-1 flex gap-x-2",children:["Usage: ",r.jsxs("span",{title:"Storyboards",children:[r.jsx("i",{className:"fas fa-file-alt"})," ",P.storyboard,"/",j.generateStoryboard]})," |",r.jsxs("span",{title:"Images",children:[r.jsx("i",{className:"fas fa-image"})," ",P.image,"/",j.generateImage]})," |",r.jsxs("span",{title:"Videos",children:[r.jsx("i",{className:"fas fa-video"})," ",P.video,"/",j.generateVideo]})]})]}),r.jsx("button",{onClick:k,className:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-full",children:"Logout"})]})]})]}),r.jsx("main",{className:"flex-1 overflow-y-auto p-4 md:p-8",children:r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 xl:grid-cols-4 gap-8 items-start",children:[r.jsx("div",{className:"lg:sticky lg:top-8 xl:col-span-1",children:r.jsx(He,{script:h,setScript:V,visualStyle:b,setVisualStyle:w,onGenerate:ee,isGenerating:u,videoAspectRatio:x,setVideoAspectRatio:O,ttsVoice:G,setTtsVoice:B})}),r.jsx("div",{className:"lg:col-span-2 xl:col-span-3",children:r.jsx(Le,{generationStep:d.length>0?"prompts_generated":"input",scenes:d,isLoading:u,isGeneratingPrompts:!1,error:C,voiceoverScript:h,onVoiceoverScriptChange:V,onGeneratePrompts:ee,sceneOverrides:A,onGenerateImage:T,onSceneImagePromptChange:Ne,onSceneVideoPromptChange:ke,onSceneVoiceoverGuideChange:Ce,onSceneEnhancementChange:Ee,onSceneOverrideChange:Ie,onDeleteImage:Pe,onViewImage:_,onUploadImageForVideo:Fe,onGenerateAllImages:be,isBatchGenerating:se,onViewStoryboard:()=>z(!0),onDownloadAllImages:()=>Ke(d),isDownloadingImages:!1,onDownloadAllVideos:()=>_e(d),isDownloadingVideos:!1,onSelectImageForVideo:Te,onGenerateVideo:D,onToggleVideoUpscale:Ue,onUpscaleVideo:U,onGenerateAllVideos:xe,isBatchGeneratingVideos:ie,onUpscaleAllVideos:ve,isBatchUpscalingVideos:le,generatedEnvironments:[],onGenerateAudio:F,onGenerateAllAudio:ue,isBatchGeneratingAudio:ne,activeModule:"explainer",onAddScene:pe,onPickAllImages:he,onSendAllImagesToTelegram:ye,isSendingImagesToTelegram:ce,onSendAllVideosToTelegram:Se,isSendingVideosToTelegram:ge,videoAspectRatio:x,onToggleDialogueInPrompt:Ge,onDeleteScene:we,onGenerateEnhancedPrompt:Ae,onDeleteVideo:fe})})]})}),L&&r.jsx(ze,{imageUrl:L,onClose:()=>_(null)}),de&&r.jsx(Ze,{scenes:d,onClose:()=>z(!1),videoAspectRatio:x})]})};export{ra as default};

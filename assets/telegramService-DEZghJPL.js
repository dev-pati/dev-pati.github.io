import{c as ge,g as Be,r as Se,j as n,R as We}from"./index-3Ior5TtI.js";import{k as $e,l as Ze,y as He,z as Ke}from"./lehuyducanhService-Ba6mGdSt.js";import{M as Ye}from"./streetInterviewPrompts-Dzu83YwK.js";import{s as qe}from"./settingsService-CbIZ9NBp.js";var je={exports:{}},Xe=je.exports,Ie;function Je(){return Ie||(Ie=1,(function(k,$){(function(h,S){S()})(Xe,function(){function h(f,g){return typeof g>"u"?g={autoBom:!1}:typeof g!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),g={autoBom:!g}),g.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(f.type)?new Blob(["\uFEFF",f],{type:f.type}):f}function S(f,g,x){var u=new XMLHttpRequest;u.open("GET",f),u.responseType="blob",u.onload=function(){l(u.response,g,x)},u.onerror=function(){console.error("could not download file")},u.send()}function y(f){var g=new XMLHttpRequest;g.open("HEAD",f,!1);try{g.send()}catch{}return 200<=g.status&&299>=g.status}function o(f){try{f.dispatchEvent(new MouseEvent("click"))}catch{var g=document.createEvent("MouseEvents");g.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),f.dispatchEvent(g)}}var a=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof ge=="object"&&ge.global===ge?ge:void 0,r=a.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),l=a.saveAs||(typeof window!="object"||window!==a?function(){}:"download"in HTMLAnchorElement.prototype&&!r?function(f,g,x){var u=a.URL||a.webkitURL,i=document.createElement("a");g=g||f.name||"download",i.download=g,i.rel="noopener",typeof f=="string"?(i.href=f,i.origin===location.origin?o(i):y(i.href)?S(f,g,x):o(i,i.target="_blank")):(i.href=u.createObjectURL(f),setTimeout(function(){u.revokeObjectURL(i.href)},4e4),setTimeout(function(){o(i)},0))}:"msSaveOrOpenBlob"in navigator?function(f,g,x){if(g=g||f.name||"download",typeof f!="string")navigator.msSaveOrOpenBlob(h(f,x),g);else if(y(f))S(f,g,x);else{var u=document.createElement("a");u.href=f,u.target="_blank",setTimeout(function(){o(u)})}}:function(f,g,x,u){if(u=u||open("","_blank"),u&&(u.document.title=u.document.body.innerText="downloading..."),typeof f=="string")return S(f,g,x);var i=f.type==="application/octet-stream",b=/constructor/i.test(a.HTMLElement)||a.safari,s=/CriOS\/[\d]+/.test(navigator.userAgent);if((s||i&&b||r)&&typeof FileReader<"u"){var p=new FileReader;p.onloadend=function(){var w=p.result;w=s?w:w.replace(/^data:[^;]*;/,"data:attachment/file;"),u?u.location.href=w:location=w,u=null},p.readAsDataURL(f)}else{var d=a.URL||a.webkitURL,v=d.createObjectURL(f);u?u.location=v:location.href=v,u=null,setTimeout(function(){d.revokeObjectURL(v)},4e4)}});a.saveAs=l.saveAs=l,k.exports=l})})(je)),je.exports}var Qe=Je();const De=Be(Qe),et=["Eye Level","High Angle","Low Angle","Dutch Angle","Bird's-Eye View","Worm's-Eye View","Over-the-Shoulder"],tt=["Static","Pan Left","Pan Right","Tilt Up","Tilt Down","Zoom In","Zoom Out","Dolly In","Dolly Out","Crane Up","Crane Down","Tracking Shot"],rt=["Normal Speed","Slow Motion","Fast Motion (Timelapse)","Bullet Time","Split Screen","Rack Focus"],nt=({scene:k,onImagePromptChange:$,onVideoPromptChange:h,onSceneVoiceoverGuideChange:S,onSceneEnhancementChange:y,onGenerateAudio:o,onToggleDialogueInPrompt:a,onGenerateEnhancedPrompt:r,onSceneVoiceoverScriptChange:l})=>{const[f,g]=Se.useState({image:!1,video:!1}),x=(u,i)=>{navigator.clipboard.writeText(u),g({image:i==="image",video:i==="video"}),setTimeout(()=>g({image:!1,video:!1}),2e3)};return n.jsxs("div",{className:"bg-slate-800 p-4 rounded-lg border border-slate-700 flex flex-col gap-4 h-full",children:[n.jsxs("div",{className:"bg-gray-800 p-3 rounded-md border border-gray-700",children:[n.jsxs("h4",{className:"font-bold text-sm text-blue-400 mb-2",children:[n.jsx("i",{className:"fas fa-microphone-alt mr-2"}),"Voiceover"]}),l?n.jsx("textarea",{value:k.voiceoverScript,onChange:u=>l(k.id,u.target.value),placeholder:"Edit voiceover script...",className:"w-full bg-gray-700 border border-gray-600 rounded-md p-2 text-gray-300 italic mb-2 focus:ring-2 focus:ring-blue-500",rows:3}):n.jsxs("blockquote",{className:"border-l-4 border-blue-500 pl-3 text-gray-300 italic mb-2",children:['"',k.voiceoverScript,'"']}),n.jsx("textarea",{value:k.voiceoverGuide,onChange:u=>S(k.id,u.target.value),placeholder:"Edit voiceover delivery guide...",className:"w-full bg-gray-700 border border-gray-600 rounded-md p-2 text-gray-300 text-xs focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 resize-y",rows:2}),n.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-700/50",children:[k.isGeneratingAudio?n.jsxs("div",{className:"flex items-center justify-center text-sm text-gray-400",children:[n.jsx("i",{className:"fas fa-spinner fa-spin mr-2"})," Generating audio..."]}):k.audioUrl?n.jsx("audio",{controls:!0,src:k.audioUrl,className:"w-full h-8"}):n.jsxs("button",{onClick:()=>o(k.id),className:"w-full bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-1 px-2 rounded-md text-xs flex items-center justify-center gap-1 transition-colors",children:[n.jsx("i",{className:"fas fa-volume-up"})," Generate Audio"]}),k.audioGenerationError&&n.jsx("p",{className:"text-red-400 text-xs mt-1 text-center",children:k.audioGenerationError})]})]}),n.jsxs("div",{className:"space-y-4 flex-grow flex flex-col",children:[n.jsxs("div",{className:"bg-gray-800 p-3 rounded-md border border-gray-700 flex-grow flex flex-col gap-2",children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsxs("h4",{className:"font-bold text-sm text-blue-400",children:[n.jsx("i",{className:"fas fa-image mr-2"}),"Image Prompt (Start Frame)"]}),n.jsx("button",{onClick:()=>r(k.id,"image"),disabled:k.isGeneratingImagePrompt,className:"text-xs font-semibold text-purple-400 hover:text-purple-300 disabled:text-gray-500 disabled:cursor-not-allowed transition-colors flex items-center gap-1",title:"Use AI to suggest a better prompt",children:k.isGeneratingImagePrompt?n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"fas fa-spinner fa-spin"}),"Suggesting..."]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"fas fa-wand-magic-sparkles"}),"AI Prompt"]})})]}),n.jsxs("div",{className:"relative group flex-grow",children:[n.jsx("textarea",{value:k.imagePrompt,onChange:u=>$(k.id,u.target.value),placeholder:"Edit image prompt...",className:"w-full h-full bg-gray-700 border border-gray-600 rounded-md p-2 text-gray-200 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 resize-none"}),n.jsx("button",{onClick:()=>x(k.imagePrompt,"image"),className:"absolute top-2 right-2 bg-blue-600 hover:bg-blue-700 text-white rounded-full px-3 py-1 text-xs font-semibold opacity-0 group-hover:opacity-100 transition-all duration-300",children:f.image?n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"fas fa-check mr-1"}),"Copied!"]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"fas fa-copy mr-1"}),"Copy"]})})]}),n.jsxs("div",{className:"border-t border-gray-700 pt-2",children:[n.jsx("h5",{className:"text-xs font-bold text-gray-300 mb-2",children:"Enhancements"}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex-grow",children:[n.jsx("label",{htmlFor:`focus-${k.id}`,className:"text-xs text-gray-400 font-semibold mb-1 block",children:"Focus Object"}),n.jsx("input",{id:`focus-${k.id}`,type:"text",value:k.imageFocusObject||"",onChange:u=>y(k.id,"imageFocusObject",u.target.value),placeholder:"e.g., a red apple",className:"w-full bg-gray-600 border border-gray-500 rounded-md p-1.5 text-gray-200 text-xs focus:ring-1 focus:ring-blue-500 focus:border-blue-500 transition"})]}),n.jsxs("div",{children:[n.jsx("label",{htmlFor:`angle-${k.id}`,className:"text-xs text-gray-400 font-semibold mb-1 block",children:"Camera Angle"}),n.jsxs("select",{id:`angle-${k.id}`,value:k.imageCameraAngle||"",onChange:u=>y(k.id,"imageCameraAngle",u.target.value),className:"w-full bg-gray-600 border border-gray-500 rounded-md p-1.5 text-gray-200 text-xs focus:ring-1 focus:ring-blue-500 focus:border-blue-500 transition duration-200",children:[n.jsx("option",{value:"",children:"-- Select Angle --"}),et.map(u=>n.jsx("option",{value:u,children:u},u))]})]})]})]})]}),n.jsxs("div",{className:"bg-gray-800 p-3 rounded-md border border-gray-700 flex-grow flex flex-col gap-2",children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsxs("h4",{className:"font-bold text-sm text-green-400",children:[n.jsx("i",{className:"fas fa-video mr-2"}),"Video Motion Prompt"]}),n.jsx("button",{onClick:()=>r(k.id,"video"),disabled:k.isGeneratingVideoPrompt,className:"text-xs font-semibold text-purple-400 hover:text-purple-300 disabled:text-gray-500 disabled:cursor-not-allowed transition-colors flex items-center gap-1",title:"Use AI to suggest a better prompt",children:k.isGeneratingVideoPrompt?n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"fas fa-spinner fa-spin"}),"Suggesting..."]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"fas fa-wand-magic-sparkles"}),"AI Prompt"]})})]}),n.jsxs("div",{className:"relative group flex-grow",children:[n.jsx("textarea",{value:k.videoPrompt,onChange:u=>h(k.id,u.target.value),placeholder:"Edit video motion prompt...",className:"w-full h-full bg-gray-700 border border-gray-600 rounded-md p-2 text-gray-200 text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500 transition duration-200 resize-none"}),n.jsx("button",{onClick:()=>x(k.videoPrompt,"video"),className:"absolute top-2 right-2 bg-blue-600 hover:bg-blue-700 text-white rounded-full px-3 py-1 text-xs font-semibold opacity-0 group-hover:opacity-100 transition-all duration-300",children:f.video?n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"fas fa-check mr-1"}),"Copied!"]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"fas fa-copy mr-1"}),"Copy"]})})]}),n.jsxs("div",{className:"border-t border-gray-700 pt-2 space-y-2",children:[n.jsx("h5",{className:"text-xs font-bold text-gray-300",children:"Enhancements"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx("label",{htmlFor:`movement-${k.id}`,className:"text-xs text-gray-400 font-semibold mb-1 block",children:"Camera Movement"}),n.jsxs("select",{id:`movement-${k.id}`,value:k.videoCameraMovement||"",onChange:u=>y(k.id,"videoCameraMovement",u.target.value),className:"w-full bg-gray-600 border border-gray-500 rounded-md p-1.5 text-gray-200 text-xs focus:ring-1 focus:ring-blue-500 focus:border-blue-500 transition duration-200",children:[n.jsx("option",{value:"",children:"-- Select Movement --"}),tt.map(u=>n.jsx("option",{value:u,children:u},u))]})]}),n.jsxs("div",{className:"flex-1",children:[n.jsx("label",{htmlFor:`effect-${k.id}`,className:"text-xs text-gray-400 font-semibold mb-1 block",children:"Shooting Effect"}),n.jsxs("select",{id:`effect-${k.id}`,value:k.videoShootingEffect||"",onChange:u=>y(k.id,"videoShootingEffect",u.target.value),className:"w-full bg-gray-600 border border-gray-500 rounded-md p-1.5 text-gray-200 text-xs focus:ring-1 focus:ring-blue-500 focus:border-blue-500 transition duration-200",children:[n.jsx("option",{value:"",children:"-- Select Effect --"}),rt.map(u=>n.jsx("option",{value:u,children:u},u))]})]})]}),n.jsxs("div",{className:"flex items-start pt-1",children:[n.jsx("div",{className:"flex items-center h-5",children:n.jsx("input",{id:`include-dialogue-${k.id}`,type:"checkbox",checked:k.includeDialogueInPrompt,onChange:u=>a(k.id,u.target.checked),className:"focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-500 rounded bg-gray-700"})}),n.jsx("div",{className:"ml-2 text-xs",children:n.jsx("label",{htmlFor:`include-dialogue-${k.id}`,className:"font-medium text-gray-300 cursor-pointer",children:"Include dialogue in prompt"})})]})]})]})]})]})},at=({scene:k,overrides:$,onGenerateImage:h,onOverrideChange:S,onDeleteImage:y,onViewImage:o,onSelectImageForVideo:a,onUploadImageForVideo:r,activeModule:l,numHosts:f,generatedEnvironments:g=[],videoAspectRatio:x})=>{const u=(O,I)=>{if(O.target.files){const G=Array.from(O.target.files),X=$[I]||[];S(k.id,I,[...X,...G])}O.target.value=""},i=(O,I)=>{const G=$[I]||[];S(k.id,I,G.filter((X,_)=>_!==O))},b=(O,I)=>n.jsx("div",{className:"grid grid-cols-4 gap-1.5 mt-2",children:O.map((G,X)=>{const _=URL.createObjectURL(G);return n.jsxs("div",{className:"relative aspect-square",children:[n.jsx("img",{src:_,alt:"Preview",className:"w-full h-full object-cover rounded"}),n.jsx("button",{onClick:()=>i(X,I),className:"absolute -top-1 -right-1 bg-red-500 text-white rounded-full h-4 w-4 flex items-center justify-center text-xs font-bold leading-none hover:bg-red-600 transition-transform transform hover:scale-110",children:"×"})]},`${G.name}-${X}`)})}),s=$.subjects||[],p=$.referenceImages||[],d=$.useProjectCharacter!==!1,v=l==="podcast"&&k.imagePrompt.toLowerCase().includes("studio"),w=l==="street-interview",[C,N]=Se.useState(!k.selectedImageForVideo);Se.useEffect(()=>{k.selectedImageForVideo&&N(!1)},[k.selectedImageForVideo]);const U=$.imageProvider||"lehuyducanh",T=x==="9:16"?"aspect-[9/16]":"aspect-video";return n.jsx("div",{className:"bg-slate-800 p-4 rounded-lg border border-slate-700 space-y-3 h-full flex flex-col",children:v||w?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"flex-shrink-0",children:n.jsx("h5",{className:"font-bold text-sm text-blue-400",children:w?"Interview Background":"Studio Scene Selection"})}),w?k.selectedImageForVideo?n.jsxs("div",{className:`relative group ${T} flex-grow`,children:[n.jsx("img",{src:k.selectedImageForVideo,alt:"Selected background scene",className:"w-full h-full object-cover rounded-md border-2 border-blue-500",onClick:()=>o(k.selectedImageForVideo)}),n.jsxs("div",{className:"absolute bottom-1 left-1 bg-green-600 text-white rounded-full px-2 py-1 text-xs font-bold flex items-center gap-1 cursor-default",children:[n.jsx("i",{className:"fas fa-check"})," Video Base"]})]}):n.jsx("div",{className:"text-center text-xs text-yellow-300 flex-grow flex items-center justify-center h-full p-4 bg-gray-900/50 rounded-lg",children:n.jsxs("p",{children:[n.jsx("i",{className:"fas fa-info-circle mr-1"}),"Background not set. Please generate and select a background in the input panel."]})}):n.jsx(n.Fragment,{children:k.selectedImageForVideo&&!C?n.jsxs("div",{className:`relative group ${T}`,children:[n.jsx("img",{src:k.selectedImageForVideo,alt:"Selected studio scene",className:"w-full h-full object-cover rounded-md border-2 border-blue-500",onClick:()=>o(k.selectedImageForVideo)}),n.jsx("button",{onClick:()=>N(!0),className:"absolute top-2 right-2 bg-gray-900/80 hover:bg-black/80 text-white font-bold py-1 px-3 rounded-full text-xs",children:"Change"})]}):n.jsx("div",{className:"flex-grow min-h-[150px] bg-gray-900/50 rounded-lg p-2 overflow-y-auto",children:g&&g.length>0?n.jsx("div",{className:"grid grid-cols-2 gap-2",children:g.map((O,I)=>{const G=k.selectedImageForVideo===O;return n.jsxs("div",{className:`relative group ${T}`,onClick:()=>a(k.id,O),children:[n.jsx("img",{src:O,alt:`Studio Shot ${I+1}`,className:`w-full h-full object-cover rounded-md cursor-pointer transition-all ${G?"ring-4 ring-blue-500":"hover:ring-2 hover:ring-blue-400"}`}),G&&n.jsx("div",{className:"absolute inset-0 bg-blue-500/60 flex items-center justify-center rounded-md",children:n.jsx("i",{className:"fas fa-check-circle text-white text-3xl"})})]},I)})}):n.jsx("div",{className:"text-center text-xs text-yellow-300 flex-grow flex items-center justify-center h-full p-4",children:n.jsxs("p",{children:[n.jsx("i",{className:"fas fa-info-circle mr-1"}),"Generate studio scenes in the main input panel to select one here."]})})})})]}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex-shrink-0 space-y-3",children:[n.jsx("h5",{className:"font-bold text-sm text-blue-400",children:"Scene-Specific Visuals"}),["ugc","supplements","video-cloner"].includes(l||"")&&n.jsxs("div",{className:"bg-gray-800/60 p-2 rounded-md border border-gray-700",children:[n.jsx("div",{className:"flex items-center justify-between mb-2",children:n.jsxs("label",{htmlFor:`use-proj-char-${k.id}`,className:"flex items-center gap-2 text-sm font-semibold text-gray-300 cursor-pointer",children:[n.jsx("input",{type:"checkbox",id:`use-proj-char-${k.id}`,checked:d,onChange:O=>S(k.id,"useProjectCharacter",O.target.checked),className:"h-4 w-4 rounded border-gray-500 bg-gray-700 text-blue-600 focus:ring-blue-500"}),"Use Project Creator/Character"]})}),n.jsxs("div",{children:[n.jsxs("label",{htmlFor:`subjects-upload-${k.id}`,className:"cursor-pointer text-xs font-semibold text-gray-200 bg-gray-600 hover:bg-gray-500 px-2 py-1 rounded-md border border-gray-500 inline-flex items-center gap-1.5 transition-colors",children:[n.jsx("i",{className:"fas fa-puzzle-piece"})," Add Accessories/Subjects"]}),n.jsx("input",{id:`subjects-upload-${k.id}`,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:O=>u(O,"subjects")}),s.length>0&&b(s,"subjects")]})]}),n.jsx("div",{className:"bg-gray-800/60 p-2 rounded-md border border-gray-700",children:n.jsxs("div",{children:[n.jsxs("label",{htmlFor:`ref-images-upload-${k.id}`,className:"cursor-pointer text-xs font-semibold text-gray-200 bg-teal-600 hover:bg-teal-500 px-2 py-1 rounded-md border border-teal-500 inline-flex items-center gap-1.5 transition-colors",children:[n.jsx("i",{className:"fas fa-camera"})," Add Scene Reference Image"]}),n.jsx("input",{id:`ref-images-upload-${k.id}`,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:O=>u(O,"referenceImages")}),p.length>0&&b(p,"referenceImages")]})}),n.jsxs("div",{className:"text-center",children:[n.jsxs("label",{htmlFor:`upload-base-${k.id}`,className:"cursor-pointer w-full text-center block px-3 py-1.5 rounded-md text-xs font-semibold border-2 transition-colors bg-blue-600 border-blue-500 text-white hover:bg-blue-500",children:[n.jsx("i",{className:"fas fa-upload mr-1.5"}),"Upload Base Image for Video"]}),n.jsx("input",{id:`upload-base-${k.id}`,type:"file",accept:"image/*",className:"hidden",onChange:O=>{var I;(I=O.target.files)!=null&&I[0]&&r(k.id,O.target.files[0])}})]})]}),n.jsxs("div",{className:"mt-auto pt-3 border-t border-slate-700 space-y-2",children:[n.jsxs("div",{className:"bg-gray-800/60 p-2 rounded-md border border-gray-700",children:[n.jsx("label",{htmlFor:`provider-select-${k.id}`,className:"block text-xs font-bold text-gray-400 mb-1",children:"Image Provider"}),n.jsxs("select",{id:`provider-select-${k.id}`,value:U,onChange:O=>S(k.id,"imageProvider",O.target.value),className:"w-full bg-gray-700 border border-gray-600 rounded-md p-1.5 text-gray-200 text-xs focus:ring-1 focus:ring-blue-500",children:[n.jsx("option",{value:"lehuyducanh",children:"LeHuyDucAnh API"}),n.jsx("option",{value:"gemini",children:"Gemini API"})]})]}),n.jsx("button",{onClick:()=>h(k.id),disabled:k.isGeneratingImage,className:"w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-3 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-sm",children:k.isGeneratingImage?n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"fas fa-spinner fa-spin"}),"Generating..."]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"fas fa-camera-retro"}),k.images.length>0?"Generate More":"Generate B-Roll"]})}),k.imageGenerationError&&n.jsxs("p",{className:"text-red-300 text-xs text-center bg-red-900/50 p-2 rounded-md",children:["Error: ",k.imageGenerationError]})]}),n.jsxs("div",{className:"flex-grow min-h-[90px]",children:[k.isGeneratingImage&&k.images.length===0&&n.jsx("div",{className:`w-full bg-gray-700 rounded-md flex items-center justify-center animate-pulse ${T}`,children:n.jsx("i",{className:"fas fa-image text-gray-500 text-3xl"})}),k.images.length>0&&n.jsx("div",{className:"grid grid-cols-2 gap-2",children:k.images.map((O,I)=>{const G=k.selectedImageForVideo===O;return n.jsxs("div",{className:`relative group ${T}`,children:[n.jsx("img",{src:O,alt:`Generated scene ${I+1}`,className:`w-full h-full object-cover rounded-md cursor-pointer transition-all duration-200 ${G?"border-4 border-blue-500 ring-2 ring-blue-500 p-0.5":"border-2 border-gray-600 hover:border-blue-500"}`,onClick:()=>o(O),onError:X=>{X.target.src="https://via.placeholder.com/160x90.png?text=Error"}}),n.jsx("button",{onClick:()=>y(k.id,O),className:"absolute -top-2 -right-2 bg-red-600 text-white rounded-full h-6 w-6 flex items-center justify-center text-xs font-bold hover:bg-red-700 transition-transform transform hover:scale-110 opacity-0 group-hover:opacity-100 focus:opacity-100","aria-label":"Delete image",children:"×"}),!G&&n.jsx("button",{onClick:()=>a(k.id,O),className:"absolute bottom-1 left-1 bg-blue-600 text-white rounded-full h-6 w-6 flex items-center justify-center text-xs font-bold hover:bg-blue-700 transition-transform transform hover:scale-110 opacity-0 group-hover:opacity-100 focus:opacity-100",title:"Use as video base","aria-label":"Use for video",children:n.jsx("i",{className:"fas fa-film"})}),G&&n.jsxs("div",{className:"absolute bottom-1 left-1 bg-green-600 text-white rounded-full px-2 py-1 text-xs font-bold flex items-center gap-1 cursor-default",children:[n.jsx("i",{className:"fas fa-check"})," Video Base"]})]},I)})})]})]})})},it=({scene:k,onGenerateVideo:$,onToggleVideoUpscale:h,onUpscaleVideo:S,videoAspectRatio:y,onDeleteVideo:o})=>{const a=!!k.selectedImageForVideo,r=a&&!k.isGeneratingVideo,l=y==="9:16"?"aspect-[9/16]":"aspect-video";return n.jsxs("div",{className:"bg-slate-800 p-4 rounded-lg border border-slate-700 space-y-3 h-full flex flex-col",children:[n.jsxs("div",{className:"flex-shrink-0",children:[n.jsx("h5",{className:"font-bold text-sm text-blue-400",children:"Video Generation"}),!a&&n.jsxs("div",{className:"text-center text-xs text-yellow-300 bg-yellow-900/50 p-3 rounded-md mt-2",children:[n.jsx("i",{className:"fas fa-info-circle mr-1"}),'Select an image from the "Image Generation" panel to use as the base for your video.']})]}),n.jsxs("div",{className:"mt-auto pt-3 border-t border-slate-700 space-y-2",children:[n.jsx("div",{className:"flex items-center justify-between",children:n.jsxs("label",{htmlFor:`upscale-toggle-${k.id}`,className:"flex items-center gap-2 text-sm font-semibold text-gray-300 cursor-pointer",children:[n.jsx("input",{type:"checkbox",id:`upscale-toggle-${k.id}`,checked:k.shouldUpscaleVideo,onChange:()=>h(k.id),className:"h-4 w-4 rounded border-gray-500 bg-gray-700 text-purple-600 focus:ring-purple-500"}),"Auto-Upscale Next Video"]})}),n.jsx("button",{onClick:()=>$(k.id),disabled:!r,className:"w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-3 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-sm",children:k.isGeneratingVideo?n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"fas fa-spinner fa-spin"}),"Generating..."]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"fas fa-film"}),(k.videos||[]).length>0?"Generate More":"Generate Video"]})}),k.videoGenerationError&&n.jsxs("p",{className:"text-red-300 text-xs text-center bg-red-900/50 p-2 rounded-md",children:["Error: ",k.videoGenerationError]})]}),n.jsxs("div",{className:"flex-grow min-h-[90px] overflow-y-auto space-y-4 pr-2 -mr-2",children:[k.isGeneratingVideo&&(k.videos||[]).length===0&&n.jsx("div",{className:`w-full bg-gray-700 rounded-md flex items-center justify-center animate-pulse ${l}`,children:n.jsx("i",{className:"fas fa-video text-gray-500 text-3xl"})}),(k.videos||[]).map((f,g)=>{const x=f.upscaledUrl||f.url,u=f.url&&f.mediaGenerationId&&!f.upscaledUrl&&!f.isUpscaling;return n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:`relative group ${l}`,children:[n.jsx("video",{src:x,controls:!0,loop:!0,className:"w-full h-full object-cover rounded-md bg-black"},x),f.isUpscaling&&n.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-70 flex items-center justify-center rounded-md",children:n.jsxs("div",{className:"text-white text-center",children:[n.jsx("i",{className:"fas fa-spinner fa-spin text-2xl mb-2"}),n.jsx("p",{className:"text-sm font-bold",children:"Upscaling..."})]})}),f.upscaledUrl&&n.jsxs("div",{className:"absolute top-1 right-1 bg-purple-600 text-white rounded-full px-2 py-0.5 text-xs font-bold flex items-center gap-1",children:[n.jsx("i",{className:"fas fa-check"})," Upscaled"]}),n.jsx("button",{onClick:i=>{i.stopPropagation(),o(k.id,g)},className:"absolute -top-2 -right-2 bg-red-600 text-white rounded-full h-6 w-6 flex items-center justify-center text-xs font-bold hover:bg-red-700 transition-transform transform hover:scale-110 opacity-0 group-hover:opacity-100 focus:opacity-100","aria-label":"Delete video",children:"×"})]}),u&&n.jsx("button",{onClick:()=>S(k.id,g),disabled:f.isUpscaling,className:"w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-1.5 px-3 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-xs",children:f.isUpscaling?n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"fas fa-spinner fa-spin"}),"Upscaling..."]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"fas fa-magic"}),"Upscale Now"]})}),f.upscaleError&&n.jsxs("p",{className:"text-red-300 text-xs text-center bg-red-900/50 p-2 rounded-md",children:["Upscale Error: ",f.upscaleError]})]},`${f.mediaGenerationId}-${g}`)})]})]})},st=k=>{const{scene:$,sceneOverrides:h,onGenerateImage:S,onSceneImagePromptChange:y,onSceneVideoPromptChange:o,onSceneVoiceoverGuideChange:a,onSceneEnhancementChange:r,onSceneOverrideChange:l,onDeleteImage:f,onViewImage:g,onUploadImageForVideo:x,onSelectImageForVideo:u,onGenerateVideo:i,onToggleVideoUpscale:b,activeModule:s,numHosts:p,onGenerateAudio:d,generatedEnvironments:v,onUpscaleVideo:w,videoAspectRatio:C,onToggleDialogueInPrompt:N,onGenerateEnhancedPrompt:U,onSceneVoiceoverScriptChange:T,onDeleteVideo:O}=k;return n.jsxs("div",{className:"bg-gray-800 p-4 rounded-xl border border-gray-700 shadow-lg grid grid-cols-1 md:grid-cols-3 gap-4 items-start",children:[n.jsx("div",{className:"md:col-span-1 h-full",children:n.jsx(nt,{scene:$,onImagePromptChange:y,onVideoPromptChange:o,onSceneVoiceoverGuideChange:a,onSceneEnhancementChange:r,onGenerateAudio:d,onToggleDialogueInPrompt:N,onGenerateEnhancedPrompt:U,onSceneVoiceoverScriptChange:T})}),n.jsx("div",{className:"md:col-span-1 h-full",children:n.jsx(at,{scene:$,overrides:h[$.id]||{},onGenerateImage:S,onOverrideChange:l,onDeleteImage:f,onViewImage:g,onSelectImageForVideo:u,onUploadImageForVideo:x,activeModule:s,numHosts:p,generatedEnvironments:v,videoAspectRatio:C})}),n.jsx("div",{className:"md:col-span-1 h-full",children:n.jsx(it,{scene:$,onGenerateVideo:i,onToggleVideoUpscale:b,onUpscaleVideo:w,videoAspectRatio:C,onDeleteVideo:O})})]})},ot=({script:k,onScriptChange:$,onGenerate:h,isGenerating:S})=>{const y=k.split(`
`).filter(o=>o.trim()!=="").length;return n.jsxs("div",{className:"bg-gray-800 p-6 rounded-2xl border border-blue-600 shadow-lg flex flex-col gap-4",children:[n.jsxs("div",{children:[n.jsxs("h2",{className:"text-xl font-bold text-blue-300",children:[n.jsx("i",{className:"fas fa-microphone-alt mr-2"}),"Review Your Voiceover Script"]}),n.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Edit the script below as needed. Each line will become a new scene in your video."})]}),n.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg border border-gray-700",children:[n.jsx("textarea",{value:k,onChange:o=>$(o.target.value),placeholder:"Your generated script will appear here...",className:"w-full bg-gray-700 border border-gray-600 rounded-md p-3 text-gray-200 text-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 resize-y",rows:10}),n.jsxs("p",{className:"text-right text-xs text-gray-500 mt-1 font-mono",children:[y," scenes"]})]}),n.jsx("button",{onClick:h,disabled:S||k.trim()==="",className:"w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-lg shadow-md hover:shadow-lg transform hover:-translate-y-0.5",title:k.trim()===""?"Script cannot be empty":"Generate visual prompts for each line",children:S?n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"fas fa-spinner fa-spin"}),"Generating Prompts..."]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"fas fa-magic"}),"Generate Scene Prompts"]})})]})},yt=k=>{const{generationStep:$,scenes:h,isLoading:S,isGeneratingPrompts:y,error:o,voiceoverScript:a,onVoiceoverScriptChange:r,onGeneratePrompts:l,sceneOverrides:f,onGenerateImage:g,onSceneImagePromptChange:x,onSceneVideoPromptChange:u,onSceneVoiceoverGuideChange:i,onSceneEnhancementChange:b,onSceneOverrideChange:s,onDeleteImage:p,onViewImage:d,onUploadImageForVideo:v,onGenerateAllImages:w,isBatchGenerating:C,onViewStoryboard:N,onDownloadAllImages:U,isDownloadingImages:T,onDownloadAllVideos:O,isDownloadingVideos:I,onSelectImageForVideo:G,onGenerateVideo:X,onToggleVideoUpscale:_,onGenerateAllVideos:R,isBatchGeneratingVideos:t,generatedEnvironments:D,activeModule:ee,numHosts:V,onGenerateAudio:te,onGenerateAllAudio:M,isBatchGeneratingAudio:Q,onAddScene:z,onPickAllImages:E,onSelectEnvironment:J,selectedEnvironment:q,onSendAllImagesToTelegram:K,isSendingImagesToTelegram:se,onSendAllVideosToTelegram:ce,isSendingVideosToTelegram:ae,onUpscaleVideo:ie,onUpscaleAllVideos:de,isBatchUpscalingVideos:oe,videoAspectRatio:he,onToggleDialogueInPrompt:fe,onGenerateEnhancedPrompt:e,onSceneVoiceoverScriptChange:B,onDeleteScene:F,onDeleteVideo:m}=k;if(S)return n.jsxs("div",{className:"bg-gray-800 p-6 rounded-2xl border border-blue-600 shadow-lg flex flex-col items-center justify-center min-h-[300px]",children:[n.jsx("i",{className:"fas fa-spinner fa-spin text-blue-500 text-5xl mb-4"}),n.jsx("h2",{className:"text-xl font-bold text-blue-300",children:"Generating..."}),n.jsx("p",{className:"text-gray-400 mt-2",children:"Director AI is working its magic!"})]});if(o)return n.jsxs("div",{className:"bg-red-900/50 p-6 rounded-2xl border border-red-600 shadow-lg",children:[n.jsxs("h2",{className:"text-xl font-bold text-red-300 mb-2",children:[n.jsx("i",{className:"fas fa-exclamation-triangle mr-2"}),"An Error Occurred"]}),n.jsx("p",{className:"text-red-200 bg-red-900/70 p-3 rounded-md font-mono text-sm break-words",children:o})]});if($==="script_generated")return n.jsx(ot,{script:a,onScriptChange:r,onGenerate:l,isGenerating:y});if($==="input"&&h.length===0&&D.length===0)return n.jsxs("div",{className:"bg-gray-800 p-6 rounded-2xl border-2 border-dashed border-gray-700 shadow-lg text-center min-h-[300px] flex flex-col justify-center items-center",children:[n.jsx("i",{className:"fas fa-pencil-ruler text-6xl text-blue-500 mb-4"}),n.jsx("h2",{className:"text-2xl font-bold text-blue-300",children:"Your Storyboard Awaits"}),n.jsx("p",{className:"text-gray-400 mt-2",children:'Provide your inputs and click a "Generate" button to begin.'})]});const c=h.some(H=>H.images.length>0||!!H.selectedImageForVideo),j=h.some(H=>H.videos&&H.videos.length>0),P=h.some(H=>H.images.length===0&&!(ee==="podcast"&&H.imagePrompt.toLowerCase().includes("studio"))),L=h.some(H=>H.selectedImageForVideo),A=h.some(H=>H.selectedImageForVideo&&(!H.videos||H.videos.length===0)),W=h.some(H=>!H.audioUrl),Y=h.some(H=>H.videos.some(re=>re.url&&re.mediaGenerationId&&!re.upscaledUrl)),Z=({onClick:H})=>n.jsx("div",{className:"flex justify-center my-4",children:n.jsxs("button",{onClick:H,className:"w-full text-gray-500 hover:text-blue-400 hover:border-blue-500 border-2 border-dashed border-gray-700 rounded-lg py-2 transition-all flex items-center justify-center gap-2 font-semibold text-sm",children:[n.jsx("i",{className:"fas fa-plus"})," Add Scene"]})});return n.jsxs("div",{className:"space-y-6",children:[D.length>0&&n.jsxs("details",{open:!0,className:"bg-gray-800 p-4 rounded-xl border border-gray-700 shadow-md",children:[n.jsxs("summary",{className:"cursor-pointer font-bold text-lg text-blue-300 hover:text-white transition-colors",children:[n.jsx("i",{className:"fas fa-images mr-2"}),"Generated Backgrounds (",D.length,")"]}),n.jsx("div",{className:"mt-4 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-2",children:D.map((H,re)=>{const ne=q===H;return n.jsxs("div",{className:`relative group ${he==="9:16"?"aspect-[9/16]":"aspect-video"}`,onClick:()=>d(H),children:[n.jsx("img",{src:H,alt:`Environment ${re+1}`,className:`w-full h-full object-cover rounded-md cursor-pointer transition-all duration-200 ${ne?"ring-4 ring-blue-500":""}`}),ne&&n.jsx("div",{className:"absolute inset-0 bg-blue-500/60 flex items-center justify-center rounded-md pointer-events-none",children:n.jsx("i",{className:"fas fa-check-circle text-white text-4xl"})}),n.jsx("div",{className:"absolute top-1 left-1 bg-black bg-opacity-60 text-white text-xs font-bold px-1.5 py-0.5 rounded",children:ee==="podcast"?`Scene ${re+1}`:re===0?"Original":`Var ${re}`}),J&&n.jsx("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:n.jsx("button",{onClick:ue=>{ue.stopPropagation(),J(H)},className:"text-white bg-blue-600 hover:bg-blue-700 font-bold py-1 px-3 rounded-full text-xs",children:ne?"Selected":"Select"})})]},H)})})]}),h.length>0&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"bg-gray-800 p-4 rounded-xl border border-gray-700 shadow-md sticky top-4 z-[5] space-y-3",children:[n.jsxs("div",{className:"flex flex-wrap gap-2 items-center justify-between",children:[n.jsxs("h2",{className:"text-xl font-bold text-blue-300 shrink-0",children:[n.jsx("i",{className:"fas fa-stream mr-2"}),"Storyboard Scenes (",h.length,")"]}),n.jsxs("div",{className:"flex gap-2 flex-wrap justify-end flex-grow",children:[n.jsxs("button",{onClick:N,disabled:!c,className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-3 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-xs shadow-sm",title:c?"View Full Storyboard":"Generate at least one image to view the storyboard",children:[n.jsx("i",{className:"fas fa-grip-horizontal"}),"View"]}),n.jsx("button",{onClick:U,disabled:!c||T,className:"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-3 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-xs shadow-sm",title:c?"Download All Images as .zip":"Generate at least one image to download",children:T?n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"fas fa-spinner fa-spin"}),"Zipping..."]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"fas fa-download"}),"Images"]})}),n.jsx("button",{onClick:O,disabled:!j||I,className:"bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-3 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-xs shadow-sm",title:j?"Download All Videos as .zip":"Generate at least one video to download",children:I?n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"fas fa-spinner fa-spin"}),"Zipping..."]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"fas fa-video"}),"Videos"]})})]})]}),n.jsxs("div",{className:"border-t border-gray-700 pt-3 flex items-center gap-x-4 gap-y-2 flex-wrap",children:[n.jsx("span",{className:"text-sm font-bold text-gray-300",children:"Batch Actions:"}),n.jsxs("div",{className:"flex gap-2 flex-wrap",children:[n.jsx("button",{onClick:M,disabled:Q||!W,className:"bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-2 px-3 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-xs shadow-sm",title:W?"Generate audio for all scenes that don't have it":"All scenes already have audio",children:Q?n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"fas fa-spinner fa-spin"}),"Working..."]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"fas fa-volume-up"}),"Generate All Audio"]})}),n.jsx("button",{onClick:w,disabled:C||!P,className:"bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-3 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-xs shadow-sm",title:P?"Generate images for all B-roll scenes that don't have one":"All scenes already have images or are studio scenes",children:C?n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"fas fa-spinner fa-spin"}),"Working..."]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"fas fa-images"}),"Generate All Images"]})}),n.jsxs("button",{onClick:E,disabled:!c,className:"bg-teal-600 hover:bg-teal-700 text-white font-bold py-2 px-3 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-xs shadow-sm",title:c?"Pick the first image of every scene as the video base":"Generate some images first",children:[n.jsx("i",{className:"fas fa-check-double"}),"Pick All Images"]}),n.jsx("button",{onClick:R,disabled:t||!A,className:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-3 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-xs shadow-sm",title:L?A?"Generate video for all scenes with a selected image that don't have a video yet":"All scenes with a selected image already have videos":"Select a base image for one or more scenes to enable",children:t?n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"fas fa-spinner fa-spin"}),"Working..."]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"fas fa-film"}),"Generate All Videos"]})}),n.jsx("button",{onClick:de,disabled:oe||!Y,className:"bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-3 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-xs shadow-sm",title:Y?"Upscale all videos that haven't been upscaled yet":"Generate some videos first to enable upscaling",children:oe?n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"fas fa-spinner fa-spin"}),"Working..."]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"fas fa-magic"}),"Upscale All Missing"]})}),n.jsx("button",{onClick:K,disabled:se||!c,className:"bg-sky-600 hover:bg-sky-700 text-white font-bold py-2 px-3 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-xs shadow-sm",title:c?"Send All Images to Telegram":"Generate at least one image to send",children:se?n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"fas fa-spinner fa-spin"}),"Sending..."]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"fab fa-telegram-plane"}),"Send Images"]})}),n.jsx("button",{onClick:ce,disabled:ae||!j,className:"bg-sky-600 hover:bg-sky-700 text-white font-bold py-2 px-3 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-xs shadow-sm",title:j?"Send All Videos to Telegram":"Generate at least one video to send",children:ae?n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"fas fa-spinner fa-spin"}),"Sending..."]}):n.jsxs(n.Fragment,{children:[n.jsx("i",{className:"fab fa-telegram-plane"}),"Send Videos"]})})]})]})]}),n.jsx(Z,{onClick:()=>z(0)}),h.map((H,re)=>n.jsxs(We.Fragment,{children:[n.jsxs("div",{className:"relative group",children:[n.jsx("span",{className:"absolute -top-3 -left-3 bg-blue-600 text-white font-bold rounded-full h-8 w-8 flex items-center justify-center text-md z-10 shadow-md",children:re+1}),n.jsx("button",{onClick:()=>F(H.id),className:"absolute -top-3 -right-3 z-10 w-8 h-8 flex items-center justify-center bg-red-600 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity shadow-md hover:bg-red-700 focus:opacity-100",title:"Delete Scene",children:n.jsx("i",{className:"fas fa-trash-alt"})}),n.jsx(st,{scene:H,sceneOverrides:f,onGenerateImage:g,onSceneImagePromptChange:x,onSceneVideoPromptChange:u,onSceneVoiceoverGuideChange:i,onSceneEnhancementChange:b,onSceneOverrideChange:s,onDeleteImage:p,onViewImage:d,onUploadImageForVideo:v,onSelectImageForVideo:G,onGenerateVideo:X,onToggleVideoUpscale:_,activeModule:ee,numHosts:V,onGenerateAudio:te,generatedEnvironments:D,onUpscaleVideo:ie,videoAspectRatio:he,onToggleDialogueInPrompt:fe,onGenerateEnhancedPrompt:e,onSceneVoiceoverScriptChange:B,onDeleteVideo:m})]}),n.jsx(Z,{onClick:()=>z(re+1)})]},H.id))]})]})},_t=({scenes:k,onClose:$,videoAspectRatio:h})=>{Se.useEffect(()=>{const o=a=>{a.key==="Escape"&&$()};return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[$]);const S=k.flatMap(o=>o.images.map(a=>({id:`${o.id}-${a}`,voiceoverScript:o.voiceoverScript,imageUrl:a}))),y=h==="9:16"?"aspect-[9/16]":"aspect-video";return n.jsxs("div",{className:"fixed inset-0 bg-gray-900 bg-opacity-95 flex flex-col z-50 p-0 transition-opacity duration-300",role:"dialog","aria-modal":"true",onClick:$,children:[n.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-gray-700 bg-gray-900",onClick:o=>o.stopPropagation(),children:[n.jsxs("h2",{className:"text-xl md:text-2xl font-bold text-white",children:[n.jsx("i",{className:"fas fa-grip-horizontal mr-3"}),"Full Storyboard View"]}),n.jsx("button",{onClick:$,"aria-label":"Close storyboard viewer",className:"text-gray-400 hover:text-white text-4xl transition-colors",children:"×"})]}),n.jsx("div",{className:"flex-grow overflow-y-auto p-4 md:p-8",onClick:o=>o.stopPropagation(),children:S.length>0?n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 md:gap-6",children:S.map(o=>n.jsxs("div",{className:"flex flex-col bg-gray-800 text-gray-200 rounded-lg shadow-lg overflow-hidden transform hover:scale-[1.02] transition-transform duration-300",children:[n.jsx("div",{className:`w-full bg-gray-700 ${y}`,children:n.jsx("img",{src:o.imageUrl,alt:`Scene for "${o.voiceoverScript}"`,className:"w-full h-full object-cover",onError:a=>{a.target.src="https://via.placeholder.com/384x216.png?text=Image+Failed+to+Load"}})}),n.jsx("div",{className:"p-3 md:p-4 border-t border-gray-700",children:n.jsxs("p",{className:"text-sm text-gray-300 italic",children:['"',o.voiceoverScript,'"']})})]},o.id))}):n.jsx("div",{className:"flex items-center justify-center h-full w-full",children:n.jsxs("div",{className:"text-center",children:[n.jsx("i",{className:"fas fa-images text-6xl text-gray-600 mb-4"}),n.jsx("p",{className:"text-gray-500 text-lg",children:"No images have been generated yet."})]})})})]})},Ue="userUsageData",ze={generateStoryboard:100,generateImage:500,generateVideo:500},lt=()=>{const k=new Date;return k.setHours(0,0,0,0),k.toISOString().split("T")[0]},Fe=()=>{try{const k=localStorage.getItem(Ue);return k?JSON.parse(k):{}}catch(k){return console.error("Failed to parse usage data from localStorage",k),{}}},Te=k=>{try{localStorage.setItem(Ue,JSON.stringify(k))}catch($){console.error("Failed to write usage data to localStorage",$)}},wt={getUsage(k){const $=Fe(),h=$[k]||{},S=lt(),y={generateStoryboard:{count:0,lastReset:S},generateImage:{count:0,lastReset:S},generateVideo:{count:0,lastReset:S}};for(const o in ze){const a=o,r=h[a];r&&r.lastReset===S&&(y[a]=r)}return $[k]=y,Te($),y},logAction(k,$){const h=Fe(),S=this.getUsage(k);S[$].count+=1,h[k]=S,Te(h)},canPerformAction(k,$){var o;const S=((o=this.getUsage(k)[$])==null?void 0:o.count)||0,y=ze[$];return S<y}},dt=k=>{var y;const[$,h]=k.split(",");if(!$||!h)throw new Error("Invalid Data URL format");const S=(y=$.split(":")[1])==null?void 0:y.split(";")[0];if(!S)throw new Error("Could not determine MIME type from Data URL");return{inlineData:{mimeType:S,data:h}}},ct=async({prompt:k,subjectUrls:$=[],styleUrl:h,sceneUrl:S,referenceUrls:y=[],aspectRatio:o})=>{const a=$e();try{const r=[];let l=`Generate a high-quality, photorealistic image based on this creative brief: "${k}".`;o&&(l+=` The final image MUST have a strict ${o} aspect ratio. Do not deviate from this aspect ratio.`);const f=[...h?[{type:"Style",url:h}]:[],...S?[{type:"Scene",url:S}]:[],...$.map((u,i)=>({type:`Subject ${i+1}`,url:u})),...y.map((u,i)=>({type:`Scene Reference ${i+1}`,url:u}))];f.length>0&&(l+=`

Use the following images as crucial references for the final output. Adhere to their visual characteristics closely.`,f.forEach(u=>{r.push(dt(u.url)),l+=`
- Reference for ${u.type}: [IMAGE]`})),r.push({text:l});const g=await a.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:r},config:{responseModalities:[Ye.IMAGE]}}),x=[];for(const u of g.candidates[0].content.parts)if(u.inlineData){const i=u.inlineData.data;x.push(`data:${u.inlineData.mimeType};base64,${i}`)}if(x.length===0)throw new Error("Gemini API did not return any image data.");return x}catch(r){throw console.error("Error generating image with Gemini API:",r),new Error(`Failed to generate image with Gemini: ${r instanceof Error?r.message:"Unknown error"}`)}},kt=async k=>{const{provider:$,aspectRatio:h,...S}=k;if($==="gemini"){const a={...S,aspectRatio:h};return ct(a)}const o={...S,aspectRatio:{"16:9":"IMAGE_ASPECT_RATIO_LANDSCAPE","9:16":"IMAGE_ASPECT_RATIO_PORTRAIT","1:1":"IMAGE_ASPECT_RATIO_SQUARE"}[h]};return Ze(o)},jt=async k=>{const{provider:$,imageUrl:h,...S}=k;if($==="lehuyducanh"){const y={...S,startImageUrl:h};return Ke(y)}throw new Error(`Video provider '${$}' is not supported.`)},St=async k=>{const{provider:$,...h}=k;if($==="lehuyducanh")return He(h.mediaGenerationId,h.seed);throw new Error(`Video upscale provider '${$}' is not supported.`)};async function Nt(k,$){const h=[],S=new Set;let y=0;const o=async l=>{const f=(async()=>{try{const g=await l();h.push(g)}catch(g){h.push({error:g})}})();S.add(f),await f,S.delete(f)},a=()=>{if(y<k.length&&S.size<$){const l=k[y++];return o(l).then(()=>a())}},r=Array.from({length:Math.min(k.length,$)},a);return await Promise.all(r),h}function we(k){throw new Error('Could not dynamically require "'+k+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ce={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var Oe;function ut(){return Oe||(Oe=1,(function(k,$){(function(h){k.exports=h()})(function(){return(function h(S,y,o){function a(f,g){if(!y[f]){if(!S[f]){var x=typeof we=="function"&&we;if(!g&&x)return x(f,!0);if(r)return r(f,!0);var u=new Error("Cannot find module '"+f+"'");throw u.code="MODULE_NOT_FOUND",u}var i=y[f]={exports:{}};S[f][0].call(i.exports,function(b){var s=S[f][1][b];return a(s||b)},i,i.exports,h,S,y,o)}return y[f].exports}for(var r=typeof we=="function"&&we,l=0;l<o.length;l++)a(o[l]);return a})({1:[function(h,S,y){var o=h("./utils"),a=h("./support"),r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";y.encode=function(l){for(var f,g,x,u,i,b,s,p=[],d=0,v=l.length,w=v,C=o.getTypeOf(l)!=="string";d<l.length;)w=v-d,x=C?(f=l[d++],g=d<v?l[d++]:0,d<v?l[d++]:0):(f=l.charCodeAt(d++),g=d<v?l.charCodeAt(d++):0,d<v?l.charCodeAt(d++):0),u=f>>2,i=(3&f)<<4|g>>4,b=1<w?(15&g)<<2|x>>6:64,s=2<w?63&x:64,p.push(r.charAt(u)+r.charAt(i)+r.charAt(b)+r.charAt(s));return p.join("")},y.decode=function(l){var f,g,x,u,i,b,s=0,p=0,d="data:";if(l.substr(0,d.length)===d)throw new Error("Invalid base64 input, it looks like a data url.");var v,w=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===r.charAt(64)&&w--,l.charAt(l.length-2)===r.charAt(64)&&w--,w%1!=0)throw new Error("Invalid base64 input, bad content length.");for(v=a.uint8array?new Uint8Array(0|w):new Array(0|w);s<l.length;)f=r.indexOf(l.charAt(s++))<<2|(u=r.indexOf(l.charAt(s++)))>>4,g=(15&u)<<4|(i=r.indexOf(l.charAt(s++)))>>2,x=(3&i)<<6|(b=r.indexOf(l.charAt(s++))),v[p++]=f,i!==64&&(v[p++]=g),b!==64&&(v[p++]=x);return v}},{"./support":30,"./utils":32}],2:[function(h,S,y){var o=h("./external"),a=h("./stream/DataWorker"),r=h("./stream/Crc32Probe"),l=h("./stream/DataLengthProbe");function f(g,x,u,i,b){this.compressedSize=g,this.uncompressedSize=x,this.crc32=u,this.compression=i,this.compressedContent=b}f.prototype={getContentWorker:function(){var g=new a(o.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),x=this;return g.on("end",function(){if(this.streamInfo.data_length!==x.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),g},getCompressedWorker:function(){return new a(o.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},f.createWorkerFrom=function(g,x,u){return g.pipe(new r).pipe(new l("uncompressedSize")).pipe(x.compressWorker(u)).pipe(new l("compressedSize")).withStreamInfo("compression",x)},S.exports=f},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(h,S,y){var o=h("./stream/GenericWorker");y.STORE={magic:"\0\0",compressWorker:function(){return new o("STORE compression")},uncompressWorker:function(){return new o("STORE decompression")}},y.DEFLATE=h("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(h,S,y){var o=h("./utils"),a=(function(){for(var r,l=[],f=0;f<256;f++){r=f;for(var g=0;g<8;g++)r=1&r?3988292384^r>>>1:r>>>1;l[f]=r}return l})();S.exports=function(r,l){return r!==void 0&&r.length?o.getTypeOf(r)!=="string"?(function(f,g,x,u){var i=a,b=u+x;f^=-1;for(var s=u;s<b;s++)f=f>>>8^i[255&(f^g[s])];return-1^f})(0|l,r,r.length,0):(function(f,g,x,u){var i=a,b=u+x;f^=-1;for(var s=u;s<b;s++)f=f>>>8^i[255&(f^g.charCodeAt(s))];return-1^f})(0|l,r,r.length,0):0}},{"./utils":32}],5:[function(h,S,y){y.base64=!1,y.binary=!1,y.dir=!1,y.createFolders=!0,y.date=null,y.compression=null,y.compressionOptions=null,y.comment=null,y.unixPermissions=null,y.dosPermissions=null},{}],6:[function(h,S,y){var o=null;o=typeof Promise<"u"?Promise:h("lie"),S.exports={Promise:o}},{lie:37}],7:[function(h,S,y){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",a=h("pako"),r=h("./utils"),l=h("./stream/GenericWorker"),f=o?"uint8array":"array";function g(x,u){l.call(this,"FlateWorker/"+x),this._pako=null,this._pakoAction=x,this._pakoOptions=u,this.meta={}}y.magic="\b\0",r.inherits(g,l),g.prototype.processChunk=function(x){this.meta=x.meta,this._pako===null&&this._createPako(),this._pako.push(r.transformTo(f,x.data),!1)},g.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},g.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},g.prototype._createPako=function(){this._pako=new a[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var x=this;this._pako.onData=function(u){x.push({data:u,meta:x.meta})}},y.compressWorker=function(x){return new g("Deflate",x)},y.uncompressWorker=function(){return new g("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(h,S,y){function o(i,b){var s,p="";for(s=0;s<b;s++)p+=String.fromCharCode(255&i),i>>>=8;return p}function a(i,b,s,p,d,v){var w,C,N=i.file,U=i.compression,T=v!==f.utf8encode,O=r.transformTo("string",v(N.name)),I=r.transformTo("string",f.utf8encode(N.name)),G=N.comment,X=r.transformTo("string",v(G)),_=r.transformTo("string",f.utf8encode(G)),R=I.length!==N.name.length,t=_.length!==G.length,D="",ee="",V="",te=N.dir,M=N.date,Q={crc32:0,compressedSize:0,uncompressedSize:0};b&&!s||(Q.crc32=i.crc32,Q.compressedSize=i.compressedSize,Q.uncompressedSize=i.uncompressedSize);var z=0;b&&(z|=8),T||!R&&!t||(z|=2048);var E=0,J=0;te&&(E|=16),d==="UNIX"?(J=798,E|=(function(K,se){var ce=K;return K||(ce=se?16893:33204),(65535&ce)<<16})(N.unixPermissions,te)):(J=20,E|=(function(K){return 63&(K||0)})(N.dosPermissions)),w=M.getUTCHours(),w<<=6,w|=M.getUTCMinutes(),w<<=5,w|=M.getUTCSeconds()/2,C=M.getUTCFullYear()-1980,C<<=4,C|=M.getUTCMonth()+1,C<<=5,C|=M.getUTCDate(),R&&(ee=o(1,1)+o(g(O),4)+I,D+="up"+o(ee.length,2)+ee),t&&(V=o(1,1)+o(g(X),4)+_,D+="uc"+o(V.length,2)+V);var q="";return q+=`
\0`,q+=o(z,2),q+=U.magic,q+=o(w,2),q+=o(C,2),q+=o(Q.crc32,4),q+=o(Q.compressedSize,4),q+=o(Q.uncompressedSize,4),q+=o(O.length,2),q+=o(D.length,2),{fileRecord:x.LOCAL_FILE_HEADER+q+O+D,dirRecord:x.CENTRAL_FILE_HEADER+o(J,2)+q+o(X.length,2)+"\0\0\0\0"+o(E,4)+o(p,4)+O+D+X}}var r=h("../utils"),l=h("../stream/GenericWorker"),f=h("../utf8"),g=h("../crc32"),x=h("../signature");function u(i,b,s,p){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=b,this.zipPlatform=s,this.encodeFileName=p,this.streamFiles=i,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}r.inherits(u,l),u.prototype.push=function(i){var b=i.meta.percent||0,s=this.entriesCount,p=this._sources.length;this.accumulate?this.contentBuffer.push(i):(this.bytesWritten+=i.data.length,l.prototype.push.call(this,{data:i.data,meta:{currentFile:this.currentFile,percent:s?(b+100*(s-p-1))/s:100}}))},u.prototype.openedSource=function(i){this.currentSourceOffset=this.bytesWritten,this.currentFile=i.file.name;var b=this.streamFiles&&!i.file.dir;if(b){var s=a(i,b,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:s.fileRecord,meta:{percent:0}})}else this.accumulate=!0},u.prototype.closedSource=function(i){this.accumulate=!1;var b=this.streamFiles&&!i.file.dir,s=a(i,b,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(s.dirRecord),b)this.push({data:(function(p){return x.DATA_DESCRIPTOR+o(p.crc32,4)+o(p.compressedSize,4)+o(p.uncompressedSize,4)})(i),meta:{percent:100}});else for(this.push({data:s.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},u.prototype.flush=function(){for(var i=this.bytesWritten,b=0;b<this.dirRecords.length;b++)this.push({data:this.dirRecords[b],meta:{percent:100}});var s=this.bytesWritten-i,p=(function(d,v,w,C,N){var U=r.transformTo("string",N(C));return x.CENTRAL_DIRECTORY_END+"\0\0\0\0"+o(d,2)+o(d,2)+o(v,4)+o(w,4)+o(U.length,2)+U})(this.dirRecords.length,s,i,this.zipComment,this.encodeFileName);this.push({data:p,meta:{percent:100}})},u.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},u.prototype.registerPrevious=function(i){this._sources.push(i);var b=this;return i.on("data",function(s){b.processChunk(s)}),i.on("end",function(){b.closedSource(b.previous.streamInfo),b._sources.length?b.prepareNextSource():b.end()}),i.on("error",function(s){b.error(s)}),this},u.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},u.prototype.error=function(i){var b=this._sources;if(!l.prototype.error.call(this,i))return!1;for(var s=0;s<b.length;s++)try{b[s].error(i)}catch{}return!0},u.prototype.lock=function(){l.prototype.lock.call(this);for(var i=this._sources,b=0;b<i.length;b++)i[b].lock()},S.exports=u},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(h,S,y){var o=h("../compressions"),a=h("./ZipFileWorker");y.generateWorker=function(r,l,f){var g=new a(l.streamFiles,f,l.platform,l.encodeFileName),x=0;try{r.forEach(function(u,i){x++;var b=(function(v,w){var C=v||w,N=o[C];if(!N)throw new Error(C+" is not a valid compression method !");return N})(i.options.compression,l.compression),s=i.options.compressionOptions||l.compressionOptions||{},p=i.dir,d=i.date;i._compressWorker(b,s).withStreamInfo("file",{name:u,dir:p,date:d,comment:i.comment||"",unixPermissions:i.unixPermissions,dosPermissions:i.dosPermissions}).pipe(g)}),g.entriesCount=x}catch(u){g.error(u)}return g}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(h,S,y){function o(){if(!(this instanceof o))return new o;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var a=new o;for(var r in this)typeof this[r]!="function"&&(a[r]=this[r]);return a}}(o.prototype=h("./object")).loadAsync=h("./load"),o.support=h("./support"),o.defaults=h("./defaults"),o.version="3.10.1",o.loadAsync=function(a,r){return new o().loadAsync(a,r)},o.external=h("./external"),S.exports=o},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(h,S,y){var o=h("./utils"),a=h("./external"),r=h("./utf8"),l=h("./zipEntries"),f=h("./stream/Crc32Probe"),g=h("./nodejsUtils");function x(u){return new a.Promise(function(i,b){var s=u.decompressed.getContentWorker().pipe(new f);s.on("error",function(p){b(p)}).on("end",function(){s.streamInfo.crc32!==u.decompressed.crc32?b(new Error("Corrupted zip : CRC32 mismatch")):i()}).resume()})}S.exports=function(u,i){var b=this;return i=o.extend(i||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:r.utf8decode}),g.isNode&&g.isStream(u)?a.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):o.prepareContent("the loaded zip file",u,!0,i.optimizedBinaryString,i.base64).then(function(s){var p=new l(i);return p.load(s),p}).then(function(s){var p=[a.Promise.resolve(s)],d=s.files;if(i.checkCRC32)for(var v=0;v<d.length;v++)p.push(x(d[v]));return a.Promise.all(p)}).then(function(s){for(var p=s.shift(),d=p.files,v=0;v<d.length;v++){var w=d[v],C=w.fileNameStr,N=o.resolve(w.fileNameStr);b.file(N,w.decompressed,{binary:!0,optimizedBinaryString:!0,date:w.date,dir:w.dir,comment:w.fileCommentStr.length?w.fileCommentStr:null,unixPermissions:w.unixPermissions,dosPermissions:w.dosPermissions,createFolders:i.createFolders}),w.dir||(b.file(N).unsafeOriginalName=C)}return p.zipComment.length&&(b.comment=p.zipComment),b})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(h,S,y){var o=h("../utils"),a=h("../stream/GenericWorker");function r(l,f){a.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(f)}o.inherits(r,a),r.prototype._bindStream=function(l){var f=this;(this._stream=l).pause(),l.on("data",function(g){f.push({data:g,meta:{percent:0}})}).on("error",function(g){f.isPaused?this.generatedError=g:f.error(g)}).on("end",function(){f.isPaused?f._upstreamEnded=!0:f.end()})},r.prototype.pause=function(){return!!a.prototype.pause.call(this)&&(this._stream.pause(),!0)},r.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},S.exports=r},{"../stream/GenericWorker":28,"../utils":32}],13:[function(h,S,y){var o=h("readable-stream").Readable;function a(r,l,f){o.call(this,l),this._helper=r;var g=this;r.on("data",function(x,u){g.push(x)||g._helper.pause(),f&&f(u)}).on("error",function(x){g.emit("error",x)}).on("end",function(){g.push(null)})}h("../utils").inherits(a,o),a.prototype._read=function(){this._helper.resume()},S.exports=a},{"../utils":32,"readable-stream":16}],14:[function(h,S,y){S.exports={isNode:typeof Buffer<"u",newBufferFrom:function(o,a){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(o,a);if(typeof o=="number")throw new Error('The "data" argument must not be a number');return new Buffer(o,a)},allocBuffer:function(o){if(Buffer.alloc)return Buffer.alloc(o);var a=new Buffer(o);return a.fill(0),a},isBuffer:function(o){return Buffer.isBuffer(o)},isStream:function(o){return o&&typeof o.on=="function"&&typeof o.pause=="function"&&typeof o.resume=="function"}}},{}],15:[function(h,S,y){function o(N,U,T){var O,I=r.getTypeOf(U),G=r.extend(T||{},g);G.date=G.date||new Date,G.compression!==null&&(G.compression=G.compression.toUpperCase()),typeof G.unixPermissions=="string"&&(G.unixPermissions=parseInt(G.unixPermissions,8)),G.unixPermissions&&16384&G.unixPermissions&&(G.dir=!0),G.dosPermissions&&16&G.dosPermissions&&(G.dir=!0),G.dir&&(N=d(N)),G.createFolders&&(O=p(N))&&v.call(this,O,!0);var X=I==="string"&&G.binary===!1&&G.base64===!1;T&&T.binary!==void 0||(G.binary=!X),(U instanceof x&&U.uncompressedSize===0||G.dir||!U||U.length===0)&&(G.base64=!1,G.binary=!0,U="",G.compression="STORE",I="string");var _=null;_=U instanceof x||U instanceof l?U:b.isNode&&b.isStream(U)?new s(N,U):r.prepareContent(N,U,G.binary,G.optimizedBinaryString,G.base64);var R=new u(N,_,G);this.files[N]=R}var a=h("./utf8"),r=h("./utils"),l=h("./stream/GenericWorker"),f=h("./stream/StreamHelper"),g=h("./defaults"),x=h("./compressedObject"),u=h("./zipObject"),i=h("./generate"),b=h("./nodejsUtils"),s=h("./nodejs/NodejsStreamInputAdapter"),p=function(N){N.slice(-1)==="/"&&(N=N.substring(0,N.length-1));var U=N.lastIndexOf("/");return 0<U?N.substring(0,U):""},d=function(N){return N.slice(-1)!=="/"&&(N+="/"),N},v=function(N,U){return U=U!==void 0?U:g.createFolders,N=d(N),this.files[N]||o.call(this,N,null,{dir:!0,createFolders:U}),this.files[N]};function w(N){return Object.prototype.toString.call(N)==="[object RegExp]"}var C={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(N){var U,T,O;for(U in this.files)O=this.files[U],(T=U.slice(this.root.length,U.length))&&U.slice(0,this.root.length)===this.root&&N(T,O)},filter:function(N){var U=[];return this.forEach(function(T,O){N(T,O)&&U.push(O)}),U},file:function(N,U,T){if(arguments.length!==1)return N=this.root+N,o.call(this,N,U,T),this;if(w(N)){var O=N;return this.filter(function(G,X){return!X.dir&&O.test(G)})}var I=this.files[this.root+N];return I&&!I.dir?I:null},folder:function(N){if(!N)return this;if(w(N))return this.filter(function(I,G){return G.dir&&N.test(I)});var U=this.root+N,T=v.call(this,U),O=this.clone();return O.root=T.name,O},remove:function(N){N=this.root+N;var U=this.files[N];if(U||(N.slice(-1)!=="/"&&(N+="/"),U=this.files[N]),U&&!U.dir)delete this.files[N];else for(var T=this.filter(function(I,G){return G.name.slice(0,N.length)===N}),O=0;O<T.length;O++)delete this.files[T[O].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(N){var U,T={};try{if((T=r.extend(N||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:a.utf8encode})).type=T.type.toLowerCase(),T.compression=T.compression.toUpperCase(),T.type==="binarystring"&&(T.type="string"),!T.type)throw new Error("No output type specified.");r.checkSupport(T.type),T.platform!=="darwin"&&T.platform!=="freebsd"&&T.platform!=="linux"&&T.platform!=="sunos"||(T.platform="UNIX"),T.platform==="win32"&&(T.platform="DOS");var O=T.comment||this.comment||"";U=i.generateWorker(this,T,O)}catch(I){(U=new l("error")).error(I)}return new f(U,T.type||"string",T.mimeType)},generateAsync:function(N,U){return this.generateInternalStream(N).accumulate(U)},generateNodeStream:function(N,U){return(N=N||{}).type||(N.type="nodebuffer"),this.generateInternalStream(N).toNodejsStream(U)}};S.exports=C},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(h,S,y){S.exports=h("stream")},{stream:void 0}],17:[function(h,S,y){var o=h("./DataReader");function a(r){o.call(this,r);for(var l=0;l<this.data.length;l++)r[l]=255&r[l]}h("../utils").inherits(a,o),a.prototype.byteAt=function(r){return this.data[this.zero+r]},a.prototype.lastIndexOfSignature=function(r){for(var l=r.charCodeAt(0),f=r.charCodeAt(1),g=r.charCodeAt(2),x=r.charCodeAt(3),u=this.length-4;0<=u;--u)if(this.data[u]===l&&this.data[u+1]===f&&this.data[u+2]===g&&this.data[u+3]===x)return u-this.zero;return-1},a.prototype.readAndCheckSignature=function(r){var l=r.charCodeAt(0),f=r.charCodeAt(1),g=r.charCodeAt(2),x=r.charCodeAt(3),u=this.readData(4);return l===u[0]&&f===u[1]&&g===u[2]&&x===u[3]},a.prototype.readData=function(r){if(this.checkOffset(r),r===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,l},S.exports=a},{"../utils":32,"./DataReader":18}],18:[function(h,S,y){var o=h("../utils");function a(r){this.data=r,this.length=r.length,this.index=0,this.zero=0}a.prototype={checkOffset:function(r){this.checkIndex(this.index+r)},checkIndex:function(r){if(this.length<this.zero+r||r<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+r+"). Corrupted zip ?")},setIndex:function(r){this.checkIndex(r),this.index=r},skip:function(r){this.setIndex(this.index+r)},byteAt:function(){},readInt:function(r){var l,f=0;for(this.checkOffset(r),l=this.index+r-1;l>=this.index;l--)f=(f<<8)+this.byteAt(l);return this.index+=r,f},readString:function(r){return o.transformTo("string",this.readData(r))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var r=this.readInt(4);return new Date(Date.UTC(1980+(r>>25&127),(r>>21&15)-1,r>>16&31,r>>11&31,r>>5&63,(31&r)<<1))}},S.exports=a},{"../utils":32}],19:[function(h,S,y){var o=h("./Uint8ArrayReader");function a(r){o.call(this,r)}h("../utils").inherits(a,o),a.prototype.readData=function(r){this.checkOffset(r);var l=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,l},S.exports=a},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(h,S,y){var o=h("./DataReader");function a(r){o.call(this,r)}h("../utils").inherits(a,o),a.prototype.byteAt=function(r){return this.data.charCodeAt(this.zero+r)},a.prototype.lastIndexOfSignature=function(r){return this.data.lastIndexOf(r)-this.zero},a.prototype.readAndCheckSignature=function(r){return r===this.readData(4)},a.prototype.readData=function(r){this.checkOffset(r);var l=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,l},S.exports=a},{"../utils":32,"./DataReader":18}],21:[function(h,S,y){var o=h("./ArrayReader");function a(r){o.call(this,r)}h("../utils").inherits(a,o),a.prototype.readData=function(r){if(this.checkOffset(r),r===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+r);return this.index+=r,l},S.exports=a},{"../utils":32,"./ArrayReader":17}],22:[function(h,S,y){var o=h("../utils"),a=h("../support"),r=h("./ArrayReader"),l=h("./StringReader"),f=h("./NodeBufferReader"),g=h("./Uint8ArrayReader");S.exports=function(x){var u=o.getTypeOf(x);return o.checkSupport(u),u!=="string"||a.uint8array?u==="nodebuffer"?new f(x):a.uint8array?new g(o.transformTo("uint8array",x)):new r(o.transformTo("array",x)):new l(x)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(h,S,y){y.LOCAL_FILE_HEADER="PK",y.CENTRAL_FILE_HEADER="PK",y.CENTRAL_DIRECTORY_END="PK",y.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",y.ZIP64_CENTRAL_DIRECTORY_END="PK",y.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(h,S,y){var o=h("./GenericWorker"),a=h("../utils");function r(l){o.call(this,"ConvertWorker to "+l),this.destType=l}a.inherits(r,o),r.prototype.processChunk=function(l){this.push({data:a.transformTo(this.destType,l.data),meta:l.meta})},S.exports=r},{"../utils":32,"./GenericWorker":28}],25:[function(h,S,y){var o=h("./GenericWorker"),a=h("../crc32");function r(){o.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}h("../utils").inherits(r,o),r.prototype.processChunk=function(l){this.streamInfo.crc32=a(l.data,this.streamInfo.crc32||0),this.push(l)},S.exports=r},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(h,S,y){var o=h("../utils"),a=h("./GenericWorker");function r(l){a.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}o.inherits(r,a),r.prototype.processChunk=function(l){if(l){var f=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=f+l.data.length}a.prototype.processChunk.call(this,l)},S.exports=r},{"../utils":32,"./GenericWorker":28}],27:[function(h,S,y){var o=h("../utils"),a=h("./GenericWorker");function r(l){a.call(this,"DataWorker");var f=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(g){f.dataIsReady=!0,f.data=g,f.max=g&&g.length||0,f.type=o.getTypeOf(g),f.isPaused||f._tickAndRepeat()},function(g){f.error(g)})}o.inherits(r,a),r.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this.data=null},r.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,o.delay(this._tickAndRepeat,[],this)),!0)},r.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(o.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},r.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,f=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,f);break;case"uint8array":l=this.data.subarray(this.index,f);break;case"array":case"nodebuffer":l=this.data.slice(this.index,f)}return this.index=f,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},S.exports=r},{"../utils":32,"./GenericWorker":28}],28:[function(h,S,y){function o(a){this.name=a||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}o.prototype={push:function(a){this.emit("data",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit("error",a)}return!0},error:function(a){return!this.isFinished&&(this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",a),this.previous&&this.previous.error(a),this.cleanUp()),!0)},on:function(a,r){return this._listeners[a].push(r),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(a,r){if(this._listeners[a])for(var l=0;l<this._listeners[a].length;l++)this._listeners[a][l].call(this,r)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=a.streamInfo,this.mergeStreamInfo(),this.previous=a;var r=this;return a.on("data",function(l){r.processChunk(l)}),a.on("end",function(){r.end()}),a.on("error",function(l){r.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var a=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),a=!0),this.previous&&this.previous.resume(),!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,r){return this.extraStreamInfo[a]=r,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var a="Worker "+this.name;return this.previous?this.previous+" -> "+a:a}},S.exports=o},{}],29:[function(h,S,y){var o=h("../utils"),a=h("./ConvertWorker"),r=h("./GenericWorker"),l=h("../base64"),f=h("../support"),g=h("../external"),x=null;if(f.nodestream)try{x=h("../nodejs/NodejsStreamOutputAdapter")}catch{}function u(b,s){return new g.Promise(function(p,d){var v=[],w=b._internalType,C=b._outputType,N=b._mimeType;b.on("data",function(U,T){v.push(U),s&&s(T)}).on("error",function(U){v=[],d(U)}).on("end",function(){try{var U=(function(T,O,I){switch(T){case"blob":return o.newBlob(o.transformTo("arraybuffer",O),I);case"base64":return l.encode(O);default:return o.transformTo(T,O)}})(C,(function(T,O){var I,G=0,X=null,_=0;for(I=0;I<O.length;I++)_+=O[I].length;switch(T){case"string":return O.join("");case"array":return Array.prototype.concat.apply([],O);case"uint8array":for(X=new Uint8Array(_),I=0;I<O.length;I++)X.set(O[I],G),G+=O[I].length;return X;case"nodebuffer":return Buffer.concat(O);default:throw new Error("concat : unsupported type '"+T+"'")}})(w,v),N);p(U)}catch(T){d(T)}v=[]}).resume()})}function i(b,s,p){var d=s;switch(s){case"blob":case"arraybuffer":d="uint8array";break;case"base64":d="string"}try{this._internalType=d,this._outputType=s,this._mimeType=p,o.checkSupport(d),this._worker=b.pipe(new a(d)),b.lock()}catch(v){this._worker=new r("error"),this._worker.error(v)}}i.prototype={accumulate:function(b){return u(this,b)},on:function(b,s){var p=this;return b==="data"?this._worker.on(b,function(d){s.call(p,d.data,d.meta)}):this._worker.on(b,function(){o.delay(s,arguments,p)}),this},resume:function(){return o.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(b){if(o.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new x(this,{objectMode:this._outputType!=="nodebuffer"},b)}},S.exports=i},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(h,S,y){if(y.base64=!0,y.array=!0,y.string=!0,y.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",y.nodebuffer=typeof Buffer<"u",y.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")y.blob=!1;else{var o=new ArrayBuffer(0);try{y.blob=new Blob([o],{type:"application/zip"}).size===0}catch{try{var a=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);a.append(o),y.blob=a.getBlob("application/zip").size===0}catch{y.blob=!1}}}try{y.nodestream=!!h("readable-stream").Readable}catch{y.nodestream=!1}},{"readable-stream":16}],31:[function(h,S,y){for(var o=h("./utils"),a=h("./support"),r=h("./nodejsUtils"),l=h("./stream/GenericWorker"),f=new Array(256),g=0;g<256;g++)f[g]=252<=g?6:248<=g?5:240<=g?4:224<=g?3:192<=g?2:1;f[254]=f[254]=1;function x(){l.call(this,"utf-8 decode"),this.leftOver=null}function u(){l.call(this,"utf-8 encode")}y.utf8encode=function(i){return a.nodebuffer?r.newBufferFrom(i,"utf-8"):(function(b){var s,p,d,v,w,C=b.length,N=0;for(v=0;v<C;v++)(64512&(p=b.charCodeAt(v)))==55296&&v+1<C&&(64512&(d=b.charCodeAt(v+1)))==56320&&(p=65536+(p-55296<<10)+(d-56320),v++),N+=p<128?1:p<2048?2:p<65536?3:4;for(s=a.uint8array?new Uint8Array(N):new Array(N),v=w=0;w<N;v++)(64512&(p=b.charCodeAt(v)))==55296&&v+1<C&&(64512&(d=b.charCodeAt(v+1)))==56320&&(p=65536+(p-55296<<10)+(d-56320),v++),p<128?s[w++]=p:(p<2048?s[w++]=192|p>>>6:(p<65536?s[w++]=224|p>>>12:(s[w++]=240|p>>>18,s[w++]=128|p>>>12&63),s[w++]=128|p>>>6&63),s[w++]=128|63&p);return s})(i)},y.utf8decode=function(i){return a.nodebuffer?o.transformTo("nodebuffer",i).toString("utf-8"):(function(b){var s,p,d,v,w=b.length,C=new Array(2*w);for(s=p=0;s<w;)if((d=b[s++])<128)C[p++]=d;else if(4<(v=f[d]))C[p++]=65533,s+=v-1;else{for(d&=v===2?31:v===3?15:7;1<v&&s<w;)d=d<<6|63&b[s++],v--;1<v?C[p++]=65533:d<65536?C[p++]=d:(d-=65536,C[p++]=55296|d>>10&1023,C[p++]=56320|1023&d)}return C.length!==p&&(C.subarray?C=C.subarray(0,p):C.length=p),o.applyFromCharCode(C)})(i=o.transformTo(a.uint8array?"uint8array":"array",i))},o.inherits(x,l),x.prototype.processChunk=function(i){var b=o.transformTo(a.uint8array?"uint8array":"array",i.data);if(this.leftOver&&this.leftOver.length){if(a.uint8array){var s=b;(b=new Uint8Array(s.length+this.leftOver.length)).set(this.leftOver,0),b.set(s,this.leftOver.length)}else b=this.leftOver.concat(b);this.leftOver=null}var p=(function(v,w){var C;for((w=w||v.length)>v.length&&(w=v.length),C=w-1;0<=C&&(192&v[C])==128;)C--;return C<0||C===0?w:C+f[v[C]]>w?C:w})(b),d=b;p!==b.length&&(a.uint8array?(d=b.subarray(0,p),this.leftOver=b.subarray(p,b.length)):(d=b.slice(0,p),this.leftOver=b.slice(p,b.length))),this.push({data:y.utf8decode(d),meta:i.meta})},x.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:y.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},y.Utf8DecodeWorker=x,o.inherits(u,l),u.prototype.processChunk=function(i){this.push({data:y.utf8encode(i.data),meta:i.meta})},y.Utf8EncodeWorker=u},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(h,S,y){var o=h("./support"),a=h("./base64"),r=h("./nodejsUtils"),l=h("./external");function f(s){return s}function g(s,p){for(var d=0;d<s.length;++d)p[d]=255&s.charCodeAt(d);return p}h("setimmediate"),y.newBlob=function(s,p){y.checkSupport("blob");try{return new Blob([s],{type:p})}catch{try{var d=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return d.append(s),d.getBlob(p)}catch{throw new Error("Bug : can't construct the Blob.")}}};var x={stringifyByChunk:function(s,p,d){var v=[],w=0,C=s.length;if(C<=d)return String.fromCharCode.apply(null,s);for(;w<C;)p==="array"||p==="nodebuffer"?v.push(String.fromCharCode.apply(null,s.slice(w,Math.min(w+d,C)))):v.push(String.fromCharCode.apply(null,s.subarray(w,Math.min(w+d,C)))),w+=d;return v.join("")},stringifyByChar:function(s){for(var p="",d=0;d<s.length;d++)p+=String.fromCharCode(s[d]);return p},applyCanBeUsed:{uint8array:(function(){try{return o.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return o.nodebuffer&&String.fromCharCode.apply(null,r.allocBuffer(1)).length===1}catch{return!1}})()}};function u(s){var p=65536,d=y.getTypeOf(s),v=!0;if(d==="uint8array"?v=x.applyCanBeUsed.uint8array:d==="nodebuffer"&&(v=x.applyCanBeUsed.nodebuffer),v)for(;1<p;)try{return x.stringifyByChunk(s,d,p)}catch{p=Math.floor(p/2)}return x.stringifyByChar(s)}function i(s,p){for(var d=0;d<s.length;d++)p[d]=s[d];return p}y.applyFromCharCode=u;var b={};b.string={string:f,array:function(s){return g(s,new Array(s.length))},arraybuffer:function(s){return b.string.uint8array(s).buffer},uint8array:function(s){return g(s,new Uint8Array(s.length))},nodebuffer:function(s){return g(s,r.allocBuffer(s.length))}},b.array={string:u,array:f,arraybuffer:function(s){return new Uint8Array(s).buffer},uint8array:function(s){return new Uint8Array(s)},nodebuffer:function(s){return r.newBufferFrom(s)}},b.arraybuffer={string:function(s){return u(new Uint8Array(s))},array:function(s){return i(new Uint8Array(s),new Array(s.byteLength))},arraybuffer:f,uint8array:function(s){return new Uint8Array(s)},nodebuffer:function(s){return r.newBufferFrom(new Uint8Array(s))}},b.uint8array={string:u,array:function(s){return i(s,new Array(s.length))},arraybuffer:function(s){return s.buffer},uint8array:f,nodebuffer:function(s){return r.newBufferFrom(s)}},b.nodebuffer={string:u,array:function(s){return i(s,new Array(s.length))},arraybuffer:function(s){return b.nodebuffer.uint8array(s).buffer},uint8array:function(s){return i(s,new Uint8Array(s.length))},nodebuffer:f},y.transformTo=function(s,p){if(p=p||"",!s)return p;y.checkSupport(s);var d=y.getTypeOf(p);return b[d][s](p)},y.resolve=function(s){for(var p=s.split("/"),d=[],v=0;v<p.length;v++){var w=p[v];w==="."||w===""&&v!==0&&v!==p.length-1||(w===".."?d.pop():d.push(w))}return d.join("/")},y.getTypeOf=function(s){return typeof s=="string"?"string":Object.prototype.toString.call(s)==="[object Array]"?"array":o.nodebuffer&&r.isBuffer(s)?"nodebuffer":o.uint8array&&s instanceof Uint8Array?"uint8array":o.arraybuffer&&s instanceof ArrayBuffer?"arraybuffer":void 0},y.checkSupport=function(s){if(!o[s.toLowerCase()])throw new Error(s+" is not supported by this platform")},y.MAX_VALUE_16BITS=65535,y.MAX_VALUE_32BITS=-1,y.pretty=function(s){var p,d,v="";for(d=0;d<(s||"").length;d++)v+="\\x"+((p=s.charCodeAt(d))<16?"0":"")+p.toString(16).toUpperCase();return v},y.delay=function(s,p,d){setImmediate(function(){s.apply(d||null,p||[])})},y.inherits=function(s,p){function d(){}d.prototype=p.prototype,s.prototype=new d},y.extend=function(){var s,p,d={};for(s=0;s<arguments.length;s++)for(p in arguments[s])Object.prototype.hasOwnProperty.call(arguments[s],p)&&d[p]===void 0&&(d[p]=arguments[s][p]);return d},y.prepareContent=function(s,p,d,v,w){return l.Promise.resolve(p).then(function(C){return o.blob&&(C instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(C))!==-1)&&typeof FileReader<"u"?new l.Promise(function(N,U){var T=new FileReader;T.onload=function(O){N(O.target.result)},T.onerror=function(O){U(O.target.error)},T.readAsArrayBuffer(C)}):C}).then(function(C){var N=y.getTypeOf(C);return N?(N==="arraybuffer"?C=y.transformTo("uint8array",C):N==="string"&&(w?C=a.decode(C):d&&v!==!0&&(C=(function(U){return g(U,o.uint8array?new Uint8Array(U.length):new Array(U.length))})(C))),C):l.Promise.reject(new Error("Can't read the data of '"+s+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(h,S,y){var o=h("./reader/readerFor"),a=h("./utils"),r=h("./signature"),l=h("./zipEntry"),f=h("./support");function g(x){this.files=[],this.loadOptions=x}g.prototype={checkSignature:function(x){if(!this.reader.readAndCheckSignature(x)){this.reader.index-=4;var u=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+a.pretty(u)+", expected "+a.pretty(x)+")")}},isSignature:function(x,u){var i=this.reader.index;this.reader.setIndex(x);var b=this.reader.readString(4)===u;return this.reader.setIndex(i),b},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var x=this.reader.readData(this.zipCommentLength),u=f.uint8array?"uint8array":"array",i=a.transformTo(u,x);this.zipComment=this.loadOptions.decodeFileName(i)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var x,u,i,b=this.zip64EndOfCentralSize-44;0<b;)x=this.reader.readInt(2),u=this.reader.readInt(4),i=this.reader.readData(u),this.zip64ExtensibleData[x]={id:x,length:u,value:i}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var x,u;for(x=0;x<this.files.length;x++)u=this.files[x],this.reader.setIndex(u.localHeaderOffset),this.checkSignature(r.LOCAL_FILE_HEADER),u.readLocalPart(this.reader),u.handleUTF8(),u.processAttributes()},readCentralDir:function(){var x;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(r.CENTRAL_FILE_HEADER);)(x=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(x);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var x=this.reader.lastIndexOfSignature(r.CENTRAL_DIRECTORY_END);if(x<0)throw this.isSignature(0,r.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(x);var u=x;if(this.checkSignature(r.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===a.MAX_VALUE_16BITS||this.diskWithCentralDirStart===a.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===a.MAX_VALUE_16BITS||this.centralDirRecords===a.MAX_VALUE_16BITS||this.centralDirSize===a.MAX_VALUE_32BITS||this.centralDirOffset===a.MAX_VALUE_32BITS){if(this.zip64=!0,(x=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(x),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,r.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var i=this.centralDirOffset+this.centralDirSize;this.zip64&&(i+=20,i+=12+this.zip64EndOfCentralSize);var b=u-i;if(0<b)this.isSignature(u,r.CENTRAL_FILE_HEADER)||(this.reader.zero=b);else if(b<0)throw new Error("Corrupted zip: missing "+Math.abs(b)+" bytes.")},prepareReader:function(x){this.reader=o(x)},load:function(x){this.prepareReader(x),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},S.exports=g},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(h,S,y){var o=h("./reader/readerFor"),a=h("./utils"),r=h("./compressedObject"),l=h("./crc32"),f=h("./utf8"),g=h("./compressions"),x=h("./support");function u(i,b){this.options=i,this.loadOptions=b}u.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(i){var b,s;if(i.skip(22),this.fileNameLength=i.readInt(2),s=i.readInt(2),this.fileName=i.readData(this.fileNameLength),i.skip(s),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((b=(function(p){for(var d in g)if(Object.prototype.hasOwnProperty.call(g,d)&&g[d].magic===p)return g[d];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+a.pretty(this.compressionMethod)+" unknown (inner file : "+a.transformTo("string",this.fileName)+")");this.decompressed=new r(this.compressedSize,this.uncompressedSize,this.crc32,b,i.readData(this.compressedSize))},readCentralPart:function(i){this.versionMadeBy=i.readInt(2),i.skip(2),this.bitFlag=i.readInt(2),this.compressionMethod=i.readString(2),this.date=i.readDate(),this.crc32=i.readInt(4),this.compressedSize=i.readInt(4),this.uncompressedSize=i.readInt(4);var b=i.readInt(2);if(this.extraFieldsLength=i.readInt(2),this.fileCommentLength=i.readInt(2),this.diskNumberStart=i.readInt(2),this.internalFileAttributes=i.readInt(2),this.externalFileAttributes=i.readInt(4),this.localHeaderOffset=i.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");i.skip(b),this.readExtraFields(i),this.parseZIP64ExtraField(i),this.fileComment=i.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var i=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),i==0&&(this.dosPermissions=63&this.externalFileAttributes),i==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var i=o(this.extraFields[1].value);this.uncompressedSize===a.MAX_VALUE_32BITS&&(this.uncompressedSize=i.readInt(8)),this.compressedSize===a.MAX_VALUE_32BITS&&(this.compressedSize=i.readInt(8)),this.localHeaderOffset===a.MAX_VALUE_32BITS&&(this.localHeaderOffset=i.readInt(8)),this.diskNumberStart===a.MAX_VALUE_32BITS&&(this.diskNumberStart=i.readInt(4))}},readExtraFields:function(i){var b,s,p,d=i.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});i.index+4<d;)b=i.readInt(2),s=i.readInt(2),p=i.readData(s),this.extraFields[b]={id:b,length:s,value:p};i.setIndex(d)},handleUTF8:function(){var i=x.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=f.utf8decode(this.fileName),this.fileCommentStr=f.utf8decode(this.fileComment);else{var b=this.findExtraFieldUnicodePath();if(b!==null)this.fileNameStr=b;else{var s=a.transformTo(i,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(s)}var p=this.findExtraFieldUnicodeComment();if(p!==null)this.fileCommentStr=p;else{var d=a.transformTo(i,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(d)}}},findExtraFieldUnicodePath:function(){var i=this.extraFields[28789];if(i){var b=o(i.value);return b.readInt(1)!==1||l(this.fileName)!==b.readInt(4)?null:f.utf8decode(b.readData(i.length-5))}return null},findExtraFieldUnicodeComment:function(){var i=this.extraFields[25461];if(i){var b=o(i.value);return b.readInt(1)!==1||l(this.fileComment)!==b.readInt(4)?null:f.utf8decode(b.readData(i.length-5))}return null}},S.exports=u},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(h,S,y){function o(b,s,p){this.name=b,this.dir=p.dir,this.date=p.date,this.comment=p.comment,this.unixPermissions=p.unixPermissions,this.dosPermissions=p.dosPermissions,this._data=s,this._dataBinary=p.binary,this.options={compression:p.compression,compressionOptions:p.compressionOptions}}var a=h("./stream/StreamHelper"),r=h("./stream/DataWorker"),l=h("./utf8"),f=h("./compressedObject"),g=h("./stream/GenericWorker");o.prototype={internalStream:function(b){var s=null,p="string";try{if(!b)throw new Error("No output type specified.");var d=(p=b.toLowerCase())==="string"||p==="text";p!=="binarystring"&&p!=="text"||(p="string"),s=this._decompressWorker();var v=!this._dataBinary;v&&!d&&(s=s.pipe(new l.Utf8EncodeWorker)),!v&&d&&(s=s.pipe(new l.Utf8DecodeWorker))}catch(w){(s=new g("error")).error(w)}return new a(s,p,"")},async:function(b,s){return this.internalStream(b).accumulate(s)},nodeStream:function(b,s){return this.internalStream(b||"nodebuffer").toNodejsStream(s)},_compressWorker:function(b,s){if(this._data instanceof f&&this._data.compression.magic===b.magic)return this._data.getCompressedWorker();var p=this._decompressWorker();return this._dataBinary||(p=p.pipe(new l.Utf8EncodeWorker)),f.createWorkerFrom(p,b,s)},_decompressWorker:function(){return this._data instanceof f?this._data.getContentWorker():this._data instanceof g?this._data:new r(this._data)}};for(var x=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],u=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},i=0;i<x.length;i++)o.prototype[x[i]]=u;S.exports=o},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(h,S,y){(function(o){var a,r,l=o.MutationObserver||o.WebKitMutationObserver;if(l){var f=0,g=new l(b),x=o.document.createTextNode("");g.observe(x,{characterData:!0}),a=function(){x.data=f=++f%2}}else if(o.setImmediate||o.MessageChannel===void 0)a="document"in o&&"onreadystatechange"in o.document.createElement("script")?function(){var s=o.document.createElement("script");s.onreadystatechange=function(){b(),s.onreadystatechange=null,s.parentNode.removeChild(s),s=null},o.document.documentElement.appendChild(s)}:function(){setTimeout(b,0)};else{var u=new o.MessageChannel;u.port1.onmessage=b,a=function(){u.port2.postMessage(0)}}var i=[];function b(){var s,p;r=!0;for(var d=i.length;d;){for(p=i,i=[],s=-1;++s<d;)p[s]();d=i.length}r=!1}S.exports=function(s){i.push(s)!==1||r||a()}}).call(this,typeof ge<"u"?ge:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(h,S,y){var o=h("immediate");function a(){}var r={},l=["REJECTED"],f=["FULFILLED"],g=["PENDING"];function x(d){if(typeof d!="function")throw new TypeError("resolver must be a function");this.state=g,this.queue=[],this.outcome=void 0,d!==a&&s(this,d)}function u(d,v,w){this.promise=d,typeof v=="function"&&(this.onFulfilled=v,this.callFulfilled=this.otherCallFulfilled),typeof w=="function"&&(this.onRejected=w,this.callRejected=this.otherCallRejected)}function i(d,v,w){o(function(){var C;try{C=v(w)}catch(N){return r.reject(d,N)}C===d?r.reject(d,new TypeError("Cannot resolve promise with itself")):r.resolve(d,C)})}function b(d){var v=d&&d.then;if(d&&(typeof d=="object"||typeof d=="function")&&typeof v=="function")return function(){v.apply(d,arguments)}}function s(d,v){var w=!1;function C(T){w||(w=!0,r.reject(d,T))}function N(T){w||(w=!0,r.resolve(d,T))}var U=p(function(){v(N,C)});U.status==="error"&&C(U.value)}function p(d,v){var w={};try{w.value=d(v),w.status="success"}catch(C){w.status="error",w.value=C}return w}(S.exports=x).prototype.finally=function(d){if(typeof d!="function")return this;var v=this.constructor;return this.then(function(w){return v.resolve(d()).then(function(){return w})},function(w){return v.resolve(d()).then(function(){throw w})})},x.prototype.catch=function(d){return this.then(null,d)},x.prototype.then=function(d,v){if(typeof d!="function"&&this.state===f||typeof v!="function"&&this.state===l)return this;var w=new this.constructor(a);return this.state!==g?i(w,this.state===f?d:v,this.outcome):this.queue.push(new u(w,d,v)),w},u.prototype.callFulfilled=function(d){r.resolve(this.promise,d)},u.prototype.otherCallFulfilled=function(d){i(this.promise,this.onFulfilled,d)},u.prototype.callRejected=function(d){r.reject(this.promise,d)},u.prototype.otherCallRejected=function(d){i(this.promise,this.onRejected,d)},r.resolve=function(d,v){var w=p(b,v);if(w.status==="error")return r.reject(d,w.value);var C=w.value;if(C)s(d,C);else{d.state=f,d.outcome=v;for(var N=-1,U=d.queue.length;++N<U;)d.queue[N].callFulfilled(v)}return d},r.reject=function(d,v){d.state=l,d.outcome=v;for(var w=-1,C=d.queue.length;++w<C;)d.queue[w].callRejected(v);return d},x.resolve=function(d){return d instanceof this?d:r.resolve(new this(a),d)},x.reject=function(d){var v=new this(a);return r.reject(v,d)},x.all=function(d){var v=this;if(Object.prototype.toString.call(d)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=d.length,C=!1;if(!w)return this.resolve([]);for(var N=new Array(w),U=0,T=-1,O=new this(a);++T<w;)I(d[T],T);return O;function I(G,X){v.resolve(G).then(function(_){N[X]=_,++U!==w||C||(C=!0,r.resolve(O,N))},function(_){C||(C=!0,r.reject(O,_))})}},x.race=function(d){var v=this;if(Object.prototype.toString.call(d)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=d.length,C=!1;if(!w)return this.resolve([]);for(var N=-1,U=new this(a);++N<w;)T=d[N],v.resolve(T).then(function(O){C||(C=!0,r.resolve(U,O))},function(O){C||(C=!0,r.reject(U,O))});var T;return U}},{immediate:36}],38:[function(h,S,y){var o={};(0,h("./lib/utils/common").assign)(o,h("./lib/deflate"),h("./lib/inflate"),h("./lib/zlib/constants")),S.exports=o},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(h,S,y){var o=h("./zlib/deflate"),a=h("./utils/common"),r=h("./utils/strings"),l=h("./zlib/messages"),f=h("./zlib/zstream"),g=Object.prototype.toString,x=0,u=-1,i=0,b=8;function s(d){if(!(this instanceof s))return new s(d);this.options=a.assign({level:u,method:b,chunkSize:16384,windowBits:15,memLevel:8,strategy:i,to:""},d||{});var v=this.options;v.raw&&0<v.windowBits?v.windowBits=-v.windowBits:v.gzip&&0<v.windowBits&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var w=o.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(w!==x)throw new Error(l[w]);if(v.header&&o.deflateSetHeader(this.strm,v.header),v.dictionary){var C;if(C=typeof v.dictionary=="string"?r.string2buf(v.dictionary):g.call(v.dictionary)==="[object ArrayBuffer]"?new Uint8Array(v.dictionary):v.dictionary,(w=o.deflateSetDictionary(this.strm,C))!==x)throw new Error(l[w]);this._dict_set=!0}}function p(d,v){var w=new s(v);if(w.push(d,!0),w.err)throw w.msg||l[w.err];return w.result}s.prototype.push=function(d,v){var w,C,N=this.strm,U=this.options.chunkSize;if(this.ended)return!1;C=v===~~v?v:v===!0?4:0,typeof d=="string"?N.input=r.string2buf(d):g.call(d)==="[object ArrayBuffer]"?N.input=new Uint8Array(d):N.input=d,N.next_in=0,N.avail_in=N.input.length;do{if(N.avail_out===0&&(N.output=new a.Buf8(U),N.next_out=0,N.avail_out=U),(w=o.deflate(N,C))!==1&&w!==x)return this.onEnd(w),!(this.ended=!0);N.avail_out!==0&&(N.avail_in!==0||C!==4&&C!==2)||(this.options.to==="string"?this.onData(r.buf2binstring(a.shrinkBuf(N.output,N.next_out))):this.onData(a.shrinkBuf(N.output,N.next_out)))}while((0<N.avail_in||N.avail_out===0)&&w!==1);return C===4?(w=o.deflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===x):C!==2||(this.onEnd(x),!(N.avail_out=0))},s.prototype.onData=function(d){this.chunks.push(d)},s.prototype.onEnd=function(d){d===x&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=d,this.msg=this.strm.msg},y.Deflate=s,y.deflate=p,y.deflateRaw=function(d,v){return(v=v||{}).raw=!0,p(d,v)},y.gzip=function(d,v){return(v=v||{}).gzip=!0,p(d,v)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(h,S,y){var o=h("./zlib/inflate"),a=h("./utils/common"),r=h("./utils/strings"),l=h("./zlib/constants"),f=h("./zlib/messages"),g=h("./zlib/zstream"),x=h("./zlib/gzheader"),u=Object.prototype.toString;function i(s){if(!(this instanceof i))return new i(s);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},s||{});var p=this.options;p.raw&&0<=p.windowBits&&p.windowBits<16&&(p.windowBits=-p.windowBits,p.windowBits===0&&(p.windowBits=-15)),!(0<=p.windowBits&&p.windowBits<16)||s&&s.windowBits||(p.windowBits+=32),15<p.windowBits&&p.windowBits<48&&(15&p.windowBits)==0&&(p.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new g,this.strm.avail_out=0;var d=o.inflateInit2(this.strm,p.windowBits);if(d!==l.Z_OK)throw new Error(f[d]);this.header=new x,o.inflateGetHeader(this.strm,this.header)}function b(s,p){var d=new i(p);if(d.push(s,!0),d.err)throw d.msg||f[d.err];return d.result}i.prototype.push=function(s,p){var d,v,w,C,N,U,T=this.strm,O=this.options.chunkSize,I=this.options.dictionary,G=!1;if(this.ended)return!1;v=p===~~p?p:p===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof s=="string"?T.input=r.binstring2buf(s):u.call(s)==="[object ArrayBuffer]"?T.input=new Uint8Array(s):T.input=s,T.next_in=0,T.avail_in=T.input.length;do{if(T.avail_out===0&&(T.output=new a.Buf8(O),T.next_out=0,T.avail_out=O),(d=o.inflate(T,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&I&&(U=typeof I=="string"?r.string2buf(I):u.call(I)==="[object ArrayBuffer]"?new Uint8Array(I):I,d=o.inflateSetDictionary(this.strm,U)),d===l.Z_BUF_ERROR&&G===!0&&(d=l.Z_OK,G=!1),d!==l.Z_STREAM_END&&d!==l.Z_OK)return this.onEnd(d),!(this.ended=!0);T.next_out&&(T.avail_out!==0&&d!==l.Z_STREAM_END&&(T.avail_in!==0||v!==l.Z_FINISH&&v!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(w=r.utf8border(T.output,T.next_out),C=T.next_out-w,N=r.buf2string(T.output,w),T.next_out=C,T.avail_out=O-C,C&&a.arraySet(T.output,T.output,w,C,0),this.onData(N)):this.onData(a.shrinkBuf(T.output,T.next_out)))),T.avail_in===0&&T.avail_out===0&&(G=!0)}while((0<T.avail_in||T.avail_out===0)&&d!==l.Z_STREAM_END);return d===l.Z_STREAM_END&&(v=l.Z_FINISH),v===l.Z_FINISH?(d=o.inflateEnd(this.strm),this.onEnd(d),this.ended=!0,d===l.Z_OK):v!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(T.avail_out=0))},i.prototype.onData=function(s){this.chunks.push(s)},i.prototype.onEnd=function(s){s===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=s,this.msg=this.strm.msg},y.Inflate=i,y.inflate=b,y.inflateRaw=function(s,p){return(p=p||{}).raw=!0,b(s,p)},y.ungzip=b},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(h,S,y){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";y.assign=function(l){for(var f=Array.prototype.slice.call(arguments,1);f.length;){var g=f.shift();if(g){if(typeof g!="object")throw new TypeError(g+"must be non-object");for(var x in g)g.hasOwnProperty(x)&&(l[x]=g[x])}}return l},y.shrinkBuf=function(l,f){return l.length===f?l:l.subarray?l.subarray(0,f):(l.length=f,l)};var a={arraySet:function(l,f,g,x,u){if(f.subarray&&l.subarray)l.set(f.subarray(g,g+x),u);else for(var i=0;i<x;i++)l[u+i]=f[g+i]},flattenChunks:function(l){var f,g,x,u,i,b;for(f=x=0,g=l.length;f<g;f++)x+=l[f].length;for(b=new Uint8Array(x),f=u=0,g=l.length;f<g;f++)i=l[f],b.set(i,u),u+=i.length;return b}},r={arraySet:function(l,f,g,x,u){for(var i=0;i<x;i++)l[u+i]=f[g+i]},flattenChunks:function(l){return[].concat.apply([],l)}};y.setTyped=function(l){l?(y.Buf8=Uint8Array,y.Buf16=Uint16Array,y.Buf32=Int32Array,y.assign(y,a)):(y.Buf8=Array,y.Buf16=Array,y.Buf32=Array,y.assign(y,r))},y.setTyped(o)},{}],42:[function(h,S,y){var o=h("./common"),a=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch{a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{r=!1}for(var l=new o.Buf8(256),f=0;f<256;f++)l[f]=252<=f?6:248<=f?5:240<=f?4:224<=f?3:192<=f?2:1;function g(x,u){if(u<65537&&(x.subarray&&r||!x.subarray&&a))return String.fromCharCode.apply(null,o.shrinkBuf(x,u));for(var i="",b=0;b<u;b++)i+=String.fromCharCode(x[b]);return i}l[254]=l[254]=1,y.string2buf=function(x){var u,i,b,s,p,d=x.length,v=0;for(s=0;s<d;s++)(64512&(i=x.charCodeAt(s)))==55296&&s+1<d&&(64512&(b=x.charCodeAt(s+1)))==56320&&(i=65536+(i-55296<<10)+(b-56320),s++),v+=i<128?1:i<2048?2:i<65536?3:4;for(u=new o.Buf8(v),s=p=0;p<v;s++)(64512&(i=x.charCodeAt(s)))==55296&&s+1<d&&(64512&(b=x.charCodeAt(s+1)))==56320&&(i=65536+(i-55296<<10)+(b-56320),s++),i<128?u[p++]=i:(i<2048?u[p++]=192|i>>>6:(i<65536?u[p++]=224|i>>>12:(u[p++]=240|i>>>18,u[p++]=128|i>>>12&63),u[p++]=128|i>>>6&63),u[p++]=128|63&i);return u},y.buf2binstring=function(x){return g(x,x.length)},y.binstring2buf=function(x){for(var u=new o.Buf8(x.length),i=0,b=u.length;i<b;i++)u[i]=x.charCodeAt(i);return u},y.buf2string=function(x,u){var i,b,s,p,d=u||x.length,v=new Array(2*d);for(i=b=0;i<d;)if((s=x[i++])<128)v[b++]=s;else if(4<(p=l[s]))v[b++]=65533,i+=p-1;else{for(s&=p===2?31:p===3?15:7;1<p&&i<d;)s=s<<6|63&x[i++],p--;1<p?v[b++]=65533:s<65536?v[b++]=s:(s-=65536,v[b++]=55296|s>>10&1023,v[b++]=56320|1023&s)}return g(v,b)},y.utf8border=function(x,u){var i;for((u=u||x.length)>x.length&&(u=x.length),i=u-1;0<=i&&(192&x[i])==128;)i--;return i<0||i===0?u:i+l[x[i]]>u?i:u}},{"./common":41}],43:[function(h,S,y){S.exports=function(o,a,r,l){for(var f=65535&o|0,g=o>>>16&65535|0,x=0;r!==0;){for(r-=x=2e3<r?2e3:r;g=g+(f=f+a[l++]|0)|0,--x;);f%=65521,g%=65521}return f|g<<16|0}},{}],44:[function(h,S,y){S.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(h,S,y){var o=(function(){for(var a,r=[],l=0;l<256;l++){a=l;for(var f=0;f<8;f++)a=1&a?3988292384^a>>>1:a>>>1;r[l]=a}return r})();S.exports=function(a,r,l,f){var g=o,x=f+l;a^=-1;for(var u=f;u<x;u++)a=a>>>8^g[255&(a^r[u])];return-1^a}},{}],46:[function(h,S,y){var o,a=h("../utils/common"),r=h("./trees"),l=h("./adler32"),f=h("./crc32"),g=h("./messages"),x=0,u=4,i=0,b=-2,s=-1,p=4,d=2,v=8,w=9,C=286,N=30,U=19,T=2*C+1,O=15,I=3,G=258,X=G+I+1,_=42,R=113,t=1,D=2,ee=3,V=4;function te(e,B){return e.msg=g[B],B}function M(e){return(e<<1)-(4<e?9:0)}function Q(e){for(var B=e.length;0<=--B;)e[B]=0}function z(e){var B=e.state,F=B.pending;F>e.avail_out&&(F=e.avail_out),F!==0&&(a.arraySet(e.output,B.pending_buf,B.pending_out,F,e.next_out),e.next_out+=F,B.pending_out+=F,e.total_out+=F,e.avail_out-=F,B.pending-=F,B.pending===0&&(B.pending_out=0))}function E(e,B){r._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,B),e.block_start=e.strstart,z(e.strm)}function J(e,B){e.pending_buf[e.pending++]=B}function q(e,B){e.pending_buf[e.pending++]=B>>>8&255,e.pending_buf[e.pending++]=255&B}function K(e,B){var F,m,c=e.max_chain_length,j=e.strstart,P=e.prev_length,L=e.nice_match,A=e.strstart>e.w_size-X?e.strstart-(e.w_size-X):0,W=e.window,Y=e.w_mask,Z=e.prev,H=e.strstart+G,re=W[j+P-1],ne=W[j+P];e.prev_length>=e.good_match&&(c>>=2),L>e.lookahead&&(L=e.lookahead);do if(W[(F=B)+P]===ne&&W[F+P-1]===re&&W[F]===W[j]&&W[++F]===W[j+1]){j+=2,F++;do;while(W[++j]===W[++F]&&W[++j]===W[++F]&&W[++j]===W[++F]&&W[++j]===W[++F]&&W[++j]===W[++F]&&W[++j]===W[++F]&&W[++j]===W[++F]&&W[++j]===W[++F]&&j<H);if(m=G-(H-j),j=H-G,P<m){if(e.match_start=B,L<=(P=m))break;re=W[j+P-1],ne=W[j+P]}}while((B=Z[B&Y])>A&&--c!=0);return P<=e.lookahead?P:e.lookahead}function se(e){var B,F,m,c,j,P,L,A,W,Y,Z=e.w_size;do{if(c=e.window_size-e.lookahead-e.strstart,e.strstart>=Z+(Z-X)){for(a.arraySet(e.window,e.window,Z,Z,0),e.match_start-=Z,e.strstart-=Z,e.block_start-=Z,B=F=e.hash_size;m=e.head[--B],e.head[B]=Z<=m?m-Z:0,--F;);for(B=F=Z;m=e.prev[--B],e.prev[B]=Z<=m?m-Z:0,--F;);c+=Z}if(e.strm.avail_in===0)break;if(P=e.strm,L=e.window,A=e.strstart+e.lookahead,W=c,Y=void 0,Y=P.avail_in,W<Y&&(Y=W),F=Y===0?0:(P.avail_in-=Y,a.arraySet(L,P.input,P.next_in,Y,A),P.state.wrap===1?P.adler=l(P.adler,L,Y,A):P.state.wrap===2&&(P.adler=f(P.adler,L,Y,A)),P.next_in+=Y,P.total_in+=Y,Y),e.lookahead+=F,e.lookahead+e.insert>=I)for(j=e.strstart-e.insert,e.ins_h=e.window[j],e.ins_h=(e.ins_h<<e.hash_shift^e.window[j+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[j+I-1])&e.hash_mask,e.prev[j&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=j,j++,e.insert--,!(e.lookahead+e.insert<I)););}while(e.lookahead<X&&e.strm.avail_in!==0)}function ce(e,B){for(var F,m;;){if(e.lookahead<X){if(se(e),e.lookahead<X&&B===x)return t;if(e.lookahead===0)break}if(F=0,e.lookahead>=I&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+I-1])&e.hash_mask,F=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),F!==0&&e.strstart-F<=e.w_size-X&&(e.match_length=K(e,F)),e.match_length>=I)if(m=r._tr_tally(e,e.strstart-e.match_start,e.match_length-I),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=I){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+I-1])&e.hash_mask,F=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,--e.match_length!=0;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else m=r._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(m&&(E(e,!1),e.strm.avail_out===0))return t}return e.insert=e.strstart<I-1?e.strstart:I-1,B===u?(E(e,!0),e.strm.avail_out===0?ee:V):e.last_lit&&(E(e,!1),e.strm.avail_out===0)?t:D}function ae(e,B){for(var F,m,c;;){if(e.lookahead<X){if(se(e),e.lookahead<X&&B===x)return t;if(e.lookahead===0)break}if(F=0,e.lookahead>=I&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+I-1])&e.hash_mask,F=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=I-1,F!==0&&e.prev_length<e.max_lazy_match&&e.strstart-F<=e.w_size-X&&(e.match_length=K(e,F),e.match_length<=5&&(e.strategy===1||e.match_length===I&&4096<e.strstart-e.match_start)&&(e.match_length=I-1)),e.prev_length>=I&&e.match_length<=e.prev_length){for(c=e.strstart+e.lookahead-I,m=r._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-I),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=c&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+I-1])&e.hash_mask,F=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),--e.prev_length!=0;);if(e.match_available=0,e.match_length=I-1,e.strstart++,m&&(E(e,!1),e.strm.avail_out===0))return t}else if(e.match_available){if((m=r._tr_tally(e,0,e.window[e.strstart-1]))&&E(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return t}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(m=r._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<I-1?e.strstart:I-1,B===u?(E(e,!0),e.strm.avail_out===0?ee:V):e.last_lit&&(E(e,!1),e.strm.avail_out===0)?t:D}function ie(e,B,F,m,c){this.good_length=e,this.max_lazy=B,this.nice_length=F,this.max_chain=m,this.func=c}function de(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(2*T),this.dyn_dtree=new a.Buf16(2*(2*N+1)),this.bl_tree=new a.Buf16(2*(2*U+1)),Q(this.dyn_ltree),Q(this.dyn_dtree),Q(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(O+1),this.heap=new a.Buf16(2*C+1),Q(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(2*C+1),Q(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function oe(e){var B;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=d,(B=e.state).pending=0,B.pending_out=0,B.wrap<0&&(B.wrap=-B.wrap),B.status=B.wrap?_:R,e.adler=B.wrap===2?0:1,B.last_flush=x,r._tr_init(B),i):te(e,b)}function he(e){var B=oe(e);return B===i&&(function(F){F.window_size=2*F.w_size,Q(F.head),F.max_lazy_match=o[F.level].max_lazy,F.good_match=o[F.level].good_length,F.nice_match=o[F.level].nice_length,F.max_chain_length=o[F.level].max_chain,F.strstart=0,F.block_start=0,F.lookahead=0,F.insert=0,F.match_length=F.prev_length=I-1,F.match_available=0,F.ins_h=0})(e.state),B}function fe(e,B,F,m,c,j){if(!e)return b;var P=1;if(B===s&&(B=6),m<0?(P=0,m=-m):15<m&&(P=2,m-=16),c<1||w<c||F!==v||m<8||15<m||B<0||9<B||j<0||p<j)return te(e,b);m===8&&(m=9);var L=new de;return(e.state=L).strm=e,L.wrap=P,L.gzhead=null,L.w_bits=m,L.w_size=1<<L.w_bits,L.w_mask=L.w_size-1,L.hash_bits=c+7,L.hash_size=1<<L.hash_bits,L.hash_mask=L.hash_size-1,L.hash_shift=~~((L.hash_bits+I-1)/I),L.window=new a.Buf8(2*L.w_size),L.head=new a.Buf16(L.hash_size),L.prev=new a.Buf16(L.w_size),L.lit_bufsize=1<<c+6,L.pending_buf_size=4*L.lit_bufsize,L.pending_buf=new a.Buf8(L.pending_buf_size),L.d_buf=1*L.lit_bufsize,L.l_buf=3*L.lit_bufsize,L.level=B,L.strategy=j,L.method=F,he(e)}o=[new ie(0,0,0,0,function(e,B){var F=65535;for(F>e.pending_buf_size-5&&(F=e.pending_buf_size-5);;){if(e.lookahead<=1){if(se(e),e.lookahead===0&&B===x)return t;if(e.lookahead===0)break}e.strstart+=e.lookahead,e.lookahead=0;var m=e.block_start+F;if((e.strstart===0||e.strstart>=m)&&(e.lookahead=e.strstart-m,e.strstart=m,E(e,!1),e.strm.avail_out===0)||e.strstart-e.block_start>=e.w_size-X&&(E(e,!1),e.strm.avail_out===0))return t}return e.insert=0,B===u?(E(e,!0),e.strm.avail_out===0?ee:V):(e.strstart>e.block_start&&(E(e,!1),e.strm.avail_out),t)}),new ie(4,4,8,4,ce),new ie(4,5,16,8,ce),new ie(4,6,32,32,ce),new ie(4,4,16,16,ae),new ie(8,16,32,32,ae),new ie(8,16,128,128,ae),new ie(8,32,128,256,ae),new ie(32,128,258,1024,ae),new ie(32,258,258,4096,ae)],y.deflateInit=function(e,B){return fe(e,B,v,15,8,0)},y.deflateInit2=fe,y.deflateReset=he,y.deflateResetKeep=oe,y.deflateSetHeader=function(e,B){return e&&e.state?e.state.wrap!==2?b:(e.state.gzhead=B,i):b},y.deflate=function(e,B){var F,m,c,j;if(!e||!e.state||5<B||B<0)return e?te(e,b):b;if(m=e.state,!e.output||!e.input&&e.avail_in!==0||m.status===666&&B!==u)return te(e,e.avail_out===0?-5:b);if(m.strm=e,F=m.last_flush,m.last_flush=B,m.status===_)if(m.wrap===2)e.adler=0,J(m,31),J(m,139),J(m,8),m.gzhead?(J(m,(m.gzhead.text?1:0)+(m.gzhead.hcrc?2:0)+(m.gzhead.extra?4:0)+(m.gzhead.name?8:0)+(m.gzhead.comment?16:0)),J(m,255&m.gzhead.time),J(m,m.gzhead.time>>8&255),J(m,m.gzhead.time>>16&255),J(m,m.gzhead.time>>24&255),J(m,m.level===9?2:2<=m.strategy||m.level<2?4:0),J(m,255&m.gzhead.os),m.gzhead.extra&&m.gzhead.extra.length&&(J(m,255&m.gzhead.extra.length),J(m,m.gzhead.extra.length>>8&255)),m.gzhead.hcrc&&(e.adler=f(e.adler,m.pending_buf,m.pending,0)),m.gzindex=0,m.status=69):(J(m,0),J(m,0),J(m,0),J(m,0),J(m,0),J(m,m.level===9?2:2<=m.strategy||m.level<2?4:0),J(m,3),m.status=R);else{var P=v+(m.w_bits-8<<4)<<8;P|=(2<=m.strategy||m.level<2?0:m.level<6?1:m.level===6?2:3)<<6,m.strstart!==0&&(P|=32),P+=31-P%31,m.status=R,q(m,P),m.strstart!==0&&(q(m,e.adler>>>16),q(m,65535&e.adler)),e.adler=1}if(m.status===69)if(m.gzhead.extra){for(c=m.pending;m.gzindex<(65535&m.gzhead.extra.length)&&(m.pending!==m.pending_buf_size||(m.gzhead.hcrc&&m.pending>c&&(e.adler=f(e.adler,m.pending_buf,m.pending-c,c)),z(e),c=m.pending,m.pending!==m.pending_buf_size));)J(m,255&m.gzhead.extra[m.gzindex]),m.gzindex++;m.gzhead.hcrc&&m.pending>c&&(e.adler=f(e.adler,m.pending_buf,m.pending-c,c)),m.gzindex===m.gzhead.extra.length&&(m.gzindex=0,m.status=73)}else m.status=73;if(m.status===73)if(m.gzhead.name){c=m.pending;do{if(m.pending===m.pending_buf_size&&(m.gzhead.hcrc&&m.pending>c&&(e.adler=f(e.adler,m.pending_buf,m.pending-c,c)),z(e),c=m.pending,m.pending===m.pending_buf_size)){j=1;break}j=m.gzindex<m.gzhead.name.length?255&m.gzhead.name.charCodeAt(m.gzindex++):0,J(m,j)}while(j!==0);m.gzhead.hcrc&&m.pending>c&&(e.adler=f(e.adler,m.pending_buf,m.pending-c,c)),j===0&&(m.gzindex=0,m.status=91)}else m.status=91;if(m.status===91)if(m.gzhead.comment){c=m.pending;do{if(m.pending===m.pending_buf_size&&(m.gzhead.hcrc&&m.pending>c&&(e.adler=f(e.adler,m.pending_buf,m.pending-c,c)),z(e),c=m.pending,m.pending===m.pending_buf_size)){j=1;break}j=m.gzindex<m.gzhead.comment.length?255&m.gzhead.comment.charCodeAt(m.gzindex++):0,J(m,j)}while(j!==0);m.gzhead.hcrc&&m.pending>c&&(e.adler=f(e.adler,m.pending_buf,m.pending-c,c)),j===0&&(m.status=103)}else m.status=103;if(m.status===103&&(m.gzhead.hcrc?(m.pending+2>m.pending_buf_size&&z(e),m.pending+2<=m.pending_buf_size&&(J(m,255&e.adler),J(m,e.adler>>8&255),e.adler=0,m.status=R)):m.status=R),m.pending!==0){if(z(e),e.avail_out===0)return m.last_flush=-1,i}else if(e.avail_in===0&&M(B)<=M(F)&&B!==u)return te(e,-5);if(m.status===666&&e.avail_in!==0)return te(e,-5);if(e.avail_in!==0||m.lookahead!==0||B!==x&&m.status!==666){var L=m.strategy===2?(function(A,W){for(var Y;;){if(A.lookahead===0&&(se(A),A.lookahead===0)){if(W===x)return t;break}if(A.match_length=0,Y=r._tr_tally(A,0,A.window[A.strstart]),A.lookahead--,A.strstart++,Y&&(E(A,!1),A.strm.avail_out===0))return t}return A.insert=0,W===u?(E(A,!0),A.strm.avail_out===0?ee:V):A.last_lit&&(E(A,!1),A.strm.avail_out===0)?t:D})(m,B):m.strategy===3?(function(A,W){for(var Y,Z,H,re,ne=A.window;;){if(A.lookahead<=G){if(se(A),A.lookahead<=G&&W===x)return t;if(A.lookahead===0)break}if(A.match_length=0,A.lookahead>=I&&0<A.strstart&&(Z=ne[H=A.strstart-1])===ne[++H]&&Z===ne[++H]&&Z===ne[++H]){re=A.strstart+G;do;while(Z===ne[++H]&&Z===ne[++H]&&Z===ne[++H]&&Z===ne[++H]&&Z===ne[++H]&&Z===ne[++H]&&Z===ne[++H]&&Z===ne[++H]&&H<re);A.match_length=G-(re-H),A.match_length>A.lookahead&&(A.match_length=A.lookahead)}if(A.match_length>=I?(Y=r._tr_tally(A,1,A.match_length-I),A.lookahead-=A.match_length,A.strstart+=A.match_length,A.match_length=0):(Y=r._tr_tally(A,0,A.window[A.strstart]),A.lookahead--,A.strstart++),Y&&(E(A,!1),A.strm.avail_out===0))return t}return A.insert=0,W===u?(E(A,!0),A.strm.avail_out===0?ee:V):A.last_lit&&(E(A,!1),A.strm.avail_out===0)?t:D})(m,B):o[m.level].func(m,B);if(L!==ee&&L!==V||(m.status=666),L===t||L===ee)return e.avail_out===0&&(m.last_flush=-1),i;if(L===D&&(B===1?r._tr_align(m):B!==5&&(r._tr_stored_block(m,0,0,!1),B===3&&(Q(m.head),m.lookahead===0&&(m.strstart=0,m.block_start=0,m.insert=0))),z(e),e.avail_out===0))return m.last_flush=-1,i}return B!==u?i:m.wrap<=0?1:(m.wrap===2?(J(m,255&e.adler),J(m,e.adler>>8&255),J(m,e.adler>>16&255),J(m,e.adler>>24&255),J(m,255&e.total_in),J(m,e.total_in>>8&255),J(m,e.total_in>>16&255),J(m,e.total_in>>24&255)):(q(m,e.adler>>>16),q(m,65535&e.adler)),z(e),0<m.wrap&&(m.wrap=-m.wrap),m.pending!==0?i:1)},y.deflateEnd=function(e){var B;return e&&e.state?(B=e.state.status)!==_&&B!==69&&B!==73&&B!==91&&B!==103&&B!==R&&B!==666?te(e,b):(e.state=null,B===R?te(e,-3):i):b},y.deflateSetDictionary=function(e,B){var F,m,c,j,P,L,A,W,Y=B.length;if(!e||!e.state||(j=(F=e.state).wrap)===2||j===1&&F.status!==_||F.lookahead)return b;for(j===1&&(e.adler=l(e.adler,B,Y,0)),F.wrap=0,Y>=F.w_size&&(j===0&&(Q(F.head),F.strstart=0,F.block_start=0,F.insert=0),W=new a.Buf8(F.w_size),a.arraySet(W,B,Y-F.w_size,F.w_size,0),B=W,Y=F.w_size),P=e.avail_in,L=e.next_in,A=e.input,e.avail_in=Y,e.next_in=0,e.input=B,se(F);F.lookahead>=I;){for(m=F.strstart,c=F.lookahead-(I-1);F.ins_h=(F.ins_h<<F.hash_shift^F.window[m+I-1])&F.hash_mask,F.prev[m&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=m,m++,--c;);F.strstart=m,F.lookahead=I-1,se(F)}return F.strstart+=F.lookahead,F.block_start=F.strstart,F.insert=F.lookahead,F.lookahead=0,F.match_length=F.prev_length=I-1,F.match_available=0,e.next_in=L,e.input=A,e.avail_in=P,F.wrap=j,i},y.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(h,S,y){S.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(h,S,y){S.exports=function(o,a){var r,l,f,g,x,u,i,b,s,p,d,v,w,C,N,U,T,O,I,G,X,_,R,t,D;r=o.state,l=o.next_in,t=o.input,f=l+(o.avail_in-5),g=o.next_out,D=o.output,x=g-(a-o.avail_out),u=g+(o.avail_out-257),i=r.dmax,b=r.wsize,s=r.whave,p=r.wnext,d=r.window,v=r.hold,w=r.bits,C=r.lencode,N=r.distcode,U=(1<<r.lenbits)-1,T=(1<<r.distbits)-1;e:do{w<15&&(v+=t[l++]<<w,w+=8,v+=t[l++]<<w,w+=8),O=C[v&U];t:for(;;){if(v>>>=I=O>>>24,w-=I,(I=O>>>16&255)===0)D[g++]=65535&O;else{if(!(16&I)){if((64&I)==0){O=C[(65535&O)+(v&(1<<I)-1)];continue t}if(32&I){r.mode=12;break e}o.msg="invalid literal/length code",r.mode=30;break e}G=65535&O,(I&=15)&&(w<I&&(v+=t[l++]<<w,w+=8),G+=v&(1<<I)-1,v>>>=I,w-=I),w<15&&(v+=t[l++]<<w,w+=8,v+=t[l++]<<w,w+=8),O=N[v&T];r:for(;;){if(v>>>=I=O>>>24,w-=I,!(16&(I=O>>>16&255))){if((64&I)==0){O=N[(65535&O)+(v&(1<<I)-1)];continue r}o.msg="invalid distance code",r.mode=30;break e}if(X=65535&O,w<(I&=15)&&(v+=t[l++]<<w,(w+=8)<I&&(v+=t[l++]<<w,w+=8)),i<(X+=v&(1<<I)-1)){o.msg="invalid distance too far back",r.mode=30;break e}if(v>>>=I,w-=I,(I=g-x)<X){if(s<(I=X-I)&&r.sane){o.msg="invalid distance too far back",r.mode=30;break e}if(R=d,(_=0)===p){if(_+=b-I,I<G){for(G-=I;D[g++]=d[_++],--I;);_=g-X,R=D}}else if(p<I){if(_+=b+p-I,(I-=p)<G){for(G-=I;D[g++]=d[_++],--I;);if(_=0,p<G){for(G-=I=p;D[g++]=d[_++],--I;);_=g-X,R=D}}}else if(_+=p-I,I<G){for(G-=I;D[g++]=d[_++],--I;);_=g-X,R=D}for(;2<G;)D[g++]=R[_++],D[g++]=R[_++],D[g++]=R[_++],G-=3;G&&(D[g++]=R[_++],1<G&&(D[g++]=R[_++]))}else{for(_=g-X;D[g++]=D[_++],D[g++]=D[_++],D[g++]=D[_++],2<(G-=3););G&&(D[g++]=D[_++],1<G&&(D[g++]=D[_++]))}break}}break}}while(l<f&&g<u);l-=G=w>>3,v&=(1<<(w-=G<<3))-1,o.next_in=l,o.next_out=g,o.avail_in=l<f?f-l+5:5-(l-f),o.avail_out=g<u?u-g+257:257-(g-u),r.hold=v,r.bits=w}},{}],49:[function(h,S,y){var o=h("../utils/common"),a=h("./adler32"),r=h("./crc32"),l=h("./inffast"),f=h("./inftrees"),g=1,x=2,u=0,i=-2,b=1,s=852,p=592;function d(_){return(_>>>24&255)+(_>>>8&65280)+((65280&_)<<8)+((255&_)<<24)}function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new o.Buf16(320),this.work=new o.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function w(_){var R;return _&&_.state?(R=_.state,_.total_in=_.total_out=R.total=0,_.msg="",R.wrap&&(_.adler=1&R.wrap),R.mode=b,R.last=0,R.havedict=0,R.dmax=32768,R.head=null,R.hold=0,R.bits=0,R.lencode=R.lendyn=new o.Buf32(s),R.distcode=R.distdyn=new o.Buf32(p),R.sane=1,R.back=-1,u):i}function C(_){var R;return _&&_.state?((R=_.state).wsize=0,R.whave=0,R.wnext=0,w(_)):i}function N(_,R){var t,D;return _&&_.state?(D=_.state,R<0?(t=0,R=-R):(t=1+(R>>4),R<48&&(R&=15)),R&&(R<8||15<R)?i:(D.window!==null&&D.wbits!==R&&(D.window=null),D.wrap=t,D.wbits=R,C(_))):i}function U(_,R){var t,D;return _?(D=new v,(_.state=D).window=null,(t=N(_,R))!==u&&(_.state=null),t):i}var T,O,I=!0;function G(_){if(I){var R;for(T=new o.Buf32(512),O=new o.Buf32(32),R=0;R<144;)_.lens[R++]=8;for(;R<256;)_.lens[R++]=9;for(;R<280;)_.lens[R++]=7;for(;R<288;)_.lens[R++]=8;for(f(g,_.lens,0,288,T,0,_.work,{bits:9}),R=0;R<32;)_.lens[R++]=5;f(x,_.lens,0,32,O,0,_.work,{bits:5}),I=!1}_.lencode=T,_.lenbits=9,_.distcode=O,_.distbits=5}function X(_,R,t,D){var ee,V=_.state;return V.window===null&&(V.wsize=1<<V.wbits,V.wnext=0,V.whave=0,V.window=new o.Buf8(V.wsize)),D>=V.wsize?(o.arraySet(V.window,R,t-V.wsize,V.wsize,0),V.wnext=0,V.whave=V.wsize):(D<(ee=V.wsize-V.wnext)&&(ee=D),o.arraySet(V.window,R,t-D,ee,V.wnext),(D-=ee)?(o.arraySet(V.window,R,t-D,D,0),V.wnext=D,V.whave=V.wsize):(V.wnext+=ee,V.wnext===V.wsize&&(V.wnext=0),V.whave<V.wsize&&(V.whave+=ee))),0}y.inflateReset=C,y.inflateReset2=N,y.inflateResetKeep=w,y.inflateInit=function(_){return U(_,15)},y.inflateInit2=U,y.inflate=function(_,R){var t,D,ee,V,te,M,Q,z,E,J,q,K,se,ce,ae,ie,de,oe,he,fe,e,B,F,m,c=0,j=new o.Buf8(4),P=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!_||!_.state||!_.output||!_.input&&_.avail_in!==0)return i;(t=_.state).mode===12&&(t.mode=13),te=_.next_out,ee=_.output,Q=_.avail_out,V=_.next_in,D=_.input,M=_.avail_in,z=t.hold,E=t.bits,J=M,q=Q,B=u;e:for(;;)switch(t.mode){case b:if(t.wrap===0){t.mode=13;break}for(;E<16;){if(M===0)break e;M--,z+=D[V++]<<E,E+=8}if(2&t.wrap&&z===35615){j[t.check=0]=255&z,j[1]=z>>>8&255,t.check=r(t.check,j,2,0),E=z=0,t.mode=2;break}if(t.flags=0,t.head&&(t.head.done=!1),!(1&t.wrap)||(((255&z)<<8)+(z>>8))%31){_.msg="incorrect header check",t.mode=30;break}if((15&z)!=8){_.msg="unknown compression method",t.mode=30;break}if(E-=4,e=8+(15&(z>>>=4)),t.wbits===0)t.wbits=e;else if(e>t.wbits){_.msg="invalid window size",t.mode=30;break}t.dmax=1<<e,_.adler=t.check=1,t.mode=512&z?10:12,E=z=0;break;case 2:for(;E<16;){if(M===0)break e;M--,z+=D[V++]<<E,E+=8}if(t.flags=z,(255&t.flags)!=8){_.msg="unknown compression method",t.mode=30;break}if(57344&t.flags){_.msg="unknown header flags set",t.mode=30;break}t.head&&(t.head.text=z>>8&1),512&t.flags&&(j[0]=255&z,j[1]=z>>>8&255,t.check=r(t.check,j,2,0)),E=z=0,t.mode=3;case 3:for(;E<32;){if(M===0)break e;M--,z+=D[V++]<<E,E+=8}t.head&&(t.head.time=z),512&t.flags&&(j[0]=255&z,j[1]=z>>>8&255,j[2]=z>>>16&255,j[3]=z>>>24&255,t.check=r(t.check,j,4,0)),E=z=0,t.mode=4;case 4:for(;E<16;){if(M===0)break e;M--,z+=D[V++]<<E,E+=8}t.head&&(t.head.xflags=255&z,t.head.os=z>>8),512&t.flags&&(j[0]=255&z,j[1]=z>>>8&255,t.check=r(t.check,j,2,0)),E=z=0,t.mode=5;case 5:if(1024&t.flags){for(;E<16;){if(M===0)break e;M--,z+=D[V++]<<E,E+=8}t.length=z,t.head&&(t.head.extra_len=z),512&t.flags&&(j[0]=255&z,j[1]=z>>>8&255,t.check=r(t.check,j,2,0)),E=z=0}else t.head&&(t.head.extra=null);t.mode=6;case 6:if(1024&t.flags&&(M<(K=t.length)&&(K=M),K&&(t.head&&(e=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Array(t.head.extra_len)),o.arraySet(t.head.extra,D,V,K,e)),512&t.flags&&(t.check=r(t.check,D,K,V)),M-=K,V+=K,t.length-=K),t.length))break e;t.length=0,t.mode=7;case 7:if(2048&t.flags){if(M===0)break e;for(K=0;e=D[V+K++],t.head&&e&&t.length<65536&&(t.head.name+=String.fromCharCode(e)),e&&K<M;);if(512&t.flags&&(t.check=r(t.check,D,K,V)),M-=K,V+=K,e)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=8;case 8:if(4096&t.flags){if(M===0)break e;for(K=0;e=D[V+K++],t.head&&e&&t.length<65536&&(t.head.comment+=String.fromCharCode(e)),e&&K<M;);if(512&t.flags&&(t.check=r(t.check,D,K,V)),M-=K,V+=K,e)break e}else t.head&&(t.head.comment=null);t.mode=9;case 9:if(512&t.flags){for(;E<16;){if(M===0)break e;M--,z+=D[V++]<<E,E+=8}if(z!==(65535&t.check)){_.msg="header crc mismatch",t.mode=30;break}E=z=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),_.adler=t.check=0,t.mode=12;break;case 10:for(;E<32;){if(M===0)break e;M--,z+=D[V++]<<E,E+=8}_.adler=t.check=d(z),E=z=0,t.mode=11;case 11:if(t.havedict===0)return _.next_out=te,_.avail_out=Q,_.next_in=V,_.avail_in=M,t.hold=z,t.bits=E,2;_.adler=t.check=1,t.mode=12;case 12:if(R===5||R===6)break e;case 13:if(t.last){z>>>=7&E,E-=7&E,t.mode=27;break}for(;E<3;){if(M===0)break e;M--,z+=D[V++]<<E,E+=8}switch(t.last=1&z,E-=1,3&(z>>>=1)){case 0:t.mode=14;break;case 1:if(G(t),t.mode=20,R!==6)break;z>>>=2,E-=2;break e;case 2:t.mode=17;break;case 3:_.msg="invalid block type",t.mode=30}z>>>=2,E-=2;break;case 14:for(z>>>=7&E,E-=7&E;E<32;){if(M===0)break e;M--,z+=D[V++]<<E,E+=8}if((65535&z)!=(z>>>16^65535)){_.msg="invalid stored block lengths",t.mode=30;break}if(t.length=65535&z,E=z=0,t.mode=15,R===6)break e;case 15:t.mode=16;case 16:if(K=t.length){if(M<K&&(K=M),Q<K&&(K=Q),K===0)break e;o.arraySet(ee,D,V,K,te),M-=K,V+=K,Q-=K,te+=K,t.length-=K;break}t.mode=12;break;case 17:for(;E<14;){if(M===0)break e;M--,z+=D[V++]<<E,E+=8}if(t.nlen=257+(31&z),z>>>=5,E-=5,t.ndist=1+(31&z),z>>>=5,E-=5,t.ncode=4+(15&z),z>>>=4,E-=4,286<t.nlen||30<t.ndist){_.msg="too many length or distance symbols",t.mode=30;break}t.have=0,t.mode=18;case 18:for(;t.have<t.ncode;){for(;E<3;){if(M===0)break e;M--,z+=D[V++]<<E,E+=8}t.lens[P[t.have++]]=7&z,z>>>=3,E-=3}for(;t.have<19;)t.lens[P[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,F={bits:t.lenbits},B=f(0,t.lens,0,19,t.lencode,0,t.work,F),t.lenbits=F.bits,B){_.msg="invalid code lengths set",t.mode=30;break}t.have=0,t.mode=19;case 19:for(;t.have<t.nlen+t.ndist;){for(;ie=(c=t.lencode[z&(1<<t.lenbits)-1])>>>16&255,de=65535&c,!((ae=c>>>24)<=E);){if(M===0)break e;M--,z+=D[V++]<<E,E+=8}if(de<16)z>>>=ae,E-=ae,t.lens[t.have++]=de;else{if(de===16){for(m=ae+2;E<m;){if(M===0)break e;M--,z+=D[V++]<<E,E+=8}if(z>>>=ae,E-=ae,t.have===0){_.msg="invalid bit length repeat",t.mode=30;break}e=t.lens[t.have-1],K=3+(3&z),z>>>=2,E-=2}else if(de===17){for(m=ae+3;E<m;){if(M===0)break e;M--,z+=D[V++]<<E,E+=8}E-=ae,e=0,K=3+(7&(z>>>=ae)),z>>>=3,E-=3}else{for(m=ae+7;E<m;){if(M===0)break e;M--,z+=D[V++]<<E,E+=8}E-=ae,e=0,K=11+(127&(z>>>=ae)),z>>>=7,E-=7}if(t.have+K>t.nlen+t.ndist){_.msg="invalid bit length repeat",t.mode=30;break}for(;K--;)t.lens[t.have++]=e}}if(t.mode===30)break;if(t.lens[256]===0){_.msg="invalid code -- missing end-of-block",t.mode=30;break}if(t.lenbits=9,F={bits:t.lenbits},B=f(g,t.lens,0,t.nlen,t.lencode,0,t.work,F),t.lenbits=F.bits,B){_.msg="invalid literal/lengths set",t.mode=30;break}if(t.distbits=6,t.distcode=t.distdyn,F={bits:t.distbits},B=f(x,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,F),t.distbits=F.bits,B){_.msg="invalid distances set",t.mode=30;break}if(t.mode=20,R===6)break e;case 20:t.mode=21;case 21:if(6<=M&&258<=Q){_.next_out=te,_.avail_out=Q,_.next_in=V,_.avail_in=M,t.hold=z,t.bits=E,l(_,q),te=_.next_out,ee=_.output,Q=_.avail_out,V=_.next_in,D=_.input,M=_.avail_in,z=t.hold,E=t.bits,t.mode===12&&(t.back=-1);break}for(t.back=0;ie=(c=t.lencode[z&(1<<t.lenbits)-1])>>>16&255,de=65535&c,!((ae=c>>>24)<=E);){if(M===0)break e;M--,z+=D[V++]<<E,E+=8}if(ie&&(240&ie)==0){for(oe=ae,he=ie,fe=de;ie=(c=t.lencode[fe+((z&(1<<oe+he)-1)>>oe)])>>>16&255,de=65535&c,!(oe+(ae=c>>>24)<=E);){if(M===0)break e;M--,z+=D[V++]<<E,E+=8}z>>>=oe,E-=oe,t.back+=oe}if(z>>>=ae,E-=ae,t.back+=ae,t.length=de,ie===0){t.mode=26;break}if(32&ie){t.back=-1,t.mode=12;break}if(64&ie){_.msg="invalid literal/length code",t.mode=30;break}t.extra=15&ie,t.mode=22;case 22:if(t.extra){for(m=t.extra;E<m;){if(M===0)break e;M--,z+=D[V++]<<E,E+=8}t.length+=z&(1<<t.extra)-1,z>>>=t.extra,E-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=23;case 23:for(;ie=(c=t.distcode[z&(1<<t.distbits)-1])>>>16&255,de=65535&c,!((ae=c>>>24)<=E);){if(M===0)break e;M--,z+=D[V++]<<E,E+=8}if((240&ie)==0){for(oe=ae,he=ie,fe=de;ie=(c=t.distcode[fe+((z&(1<<oe+he)-1)>>oe)])>>>16&255,de=65535&c,!(oe+(ae=c>>>24)<=E);){if(M===0)break e;M--,z+=D[V++]<<E,E+=8}z>>>=oe,E-=oe,t.back+=oe}if(z>>>=ae,E-=ae,t.back+=ae,64&ie){_.msg="invalid distance code",t.mode=30;break}t.offset=de,t.extra=15&ie,t.mode=24;case 24:if(t.extra){for(m=t.extra;E<m;){if(M===0)break e;M--,z+=D[V++]<<E,E+=8}t.offset+=z&(1<<t.extra)-1,z>>>=t.extra,E-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){_.msg="invalid distance too far back",t.mode=30;break}t.mode=25;case 25:if(Q===0)break e;if(K=q-Q,t.offset>K){if((K=t.offset-K)>t.whave&&t.sane){_.msg="invalid distance too far back",t.mode=30;break}se=K>t.wnext?(K-=t.wnext,t.wsize-K):t.wnext-K,K>t.length&&(K=t.length),ce=t.window}else ce=ee,se=te-t.offset,K=t.length;for(Q<K&&(K=Q),Q-=K,t.length-=K;ee[te++]=ce[se++],--K;);t.length===0&&(t.mode=21);break;case 26:if(Q===0)break e;ee[te++]=t.length,Q--,t.mode=21;break;case 27:if(t.wrap){for(;E<32;){if(M===0)break e;M--,z|=D[V++]<<E,E+=8}if(q-=Q,_.total_out+=q,t.total+=q,q&&(_.adler=t.check=t.flags?r(t.check,ee,q,te-q):a(t.check,ee,q,te-q)),q=Q,(t.flags?z:d(z))!==t.check){_.msg="incorrect data check",t.mode=30;break}E=z=0}t.mode=28;case 28:if(t.wrap&&t.flags){for(;E<32;){if(M===0)break e;M--,z+=D[V++]<<E,E+=8}if(z!==(4294967295&t.total)){_.msg="incorrect length check",t.mode=30;break}E=z=0}t.mode=29;case 29:B=1;break e;case 30:B=-3;break e;case 31:return-4;case 32:default:return i}return _.next_out=te,_.avail_out=Q,_.next_in=V,_.avail_in=M,t.hold=z,t.bits=E,(t.wsize||q!==_.avail_out&&t.mode<30&&(t.mode<27||R!==4))&&X(_,_.output,_.next_out,q-_.avail_out)?(t.mode=31,-4):(J-=_.avail_in,q-=_.avail_out,_.total_in+=J,_.total_out+=q,t.total+=q,t.wrap&&q&&(_.adler=t.check=t.flags?r(t.check,ee,q,_.next_out-q):a(t.check,ee,q,_.next_out-q)),_.data_type=t.bits+(t.last?64:0)+(t.mode===12?128:0)+(t.mode===20||t.mode===15?256:0),(J==0&&q===0||R===4)&&B===u&&(B=-5),B)},y.inflateEnd=function(_){if(!_||!_.state)return i;var R=_.state;return R.window&&(R.window=null),_.state=null,u},y.inflateGetHeader=function(_,R){var t;return _&&_.state?(2&(t=_.state).wrap)==0?i:((t.head=R).done=!1,u):i},y.inflateSetDictionary=function(_,R){var t,D=R.length;return _&&_.state?(t=_.state).wrap!==0&&t.mode!==11?i:t.mode===11&&a(1,R,D,0)!==t.check?-3:X(_,R,D,D)?(t.mode=31,-4):(t.havedict=1,u):i},y.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(h,S,y){var o=h("../utils/common"),a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],r=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],f=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];S.exports=function(g,x,u,i,b,s,p,d){var v,w,C,N,U,T,O,I,G,X=d.bits,_=0,R=0,t=0,D=0,ee=0,V=0,te=0,M=0,Q=0,z=0,E=null,J=0,q=new o.Buf16(16),K=new o.Buf16(16),se=null,ce=0;for(_=0;_<=15;_++)q[_]=0;for(R=0;R<i;R++)q[x[u+R]]++;for(ee=X,D=15;1<=D&&q[D]===0;D--);if(D<ee&&(ee=D),D===0)return b[s++]=20971520,b[s++]=20971520,d.bits=1,0;for(t=1;t<D&&q[t]===0;t++);for(ee<t&&(ee=t),_=M=1;_<=15;_++)if(M<<=1,(M-=q[_])<0)return-1;if(0<M&&(g===0||D!==1))return-1;for(K[1]=0,_=1;_<15;_++)K[_+1]=K[_]+q[_];for(R=0;R<i;R++)x[u+R]!==0&&(p[K[x[u+R]]++]=R);if(T=g===0?(E=se=p,19):g===1?(E=a,J-=257,se=r,ce-=257,256):(E=l,se=f,-1),_=t,U=s,te=R=z=0,C=-1,N=(Q=1<<(V=ee))-1,g===1&&852<Q||g===2&&592<Q)return 1;for(;;){for(O=_-te,G=p[R]<T?(I=0,p[R]):p[R]>T?(I=se[ce+p[R]],E[J+p[R]]):(I=96,0),v=1<<_-te,t=w=1<<V;b[U+(z>>te)+(w-=v)]=O<<24|I<<16|G|0,w!==0;);for(v=1<<_-1;z&v;)v>>=1;if(v!==0?(z&=v-1,z+=v):z=0,R++,--q[_]==0){if(_===D)break;_=x[u+p[R]]}if(ee<_&&(z&N)!==C){for(te===0&&(te=ee),U+=t,M=1<<(V=_-te);V+te<D&&!((M-=q[V+te])<=0);)V++,M<<=1;if(Q+=1<<V,g===1&&852<Q||g===2&&592<Q)return 1;b[C=z&N]=ee<<24|V<<16|U-s|0}}return z!==0&&(b[U+z]=_-te<<24|64<<16|0),d.bits=ee,0}},{"../utils/common":41}],51:[function(h,S,y){S.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(h,S,y){var o=h("../utils/common"),a=0,r=1;function l(c){for(var j=c.length;0<=--j;)c[j]=0}var f=0,g=29,x=256,u=x+1+g,i=30,b=19,s=2*u+1,p=15,d=16,v=7,w=256,C=16,N=17,U=18,T=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],O=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],I=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],X=new Array(2*(u+2));l(X);var _=new Array(2*i);l(_);var R=new Array(512);l(R);var t=new Array(256);l(t);var D=new Array(g);l(D);var ee,V,te,M=new Array(i);function Q(c,j,P,L,A){this.static_tree=c,this.extra_bits=j,this.extra_base=P,this.elems=L,this.max_length=A,this.has_stree=c&&c.length}function z(c,j){this.dyn_tree=c,this.max_code=0,this.stat_desc=j}function E(c){return c<256?R[c]:R[256+(c>>>7)]}function J(c,j){c.pending_buf[c.pending++]=255&j,c.pending_buf[c.pending++]=j>>>8&255}function q(c,j,P){c.bi_valid>d-P?(c.bi_buf|=j<<c.bi_valid&65535,J(c,c.bi_buf),c.bi_buf=j>>d-c.bi_valid,c.bi_valid+=P-d):(c.bi_buf|=j<<c.bi_valid&65535,c.bi_valid+=P)}function K(c,j,P){q(c,P[2*j],P[2*j+1])}function se(c,j){for(var P=0;P|=1&c,c>>>=1,P<<=1,0<--j;);return P>>>1}function ce(c,j,P){var L,A,W=new Array(p+1),Y=0;for(L=1;L<=p;L++)W[L]=Y=Y+P[L-1]<<1;for(A=0;A<=j;A++){var Z=c[2*A+1];Z!==0&&(c[2*A]=se(W[Z]++,Z))}}function ae(c){var j;for(j=0;j<u;j++)c.dyn_ltree[2*j]=0;for(j=0;j<i;j++)c.dyn_dtree[2*j]=0;for(j=0;j<b;j++)c.bl_tree[2*j]=0;c.dyn_ltree[2*w]=1,c.opt_len=c.static_len=0,c.last_lit=c.matches=0}function ie(c){8<c.bi_valid?J(c,c.bi_buf):0<c.bi_valid&&(c.pending_buf[c.pending++]=c.bi_buf),c.bi_buf=0,c.bi_valid=0}function de(c,j,P,L){var A=2*j,W=2*P;return c[A]<c[W]||c[A]===c[W]&&L[j]<=L[P]}function oe(c,j,P){for(var L=c.heap[P],A=P<<1;A<=c.heap_len&&(A<c.heap_len&&de(j,c.heap[A+1],c.heap[A],c.depth)&&A++,!de(j,L,c.heap[A],c.depth));)c.heap[P]=c.heap[A],P=A,A<<=1;c.heap[P]=L}function he(c,j,P){var L,A,W,Y,Z=0;if(c.last_lit!==0)for(;L=c.pending_buf[c.d_buf+2*Z]<<8|c.pending_buf[c.d_buf+2*Z+1],A=c.pending_buf[c.l_buf+Z],Z++,L===0?K(c,A,j):(K(c,(W=t[A])+x+1,j),(Y=T[W])!==0&&q(c,A-=D[W],Y),K(c,W=E(--L),P),(Y=O[W])!==0&&q(c,L-=M[W],Y)),Z<c.last_lit;);K(c,w,j)}function fe(c,j){var P,L,A,W=j.dyn_tree,Y=j.stat_desc.static_tree,Z=j.stat_desc.has_stree,H=j.stat_desc.elems,re=-1;for(c.heap_len=0,c.heap_max=s,P=0;P<H;P++)W[2*P]!==0?(c.heap[++c.heap_len]=re=P,c.depth[P]=0):W[2*P+1]=0;for(;c.heap_len<2;)W[2*(A=c.heap[++c.heap_len]=re<2?++re:0)]=1,c.depth[A]=0,c.opt_len--,Z&&(c.static_len-=Y[2*A+1]);for(j.max_code=re,P=c.heap_len>>1;1<=P;P--)oe(c,W,P);for(A=H;P=c.heap[1],c.heap[1]=c.heap[c.heap_len--],oe(c,W,1),L=c.heap[1],c.heap[--c.heap_max]=P,c.heap[--c.heap_max]=L,W[2*A]=W[2*P]+W[2*L],c.depth[A]=(c.depth[P]>=c.depth[L]?c.depth[P]:c.depth[L])+1,W[2*P+1]=W[2*L+1]=A,c.heap[1]=A++,oe(c,W,1),2<=c.heap_len;);c.heap[--c.heap_max]=c.heap[1],(function(ne,ue){var be,pe,xe,le,ye,Ne,me=ue.dyn_tree,Ae=ue.max_code,Ge=ue.stat_desc.static_tree,Ve=ue.stat_desc.has_stree,Me=ue.stat_desc.extra_bits,Ee=ue.stat_desc.extra_base,ve=ue.stat_desc.max_length,_e=0;for(le=0;le<=p;le++)ne.bl_count[le]=0;for(me[2*ne.heap[ne.heap_max]+1]=0,be=ne.heap_max+1;be<s;be++)ve<(le=me[2*me[2*(pe=ne.heap[be])+1]+1]+1)&&(le=ve,_e++),me[2*pe+1]=le,Ae<pe||(ne.bl_count[le]++,ye=0,Ee<=pe&&(ye=Me[pe-Ee]),Ne=me[2*pe],ne.opt_len+=Ne*(le+ye),Ve&&(ne.static_len+=Ne*(Ge[2*pe+1]+ye)));if(_e!==0){do{for(le=ve-1;ne.bl_count[le]===0;)le--;ne.bl_count[le]--,ne.bl_count[le+1]+=2,ne.bl_count[ve]--,_e-=2}while(0<_e);for(le=ve;le!==0;le--)for(pe=ne.bl_count[le];pe!==0;)Ae<(xe=ne.heap[--be])||(me[2*xe+1]!==le&&(ne.opt_len+=(le-me[2*xe+1])*me[2*xe],me[2*xe+1]=le),pe--)}})(c,j),ce(W,re,c.bl_count)}function e(c,j,P){var L,A,W=-1,Y=j[1],Z=0,H=7,re=4;for(Y===0&&(H=138,re=3),j[2*(P+1)+1]=65535,L=0;L<=P;L++)A=Y,Y=j[2*(L+1)+1],++Z<H&&A===Y||(Z<re?c.bl_tree[2*A]+=Z:A!==0?(A!==W&&c.bl_tree[2*A]++,c.bl_tree[2*C]++):Z<=10?c.bl_tree[2*N]++:c.bl_tree[2*U]++,W=A,re=(Z=0)===Y?(H=138,3):A===Y?(H=6,3):(H=7,4))}function B(c,j,P){var L,A,W=-1,Y=j[1],Z=0,H=7,re=4;for(Y===0&&(H=138,re=3),L=0;L<=P;L++)if(A=Y,Y=j[2*(L+1)+1],!(++Z<H&&A===Y)){if(Z<re)for(;K(c,A,c.bl_tree),--Z!=0;);else A!==0?(A!==W&&(K(c,A,c.bl_tree),Z--),K(c,C,c.bl_tree),q(c,Z-3,2)):Z<=10?(K(c,N,c.bl_tree),q(c,Z-3,3)):(K(c,U,c.bl_tree),q(c,Z-11,7));W=A,re=(Z=0)===Y?(H=138,3):A===Y?(H=6,3):(H=7,4)}}l(M);var F=!1;function m(c,j,P,L){q(c,(f<<1)+(L?1:0),3),(function(A,W,Y,Z){ie(A),J(A,Y),J(A,~Y),o.arraySet(A.pending_buf,A.window,W,Y,A.pending),A.pending+=Y})(c,j,P)}y._tr_init=function(c){F||((function(){var j,P,L,A,W,Y=new Array(p+1);for(A=L=0;A<g-1;A++)for(D[A]=L,j=0;j<1<<T[A];j++)t[L++]=A;for(t[L-1]=A,A=W=0;A<16;A++)for(M[A]=W,j=0;j<1<<O[A];j++)R[W++]=A;for(W>>=7;A<i;A++)for(M[A]=W<<7,j=0;j<1<<O[A]-7;j++)R[256+W++]=A;for(P=0;P<=p;P++)Y[P]=0;for(j=0;j<=143;)X[2*j+1]=8,j++,Y[8]++;for(;j<=255;)X[2*j+1]=9,j++,Y[9]++;for(;j<=279;)X[2*j+1]=7,j++,Y[7]++;for(;j<=287;)X[2*j+1]=8,j++,Y[8]++;for(ce(X,u+1,Y),j=0;j<i;j++)_[2*j+1]=5,_[2*j]=se(j,5);ee=new Q(X,T,x+1,u,p),V=new Q(_,O,0,i,p),te=new Q(new Array(0),I,0,b,v)})(),F=!0),c.l_desc=new z(c.dyn_ltree,ee),c.d_desc=new z(c.dyn_dtree,V),c.bl_desc=new z(c.bl_tree,te),c.bi_buf=0,c.bi_valid=0,ae(c)},y._tr_stored_block=m,y._tr_flush_block=function(c,j,P,L){var A,W,Y=0;0<c.level?(c.strm.data_type===2&&(c.strm.data_type=(function(Z){var H,re=4093624447;for(H=0;H<=31;H++,re>>>=1)if(1&re&&Z.dyn_ltree[2*H]!==0)return a;if(Z.dyn_ltree[18]!==0||Z.dyn_ltree[20]!==0||Z.dyn_ltree[26]!==0)return r;for(H=32;H<x;H++)if(Z.dyn_ltree[2*H]!==0)return r;return a})(c)),fe(c,c.l_desc),fe(c,c.d_desc),Y=(function(Z){var H;for(e(Z,Z.dyn_ltree,Z.l_desc.max_code),e(Z,Z.dyn_dtree,Z.d_desc.max_code),fe(Z,Z.bl_desc),H=b-1;3<=H&&Z.bl_tree[2*G[H]+1]===0;H--);return Z.opt_len+=3*(H+1)+5+5+4,H})(c),A=c.opt_len+3+7>>>3,(W=c.static_len+3+7>>>3)<=A&&(A=W)):A=W=P+5,P+4<=A&&j!==-1?m(c,j,P,L):c.strategy===4||W===A?(q(c,2+(L?1:0),3),he(c,X,_)):(q(c,4+(L?1:0),3),(function(Z,H,re,ne){var ue;for(q(Z,H-257,5),q(Z,re-1,5),q(Z,ne-4,4),ue=0;ue<ne;ue++)q(Z,Z.bl_tree[2*G[ue]+1],3);B(Z,Z.dyn_ltree,H-1),B(Z,Z.dyn_dtree,re-1)})(c,c.l_desc.max_code+1,c.d_desc.max_code+1,Y+1),he(c,c.dyn_ltree,c.dyn_dtree)),ae(c),L&&ie(c)},y._tr_tally=function(c,j,P){return c.pending_buf[c.d_buf+2*c.last_lit]=j>>>8&255,c.pending_buf[c.d_buf+2*c.last_lit+1]=255&j,c.pending_buf[c.l_buf+c.last_lit]=255&P,c.last_lit++,j===0?c.dyn_ltree[2*P]++:(c.matches++,j--,c.dyn_ltree[2*(t[P]+x+1)]++,c.dyn_dtree[2*E(j)]++),c.last_lit===c.lit_bufsize-1},y._tr_align=function(c){q(c,2,3),K(c,w,X),(function(j){j.bi_valid===16?(J(j,j.bi_buf),j.bi_buf=0,j.bi_valid=0):8<=j.bi_valid&&(j.pending_buf[j.pending++]=255&j.bi_buf,j.bi_buf>>=8,j.bi_valid-=8)})(c)}},{"../utils/common":41}],53:[function(h,S,y){S.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(h,S,y){(function(o){(function(a,r){if(!a.setImmediate){var l,f,g,x,u=1,i={},b=!1,s=a.document,p=Object.getPrototypeOf&&Object.getPrototypeOf(a);p=p&&p.setTimeout?p:a,l={}.toString.call(a.process)==="[object process]"?function(C){process.nextTick(function(){v(C)})}:(function(){if(a.postMessage&&!a.importScripts){var C=!0,N=a.onmessage;return a.onmessage=function(){C=!1},a.postMessage("","*"),a.onmessage=N,C}})()?(x="setImmediate$"+Math.random()+"$",a.addEventListener?a.addEventListener("message",w,!1):a.attachEvent("onmessage",w),function(C){a.postMessage(x+C,"*")}):a.MessageChannel?((g=new MessageChannel).port1.onmessage=function(C){v(C.data)},function(C){g.port2.postMessage(C)}):s&&"onreadystatechange"in s.createElement("script")?(f=s.documentElement,function(C){var N=s.createElement("script");N.onreadystatechange=function(){v(C),N.onreadystatechange=null,f.removeChild(N),N=null},f.appendChild(N)}):function(C){setTimeout(v,0,C)},p.setImmediate=function(C){typeof C!="function"&&(C=new Function(""+C));for(var N=new Array(arguments.length-1),U=0;U<N.length;U++)N[U]=arguments[U+1];var T={callback:C,args:N};return i[u]=T,l(u),u++},p.clearImmediate=d}function d(C){delete i[C]}function v(C){if(b)setTimeout(v,0,C);else{var N=i[C];if(N){b=!0;try{(function(U){var T=U.callback,O=U.args;switch(O.length){case 0:T();break;case 1:T(O[0]);break;case 2:T(O[0],O[1]);break;case 3:T(O[0],O[1],O[2]);break;default:T.apply(r,O)}})(N)}finally{d(C),b=!1}}}}function w(C){C.source===a&&typeof C.data=="string"&&C.data.indexOf(x)===0&&v(+C.data.slice(x.length))}})(typeof self>"u"?o===void 0?this:o:self)}).call(this,typeof ge<"u"?ge:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Ce)),Ce.exports}var ht=ut();const Pe=Be(ht),Ct=async k=>{const $=k.flatMap((a,r)=>a.images.map((l,f)=>({url:l,filename:`${String(r+1).padStart(3,"0")}_${String(f+1).padStart(2,"0")}`})));if($.length===0){alert("No images to download.");return}const h=new Pe;let S=0,y=0;if(await Promise.all($.map(async a=>{var r;try{const l=await fetch(a.url);if(!l.ok)throw new Error(`Failed to fetch image: ${a.url} with status ${l.status}`);const f=await l.blob(),g=((r=a.url.split(".").pop())==null?void 0:r.split("?")[0])||"jpg";h.file(`${a.filename}.${g}`,f),S++}catch(l){console.error(`Skipping file due to error: ${a.url}`,l),y++}})),S===0)throw new Error("All image downloads failed.");y>0&&alert(`Warning: Could not download ${y} images.`);const o=await h.generateAsync({type:"blob"});De(o,"storyboard-images.zip")},At=async k=>{const $=k.flatMap((a,r)=>{const l=String(r+1).padStart(3,"0");return(a.videos||[]).map((f,g)=>{const x=(a.videos||[]).length>1?`_v${g+1}`:"";return f.upscaledUrl?{url:f.upscaledUrl,filename:`${l}${x}_upscaled`}:{url:f.url,filename:`${l}${x}_base`}})});if($.length===0){alert("No videos to download.");return}const h=new Pe;let S=0,y=0;if(await Promise.all($.map(async a=>{var r;try{const l=await fetch(a.url);if(!l.ok)throw new Error(`Fetch failed with status ${l.status}`);const f=await l.blob(),g=((r=a.url.split(".").pop())==null?void 0:r.split("?")[0])||"mp4";h.file(`${a.filename}.${g}`,f),S++}catch(l){console.error(`Skipping video due to error: ${a.url}`,l),y++}})),S===0)throw new Error("All video downloads failed.");y>0&&alert(`Warning: Could not download ${y} videos.`);const o=await h.generateAsync({type:"blob"});De(o,"storyboard-videos.zip")};function ke(k,$,h){for(let S=0;S<h.length;S++)k.setUint8($+S,h.charCodeAt(S))}function ft(k,$,h,S){const y=k.length,o=new ArrayBuffer(44+y),a=new DataView(o);ke(a,0,"RIFF"),a.setUint32(4,36+y,!0),ke(a,8,"WAVE"),ke(a,12,"fmt "),a.setUint32(16,16,!0),a.setUint16(20,1,!0),a.setUint16(22,$,!0),a.setUint32(24,h,!0);const r=h*$*(S/8);a.setUint32(28,r,!0);const l=$*(S/8);return a.setUint16(32,l,!0),a.setUint16(34,S,!0),ke(a,36,"data"),a.setUint32(40,y,!0),new Uint8Array(o,44).set(k),new Blob([a],{type:"audio/wav"})}function pt(k){const $=atob(k),h=$.length,S=new Uint8Array(h);for(let y=0;y<h;y++)S[y]=$.charCodeAt(y);return S}function Et(k){const $=pt(k);return ft($,1,24e3,16)}const Le=async k=>await(await fetch(k)).blob(),mt=async(k,$)=>{const h=new FormData,S=[];await Promise.all(k.map(async(a,r)=>{const l=await Le(a.url),f=`file_${r}`,g=a.fileName||`${a.type}_${Date.now()}.${l.type.split("/")[1]||"tmp"}`;h.append(f,l,g),S.push({type:a.type,media:`attach://${f}`,caption:r===0?a.caption:void 0})})),h.append("chat_id",$.chatId),$.topicId&&h.append("message_thread_id",$.topicId),h.append("media",JSON.stringify(S));const y=`https://api.telegram.org/bot${$.botToken}/sendMediaGroup`,o=await fetch(y,{method:"POST",body:h});if(!o.ok){const a=await o.json();throw new Error(`Telegram API Error: ${a.description||o.statusText}`)}return o.json()},Re=async(k,$)=>{const h=new FormData,S=await Le(k.url),y=k.fileName||`${k.type}_${Date.now()}.${S.type.split("/")[1]||"tmp"}`;h.append(k.type,S,y),h.append("chat_id",$.chatId),$.topicId&&h.append("message_thread_id",$.topicId),h.append("caption",k.caption);const o=k.type==="photo"?"sendPhoto":"sendVideo",a=`https://api.telegram.org/bot${$.botToken}/${o}`,r=await fetch(a,{method:"POST",body:h});if(!r.ok){const l=await r.json();throw new Error(`Telegram API Error: ${l.description||r.statusText}`)}return r.json()},It={async sendMedia(k){const $=qe.getTelegramConfig();if(!$.botToken||!$.chatId)throw new Error("Telegram Bot Token and Chat ID must be configured in Settings.");if(k.length===0)return;if(k.length===1){await Re(k[0],$);return}const h=[];for(let S=0;S<k.length;S+=10)h.push(k.slice(S,S+10));for(const S of h)S.length>1?await mt(S,$):S.length===1&&await Re(S[0],$)}};export{yt as O,_t as S,ze as U,ot as V,St as a,jt as b,Et as c,Ct as d,At as e,kt as g,Nt as r,De as s,It as t,wt as u};

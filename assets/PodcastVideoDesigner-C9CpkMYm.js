import{r as n,j as e}from"./index-CRGght61.js";import{u as j,U as $,g as _e,a as Ca,b as Ga,s as Aa,r as ce,c as Pa,t as qe,d as Ta,e as Ea,O as Fa,S as Ua}from"./telegramService-wrTyrj_M.js";import{I as Ie}from"./ImageUpload-DM7okLVI.js";import{h as Ha,i as Oa,m as We,c as Da,j as $a,I as Ba}from"./lehuyducanhService-BuhKn-w0.js";import{r as Ne,i as Ma,f as Ve,d as ke}from"./media-CDZXYBSY.js";import{s as Ye}from"./settingsService-CbIZ9NBp.js";import"./streetInterviewPrompts-Dzu83YwK.js";const Ce=[{value:"Kore",label:"Kore (Female)"},{value:"Puck",label:"Puck (Male)"},{value:"Charon",label:"Charon (Male)"},{value:"Fenrir",label:"Fenrir (Male)"},{value:"Zephyr",label:"Zephyr (Male)"}],La=p=>{const{numHosts:y,setNumHosts:h,hostOneImage:I,setHostOneImage:f,hostTwoImage:A,setHostTwoImage:b,podcastTopic:B,setPodcastTopic:N,pastedScript:M,setPastedScript:V,onGenerateScript:P,isGeneratingScript:c,onAnalyzeScript:d,isAnalyzingScript:L,reporterVoice:Q,setReporterVoice:X,intervieweeVoice:m,setIntervieweeVoice:C,environmentImage:T,setEnvironmentImage:ee,environmentVariationsCount:ae,setEnvironmentVariationsCount:te,onGenerateEnvironments:se,isGeneratingEnvironments:k,globalVoiceInstruction:oe,setGlobalVoiceInstruction:ne,videoAspectRatio:z,setVideoAspectRatio:de,singleHostSetting:E,setSingleHostSetting:re,backgroundPrompt:ge,setBackgroundPrompt:me,onViewImage:R}=p,[S,ie]=n.useState("custom"),[F,_]=n.useState("generate"),ue=!!I&&(y===1||!!A)&&!!B,q=(!!I&&(y===1||!!A)||!!T)&&!!M,U=y===1&&E==="stage"?"Stage":"Studio";return e.jsxs("div",{className:"bg-gray-800 p-6 rounded-2xl border border-gray-700 shadow-lg flex flex-col gap-6",children:[e.jsxs("div",{className:"flex mb-2 border-b-2 border-gray-700",children:[e.jsxs("button",{onClick:()=>ie("custom"),className:`flex-1 text-center font-bold py-3 transition-all duration-300 flex items-center justify-center gap-2 ${S==="custom"?"text-blue-400 border-b-4 border-blue-500":"text-gray-400 hover:text-white"}`,children:[e.jsx("i",{className:"fas fa-tools"})," Custom Setup"]}),e.jsxs("button",{onClick:()=>ie("quick-start"),className:`flex-1 text-center font-bold py-3 transition-all duration-300 flex items-center justify-center gap-2 ${S==="quick-start"?"text-yellow-400 border-b-4 border-yellow-500":"text-gray-400 hover:text-white"}`,children:[e.jsx("i",{className:"fas fa-bolt"})," Quick Start"]})]}),S==="custom"&&e.jsxs("div",{className:"flex flex-col gap-6 animate-fade-in",children:[e.jsxs("h3",{className:"text-xl font-bold text-blue-400 -mb-2",children:[e.jsx("i",{className:"fas fa-users mr-2"}),"Cast"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-md font-bold text-gray-300 mb-2",children:"Number of Hosts"}),e.jsxs("div",{className:"flex gap-2 bg-gray-900 border-2 border-gray-600 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>h(1),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${y===1?"bg-blue-600":"bg-transparent text-gray-400 hover:bg-gray-700"}`,children:"1 Host"}),e.jsx("button",{onClick:()=>h(2),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${y===2?"bg-blue-600":"bg-transparent text-gray-400 hover:bg-gray-700"}`,children:"2 Hosts"})]})]}),y===1&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-md font-bold text-gray-300 mb-2",children:"Host Setting"}),e.jsxs("div",{className:"flex gap-2 bg-gray-900 border-2 border-gray-600 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>re("studio"),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${E==="studio"?"bg-blue-600":"bg-transparent text-gray-400 hover:bg-gray-700"}`,children:"In Studio"}),e.jsx("button",{onClick:()=>re("stage"),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${E==="stage"?"bg-blue-600":"bg-transparent text-gray-400 hover:bg-gray-700"}`,children:"On Stage"})]})]}),e.jsx(Ie,{id:"podcast-host-1-image",label:y===1?"Host Image":"Host 1 Image",file:I,onFileChange:f,onViewImage:R}),y===2&&e.jsx(Ie,{id:"podcast-host-2-image",label:"Host 2 Image",file:A,onFileChange:b,onViewImage:R}),e.jsx("div",{className:"border-t-2 border-gray-700 -mx-6"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-400 mb-2",children:[e.jsx("i",{className:"fas fa-image mr-2"}),U," / Set"]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"background-prompt",className:"block text-sm font-bold text-gray-300 mb-1",children:"Generate with AI using a prompt"}),e.jsx("input",{id:"background-prompt",type:"text",value:ge,onChange:l=>me(l.target.value),placeholder:"e.g., minimalist, wooden textures...",className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-2 text-gray-200"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"env-count",className:"block text-sm font-bold text-gray-300 mb-1",children:"Number of Camera Angles"}),e.jsx("input",{id:"env-count",type:"number",min:"1",max:"10",value:ae,onChange:l=>te(parseInt(l.target.value,10)),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-2 text-gray-200"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"aspect-ratio-podcast",className:"block text-sm font-bold text-gray-300 mb-1",children:"Video Aspect Ratio"}),e.jsxs("select",{id:"aspect-ratio-podcast",value:z,onChange:l=>de(l.target.value),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-2 text-gray-200",children:[e.jsx("option",{value:"16:9",children:"16:9 (Landscape)"}),e.jsx("option",{value:"9:16",children:"9:16 (Portrait)"})]})]}),e.jsx("button",{onClick:se,disabled:k||!I,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-full disabled:opacity-50",title:I?`Generate ${U} Scene Variations`:"Please upload at least one host image",children:k?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"})," Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-camera-retro"})," Generate ",U," Scenes"]})})]})]}),S==="quick-start"&&e.jsxs("div",{className:"flex flex-col gap-6 animate-fade-in",children:[e.jsx("div",{className:"bg-yellow-900/30 border border-yellow-700/50 p-3 rounded-lg text-center text-yellow-200 text-sm",children:e.jsxs("p",{children:[e.jsx("i",{className:"fas fa-bolt mr-2"}),"Upload a finalized photo of you in the studio. We'll use it for everything."]})}),e.jsx(Ie,{id:"environment-image",label:"Master Shot (You in Studio)",file:T,onFileChange:ee,onViewImage:R})]}),e.jsx("div",{className:"border-t-2 border-gray-700 -mx-6"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-400 mb-2",children:[e.jsx("i",{className:"fas fa-cog mr-2"}),"Audio & Video"]}),y===1?e.jsxs("div",{children:[e.jsx("label",{htmlFor:"podcast-tts-voice",className:"block text-md font-bold text-gray-300 mb-2",children:"Host's Voice"}),e.jsx("select",{id:"podcast-tts-voice",value:Q,onChange:l=>X(l.target.value),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200",children:Ce.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"reporter-voice",className:"block text-md font-bold text-gray-300 mb-2",children:"Host 1's Voice"}),e.jsx("select",{id:"reporter-voice",value:Q,onChange:l=>X(l.target.value),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200",children:Ce.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"interviewee-voice",className:"block text-md font-bold text-gray-300 mb-2",children:"Host 2's Voice"}),e.jsx("select",{id:"interviewee-voice",value:m,onChange:l=>C(l.target.value),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200",children:Ce.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"global-voice-instruction",className:"block text-md font-bold text-gray-300 mb-2",children:"Global Voice Instruction (Optional)"}),e.jsx("textarea",{id:"global-voice-instruction",value:oe,onChange:l=>ne(l.target.value),placeholder:"e.g., Speak in a warm, friendly, and engaging tone.",className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200",rows:2})]})]}),e.jsx("div",{className:"border-t-2 border-gray-700 -mx-6"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-400 mb-4",children:[e.jsx("i",{className:"fas fa-file-alt mr-2"}),"Scripting"]}),e.jsxs("div",{className:"flex gap-1 bg-gray-900 border-2 border-gray-600 rounded-lg p-1 mb-4",children:[e.jsx("button",{onClick:()=>_("generate"),disabled:S==="quick-start",className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${F==="generate"&&S!=="quick-start"?"bg-blue-600":"bg-transparent text-gray-400 hover:bg-gray-700"} ${S==="quick-start"?"opacity-50 cursor-not-allowed":""}`,children:"Generate"}),e.jsx("button",{onClick:()=>_("paste"),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${F==="paste"?"bg-blue-600":"bg-transparent text-gray-400 hover:bg-gray-700"}`,children:"Paste"})]}),F==="generate"&&S==="custom"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{htmlFor:"podcast-topic",className:"block text-md font-bold text-gray-300",children:"Podcast Topic"}),e.jsx("input",{id:"podcast-topic",type:"text",value:B,onChange:l=>N(l.target.value),placeholder:"e.g., The future of AI",className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200"}),e.jsx("button",{onClick:P,disabled:c||!ue,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-full disabled:opacity-50 flex items-center justify-center gap-2",children:c?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"})," Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-wand-magic-sparkles"})," Generate Script"]})})]}),F==="paste"&&e.jsx("textarea",{id:"pasted-script",value:M,onChange:l=>V(l.target.value),placeholder:"Paste your full podcast script here. Each new line or paragraph will be treated as a scene.",className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200",rows:8})]}),e.jsx("div",{className:"border-t-2 border-gray-700 -mx-6 pt-6",children:e.jsx("button",{onClick:d,disabled:L||!q,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-full disabled:opacity-50 text-lg flex items-center justify-center gap-2",title:q?"Generate Storyboard":"Please provide required inputs",children:L?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"})," Analyzing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-cogs"})," Generate Storyboard"]})})})]})},Za=({currentUser:p,onLogout:y})=>{const[h,I]=n.useState(1),[f,A]=n.useState(null),[b,B]=n.useState(null),[N,M]=n.useState(""),[V,P]=n.useState(""),[c,d]=n.useState([]),[L,Q]=n.useState(null),[X,m]=n.useState(null),[C,T]=n.useState("input"),[ee,ae]=n.useState(!1),[te,se]=n.useState(!1),[k,oe]=n.useState({}),[ne,z]=n.useState(null),[de,E]=n.useState(!1),[re,ge]=n.useState(!1),[me,R]=n.useState(!1),[S,ie]=n.useState(!1),[F,_]=n.useState(!1),[ue,q]=n.useState(!1),[Ge,U]=n.useState(!1),[l,Ke]=n.useState({storyboard:0,image:0,video:0}),[Ae,Pe]=n.useState(!1),[pe,Te]=n.useState(!1),[W,Ee]=n.useState("Puck"),[H,Fe]=n.useState("Kore"),[Y,Ue]=n.useState(""),[v,He]=n.useState("16:9"),[G,Oe]=n.useState("studio"),[K,De]=n.useState(null),[Z,$e]=n.useState("a modern, professional podcast studio interior"),[he,Be]=n.useState([]),[J,fe]=n.useState(),[be,Ze]=n.useState(4),[Je,Me]=n.useState(!1),[Qe,Le]=n.useState(!1),[Xe,ze]=n.useState(!1),w=n.useCallback(()=>{const a=j.getUsage(p);Ke({storyboard:a.generateStoryboard.count,image:a.generateImage.count,video:a.generateVideo.count})},[p]);n.useEffect(()=>{w()},[w]);const O=n.useCallback(async()=>{const a=[];return f&&a.push(await Ne(f)),h===2&&b&&a.push(await Ne(b)),a},[f,b,h]),ea=n.useCallback(async()=>{if(!j.canPerformAction(p,"generateStoryboard")){alert(`You have reached your daily limit of ${$.generateStoryboard} storyboard generations.`);return}ae(!0),m(null);try{const a=await O();if(a.length!==h)throw new Error("Missing host images.");const s=await Ha(N,h,a);P(s),T("script_generated"),j.logAction(p,"generateStoryboard"),w()}catch(a){m(a instanceof Error?a.message:"An unknown error occurred.")}finally{ae(!1)}},[p,O,h,N,w]),Re=n.useCallback(async()=>{se(!0),m(null),d([]);try{const a=await O();if(a.length!==h)throw new Error("Missing host images.");if(!j.canPerformAction(p,"generateImage"))throw new Error("You have reached your daily limit for image generations and cannot create the initial studio image.");const s=h===1?"A realistic photo of a person in a modern podcast studio, sitting at a table with a professional microphone. The shot is a medium wide shot.":"A realistic photo of two people sitting across from each other in a modern podcast studio, at a table with professional microphones. The shot is a medium wide shot.",[o]=await _e({provider:"gemini",prompt:s,subjectUrls:a,aspectRatio:v});Q(o),j.logAction(p,"generateImage"),w();const t=await Oa(V,a,G);d(t),T("prompts_generated")}catch(a){m(a instanceof Error?a.message:"An unknown error occurred.")}finally{se(!1)}},[O,h,V,p,w,v,G]),xe=n.useCallback(async a=>{if(!j.canPerformAction(p,"generateImage"))throw new Error(`You have reached your daily limit of ${$.generateImage} image generations.`);const s=c.find(o=>o.id===a);if(s){d(o=>o.map(t=>t.id===a?{...t,isGeneratingImage:!0,imageGenerationError:null}:t));try{const o=k[a]||{},t=o.imageProvider||"lehuyducanh",i=o.selectedHost,r=[];i==="host1"?f&&r.push(f):i==="host2"?b&&r.push(b):(f&&r.push(f),h===2&&b&&r.push(b));const g=await Promise.all(r.map(je=>Ne(je))),u=s.imagePrompt.toLowerCase().includes("studio"),x=u?g:[],we=u?L??void 0:void 0,D=await _e({provider:t,prompt:s.imagePrompt,subjectUrls:x,sceneUrl:we,aspectRatio:v});d(je=>je.map(le=>le.id===a?{...le,images:[...le.images,...D],isGeneratingImage:!1}:le)),j.logAction(p,"generateImage"),w()}catch(o){throw d(t=>t.map(i=>i.id===a?{...i,isGeneratingImage:!1,imageGenerationError:o instanceof Error?o.message:"Unknown error"}:i)),o}}},[c,p,w,k,f,b,h,L,v]),ve=n.useCallback(async(a,s)=>{const o=c.find(i=>i.id===a),t=o==null?void 0:o.videos[s];if(t){d(i=>i.map(r=>r.id===a?{...r,videos:r.videos.map((g,u)=>u===s?{...g,isUpscaling:!0,upscaleError:null}:g)}:r));try{const i=await Ca({provider:"lehuyducanh",mediaGenerationId:t.mediaGenerationId,seed:t.seed});d(r=>r.map(g=>g.id===a?{...g,videos:g.videos.map((u,x)=>x===s?{...u,upscaledUrl:i,isUpscaling:!1}:u)}:g))}catch(i){throw d(r=>r.map(g=>g.id===a?{...g,videos:g.videos.map((u,x)=>x===s?{...u,isUpscaling:!1,upscaleError:i instanceof Error?i.message:"Unknown error"}:u)}:g)),i}}},[c]),aa=(a,s)=>{d(o=>o.map(t=>{if(t.id!==a)return t;const i=[...t.videos];return i.splice(s,1),{...t,videos:i}}))},ye=n.useCallback(async a=>{if(!j.canPerformAction(p,"generateVideo"))throw new Error(`You have reached your daily limit of ${$.generateVideo} video generations.`);const s=c.find(o=>o.id===a);if(!s||!s.selectedImageForVideo)throw new Error("No image selected for video generation.");d(o=>o.map(t=>t.id===a?{...t,isGeneratingVideo:!0,videoGenerationError:null}:t));try{const o=await Ma(s.selectedImageForVideo),t=`Voiceover: "${s.voiceoverScript}".
Motion: ${s.videoPrompt}`,{videoUrl:i,upscaledUrl:r,mediaGenerationId:g,seed:u}=await Ga({provider:"lehuyducanh",prompt:t,imageUrl:o,upscale:s.shouldUpscaleVideo,aspectRatio:v}),x={url:i,upscaledUrl:r,mediaGenerationId:g,seed:u};d(we=>we.map(D=>D.id!==a?D:{...D,videos:[...D.videos||[],x],isGeneratingVideo:!1})),j.logAction(p,"generateVideo"),w()}catch(o){throw d(t=>t.map(i=>i.id===a?{...i,isGeneratingVideo:!1,videoGenerationError:o instanceof Error?o.message:"Unknown error"}:i)),o}},[c,p,w,v]),ta=n.useCallback(async()=>{if(C==="input"){alert("Please generate a script or storyboard before saving.");return}Pe(!0),m(null);try{const a=f?{name:f.name,data:await Ve(f)}:void 0,s=b?{name:b.name,data:await Ve(b)}:void 0,o=K?{name:K.name,data:await Ve(K)}:void 0,t={version:"1.0.0-podcast",numHosts:h,hostOneImage:a,hostTwoImage:s,podcastTopic:N,pastedScript:V,reporterVoice:W,intervieweeVoice:H,globalVoiceInstruction:Y,videoAspectRatio:v,singleHostSetting:G,environmentImage:o,backgroundPrompt:Z,generatedEnvironments:he,selectedBackground:J,scenes:c,sceneOverrides:k,generationStep:C},i=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),r=(N.trim().replace(/\s+/g,"-").substring(0,20)||"podcast-project").toLowerCase();Aa(i,`${r}.pvdproj`)}catch(a){m(a instanceof Error?a.message:"An unknown error occurred during saving.")}finally{Pe(!1)}},[C,h,f,b,N,V,W,H,Y,v,G,K,Z,he,J,c,k]),sa=n.useCallback(async a=>{var o,t;const s=(o=a.target.files)==null?void 0:o[0];if(s){Te(!0),m(null);try{const i=await s.text(),r=JSON.parse(i);if(!((t=r.version)!=null&&t.includes("-podcast")))throw new Error("Invalid project file. Please import a .pvdproj file.");I(r.numHosts||1),A(r.hostOneImage?await ke(r.hostOneImage.data,r.hostOneImage.name):null),B(r.hostTwoImage?await ke(r.hostTwoImage.data,r.hostTwoImage.name):null),M(r.podcastTopic||""),P(r.pastedScript||""),Ee(r.reporterVoice||"Puck"),Fe(r.intervieweeVoice||"Kore"),Ue(r.globalVoiceInstruction||""),He(r.videoAspectRatio||"16:9"),Oe(r.singleHostSetting||"studio"),De(r.environmentImage?await ke(r.environmentImage.data,r.environmentImage.name):null),$e(r.backgroundPrompt||"a modern, professional podcast studio interior"),Be(r.generatedEnvironments||[]),fe(r.selectedBackground||void 0),oe(r.sceneOverrides||{});const u=(r.scenes||[]).map(x=>({...We({}),...x,videos:x.videos||[]}));d(u),T(r.generationStep||"input"),alert("Project imported successfully!")}catch(i){m(i instanceof Error?i.message:"An unknown error occurred during import.")}finally{Te(!1),a.target.value=""}}},[]),oa=n.useCallback((a,s,o)=>{oe(t=>{const r={...t[a]||{},[s]:o};if((s==="selectedHost"&&o==="auto"||s==="imageProvider"&&o==="lehuyducanh")&&delete r[s],Object.keys(r).length===0){const{[a]:g,...u}=t;return u}return{...t,[a]:r}})},[]),na=(a,s)=>d(o=>o.map(t=>t.id===a?{...t,imagePrompt:s}:t)),ra=(a,s)=>d(o=>o.map(t=>t.id===a?{...t,videoPrompt:s}:t)),ia=(a,s)=>d(o=>o.map(t=>t.id===a?{...t,voiceoverGuide:s}:t)),la=(a,s,o)=>d(t=>t.map(i=>i.id===a?{...i,[s]:o}:i)),ca=(a,s)=>d(o=>o.map(t=>t.id!==a?t:{...t,images:t.images.filter(i=>i!==s),selectedImageForVideo:t.selectedImageForVideo===s?void 0:t.selectedImageForVideo})),da=(a,s)=>d(o=>o.map(t=>t.id===a?{...t,selectedImageForVideo:s,videos:[],videoGenerationError:null}:t)),ga=a=>d(s=>s.map(o=>o.id===a?{...o,shouldUpscaleVideo:!o.shouldUpscaleVideo}:o)),ma=async(a,s)=>{},ua=n.useCallback(async()=>ce(c.filter(a=>a.images.length===0&&!a.imagePrompt.toLowerCase().includes("studio")).map(a=>()=>xe(a.id)),5).finally(()=>ge(!1)),[c,xe]),pa=n.useCallback(async()=>ce(c.filter(a=>a.selectedImageForVideo&&(!a.videos||a.videos.length===0)).map(a=>()=>ye(a.id)),5).finally(()=>R(!1)),[c,ye]),ha=n.useCallback(async()=>ce(c.flatMap(a=>(a.videos||[]).map((s,o)=>({scene:a,video:s,index:o})).filter(s=>s.video.url&&s.video.mediaGenerationId&&!s.video.upscaledUrl).map(s=>()=>ve(s.scene.id,s.index))),5).finally(()=>ie(!1)),[c,ve]),Se=n.useCallback(async a=>{const s=c.find(o=>o.id===a);if(s){d(o=>o.map(t=>t.id===a?{...t,isGeneratingAudio:!0,audioGenerationError:null}:t));try{let o=H,t=s.voiceoverScript;t.toLowerCase().startsWith("host 1:")||t.toLowerCase().startsWith("reporter:")?(o=W,t=t.replace(/^(host 1:|reporter:)\s*/i,"")):(t.toLowerCase().startsWith("host 2:")||t.toLowerCase().startsWith("interviewee:"))&&(o=H,t=t.replace(/^(host 2:|interviewee:)\s*/i,""));const i=await Da(t,s.voiceoverGuide,o,Y),r=Pa(i),g=URL.createObjectURL(r);d(u=>u.map(x=>x.id===a?{...x,audioUrl:g,isGeneratingAudio:!1}:x))}catch(o){const t=o instanceof Error?o.message:"An unknown audio generation error occurred.";d(i=>i.map(r=>r.id===a?{...r,isGeneratingAudio:!1,audioGenerationError:t}:r))}}},[c,W,H,Y]),fa=n.useCallback(async()=>{U(!0);const a=c.filter(s=>!s.audioUrl).map(s=>()=>Se(s.id));await ce(a,5),U(!1)},[c,Se]),ba=a=>{const s=We({voiceoverScript:"New scene..."});d(o=>{const t=[...o];return t.splice(a,0,s),t})},xa=n.useCallback(()=>{d(a=>a.map(s=>s.imagePrompt.toLowerCase().includes("studio")||s.imagePrompt.toLowerCase().includes("stage")?{...s,selectedImageForVideo:J}:s.images.length>0?{...s,selectedImageForVideo:s.images[0]}:s)),alert("Set studio scenes to the selected background and picked the first image for all B-roll scenes!")},[J]),va=n.useCallback(async()=>{const{botToken:a,chatId:s}=Ye.getTelegramConfig();if(!a||!s){alert("Please configure Telegram settings first in the Settings page.");return}const o=c.flatMap((t,i)=>t.images.map((r,g)=>({type:"photo",url:r,caption:`Scene ${i+1}: ${t.voiceoverScript}`,fileName:`${String(i+1).padStart(3,"0")}_image_${String(g+1).padStart(2,"0")}.jpg`})));if(o.length===0){alert("No generated images found to send.");return}Le(!0),m(null);try{await qe.sendMedia(o),alert("All images sent to Telegram successfully!")}catch(t){const i=t instanceof Error?t.message:"Failed to send images to Telegram.";m(i),alert(i)}finally{Le(!1)}},[c]),ya=n.useCallback(async()=>{const{botToken:a,chatId:s}=Ye.getTelegramConfig();if(!a||!s){alert("Please configure Telegram settings first in the Settings page.");return}const o=c.flatMap((t,i)=>(t.videos||[]).map((r,g)=>({type:"video",url:r.upscaledUrl||r.url,caption:`Scene ${i+1}: ${t.voiceoverScript}`,fileName:`${String(i+1).padStart(3,"0")}_video_${String(g+1).padStart(2,"0")}.mp4`}))).filter(t=>t.url);if(o.length===0){alert("No videos found to send.");return}ze(!0),m(null);try{await qe.sendMedia(o),alert("All videos sent to Telegram successfully!")}catch(t){const i=t instanceof Error?t.message:"Failed to send videos to Telegram.";m(i),alert(i)}finally{ze(!1)}},[c]),Sa=n.useCallback(async()=>{_(!0);try{await Ta(c)}catch(a){m(a instanceof Error?a.message:"Failed to download images.")}finally{_(!1)}},[c]),wa=n.useCallback(async()=>{q(!0);try{await Ea(c)}catch(a){m(a instanceof Error?a.message:"Failed to download videos.")}finally{q(!1)}},[c]),ja=(a,s)=>{d(o=>o.map(t=>t.id===a?{...t,includeDialogueInPrompt:s}:t))},Ia=async(a,s)=>{alert("Enhanced prompt generation is not yet implemented for the Podcast module.")},Na=a=>{window.confirm("Are you sure you want to delete this scene?")&&d(s=>s.filter(o=>o.id!==a))},Va=(a,s)=>{d(o=>o.map(t=>t.id===a?{...t,voiceoverScript:s}:t))},ka=n.useCallback(async()=>{Me(!0),m(null);try{const a=await O();if(a.length===0)throw new Error("Please upload at least one host image.");const s=await $a(a,Z,be,G,v);Be(s),s.length>0&&fe(s[0])}catch(a){m(a instanceof Error?a.message:"Failed to generate background scenes.")}finally{Me(!1)}},[O,Z,be,G,v]);return e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"py-4 px-8 bg-gray-800 shadow-lg border-b border-gray-700 shrink-0 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-blue-400",children:[e.jsx("i",{className:"fas fa-podcast mr-3"}),"Podcast Video Designer"]}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Turn your podcast into visually engaging videos."})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("label",{htmlFor:"import-project-podcast",className:`text-center bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-full transition-all duration-300 flex items-center justify-center gap-2 text-sm shadow-sm ${pe?"cursor-not-allowed opacity-50":"cursor-pointer"}`,children:pe?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"}),"Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-folder-open"}),"Import"]})}),e.jsx("input",{id:"import-project-podcast",type:"file",accept:".pvdproj",className:"hidden",onChange:sa,disabled:pe}),e.jsx("button",{onClick:ta,disabled:Ae||C==="input",className:"bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-sm shadow-sm",children:Ae?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-save"}),"Save"]})})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"text-gray-300 font-medium",children:["Welcome, ",e.jsx("span",{className:"font-bold text-blue-400",children:p}),"!"]}),e.jsxs("div",{className:"text-xs text-gray-400 bg-gray-700 px-2 py-1 rounded-md mt-1 flex gap-x-2",children:["Daily Usage:",e.jsxs("span",{className:"font-bold text-blue-400",title:"Storyboard Generations",children:[" ",e.jsx("i",{className:"fas fa-file-alt"})," ",l.storyboard,"/",$.generateStoryboard]})," |",e.jsxs("span",{className:"font-bold text-green-400",title:"Image Generations",children:[" ",e.jsx("i",{className:"fas fa-image"})," ",l.image,"/",$.generateImage]})," |",e.jsxs("span",{className:"font-bold text-red-400",title:"Video Generations",children:[" ",e.jsx("i",{className:"fas fa-video"})," ",l.video,"/",$.generateVideo]})]})]}),e.jsx("button",{onClick:y,className:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-full",children:"Logout"})]})]})]}),e.jsx("main",{className:"flex-1 overflow-x-hidden overflow-y-auto p-4 md:p-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 xl:grid-cols-4 gap-8 items-start",children:[e.jsx("div",{className:"lg:sticky lg:top-8 xl:col-span-1",children:e.jsx(La,{numHosts:h,setNumHosts:I,hostOneImage:f,setHostOneImage:A,hostTwoImage:b,setHostTwoImage:B,podcastTopic:N,setPodcastTopic:M,pastedScript:V,setPastedScript:P,onGenerateScript:ea,isGeneratingScript:ee,onAnalyzeScript:Re,isAnalyzingScript:te,reporterVoice:W,setReporterVoice:Ee,intervieweeVoice:H,setIntervieweeVoice:Fe,environmentImage:K,setEnvironmentImage:De,environmentVariationsCount:be,setEnvironmentVariationsCount:Ze,onGenerateEnvironments:ka,isGeneratingEnvironments:Je,globalVoiceInstruction:Y,setGlobalVoiceInstruction:Ue,videoAspectRatio:v,setVideoAspectRatio:He,singleHostSetting:G,setSingleHostSetting:Oe,backgroundPrompt:Z,setBackgroundPrompt:$e,onViewImage:z})}),e.jsx("div",{className:"lg:col-span-2 xl:col-span-3",children:e.jsx(Fa,{generationStep:C,scenes:c,isLoading:ee||te,isGeneratingPrompts:!1,error:X,voiceoverScript:V,onVoiceoverScriptChange:P,onGeneratePrompts:Re,sceneOverrides:k,onGenerateImage:xe,onSceneImagePromptChange:na,onSceneVideoPromptChange:ra,onSceneVoiceoverGuideChange:ia,onSceneEnhancementChange:la,onSceneOverrideChange:oa,onDeleteImage:ca,onViewImage:z,onUploadImageForVideo:ma,onGenerateAllImages:ua,isBatchGenerating:re,onViewStoryboard:()=>E(!0),onDownloadAllImages:Sa,isDownloadingImages:F,onDownloadAllVideos:wa,isDownloadingVideos:ue,onSelectImageForVideo:da,onGenerateVideo:ye,onToggleVideoUpscale:ga,onUpscaleVideo:ve,onGenerateAllVideos:pa,isBatchGeneratingVideos:me,onUpscaleAllVideos:ha,isBatchUpscalingVideos:S,generatedEnvironments:he,activeModule:"podcast",numHosts:h,onGenerateAudio:Se,onGenerateAllAudio:fa,isBatchGeneratingAudio:Ge,onAddScene:ba,onPickAllImages:xa,onSelectEnvironment:fe,selectedEnvironment:J,onSendAllImagesToTelegram:va,isSendingImagesToTelegram:Qe,onSendAllVideosToTelegram:ya,isSendingVideosToTelegram:Xe,videoAspectRatio:v,onToggleDialogueInPrompt:ja,onGenerateEnhancedPrompt:Ia,onSceneVoiceoverScriptChange:Va,onDeleteScene:Na,onDeleteVideo:aa})})]})}),ne&&e.jsx(Ba,{imageUrl:ne,onClose:()=>z(null)}),de&&e.jsx(Ua,{scenes:c,onClose:()=>E(!1),videoAspectRatio:v})]})};export{Za as default};

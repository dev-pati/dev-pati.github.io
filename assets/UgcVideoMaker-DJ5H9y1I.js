import{r as i,j as o}from"./index-BDGPSugR.js";import{u as k,U as T,c as ba,r as ae,g as va,a as xa,b as ya,d as ja,e as Sa,t as Pe,s as wa,O as Ia,S as Va}from"./telegramService-Cj56laOR.js";import{I as Ne}from"./ImageUpload-cWb71mSq.js";import{g as Ga,a as Aa,b as Ca,c as Pa,m as ke,I as Na}from"./lehuyducanhService-B9F-RCut.js";import{r as E,i as ka,f as ue,d as me}from"./media-CDZXYBSY.js";import{s as Te}from"./settingsService-CbIZ9NBp.js";import"./streetInterviewPrompts-Dzu83YwK.js";const pe=["Honest Review / Testimonial","Problem / Solution","My Daily Routine","Unboxing / First Impression","Why I Switched","GRWM (Get Ready With Me)","Custom"],Ta=[{value:"Kore",label:"Kore (Female)"},{value:"Puck",label:"Puck (Male)"},{value:"Charon",label:"Charon (Male)"},{value:"Fenrir",label:"Fenrir (Male)"},{value:"Zephyr",label:"Zephyr (Male)"}],Ea=h=>{const{videoAngle:M,setVideoAngle:x,productInfo:R,setProductInfo:I,targetAudience:B,setTargetAudience:V,ctaMessage:_,setCtaMessage:G,promptLanguage:D,setPromptLanguage:c,onGenerateScript:l,isGeneratingScript:Y,productImage:g,setProductImage:j,creatorImage:z,setCreatorImage:H,onViewImage:K,ttsVoice:S,setTtsVoice:Z,videoAspectRatio:A,setVideoAspectRatio:J,globalVoiceInstruction:$,setGlobalVoiceInstruction:U}=h,[C,P]=i.useState(pe.includes(M)?"":M),q=u=>{const b=u.target.value;b!=="Custom"?(x(b),P("")):x(C||"")},Q=u=>{P(u.target.value),x(u.target.value)},X=pe.includes(M)?M:"Custom";return o.jsxs("div",{className:"bg-gray-800 p-6 rounded-2xl border border-gray-700 shadow-lg flex flex-col gap-6",children:[o.jsxs("div",{className:"space-y-4",children:[o.jsxs("h3",{className:"text-lg font-bold text-blue-400 mb-2",children:[o.jsx("i",{className:"fas fa-cogs mr-2"}),"Core Video Inputs"]}),o.jsx(Ne,{id:"product-image",label:"Product Image (Required)",file:g,onFileChange:j,onViewImage:K}),o.jsx(Ne,{id:"creator-image",label:"Creator/Model Image (Optional)",file:z,onFileChange:H,onViewImage:K})]}),o.jsx("div",{className:"border-t-2 border-gray-700 -mx-6"}),o.jsxs("div",{className:"px-1 space-y-4",children:[o.jsxs("h3",{className:"text-lg font-bold text-blue-400 -mb-2",children:[o.jsx("i",{className:"fas fa-rocket mr-2"}),"Creative Direction"]}),o.jsxs("div",{children:[o.jsxs("label",{htmlFor:"angle-select",className:"block text-md font-bold text-blue-400 mb-2",children:[o.jsx("i",{className:"fas-fa-lightbulb mr-2"}),"Video Angle / Core Idea"]}),o.jsx("select",{id:"angle-select",value:X,onChange:q,className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200",children:pe.map(u=>o.jsx("option",{value:u,children:u},u))}),X==="Custom"&&o.jsx("input",{type:"text",value:C,onChange:Q,placeholder:"Describe your custom angle...",className:"w-full bg-gray-900 border-2 border-gray-600 rounded-lg p-3 text-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 mt-2"})]}),o.jsxs("div",{children:[o.jsxs("label",{htmlFor:"product-info",className:"block text-md font-bold text-blue-400 mb-2",children:[o.jsx("i",{className:"fas fa-file-alt mr-2"}),"Product Info & Key Benefits"]}),o.jsx("textarea",{id:"product-info",value:R,onChange:u=>I(u.target.value),placeholder:"e.g., Helps improve focus and memory. Contains Ginkgo Biloba and B12. Vegan friendly.",className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200",rows:3})]}),o.jsxs("div",{children:[o.jsxs("label",{htmlFor:"target-audience",className:"block text-md font-bold text-blue-400 mb-2",children:[o.jsx("i",{className:"fas fa-users mr-2"}),"Target Audience (Optional)"]}),o.jsx("input",{id:"target-audience",type:"text",value:B,onChange:u=>V(u.target.value),placeholder:"e.g., Fitness enthusiasts aged 25-40",className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200"})]}),o.jsxs("div",{children:[o.jsxs("label",{htmlFor:"cta",className:"block text-md font-bold text-blue-400 mb-2",children:[o.jsx("i",{className:"fas fa-bullhorn mr-2"}),"Call To Action (CTA) Message"]}),o.jsx("input",{id:"cta",type:"text",value:_,onChange:u=>G(u.target.value),placeholder:"e.g., Link in bio!, Get yours today!",className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200"})]}),o.jsxs("div",{children:[o.jsxs("label",{className:"block text-md font-bold text-blue-400 mb-2",children:[o.jsx("i",{className:"fas fa-language mr-2"}),"Prompt Language"]}),o.jsxs("div",{className:"flex gap-2 bg-gray-900 border-2 border-gray-600 rounded-lg p-1",children:[o.jsx("button",{onClick:()=>c("English"),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all duration-200 ${D==="English"?"bg-blue-600 text-white shadow-sm":"bg-transparent text-gray-400 hover:bg-gray-700"}`,children:"English"}),o.jsx("button",{onClick:()=>c("Vietnamese"),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all duration-200 ${D==="Vietnamese"?"bg-blue-600 text-white shadow-sm":"bg-transparent text-gray-400 hover:bg-gray-700"}`,children:"Tiếng Việt"})]})]})]}),o.jsx("div",{className:"border-t-2 border-gray-700 -mx-6"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("h3",{className:"text-lg font-bold text-blue-400 mb-2",children:[o.jsx("i",{className:"fas fa-cog mr-2"}),"Audio & Video Settings"]}),o.jsxs("div",{children:[o.jsxs("label",{htmlFor:"global-voice-instruction",className:"block text-md font-bold text-blue-400 mb-2",children:[o.jsx("i",{className:"fas fa-comment-dots mr-2"}),"Global Voice Instruction (Optional)"]}),o.jsx("textarea",{id:"global-voice-instruction",value:$,onChange:u=>U(u.target.value),placeholder:"e.g., Speak in a warm, friendly, and engaging tone.",className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200 focus:ring-2 focus:ring-blue-500 transition duration-200",rows:2})]}),o.jsxs("div",{children:[o.jsx("label",{htmlFor:"tts-voice",className:"block text-md font-bold text-blue-400 mb-2",children:"Voiceover Model"}),o.jsx("select",{id:"tts-voice",value:S,onChange:u=>Z(u.target.value),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200",children:Ta.map(u=>o.jsx("option",{value:u.value,children:u.label},u.value))})]}),o.jsxs("div",{children:[o.jsxs("label",{htmlFor:"aspect-ratio",className:"block text-md font-bold text-blue-400 mb-2",children:[o.jsx("i",{className:"fas fa-ruler-combined mr-2"}),"Video Aspect Ratio"]}),o.jsxs("select",{id:"aspect-ratio",value:A,onChange:u=>J(u.target.value),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200",children:[o.jsx("option",{value:"9:16",children:"9:16 (Portrait)"}),o.jsx("option",{value:"16:9",children:"16:9 (Landscape)"})]})]})]}),o.jsx("div",{className:"border-t-2 border-gray-700 -mx-6"}),o.jsx("button",{onClick:l,disabled:Y||!g,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-lg shadow-md hover:shadow-lg transform hover:-translate-y-0.5",title:g?"Generate Voiceover Script":"Please upload a product image first",children:Y?o.jsxs(o.Fragment,{children:[o.jsx("i",{className:"fas fa-spinner fa-spin"}),"Generating Script..."]}):o.jsxs(o.Fragment,{children:[o.jsx("i",{className:"fas fa-wand-magic-sparkles"}),"Generate Voiceover Script"]})})]})},Ra=({currentUser:h,onLogout:M})=>{const[x,R]=i.useState("Honest Review / Testimonial"),[I,B]=i.useState(""),[V,_]=i.useState(""),[G,D]=i.useState("Link in bio!"),[c,l]=i.useState([]),[Y,g]=i.useState(null),[j,z]=i.useState("English"),[H,K]=i.useState("Kore"),[S,Z]=i.useState("9:16"),[A,J]=i.useState(""),[$,U]=i.useState("input"),[C,P]=i.useState(""),[q,Q]=i.useState(!1),[X,u]=i.useState(!1),[b,te]=i.useState(null),[v,oe]=i.useState(null),[O,ee]=i.useState({}),[fe,re]=i.useState(null),[Ee,he]=i.useState(!1),[Ue,be]=i.useState(!1),[Fe,ve]=i.useState(!1),[Me,xe]=i.useState(!1),[De,ye]=i.useState(!1),[$e,je]=i.useState(!1),[Oe,Se]=i.useState(!1),[we,Ie]=i.useState(!1),[se,Ve]=i.useState(!1),[Le,Ge]=i.useState(!1),[Re,Ae]=i.useState(!1),[F,Ce]=i.useState({storyboard:0,image:0,video:0});i.useEffect(()=>{if(h){const t=k.getUsage(h);Ce({storyboard:t.generateStoryboard.count,image:t.generateImage.count,video:t.generateVideo.count})}},[h]);const L=i.useCallback(()=>{if(h){const t=k.getUsage(h);Ce({storyboard:t.generateStoryboard.count,image:t.generateImage.count,video:t.generateVideo.count})}},[h]),Be=()=>{M(),l([]),R("Honest Review / Testimonial"),B(""),_(""),D("Link in bio!"),te(null),oe(null),ee({}),g(null),U("input"),P("")},_e=i.useCallback(async(t,r)=>{const a=c.find(e=>e.id===t);if(a){l(e=>e.map(s=>s.id===t?{...s,[r==="image"?"isGeneratingImagePrompt":"isGeneratingVideoPrompt"]:!0}:s));try{const e=`
        Video Angle/Core Idea: ${x}
        Product Info: ${I}
        Target Audience: ${V}
        Language: ${j}
        Call to Action: ${G}
      `,s=b?await E(b):void 0,n=v?await E(v):void 0,d=await Ga(e,a,r,s,n);l(p=>p.map(f=>f.id===t?{...f,[r==="image"?"imagePrompt":"videoPrompt"]:d,[r==="image"?"isGeneratingImagePrompt":"isGeneratingVideoPrompt"]:!1}:f))}catch(e){const s=e instanceof Error?e.message:"Failed to generate prompt.";alert(s),l(n=>n.map(d=>d.id===t?{...d,[r==="image"?"isGeneratingImagePrompt":"isGeneratingVideoPrompt"]:!1}:d))}}},[c,x,I,V,j,G,b,v]),He=i.useCallback(async()=>{if(!k.canPerformAction(h,"generateStoryboard")){const t=`You have reached your daily limit of ${T.generateStoryboard} storyboard generations.`;g(t),alert(t);return}if(!b){g("Please provide a Product Image to begin.");return}Q(!0),g(null),l([]),P(""),ee({}),U("input");try{const t=await E(b),r=v?await E(v):void 0,a=await Aa(x,x,j,G,t,I,V,r);P(a),U("script_generated"),k.logAction(h,"generateStoryboard"),L()}catch(t){t instanceof Error?g(t.message):g("An unknown error occurred.")}finally{Q(!1)}},[x,G,j,b,I,V,v,h,L]),We=i.useCallback(async()=>{u(!0),g(null);try{const t=await E(b),r=v?await E(v):void 0,a=await Ca(C,x,x,j,t,[],r);l(a),U("prompts_generated")}catch(t){t instanceof Error?g(t.message):g("An unknown error occurred while generating prompts.")}finally{u(!1)}},[C,x,j,b,v]),Ye=(t,r)=>{l(a=>a.map(e=>e.id===t?{...e,imagePrompt:r}:e))},ze=(t,r)=>{l(a=>a.map(e=>e.id===t?{...e,videoPrompt:r}:e))},Ke=(t,r)=>{l(a=>a.map(e=>e.id===t?{...e,voiceoverGuide:r}:e))},Ze=(t,r,a)=>{l(e=>e.map(s=>s.id===t?{...s,[r]:a}:s))},Je=(t,r,a)=>{ee(e=>{const n={...e[t]||{},[r]:a};if(r==="subjects"&&(!a||a.length===0)?delete n.subjects:r==="useProjectCharacter"&&a===!0?delete n.useProjectCharacter:r==="imageProvider"&&a==="lehuyducanh"&&delete n.imageProvider,Object.keys(n).length===0){const{[t]:d,...p}=e;return p}return{...e,[t]:n}})},ne=i.useCallback(async t=>{const r=c.find(a=>a.id===t);if(r){l(a=>a.map(e=>e.id===t?{...e,isGeneratingAudio:!0,audioGenerationError:null}:e));try{const a=await Pa(r.voiceoverScript,r.voiceoverGuide,H),e=ba(a),s=URL.createObjectURL(e);l(n=>n.map(d=>d.id===t?{...d,audioUrl:s,isGeneratingAudio:!1}:d))}catch(a){const e=a instanceof Error?a.message:"An unknown audio generation error occurred.";l(s=>s.map(n=>n.id===t?{...n,isGeneratingAudio:!1,audioGenerationError:e}:n))}}},[c,H]),qe=i.useCallback(async()=>{const t=c.filter(a=>!a.audioUrl);if(t.length===0){alert("All scenes already have generated audio.");return}be(!0);const r=t.map(a=>()=>ne(a.id));await ae(r,5),be(!1)},[c,ne]),ie=i.useCallback(async t=>{if(!k.canPerformAction(h,"generateImage")){const a=`You have reached your daily limit of ${T.generateImage} image generations.`;throw l(e=>e.map(s=>s.id===t?{...s,isGeneratingImage:!1,imageGenerationError:a}:s)),new Error(a)}const r=c.find(a=>a.id===t);if(r){l(a=>a.map(e=>e.id===t?{...e,isGeneratingImage:!0,imageGenerationError:null}:e));try{const a=O[t]||{},e=a.imageProvider||"lehuyducanh",s=[];b&&s.push(b),v&&a.useProjectCharacter!==!1&&s.push(v),a.subjects&&a.subjects.length>0&&s.push(...a.subjects);const n=s.map(y=>E(y)),[d]=await Promise.all([Promise.all(n)]);let p=r.imagePrompt;r.imageFocusObject&&(p=`Focus on: ${r.imageFocusObject}. ${p}`),r.imageCameraAngle&&(p=`${r.imageCameraAngle} shot. ${p}`);const f=await va({provider:e,prompt:p,subjectUrls:d,aspectRatio:S});l(y=>y.map(m=>m.id===t?{...m,images:[...m.images,...f],isGeneratingImage:!1}:m)),k.logAction(h,"generateImage"),L()}catch(a){if(!(a instanceof Error&&a.message.includes("daily limit"))){const e=a instanceof Error?a.message:"An unknown error occurred.";l(s=>s.map(n=>n.id===t?{...n,isGeneratingImage:!1,imageGenerationError:e}:n))}throw a}}},[c,b,v,O,h,L,S]),Qe=(t,r)=>{l(a=>a.map(e=>{if(e.id!==t)return e;const s=e.selectedImageForVideo===r?void 0:e.selectedImageForVideo;return{...e,images:e.images.filter(n=>n!==r),selectedImageForVideo:s}}))},Xe=(t,r)=>{l(a=>a.map(e=>e.id===t?{...e,selectedImageForVideo:r,videos:[],videoGenerationError:null}:e))},ea=i.useCallback(async(t,r)=>{try{const a=await E(r);l(e=>e.map(s=>s.id===t?{...s,images:[...s.images,a],selectedImageForVideo:a,videos:[],videoGenerationError:null}:s))}catch(a){console.error("Error encoding uploaded image:",a),g("Failed to process the uploaded image.")}},[]),aa=t=>{l(r=>r.map(a=>a.id===t?{...a,shouldUpscaleVideo:!a.shouldUpscaleVideo}:a))},ta=(t,r)=>{l(a=>a.map(e=>e.id===t?{...e,includeDialogueInPrompt:r}:e))},le=i.useCallback(async(t,r)=>{const a=c.find(s=>s.id===t),e=a==null?void 0:a.videos[r];if(!e){console.error("handleUpscaleVideo could not find the video in state:",t,r);return}l(s=>s.map(n=>n.id===t?{...n,videos:n.videos.map((d,p)=>p===r?{...d,isUpscaling:!0,upscaleError:null}:d)}:n));try{const{videoUrl:s,publicUrl:n}=await xa({provider:"lehuyducanh",mediaGenerationId:e.mediaGenerationId,seed:e.seed}),d=n||s;l(p=>p.map(f=>f.id===t?{...f,videos:f.videos.map((y,m)=>m===r?{...y,upscaledUrl:d,isUpscaling:!1}:y)}:f))}catch(s){const n=s instanceof Error?s.message:"An unknown error occurred during upscale.";throw l(d=>d.map(p=>p.id===t?{...p,videos:p.videos.map((f,y)=>y===r?{...f,isUpscaling:!1,upscaleError:n}:f)}:p)),s}},[c]),oa=(t,r)=>{l(a=>a.map(e=>{if(e.id!==t)return e;const s=[...e.videos];return s.splice(r,1),{...e,videos:s}}))},ce=i.useCallback(async t=>{if(!k.canPerformAction(h,"generateVideo")){const a=`You have reached your daily limit of ${T.generateVideo} video generations.`;throw l(e=>e.map(s=>s.id===t?{...s,isGeneratingVideo:!1,videoGenerationError:a}:s)),new Error(a)}const r=c.find(a=>a.id===t);if(!r||!r.selectedImageForVideo){const a="Attempted to generate video without a selected image.";throw l(e=>e.map(s=>s.id===t?{...s,isGeneratingVideo:!1,videoGenerationError:a}:s)),new Error(a)}l(a=>a.map(e=>e.id===t?{...e,isGeneratingVideo:!0,videoGenerationError:null}:e));try{const a=await ka(r.selectedImageForVideo);let e=`Motion/Action: ${r.videoPrompt}`;if(r.includeDialogueInPrompt!==!1){const N="The creator is speaking.",w=r.voiceoverScript;e=`${N}
${e}`,A&&(e+=`
Dialogue style: "${A}"`),e+=`
Dialogue in English: "${w}"`}e+=`

No Music Background`;const{videoUrl:s,upscaledUrl:n,mediaGenerationId:d,seed:p,publicUrl:f,upscaledPublicUrl:y}=await ya({provider:"lehuyducanh",prompt:e,imageUrl:a,upscale:r.shouldUpscaleVideo,aspectRatio:S}),m={url:f||s,mediaGenerationId:d,seed:p,upscaledUrl:y||n};l(N=>N.map(w=>{if(w.id!==t)return w;const W=w.videos.findIndex(ha=>ha.mediaGenerationId===m.mediaGenerationId),ge=[...w.videos];return W>-1?ge[W]=m:ge.push(m),{...w,videos:ge,isGeneratingVideo:!1}})),k.logAction(h,"generateVideo"),L()}catch(a){if(!(a instanceof Error&&a.message.includes("daily limit"))){const e=a instanceof Error?a.message:"An unknown error occurred.";l(s=>s.map(n=>n.id===t?{...n,isGeneratingVideo:!1,videoGenerationError:e}:n))}throw a}},[c,h,L,S,A]),ra=i.useCallback(async()=>{const t=T.generateImage-F.image;let r=c.filter(e=>e.images.length===0);if(r.length===0){alert("All scenes already have generated images.");return}r.length>t&&(alert(`You have ${t} image generations left today. The batch will only generate up to that many images.`),r=r.slice(0,t)),he(!0),g(null);const a=r.map(e=>()=>ie(e.id));await ae(a,5),he(!1)},[c,ie,h,F.image]),sa=i.useCallback(()=>{l(t=>t.map(r=>r.images.length>0?{...r,selectedImageForVideo:r.images[0]}:r)),alert("Picked the first available image for each scene as the video base!")},[]),na=i.useCallback(async()=>{const t=T.generateVideo-F.video;let r=c.filter(e=>e.selectedImageForVideo&&(!e.videos||e.videos.length===0));if(r.length===0){alert("No new scenes are ready for video generation. Either select a base image or note that all selected images already have videos.");return}r.length>t&&(alert(`You have ${t} video generations left today. The batch will only generate up to that many videos.`),r=r.slice(0,t)),ve(!0),g(null);const a=r.map(e=>()=>ce(e.id));await ae(a,5),ve(!1)},[c,ce,h,F.video]),ia=i.useCallback(async()=>{const t=c.flatMap(a=>(a.videos||[]).map((e,s)=>({scene:a,video:e,index:s})).filter(({video:e})=>e.url&&e.mediaGenerationId&&!e.upscaledUrl));if(t.length===0){alert("No videos are available to upscale.");return}xe(!0),g(null);const r=t.map(({scene:a,index:e})=>()=>le(a.id,e));await ae(r,5),xe(!1)},[c,le]),la=i.useCallback(async()=>{je(!0),g(null);try{await ja(c)}catch(t){const r=t instanceof Error?t.message:"An unknown error occurred.";g(r),alert(r)}finally{je(!1)}},[c]),ca=i.useCallback(async()=>{Se(!0),g(null);try{await Sa(c)}catch(t){const r=t instanceof Error?t.message:"An unknown error occurred.";g(r),alert(r)}finally{Se(!1)}},[c]),da=i.useCallback(async()=>{const{botToken:t,chatId:r}=Te.getTelegramConfig();if(!t||!r){alert("Please configure Telegram settings first in the Settings page.");return}const a=c.flatMap((e,s)=>e.images.map((n,d)=>({type:"photo",url:n,caption:`Scene ${s+1}: ${e.voiceoverScript}`,fileName:`${String(s+1).padStart(3,"0")}_image_${String(d+1).padStart(2,"0")}.jpg`})));if(a.length===0){alert("No generated images found to send.");return}Ge(!0),g(null);try{await Pe.sendMedia(a),alert("All images sent to Telegram successfully!")}catch(e){const s=e instanceof Error?e.message:"Failed to send images to Telegram.";g(s),alert(s)}finally{Ge(!1)}},[c]),ga=i.useCallback(async()=>{const{botToken:t,chatId:r}=Te.getTelegramConfig();if(!t||!r){alert("Please configure Telegram settings first in the Settings page.");return}const a=c.flatMap((e,s)=>(e.videos||[]).map((n,d)=>({type:"video",url:n.upscaledUrl||n.url,caption:`Scene ${s+1}: ${e.voiceoverScript}`,fileName:`${String(s+1).padStart(3,"0")}_video_${String(d+1).padStart(2,"0")}.mp4`}))).filter(e=>e.url);if(a.length===0){alert("No videos found to send.");return}Ae(!0),g(null);try{await Pe.sendMedia(a),alert("All videos sent to Telegram successfully!")}catch(e){const s=e instanceof Error?e.message:"Failed to send videos to Telegram.";g(s),alert(s)}finally{Ae(!1)}},[c]),de=$!=="input",ua=i.useCallback(async()=>{if(!de){alert("Please generate a script before saving.");return}Ie(!0),g(null);try{const t=b?{name:b.name,type:b.type,data:await ue(b)}:void 0,r=v?{name:v.name,type:v.type,data:await ue(v)}:void 0,a={};for(const p in O){const f=O[p],y={useProjectCharacter:f.useProjectCharacter,imageProvider:f.imageProvider};f.subjects&&(y.subjects=await Promise.all(f.subjects.map(async m=>({name:m.name,type:m.type,data:await ue(m)})))),a[p]=y}const s=JSON.stringify({version:"2.4.0-ugc",videoAngle:x,productInfo:I,targetAudience:V,ctaMessage:G,promptLanguage:j,generationStep:$,voiceoverScript:C,scenes:c,productImage:t,creatorImage:r,sceneOverrides:a,videoAspectRatio:S,globalVoiceInstruction:A},null,2),n=new Blob([s],{type:"application/json"}),d=(x.trim().replace(/[\s/]+/g,"-")||"ugc-project").toLowerCase();wa(n,`${d}.ugcproj`)}catch(t){const r=t instanceof Error?t.message:"An unknown error occurred during saving.";g(r),alert(`Failed to save project: ${r}`)}finally{Ie(!1)}},[c,x,I,V,G,j,b,v,O,$,C,de,S,A]),ma=i.useCallback(async t=>{var a,e;const r=(a=t.target.files)==null?void 0:a[0];if(r){Ve(!0),g(null);try{const s=await r.text(),n=JSON.parse(s);if(!((e=n.version)!=null&&e.includes("-ugc")))throw new Error("Invalid or incompatible project file. Please import a .ugcproj file.");R(n.videoAngle||"Honest Review / Testimonial"),B(n.productInfo||""),_(n.targetAudience||""),D(n.ctaMessage||"Link in bio!"),z(n.promptLanguage||"English"),P(n.voiceoverScript||""),Z(n.videoAspectRatio||"9:16"),J(n.globalVoiceInstruction||"");const d=n.scenes||[],p=d.map(m=>({...ke(m),...m,videos:m.videos||(m.videoUrl?[{url:m.videoUrl,mediaGenerationId:m.mediaGenerationId,seed:m.seed,upscaledUrl:m.upscaledVideoUrl}]:[])}));l(p);const f=n.generationStep||(d.length>0?"prompts_generated":n.voiceoverScript?"script_generated":"input");U(f),te(n.productImage?await me(n.productImage.data,n.productImage.name):null),oe(n.creatorImage?await me(n.creatorImage.data,n.creatorImage.name):null);const y={};if(n.sceneOverrides)for(const m in n.sceneOverrides){const N=n.sceneOverrides[m],w={useProjectCharacter:N.useProjectCharacter,imageProvider:N.imageProvider};N.subjects&&(w.subjects=await Promise.all(N.subjects.map(W=>me(W.data,W.name)))),y[m]=w}ee(y),alert("Project imported successfully!")}catch(s){const n=s instanceof Error?s.message:"An unknown error occurred during import.";g(n),alert(`Failed to import project: ${n}`)}finally{Ve(!1),t.target.value=""}}},[]),pa=t=>{const r=ke({voiceoverScript:"New scene",voiceoverGuide:"Neutral tone",imagePrompt:"",videoPrompt:""});l(a=>{const e=[...a];return e.splice(t,0,r),e})},fa=t=>{window.confirm("Are you sure you want to delete this scene? This action cannot be undone.")&&l(r=>r.filter(a=>a.id!==t))};return o.jsxs(o.Fragment,{children:[o.jsxs("header",{className:"py-4 px-8 bg-gray-800 shadow-lg border-b border-gray-700 shrink-0 flex justify-between items-center flex-wrap gap-y-2",children:[o.jsxs("div",{children:[o.jsxs("h1",{className:"text-3xl font-bold text-blue-400",children:[o.jsx("i",{className:"fas fa-user-check mr-3"}),"UGC Video Maker"]}),o.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Create Authentic User-Generated Style Content"})]}),o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs("div",{className:"flex gap-2",children:[o.jsx("label",{htmlFor:"import-project-ugc",className:`text-center bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-full transition-all duration-300 flex items-center justify-center gap-2 text-sm shadow-sm ${se?"cursor-not-allowed opacity-50":"cursor-pointer"}`,children:se?o.jsxs(o.Fragment,{children:[o.jsx("i",{className:"fas fa-spinner fa-spin"}),"Importing..."]}):o.jsxs(o.Fragment,{children:[o.jsx("i",{className:"fas fa-folder-open"}),"Import"]})}),o.jsx("input",{id:"import-project-ugc",type:"file",accept:".ugcproj",className:"hidden",onChange:ma,disabled:se}),o.jsx("button",{onClick:ua,disabled:we||!de,className:"bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-sm shadow-sm",children:we?o.jsxs(o.Fragment,{children:[o.jsx("i",{className:"fas fa-spinner fa-spin"}),"Saving..."]}):o.jsxs(o.Fragment,{children:[o.jsx("i",{className:"fas fa-save"}),"Save"]})})]}),o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs("div",{className:"text-right",children:[o.jsxs("span",{className:"text-gray-300 font-medium hidden sm:block",children:["Welcome, ",o.jsx("span",{className:"font-bold text-blue-400",children:h}),"!"]}),o.jsxs("div",{className:"text-xs text-gray-400 bg-gray-700 px-2 py-1 rounded-md mt-1 flex gap-x-2",children:["Daily Usage:",o.jsxs("span",{className:"font-bold text-blue-400",title:"Storyboard Generations",children:[" ",o.jsx("i",{className:"fas fa-file-alt"})," ",F.storyboard,"/",T.generateStoryboard]})," |",o.jsxs("span",{className:"font-bold text-green-400",title:"Image Generations",children:[" ",o.jsx("i",{className:"fas fa-image"})," ",F.image,"/",T.generateImage]})," |",o.jsxs("span",{className:"font-bold text-red-400",title:"Video Generations",children:[" ",o.jsx("i",{className:"fas fa-video"})," ",F.video,"/",T.generateVideo]})]})]}),o.jsx("button",{onClick:Be,className:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-full",children:"Logout"})]})]})]}),o.jsx("main",{className:"flex-1 overflow-x-hidden overflow-y-auto p-4 md:p-8",children:o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 xl:grid-cols-4 gap-8 items-start",children:[o.jsx("div",{className:"lg:sticky lg:top-8 xl:col-span-1",children:o.jsx(Ea,{videoAngle:x,setVideoAngle:R,productInfo:I,setProductInfo:B,targetAudience:V,setTargetAudience:_,ctaMessage:G,setCtaMessage:D,promptLanguage:j,setPromptLanguage:z,onGenerateScript:He,isGeneratingScript:q,productImage:b,setProductImage:te,creatorImage:v,setCreatorImage:oe,onViewImage:re,ttsVoice:H,setTtsVoice:K,videoAspectRatio:S,setVideoAspectRatio:Z,globalVoiceInstruction:A,setGlobalVoiceInstruction:J})}),o.jsx("div",{className:"lg:col-span-2 xl:col-span-3",children:o.jsx(Ia,{generationStep:$,scenes:c,isLoading:q,isGeneratingPrompts:X,error:Y,voiceoverScript:C,onVoiceoverScriptChange:P,onGeneratePrompts:We,sceneOverrides:O,onGenerateImage:ie,onSceneImagePromptChange:Ye,onSceneVideoPromptChange:ze,onSceneVoiceoverGuideChange:Ke,onSceneEnhancementChange:Ze,onSceneOverrideChange:Je,onDeleteImage:Qe,onViewImage:re,onUploadImageForVideo:ea,onGenerateAllImages:ra,isBatchGenerating:Ee,onViewStoryboard:()=>ye(!0),onDownloadAllImages:la,isDownloadingImages:$e,onDownloadAllVideos:ca,isDownloadingVideos:Oe,onSelectImageForVideo:Xe,onGenerateVideo:ce,onToggleVideoUpscale:aa,onUpscaleVideo:le,onGenerateAllVideos:na,isBatchGeneratingVideos:Fe,onUpscaleAllVideos:ia,isBatchUpscalingVideos:Me,generatedEnvironments:[],onGenerateAudio:ne,onGenerateAllAudio:qe,isBatchGeneratingAudio:Ue,activeModule:"ugc",onAddScene:pa,onPickAllImages:sa,onSendAllImagesToTelegram:da,isSendingImagesToTelegram:Le,onSendAllVideosToTelegram:ga,isSendingVideosToTelegram:Re,videoAspectRatio:S,onToggleDialogueInPrompt:ta,onGenerateEnhancedPrompt:_e,onDeleteScene:fa,onDeleteVideo:oa})})]})}),fe&&o.jsx(Na,{imageUrl:fe,onClose:()=>re(null)}),De&&o.jsx(Va,{scenes:c,onClose:()=>ye(!1),videoAspectRatio:S})]})};export{Ra as default};

import{r as i,j as r}from"./index-DX2mtma_.js";import{u as P,U,c as ca,r as se,d as da,a as ga,t as Ae,s as ma,O as ua,S as pa}from"./telegramService-DklkJaQq.js";import{A as fa}from"./config-PJqXRuVJ.js";import{I as Ce}from"./ImageUpload-mUB4HcDX.js";import{g as ha,a as ba,b as va,c as xa,m as Ge,I as ya}from"./lehuyducanhService-BqsWtKXJ.js";import{g as Sa,a as ja}from"./mediaService-1p3th5hq.js";import{r as N,i as wa,f as ie,d as le}from"./media-CDZXYBSY.js";import{s as Pe}from"./settingsService-Tte2DU1T.js";const ce=["Honest Review / Testimonial","Problem / Solution","My Daily Routine","Unboxing / First Impression","Why I Switched","GRWM (Get Ready With Me)","Custom"],Ia=[{value:"Kore",label:"Kore (Female)"},{value:"Puck",label:"Puck (Male)"},{value:"Charon",label:"Charon (Male)"},{value:"Fenrir",label:"Fenrir (Male)"},{value:"Zephyr",label:"Zephyr (Male)"}],Va=f=>{const{videoAngle:D,setVideoAngle:x,productInfo:R,setProductInfo:w,targetAudience:L,setTargetAudience:I,ctaMessage:B,setCtaMessage:V,promptLanguage:$,setPromptLanguage:c,onGenerateScript:l,isGeneratingScript:_,productImage:d,setProductImage:S,creatorImage:Y,setCreatorImage:O,onViewImage:z,ttsVoice:j,setTtsVoice:H,videoAspectRatio:A,setVideoAspectRatio:K,globalVoiceInstruction:E,setGlobalVoiceInstruction:T}=f,[C,k]=i.useState(ce.includes(D)?"":D),W=g=>{const p=g.target.value;p!=="Custom"?(x(p),k("")):x(C||"")},Z=g=>{k(g.target.value),x(g.target.value)},J=ce.includes(D)?D:"Custom";return r.jsxs("div",{className:"bg-gray-800 p-6 rounded-2xl border border-gray-700 shadow-lg flex flex-col gap-6",children:[r.jsxs("div",{className:"space-y-4",children:[r.jsxs("h3",{className:"text-lg font-bold text-blue-400 mb-2",children:[r.jsx("i",{className:"fas fa-cogs mr-2"}),"Core Video Inputs"]}),r.jsx(Ce,{id:"product-image",label:"Product Image (Required)",file:d,onFileChange:S,onViewImage:z}),r.jsx(Ce,{id:"creator-image",label:"Creator/Model Image (Optional)",file:Y,onFileChange:O,onViewImage:z})]}),r.jsx("div",{className:"border-t-2 border-gray-700 -mx-6"}),r.jsxs("div",{className:"px-1 space-y-4",children:[r.jsxs("h3",{className:"text-lg font-bold text-blue-400 -mb-2",children:[r.jsx("i",{className:"fas fa-rocket mr-2"}),"Creative Direction"]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"angle-select",className:"block text-md font-bold text-blue-400 mb-2",children:[r.jsx("i",{className:"fas-fa-lightbulb mr-2"}),"Video Angle / Core Idea"]}),r.jsx("select",{id:"angle-select",value:J,onChange:W,className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200",children:ce.map(g=>r.jsx("option",{value:g,children:g},g))}),J==="Custom"&&r.jsx("input",{type:"text",value:C,onChange:Z,placeholder:"Describe your custom angle...",className:"w-full bg-gray-900 border-2 border-gray-600 rounded-lg p-3 text-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 mt-2"})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"product-info",className:"block text-md font-bold text-blue-400 mb-2",children:[r.jsx("i",{className:"fas fa-file-alt mr-2"}),"Product Info & Key Benefits"]}),r.jsx("textarea",{id:"product-info",value:R,onChange:g=>w(g.target.value),placeholder:"e.g., Helps improve focus and memory. Contains Ginkgo Biloba and B12. Vegan friendly.",className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200",rows:3})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"target-audience",className:"block text-md font-bold text-blue-400 mb-2",children:[r.jsx("i",{className:"fas fa-users mr-2"}),"Target Audience (Optional)"]}),r.jsx("input",{id:"target-audience",type:"text",value:L,onChange:g=>I(g.target.value),placeholder:"e.g., Fitness enthusiasts aged 25-40",className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200"})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"cta",className:"block text-md font-bold text-blue-400 mb-2",children:[r.jsx("i",{className:"fas fa-bullhorn mr-2"}),"Call To Action (CTA) Message"]}),r.jsx("input",{id:"cta",type:"text",value:B,onChange:g=>V(g.target.value),placeholder:"e.g., Link in bio!, Get yours today!",className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200"})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-md font-bold text-blue-400 mb-2",children:[r.jsx("i",{className:"fas fa-language mr-2"}),"Prompt Language"]}),r.jsxs("div",{className:"flex gap-2 bg-gray-900 border-2 border-gray-600 rounded-lg p-1",children:[r.jsx("button",{onClick:()=>c("English"),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all duration-200 ${$==="English"?"bg-blue-600 text-white shadow-sm":"bg-transparent text-gray-400 hover:bg-gray-700"}`,children:"English"}),r.jsx("button",{onClick:()=>c("Vietnamese"),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all duration-200 ${$==="Vietnamese"?"bg-blue-600 text-white shadow-sm":"bg-transparent text-gray-400 hover:bg-gray-700"}`,children:"Tiếng Việt"})]})]})]}),r.jsx("div",{className:"border-t-2 border-gray-700 -mx-6"}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("h3",{className:"text-lg font-bold text-blue-400 mb-2",children:[r.jsx("i",{className:"fas fa-cog mr-2"}),"Audio & Video Settings"]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"global-voice-instruction",className:"block text-md font-bold text-blue-400 mb-2",children:[r.jsx("i",{className:"fas fa-comment-dots mr-2"}),"Global Voice Instruction (Optional)"]}),r.jsx("textarea",{id:"global-voice-instruction",value:E,onChange:g=>T(g.target.value),placeholder:"e.g., Speak in a warm, friendly, and engaging tone.",className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200 focus:ring-2 focus:ring-blue-500 transition duration-200",rows:2})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"tts-voice",className:"block text-md font-bold text-blue-400 mb-2",children:"Voiceover Model"}),r.jsx("select",{id:"tts-voice",value:j,onChange:g=>H(g.target.value),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200",children:Ia.map(g=>r.jsx("option",{value:g.value,children:g.label},g.value))})]}),r.jsxs("div",{children:[r.jsxs("label",{htmlFor:"aspect-ratio",className:"block text-md font-bold text-blue-400 mb-2",children:[r.jsx("i",{className:"fas fa-ruler-combined mr-2"}),"Video Aspect Ratio"]}),r.jsxs("select",{id:"aspect-ratio",value:A,onChange:g=>K(g.target.value),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200",children:[r.jsx("option",{value:"9:16",children:"9:16 (Portrait)"}),r.jsx("option",{value:"16:9",children:"16:9 (Landscape)"})]})]})]}),r.jsx("div",{className:"border-t-2 border-gray-700 -mx-6"}),r.jsx("button",{onClick:l,disabled:_||!d,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-lg shadow-md hover:shadow-lg transform hover:-translate-y-0.5",title:d?"Generate Voiceover Script":"Please upload a product image first",children:_?r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"fas fa-spinner fa-spin"}),"Generating Script..."]}):r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"fas fa-wand-magic-sparkles"}),"Generate Voiceover Script"]})})]})},Fa=({currentUser:f,onLogout:D})=>{const[x,R]=i.useState("Honest Review / Testimonial"),[w,L]=i.useState(""),[I,B]=i.useState(""),[V,$]=i.useState("Link in bio!"),[c,l]=i.useState([]),[_,d]=i.useState(null),[S,Y]=i.useState("English"),[O,z]=i.useState("Kore"),[j,H]=i.useState("9:16"),[A,K]=i.useState(""),[E,T]=i.useState("input"),[C,k]=i.useState(""),[W,Z]=i.useState(!1),[J,g]=i.useState(!1),[p,de]=i.useState(null),[h,ge]=i.useState(null),[F,X]=i.useState({}),[me,ee]=i.useState(null),[Ne,ue]=i.useState(!1),[ke,pe]=i.useState(!1),[Ee,fe]=i.useState(!1),[Te,he]=i.useState(!1),[Fe,be]=i.useState(!1),[Me,ve]=i.useState(!1),[xe,ye]=i.useState(!1),[ae,Se]=i.useState(!1),[De,je]=i.useState(!1),[$e,we]=i.useState(!1),[q,Ie]=i.useState({storyboard:0,image:0,video:0});i.useEffect(()=>{if(f){const t=P.getUsage(f);Ie({storyboard:t.generateStoryboard.count,image:t.generateImage.count,video:t.generateVideo.count})}},[f]);const M=i.useCallback(()=>{if(f){const t=P.getUsage(f);Ie({storyboard:t.generateStoryboard.count,image:t.generateImage.count,video:t.generateVideo.count})}},[f]),Oe=i.useCallback(async(t,o)=>{const a=c.find(e=>e.id===t);if(a){l(e=>e.map(n=>n.id===t?{...n,[o==="image"?"isGeneratingImagePrompt":"isGeneratingVideoPrompt"]:!0}:n));try{const e=`
        Video Angle/Core Idea: ${x}
        Product Info: ${w}
        Target Audience: ${I}
        Language: ${S}
        Call to Action: ${V}
      `,n=p?await N(p):void 0,s=h?await N(h):void 0,m=await ha(e,a,o,n,s);l(b=>b.map(y=>y.id===t?{...y,[o==="image"?"imagePrompt":"videoPrompt"]:m,[o==="image"?"isGeneratingImagePrompt":"isGeneratingVideoPrompt"]:!1}:y))}catch(e){const n=e instanceof Error?e.message:"Failed to generate prompt.";alert(n),l(s=>s.map(m=>m.id===t?{...m,[o==="image"?"isGeneratingImagePrompt":"isGeneratingVideoPrompt"]:!1}:m))}}},[c,x,w,I,S,V,p,h]),Ue=i.useCallback(async()=>{if(!P.canPerformAction(f,"generateStoryboard")){const t=`You have reached your daily limit of ${U.generateStoryboard} storyboard generations.`;d(t),alert(t);return}if(!p){d("Please provide a Product Image to begin.");return}Z(!0),d(null),l([]),k(""),X({}),T("input");try{const t=await N(p),o=h?await N(h):void 0,a=await ba(x,x,S,V,t,w,I,o);k(a),T("script_generated"),P.logAction(f,"generateStoryboard"),M()}catch(t){t instanceof Error?d(t.message):d("An unknown error occurred.")}finally{Z(!1)}},[x,V,S,p,w,I,h,f,M]),Re=i.useCallback(async()=>{g(!0),d(null);try{const t=await N(p),o=h?await N(h):void 0,a=await va(C,x,x,S,t,[],o);l(a),T("prompts_generated")}catch(t){t instanceof Error?d(t.message):d("An unknown error occurred while generating prompts.")}finally{g(!1)}},[C,x,S,p,h]),Le=(t,o)=>{l(a=>a.map(e=>e.id===t?{...e,imagePrompt:o}:e))},Be=(t,o)=>{l(a=>a.map(e=>e.id===t?{...e,videoPrompt:o}:e))},_e=(t,o)=>{l(a=>a.map(e=>e.id===t?{...e,voiceoverGuide:o}:e))},Ye=(t,o,a)=>{l(e=>e.map(n=>n.id===t?{...n,[o]:a}:n))},ze=(t,o,a)=>{X(e=>{const s={...e[t]||{},[o]:a};if(o==="subjects"&&(!a||a.length===0)?delete s.subjects:o==="useProjectCharacter"&&a===!0?delete s.useProjectCharacter:o==="imageProvider"&&a==="lehuyducanh"&&delete s.imageProvider,Object.keys(s).length===0){const{[t]:m,...b}=e;return b}return{...e,[t]:s}})},te=i.useCallback(async t=>{const o=c.find(a=>a.id===t);if(o){l(a=>a.map(e=>e.id===t?{...e,isGeneratingAudio:!0,audioGenerationError:null}:e));try{const a=await xa(o.voiceoverScript,o.voiceoverGuide,O),e=ca(a),n=URL.createObjectURL(e);l(s=>s.map(m=>m.id===t?{...m,audioUrl:n,isGeneratingAudio:!1}:m))}catch(a){const e=a instanceof Error?a.message:"An unknown audio generation error occurred.";l(n=>n.map(s=>s.id===t?{...s,isGeneratingAudio:!1,audioGenerationError:e}:s))}}},[c,O]),He=i.useCallback(async()=>{const t=c.filter(a=>!a.audioUrl);if(t.length===0){alert("All scenes already have generated audio.");return}pe(!0);const o=t.map(a=>()=>te(a.id));await se(o,5),pe(!1)},[c,te]),oe=i.useCallback(async t=>{if(!P.canPerformAction(f,"generateImage")){const a=`You have reached your daily limit of ${U.generateImage} image generations.`;throw l(e=>e.map(n=>n.id===t?{...n,isGeneratingImage:!1,imageGenerationError:a}:n)),new Error(a)}const o=c.find(a=>a.id===t);if(o){l(a=>a.map(e=>e.id===t?{...e,isGeneratingImage:!0,imageGenerationError:null}:e));try{const a=F[t]||{},e=a.imageProvider||"lehuyducanh",n=[];p&&n.push(p),h&&a.useProjectCharacter!==!1&&n.push(h),a.subjects&&a.subjects.length>0&&n.push(...a.subjects);const s=n.map(v=>N(v)),[m]=await Promise.all([Promise.all(s)]);let b=o.imagePrompt;o.imageFocusObject&&(b=`Focus on: ${o.imageFocusObject}. ${b}`),o.imageCameraAngle&&(b=`${o.imageCameraAngle} shot. ${b}`);const y=await Sa({provider:e,prompt:b,subjectUrls:m,aspectRatio:j});l(v=>v.map(u=>u.id===t?{...u,images:[...u.images,...y],isGeneratingImage:!1}:u)),P.logAction(f,"generateImage"),M()}catch(a){if(!(a instanceof Error&&a.message.includes("daily limit"))){const e=a instanceof Error?a.message:"An unknown error occurred.";l(n=>n.map(s=>s.id===t?{...s,isGeneratingImage:!1,imageGenerationError:e}:s))}throw a}}},[c,p,h,F,f,M,j]),Ke=(t,o)=>{l(a=>a.map(e=>{if(e.id!==t)return e;const n=e.selectedImageForVideo===o?void 0:e.selectedImageForVideo;return{...e,images:e.images.filter(s=>s!==o),selectedImageForVideo:n}}))},We=(t,o)=>{l(a=>a.map(e=>e.id===t?{...e,selectedImageForVideo:o,videos:[],videoGenerationError:null}:e))},Ze=i.useCallback(async(t,o)=>{try{const a=await N(o);l(e=>e.map(n=>n.id===t?{...n,images:[...n.images,a],selectedImageForVideo:a,videos:[],videoGenerationError:null}:n))}catch(a){console.error("Error encoding uploaded image:",a),d("Failed to process the uploaded image.")}},[]),Je=(t,o)=>{l(a=>a.map(e=>e.id===t?{...e,includeDialogueInPrompt:o}:e))},qe=(t,o)=>{l(a=>a.map(e=>{if(e.id!==t)return e;const n=[...e.videos];return n.splice(o,1),{...e,videos:n}}))},re=i.useCallback(async t=>{if(!P.canPerformAction(f,"generateVideo")){const a=`You have reached your daily limit of ${U.generateVideo} video generations.`;throw l(e=>e.map(n=>n.id===t?{...n,isGeneratingVideo:!1,videoGenerationError:a}:n)),new Error(a)}const o=c.find(a=>a.id===t);if(!o||!o.selectedImageForVideo){const a="Attempted to generate video without a selected image.";throw l(e=>e.map(n=>n.id===t?{...n,isGeneratingVideo:!1,videoGenerationError:a}:n)),new Error(a)}l(a=>a.map(e=>e.id===t?{...e,isGeneratingVideo:!0,videoGenerationError:null}:e));try{const a=await wa(o.selectedImageForVideo);let e=`Motion/Action: ${o.videoPrompt}`;if(o.includeDialogueInPrompt!==!1){const y="The creator is speaking.",v=o.voiceoverScript;e=`${y}
${e}`,A&&(e+=`
Dialogue style: "${A}"`),e+=`
Dialogue in English: "${v}"`}e+=`

No Music Background`;const{videoUrl:n,mediaGenerationId:s,seed:m}=await ja({provider:"lehuyducanh",prompt:e,imageUrl:a,aspectRatio:j}),b={url:n,mediaGenerationId:s,seed:m};l(y=>y.map(v=>{if(v.id!==t)return v;const u=v.videos.findIndex(Q=>Q.mediaGenerationId===b.mediaGenerationId),G=[...v.videos];return u>-1?G[u]=b:G.push(b),{...v,videos:G,isGeneratingVideo:!1}})),P.logAction(f,"generateVideo"),M()}catch(a){if(!(a instanceof Error&&a.message.includes("daily limit"))){const e=a instanceof Error?a.message:"An unknown error occurred.";l(n=>n.map(s=>s.id===t?{...s,isGeneratingVideo:!1,videoGenerationError:e}:s))}throw a}},[c,f,M,j,A]),Qe=i.useCallback(async()=>{const t=U.generateImage-q.image;let o=c.filter(e=>e.images.length===0);if(o.length===0){alert("All scenes already have generated images.");return}o.length>t&&(alert(`You have ${t} image generations left today. The batch will only generate up to that many images.`),o=o.slice(0,t)),ue(!0),d(null);const a=o.map(e=>()=>oe(e.id));await se(a,5),ue(!1)},[c,oe,f,q.image]),Xe=i.useCallback(()=>{l(t=>t.map(o=>o.images.length>0?{...o,selectedImageForVideo:o.images[0]}:o)),alert("Picked the first available image for each scene as the video base!")},[]),ea=i.useCallback(async()=>{const t=U.generateVideo-q.video;let o=c.filter(e=>e.selectedImageForVideo&&(!e.videos||e.videos.length===0));if(o.length===0){alert("No new scenes are ready for video generation. Either select a base image or note that all selected images already have videos.");return}o.length>t&&(alert(`You have ${t} video generations left today. The batch will only generate up to that many videos.`),o=o.slice(0,t)),fe(!0),d(null);const a=o.map(e=>()=>re(e.id));await se(a,5),fe(!1)},[c,re,f,q.video]),aa=i.useCallback(async()=>{be(!0),d(null);try{await da(c)}catch(t){const o=t instanceof Error?t.message:"An unknown error occurred.";d(o),alert(o)}finally{be(!1)}},[c]),ta=i.useCallback(async()=>{ve(!0),d(null);try{await ga(c)}catch(t){const o=t instanceof Error?t.message:"An unknown error occurred.";d(o),alert(o)}finally{ve(!1)}},[c]),oa=i.useCallback(async()=>{const{botToken:t,chatId:o}=Pe.getTelegramConfig();if(!t||!o){alert("Please configure Telegram settings first in the Settings page.");return}const a=c.flatMap((e,n)=>e.images.map((s,m)=>({type:"photo",url:s,caption:`Scene ${n+1}: ${e.voiceoverScript}`,fileName:`${String(n+1).padStart(3,"0")}_image_${String(m+1).padStart(2,"0")}.jpg`})));if(a.length===0){alert("No generated images found to send.");return}je(!0),d(null);try{await Ae.sendMedia(a),alert("All images sent to Telegram successfully!")}catch(e){const n=e instanceof Error?e.message:"Failed to send images to Telegram.";d(n),alert(n)}finally{je(!1)}},[c]),ra=i.useCallback(async()=>{const{botToken:t,chatId:o}=Pe.getTelegramConfig();if(!t||!o){alert("Please configure Telegram settings first in the Settings page.");return}const a=c.flatMap((e,n)=>(e.videos||[]).map((s,m)=>({type:"video",url:s.url,caption:`Scene ${n+1}: ${e.voiceoverScript}`,fileName:`${String(n+1).padStart(3,"0")}_video_${String(m+1).padStart(2,"0")}.mp4`}))).filter(e=>e.url);if(a.length===0){alert("No videos found to send.");return}we(!0),d(null);try{await Ae.sendMedia(a),alert("All videos sent to Telegram successfully!")}catch(e){const n=e instanceof Error?e.message:"Failed to send videos to Telegram.";d(n),alert(n)}finally{we(!1)}},[c]),ne=E!=="input",na=i.useCallback(async()=>{if(!ne){alert("Please generate a script before saving.");return}ye(!0),d(null);try{const t=p?{name:p.name,type:p.type,data:await ie(p)}:void 0,o=h?{name:h.name,type:h.type,data:await ie(h)}:void 0,a={};for(const b in F){const y=F[b],v={useProjectCharacter:y.useProjectCharacter,imageProvider:y.imageProvider};y.subjects&&(v.subjects=await Promise.all(y.subjects.map(async u=>({name:u.name,type:u.type,data:await ie(u)})))),a[b]=v}const n=JSON.stringify({version:"2.4.0-ugc",videoAngle:x,productInfo:w,targetAudience:I,ctaMessage:V,promptLanguage:S,generationStep:E,voiceoverScript:C,scenes:c,productImage:t,creatorImage:o,sceneOverrides:a,videoAspectRatio:j,globalVoiceInstruction:A},null,2),s=new Blob([n],{type:"application/json"}),m=(x.trim().replace(/[\s/]+/g,"-")||"ugc-project").toLowerCase();ma(s,`${m}.ugcproj`)}catch(t){const o=t instanceof Error?t.message:"An unknown error occurred during saving.";d(o),alert(`Failed to save project: ${o}`)}finally{ye(!1)}},[c,x,w,I,V,S,p,h,F,E,C,ne,j,A]),sa=i.useCallback(async t=>{var a,e;const o=(a=t.target.files)==null?void 0:a[0];if(o){Se(!0),d(null);try{const n=await o.text(),s=JSON.parse(n);if(!((e=s.version)!=null&&e.includes("-ugc")))throw new Error("Invalid or incompatible project file. Please import a .ugcproj file.");R(s.videoAngle||"Honest Review / Testimonial"),L(s.productInfo||""),B(s.targetAudience||""),$(s.ctaMessage||"Link in bio!"),Y(s.promptLanguage||"English"),k(s.voiceoverScript||""),H(s.videoAspectRatio||"9:16"),K(s.globalVoiceInstruction||"");const m=s.scenes||[],b=m.map(u=>({...Ge(u),...u,videos:u.videos||(u.videoUrl?[{url:u.videoUrl,mediaGenerationId:u.mediaGenerationId,seed:u.seed}]:[])}));l(b);const y=s.generationStep||(m.length>0?"prompts_generated":s.voiceoverScript?"script_generated":"input");T(y),de(s.productImage?await le(s.productImage.data,s.productImage.name):null),ge(s.creatorImage?await le(s.creatorImage.data,s.creatorImage.name):null);const v={};if(s.sceneOverrides)for(const u in s.sceneOverrides){const G=s.sceneOverrides[u],Q={useProjectCharacter:G.useProjectCharacter,imageProvider:G.imageProvider};G.subjects&&(Q.subjects=await Promise.all(G.subjects.map(Ve=>le(Ve.data,Ve.name)))),v[u]=Q}X(v),alert("Project imported successfully!")}catch(n){const s=n instanceof Error?n.message:"An unknown error occurred during import.";d(s),alert(`Failed to import project: ${s}`)}finally{Se(!1),t.target.value=""}}},[]),ia=t=>{const o=Ge({voiceoverScript:"New scene",voiceoverGuide:"Neutral tone",imagePrompt:"",videoPrompt:""});l(a=>{const e=[...a];return e.splice(t,0,o),e})},la=t=>{window.confirm("Are you sure you want to delete this scene? This action cannot be undone.")&&l(o=>o.filter(a=>a.id!==t))};return r.jsxs(r.Fragment,{children:[r.jsxs("header",{className:"py-4 px-8 bg-gray-800 shadow-lg border-b border-gray-700 shrink-0 flex justify-between items-center flex-wrap gap-y-2",children:[r.jsxs("div",{children:[r.jsxs("h1",{className:"text-3xl font-bold text-blue-400",children:[r.jsx("i",{className:"fas fa-user-check mr-3"}),"UGC Video Maker"]}),r.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Create Authentic User-Generated Style Content"})]}),r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("div",{className:"flex gap-2",children:[r.jsx("label",{htmlFor:"import-project-ugc",className:`text-center bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-full transition-all duration-300 flex items-center justify-center gap-2 text-sm shadow-sm ${ae?"cursor-not-allowed opacity-50":"cursor-pointer"}`,children:ae?r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"fas fa-spinner fa-spin"}),"Importing..."]}):r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"fas fa-folder-open"}),"Import"]})}),r.jsx("input",{id:"import-project-ugc",type:"file",accept:".ugcproj",className:"hidden",onChange:sa,disabled:ae}),r.jsx("button",{onClick:na,disabled:xe||!ne,className:"bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-sm shadow-sm",children:xe?r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"fas fa-spinner fa-spin"}),"Saving..."]}):r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"fas fa-save"}),"Save"]})})]}),fa.LOGIN_REQUIRED]})]}),r.jsx("main",{className:"flex-1 overflow-x-hidden overflow-y-auto p-4 md:p-8",children:r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 xl:grid-cols-4 gap-8 items-start",children:[r.jsx("div",{className:"lg:sticky lg:top-8 xl:col-span-1",children:r.jsx(Va,{videoAngle:x,setVideoAngle:R,productInfo:w,setProductInfo:L,targetAudience:I,setTargetAudience:B,ctaMessage:V,setCtaMessage:$,promptLanguage:S,setPromptLanguage:Y,onGenerateScript:Ue,isGeneratingScript:W,productImage:p,setProductImage:de,creatorImage:h,setCreatorImage:ge,onViewImage:ee,ttsVoice:O,setTtsVoice:z,videoAspectRatio:j,setVideoAspectRatio:H,globalVoiceInstruction:A,setGlobalVoiceInstruction:K})}),r.jsx("div",{className:"lg:col-span-2 xl:col-span-3",children:r.jsx(ua,{generationStep:E,scenes:c,isLoading:W,isGeneratingPrompts:J,error:_,voiceoverScript:C,onVoiceoverScriptChange:k,onGeneratePrompts:Re,sceneOverrides:F,onGenerateImage:oe,onSceneImagePromptChange:Le,onSceneVideoPromptChange:Be,onSceneVoiceoverGuideChange:_e,onSceneEnhancementChange:Ye,onSceneOverrideChange:ze,onDeleteImage:Ke,onViewImage:ee,onUploadImageForVideo:Ze,onGenerateAllImages:Qe,isBatchGenerating:Ne,onViewStoryboard:()=>he(!0),onDownloadAllImages:aa,isDownloadingImages:Fe,onDownloadAllVideos:ta,isDownloadingVideos:Me,onSelectImageForVideo:We,onGenerateVideo:re,onGenerateAllVideos:ea,isBatchGeneratingVideos:Ee,generatedEnvironments:[],onGenerateAudio:te,onGenerateAllAudio:He,isBatchGeneratingAudio:ke,activeModule:"ugc",onAddScene:ia,onPickAllImages:Xe,onSendAllImagesToTelegram:oa,isSendingImagesToTelegram:De,onSendAllVideosToTelegram:ra,isSendingVideosToTelegram:$e,videoAspectRatio:j,onToggleDialogueInPrompt:Je,onGenerateEnhancedPrompt:Oe,onDeleteScene:la,onDeleteVideo:qe})})]})}),me&&r.jsx(ya,{imageUrl:me,onClose:()=>ee(null)}),Te&&r.jsx(pa,{scenes:c,onClose:()=>he(!1),videoAspectRatio:j})]})};export{Fa as default};

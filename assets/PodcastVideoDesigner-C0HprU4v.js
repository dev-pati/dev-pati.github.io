import{r as n,j as e}from"./index-BDGPSugR.js";import{u as I,U as B,g as _e,a as Ca,b as Ga,s as Aa,r as ge,c as Pa,t as qe,d as Ta,e as Ea,O as Fa,S as Ua}from"./telegramService-Cj56laOR.js";import{I as Ie}from"./ImageUpload-cWb71mSq.js";import{h as Ha,i as Oa,m as We,c as Da,j as $a,I as Ba}from"./lehuyducanhService-B9F-RCut.js";import{r as Ne,i as Ma,f as Ve,d as ke}from"./media-CDZXYBSY.js";import{s as Ye}from"./settingsService-CbIZ9NBp.js";import"./streetInterviewPrompts-Dzu83YwK.js";const Ce=[{value:"Kore",label:"Kore (Female)"},{value:"Puck",label:"Puck (Male)"},{value:"Charon",label:"Charon (Male)"},{value:"Fenrir",label:"Fenrir (Male)"},{value:"Zephyr",label:"Zephyr (Male)"}],La=u=>{const{numHosts:y,setNumHosts:p,hostOneImage:N,setHostOneImage:b,hostTwoImage:P,setHostTwoImage:x,podcastTopic:M,setPodcastTopic:V,pastedScript:L,setPastedScript:k,onGenerateScript:T,isGeneratingScript:c,onAnalyzeScript:d,isAnalyzingScript:z,reporterVoice:ae,setReporterVoice:te,intervieweeVoice:m,setIntervieweeVoice:G,environmentImage:E,setEnvironmentImage:se,environmentVariationsCount:oe,setEnvironmentVariationsCount:ne,onGenerateEnvironments:re,isGeneratingEnvironments:C,globalVoiceInstruction:ie,setGlobalVoiceInstruction:le,videoAspectRatio:R,setVideoAspectRatio:me,singleHostSetting:F,setSingleHostSetting:ce,backgroundPrompt:ue,setBackgroundPrompt:pe,onViewImage:_}=u,[S,de]=n.useState("custom"),[U,q]=n.useState("generate"),he=!!N&&(y===1||!!P)&&!!M,W=(!!N&&(y===1||!!P)||!!E)&&!!L,H=y===1&&F==="stage"?"Stage":"Studio";return e.jsxs("div",{className:"bg-gray-800 p-6 rounded-2xl border border-gray-700 shadow-lg flex flex-col gap-6",children:[e.jsxs("div",{className:"flex mb-2 border-b-2 border-gray-700",children:[e.jsxs("button",{onClick:()=>de("custom"),className:`flex-1 text-center font-bold py-3 transition-all duration-300 flex items-center justify-center gap-2 ${S==="custom"?"text-blue-400 border-b-4 border-blue-500":"text-gray-400 hover:text-white"}`,children:[e.jsx("i",{className:"fas fa-tools"})," Custom Setup"]}),e.jsxs("button",{onClick:()=>de("quick-start"),className:`flex-1 text-center font-bold py-3 transition-all duration-300 flex items-center justify-center gap-2 ${S==="quick-start"?"text-yellow-400 border-b-4 border-yellow-500":"text-gray-400 hover:text-white"}`,children:[e.jsx("i",{className:"fas fa-bolt"})," Quick Start"]})]}),S==="custom"&&e.jsxs("div",{className:"flex flex-col gap-6 animate-fade-in",children:[e.jsxs("h3",{className:"text-xl font-bold text-blue-400 -mb-2",children:[e.jsx("i",{className:"fas fa-users mr-2"}),"Cast"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-md font-bold text-gray-300 mb-2",children:"Number of Hosts"}),e.jsxs("div",{className:"flex gap-2 bg-gray-900 border-2 border-gray-600 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>p(1),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${y===1?"bg-blue-600":"bg-transparent text-gray-400 hover:bg-gray-700"}`,children:"1 Host"}),e.jsx("button",{onClick:()=>p(2),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${y===2?"bg-blue-600":"bg-transparent text-gray-400 hover:bg-gray-700"}`,children:"2 Hosts"})]})]}),y===1&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-md font-bold text-gray-300 mb-2",children:"Host Setting"}),e.jsxs("div",{className:"flex gap-2 bg-gray-900 border-2 border-gray-600 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>ce("studio"),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${F==="studio"?"bg-blue-600":"bg-transparent text-gray-400 hover:bg-gray-700"}`,children:"In Studio"}),e.jsx("button",{onClick:()=>ce("stage"),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${F==="stage"?"bg-blue-600":"bg-transparent text-gray-400 hover:bg-gray-700"}`,children:"On Stage"})]})]}),e.jsx(Ie,{id:"podcast-host-1-image",label:y===1?"Host Image":"Host 1 Image",file:N,onFileChange:b,onViewImage:_}),y===2&&e.jsx(Ie,{id:"podcast-host-2-image",label:"Host 2 Image",file:P,onFileChange:x,onViewImage:_}),e.jsx("div",{className:"border-t-2 border-gray-700 -mx-6"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-400 mb-2",children:[e.jsx("i",{className:"fas fa-image mr-2"}),H," / Set"]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"background-prompt",className:"block text-sm font-bold text-gray-300 mb-1",children:"Generate with AI using a prompt"}),e.jsx("input",{id:"background-prompt",type:"text",value:ue,onChange:l=>pe(l.target.value),placeholder:"e.g., minimalist, wooden textures...",className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-2 text-gray-200"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"env-count",className:"block text-sm font-bold text-gray-300 mb-1",children:"Number of Camera Angles"}),e.jsx("input",{id:"env-count",type:"number",min:"1",max:"10",value:oe,onChange:l=>ne(parseInt(l.target.value,10)),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-2 text-gray-200"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"aspect-ratio-podcast",className:"block text-sm font-bold text-gray-300 mb-1",children:"Video Aspect Ratio"}),e.jsxs("select",{id:"aspect-ratio-podcast",value:R,onChange:l=>me(l.target.value),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-2 text-gray-200",children:[e.jsx("option",{value:"16:9",children:"16:9 (Landscape)"}),e.jsx("option",{value:"9:16",children:"9:16 (Portrait)"})]})]}),e.jsx("button",{onClick:re,disabled:C||!N,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-full disabled:opacity-50",title:N?`Generate ${H} Scene Variations`:"Please upload at least one host image",children:C?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"})," Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-camera-retro"})," Generate ",H," Scenes"]})})]})]}),S==="quick-start"&&e.jsxs("div",{className:"flex flex-col gap-6 animate-fade-in",children:[e.jsx("div",{className:"bg-yellow-900/30 border border-yellow-700/50 p-3 rounded-lg text-center text-yellow-200 text-sm",children:e.jsxs("p",{children:[e.jsx("i",{className:"fas fa-bolt mr-2"}),"Upload a finalized photo of you in the studio. We'll use it for everything."]})}),e.jsx(Ie,{id:"environment-image",label:"Master Shot (You in Studio)",file:E,onFileChange:se,onViewImage:_})]}),e.jsx("div",{className:"border-t-2 border-gray-700 -mx-6"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-400 mb-2",children:[e.jsx("i",{className:"fas fa-cog mr-2"}),"Audio & Video"]}),y===1?e.jsxs("div",{children:[e.jsx("label",{htmlFor:"podcast-tts-voice",className:"block text-md font-bold text-gray-300 mb-2",children:"Host's Voice"}),e.jsx("select",{id:"podcast-tts-voice",value:ae,onChange:l=>te(l.target.value),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200",children:Ce.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"reporter-voice",className:"block text-md font-bold text-gray-300 mb-2",children:"Host 1's Voice"}),e.jsx("select",{id:"reporter-voice",value:ae,onChange:l=>te(l.target.value),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200",children:Ce.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"interviewee-voice",className:"block text-md font-bold text-gray-300 mb-2",children:"Host 2's Voice"}),e.jsx("select",{id:"interviewee-voice",value:m,onChange:l=>G(l.target.value),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200",children:Ce.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"global-voice-instruction",className:"block text-md font-bold text-gray-300 mb-2",children:"Global Voice Instruction (Optional)"}),e.jsx("textarea",{id:"global-voice-instruction",value:ie,onChange:l=>le(l.target.value),placeholder:"e.g., Speak in a warm, friendly, and engaging tone.",className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200",rows:2})]})]}),e.jsx("div",{className:"border-t-2 border-gray-700 -mx-6"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-400 mb-4",children:[e.jsx("i",{className:"fas fa-file-alt mr-2"}),"Scripting"]}),e.jsxs("div",{className:"flex gap-1 bg-gray-900 border-2 border-gray-600 rounded-lg p-1 mb-4",children:[e.jsx("button",{onClick:()=>q("generate"),disabled:S==="quick-start",className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${U==="generate"&&S!=="quick-start"?"bg-blue-600":"bg-transparent text-gray-400 hover:bg-gray-700"} ${S==="quick-start"?"opacity-50 cursor-not-allowed":""}`,children:"Generate"}),e.jsx("button",{onClick:()=>q("paste"),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${U==="paste"?"bg-blue-600":"bg-transparent text-gray-400 hover:bg-gray-700"}`,children:"Paste"})]}),U==="generate"&&S==="custom"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{htmlFor:"podcast-topic",className:"block text-md font-bold text-gray-300",children:"Podcast Topic"}),e.jsx("input",{id:"podcast-topic",type:"text",value:M,onChange:l=>V(l.target.value),placeholder:"e.g., The future of AI",className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200"}),e.jsx("button",{onClick:T,disabled:c||!he,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-full disabled:opacity-50 flex items-center justify-center gap-2",children:c?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"})," Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-wand-magic-sparkles"})," Generate Script"]})})]}),U==="paste"&&e.jsx("textarea",{id:"pasted-script",value:L,onChange:l=>k(l.target.value),placeholder:"Paste your full podcast script here. Each new line or paragraph will be treated as a scene.",className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200",rows:8})]}),e.jsx("div",{className:"border-t-2 border-gray-700 -mx-6 pt-6",children:e.jsx("button",{onClick:d,disabled:z||!W,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-full disabled:opacity-50 text-lg flex items-center justify-center gap-2",title:W?"Generate Storyboard":"Please provide required inputs",children:z?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"})," Analyzing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-cogs"})," Generate Storyboard"]})})})]})},Za=({currentUser:u,onLogout:y})=>{const[p,N]=n.useState(1),[b,P]=n.useState(null),[x,M]=n.useState(null),[V,L]=n.useState(""),[k,T]=n.useState(""),[c,d]=n.useState([]),[z,ae]=n.useState(null),[te,m]=n.useState(null),[G,E]=n.useState("input"),[se,oe]=n.useState(!1),[ne,re]=n.useState(!1),[C,ie]=n.useState({}),[le,R]=n.useState(null),[me,F]=n.useState(!1),[ce,ue]=n.useState(!1),[pe,_]=n.useState(!1),[S,de]=n.useState(!1),[U,q]=n.useState(!1),[he,W]=n.useState(!1),[Ge,H]=n.useState(!1),[l,Ke]=n.useState({storyboard:0,image:0,video:0}),[Ae,Pe]=n.useState(!1),[fe,Te]=n.useState(!1),[Y,Ee]=n.useState("Puck"),[O,Fe]=n.useState("Kore"),[K,Ue]=n.useState(""),[v,He]=n.useState("16:9"),[A,Oe]=n.useState("studio"),[Z,De]=n.useState(null),[J,$e]=n.useState("a modern, professional podcast studio interior"),[be,Be]=n.useState([]),[Q,xe]=n.useState(),[ve,Ze]=n.useState(4),[Je,Me]=n.useState(!1),[Qe,Le]=n.useState(!1),[Xe,ze]=n.useState(!1),w=n.useCallback(()=>{const a=I.getUsage(u);Ke({storyboard:a.generateStoryboard.count,image:a.generateImage.count,video:a.generateVideo.count})},[u]);n.useEffect(()=>{w()},[w]);const D=n.useCallback(async()=>{const a=[];return b&&a.push(await Ne(b)),p===2&&x&&a.push(await Ne(x)),a},[b,x,p]),ea=n.useCallback(async()=>{if(!I.canPerformAction(u,"generateStoryboard")){alert(`You have reached your daily limit of ${B.generateStoryboard} storyboard generations.`);return}oe(!0),m(null);try{const a=await D();if(a.length!==p)throw new Error("Missing host images.");const s=await Ha(V,p,a);T(s),E("script_generated"),I.logAction(u,"generateStoryboard"),w()}catch(a){m(a instanceof Error?a.message:"An unknown error occurred.")}finally{oe(!1)}},[u,D,p,V,w]),Re=n.useCallback(async()=>{re(!0),m(null),d([]);try{const a=await D();if(a.length!==p)throw new Error("Missing host images.");if(!I.canPerformAction(u,"generateImage"))throw new Error("You have reached your daily limit for image generations and cannot create the initial studio image.");const s=p===1?"A realistic photo of a person in a modern podcast studio, sitting at a table with a professional microphone. The shot is a medium wide shot.":"A realistic photo of two people sitting across from each other in a modern podcast studio, at a table with professional microphones. The shot is a medium wide shot.",[o]=await _e({provider:"gemini",prompt:s,subjectUrls:a,aspectRatio:v});ae(o),I.logAction(u,"generateImage"),w();const t=await Oa(k,a,A);d(t),E("prompts_generated")}catch(a){m(a instanceof Error?a.message:"An unknown error occurred.")}finally{re(!1)}},[D,p,k,u,w,v,A]),ye=n.useCallback(async a=>{if(!I.canPerformAction(u,"generateImage"))throw new Error(`You have reached your daily limit of ${B.generateImage} image generations.`);const s=c.find(o=>o.id===a);if(s){d(o=>o.map(t=>t.id===a?{...t,isGeneratingImage:!0,imageGenerationError:null}:t));try{const o=C[a]||{},t=o.imageProvider||"lehuyducanh",i=o.selectedHost,r=[];i==="host1"?b&&r.push(b):i==="host2"?x&&r.push(x):(b&&r.push(b),p===2&&x&&r.push(x));const g=await Promise.all(r.map(ee=>Ne(ee))),h=s.imagePrompt.toLowerCase().includes("studio"),f=h?g:[],$=h?z??void 0:void 0,X=await _e({provider:t,prompt:s.imagePrompt,subjectUrls:f,sceneUrl:$,aspectRatio:v});d(ee=>ee.map(j=>j.id===a?{...j,images:[...j.images,...X],isGeneratingImage:!1}:j)),I.logAction(u,"generateImage"),w()}catch(o){throw d(t=>t.map(i=>i.id===a?{...i,isGeneratingImage:!1,imageGenerationError:o instanceof Error?o.message:"Unknown error"}:i)),o}}},[c,u,w,C,b,x,p,z,v]),Se=n.useCallback(async(a,s)=>{const o=c.find(i=>i.id===a),t=o==null?void 0:o.videos[s];if(t){d(i=>i.map(r=>r.id===a?{...r,videos:r.videos.map((g,h)=>h===s?{...g,isUpscaling:!0,upscaleError:null}:g)}:r));try{const{videoUrl:i,publicUrl:r}=await Ca({provider:"lehuyducanh",mediaGenerationId:t.mediaGenerationId,seed:t.seed}),g=r||i;d(h=>h.map(f=>f.id===a?{...f,videos:f.videos.map(($,X)=>X===s?{...$,upscaledUrl:g,isUpscaling:!1}:$)}:f))}catch(i){throw d(r=>r.map(g=>g.id===a?{...g,videos:g.videos.map((h,f)=>f===s?{...h,isUpscaling:!1,upscaleError:i instanceof Error?i.message:"Unknown error"}:h)}:g)),i}}},[c]),aa=(a,s)=>{d(o=>o.map(t=>{if(t.id!==a)return t;const i=[...t.videos];return i.splice(s,1),{...t,videos:i}}))},we=n.useCallback(async a=>{if(!I.canPerformAction(u,"generateVideo"))throw new Error(`You have reached your daily limit of ${B.generateVideo} video generations.`);const s=c.find(o=>o.id===a);if(!s||!s.selectedImageForVideo)throw new Error("No image selected for video generation.");d(o=>o.map(t=>t.id===a?{...t,isGeneratingVideo:!0,videoGenerationError:null}:t));try{const o=await Ma(s.selectedImageForVideo),t=`Voiceover: "${s.voiceoverScript}".
Motion: ${s.videoPrompt}`,{videoUrl:i,upscaledUrl:r,mediaGenerationId:g,seed:h,publicUrl:f,upscaledPublicUrl:$}=await Ga({provider:"lehuyducanh",prompt:t,imageUrl:o,upscale:s.shouldUpscaleVideo,aspectRatio:v}),X={url:f||i,upscaledUrl:$||r,mediaGenerationId:g,seed:h};d(ee=>ee.map(j=>j.id!==a?j:{...j,videos:[...j.videos||[],X],isGeneratingVideo:!1})),I.logAction(u,"generateVideo"),w()}catch(o){throw d(t=>t.map(i=>i.id===a?{...i,isGeneratingVideo:!1,videoGenerationError:o instanceof Error?o.message:"Unknown error"}:i)),o}},[c,u,w,v]),ta=n.useCallback(async()=>{if(G==="input"){alert("Please generate a script or storyboard before saving.");return}Pe(!0),m(null);try{const a=b?{name:b.name,data:await Ve(b)}:void 0,s=x?{name:x.name,data:await Ve(x)}:void 0,o=Z?{name:Z.name,data:await Ve(Z)}:void 0,t={version:"1.0.0-podcast",numHosts:p,hostOneImage:a,hostTwoImage:s,podcastTopic:V,pastedScript:k,reporterVoice:Y,intervieweeVoice:O,globalVoiceInstruction:K,videoAspectRatio:v,singleHostSetting:A,environmentImage:o,backgroundPrompt:J,generatedEnvironments:be,selectedBackground:Q,scenes:c,sceneOverrides:C,generationStep:G},i=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),r=(V.trim().replace(/\s+/g,"-").substring(0,20)||"podcast-project").toLowerCase();Aa(i,`${r}.pvdproj`)}catch(a){m(a instanceof Error?a.message:"An unknown error occurred during saving.")}finally{Pe(!1)}},[G,p,b,x,V,k,Y,O,K,v,A,Z,J,be,Q,c,C]),sa=n.useCallback(async a=>{var o,t;const s=(o=a.target.files)==null?void 0:o[0];if(s){Te(!0),m(null);try{const i=await s.text(),r=JSON.parse(i);if(!((t=r.version)!=null&&t.includes("-podcast")))throw new Error("Invalid project file. Please import a .pvdproj file.");N(r.numHosts||1),P(r.hostOneImage?await ke(r.hostOneImage.data,r.hostOneImage.name):null),M(r.hostTwoImage?await ke(r.hostTwoImage.data,r.hostTwoImage.name):null),L(r.podcastTopic||""),T(r.pastedScript||""),Ee(r.reporterVoice||"Puck"),Fe(r.intervieweeVoice||"Kore"),Ue(r.globalVoiceInstruction||""),He(r.videoAspectRatio||"16:9"),Oe(r.singleHostSetting||"studio"),De(r.environmentImage?await ke(r.environmentImage.data,r.environmentImage.name):null),$e(r.backgroundPrompt||"a modern, professional podcast studio interior"),Be(r.generatedEnvironments||[]),xe(r.selectedBackground||void 0),ie(r.sceneOverrides||{});const h=(r.scenes||[]).map(f=>({...We({}),...f,videos:f.videos||[]}));d(h),E(r.generationStep||"input"),alert("Project imported successfully!")}catch(i){m(i instanceof Error?i.message:"An unknown error occurred during import.")}finally{Te(!1),a.target.value=""}}},[]),oa=n.useCallback((a,s,o)=>{ie(t=>{const r={...t[a]||{},[s]:o};if((s==="selectedHost"&&o==="auto"||s==="imageProvider"&&o==="lehuyducanh")&&delete r[s],Object.keys(r).length===0){const{[a]:g,...h}=t;return h}return{...t,[a]:r}})},[]),na=(a,s)=>d(o=>o.map(t=>t.id===a?{...t,imagePrompt:s}:t)),ra=(a,s)=>d(o=>o.map(t=>t.id===a?{...t,videoPrompt:s}:t)),ia=(a,s)=>d(o=>o.map(t=>t.id===a?{...t,voiceoverGuide:s}:t)),la=(a,s,o)=>d(t=>t.map(i=>i.id===a?{...i,[s]:o}:i)),ca=(a,s)=>d(o=>o.map(t=>t.id!==a?t:{...t,images:t.images.filter(i=>i!==s),selectedImageForVideo:t.selectedImageForVideo===s?void 0:t.selectedImageForVideo})),da=(a,s)=>d(o=>o.map(t=>t.id===a?{...t,selectedImageForVideo:s,videos:[],videoGenerationError:null}:t)),ga=a=>d(s=>s.map(o=>o.id===a?{...o,shouldUpscaleVideo:!o.shouldUpscaleVideo}:o)),ma=async(a,s)=>{},ua=n.useCallback(async()=>ge(c.filter(a=>a.images.length===0&&!a.imagePrompt.toLowerCase().includes("studio")).map(a=>()=>ye(a.id)),5).finally(()=>ue(!1)),[c,ye]),pa=n.useCallback(async()=>ge(c.filter(a=>a.selectedImageForVideo&&(!a.videos||a.videos.length===0)).map(a=>()=>we(a.id)),5).finally(()=>_(!1)),[c,we]),ha=n.useCallback(async()=>ge(c.flatMap(a=>(a.videos||[]).map((s,o)=>({scene:a,video:s,index:o})).filter(s=>s.video.url&&s.video.mediaGenerationId&&!s.video.upscaledUrl).map(s=>()=>Se(s.scene.id,s.index))),5).finally(()=>de(!1)),[c,Se]),je=n.useCallback(async a=>{const s=c.find(o=>o.id===a);if(s){d(o=>o.map(t=>t.id===a?{...t,isGeneratingAudio:!0,audioGenerationError:null}:t));try{let o=O,t=s.voiceoverScript;t.toLowerCase().startsWith("host 1:")||t.toLowerCase().startsWith("reporter:")?(o=Y,t=t.replace(/^(host 1:|reporter:)\s*/i,"")):(t.toLowerCase().startsWith("host 2:")||t.toLowerCase().startsWith("interviewee:"))&&(o=O,t=t.replace(/^(host 2:|interviewee:)\s*/i,""));const i=await Da(t,s.voiceoverGuide,o,K),r=Pa(i),g=URL.createObjectURL(r);d(h=>h.map(f=>f.id===a?{...f,audioUrl:g,isGeneratingAudio:!1}:f))}catch(o){const t=o instanceof Error?o.message:"An unknown audio generation error occurred.";d(i=>i.map(r=>r.id===a?{...r,isGeneratingAudio:!1,audioGenerationError:t}:r))}}},[c,Y,O,K]),fa=n.useCallback(async()=>{H(!0);const a=c.filter(s=>!s.audioUrl).map(s=>()=>je(s.id));await ge(a,5),H(!1)},[c,je]),ba=a=>{const s=We({voiceoverScript:"New scene..."});d(o=>{const t=[...o];return t.splice(a,0,s),t})},xa=n.useCallback(()=>{d(a=>a.map(s=>s.imagePrompt.toLowerCase().includes("studio")||s.imagePrompt.toLowerCase().includes("stage")?{...s,selectedImageForVideo:Q}:s.images.length>0?{...s,selectedImageForVideo:s.images[0]}:s)),alert("Set studio scenes to the selected background and picked the first image for all B-roll scenes!")},[Q]),va=n.useCallback(async()=>{const{botToken:a,chatId:s}=Ye.getTelegramConfig();if(!a||!s){alert("Please configure Telegram settings first in the Settings page.");return}const o=c.flatMap((t,i)=>t.images.map((r,g)=>({type:"photo",url:r,caption:`Scene ${i+1}: ${t.voiceoverScript}`,fileName:`${String(i+1).padStart(3,"0")}_image_${String(g+1).padStart(2,"0")}.jpg`})));if(o.length===0){alert("No generated images found to send.");return}Le(!0),m(null);try{await qe.sendMedia(o),alert("All images sent to Telegram successfully!")}catch(t){const i=t instanceof Error?t.message:"Failed to send images to Telegram.";m(i),alert(i)}finally{Le(!1)}},[c]),ya=n.useCallback(async()=>{const{botToken:a,chatId:s}=Ye.getTelegramConfig();if(!a||!s){alert("Please configure Telegram settings first in the Settings page.");return}const o=c.flatMap((t,i)=>(t.videos||[]).map((r,g)=>({type:"video",url:r.upscaledUrl||r.url,caption:`Scene ${i+1}: ${t.voiceoverScript}`,fileName:`${String(i+1).padStart(3,"0")}_video_${String(g+1).padStart(2,"0")}.mp4`}))).filter(t=>t.url);if(o.length===0){alert("No videos found to send.");return}ze(!0),m(null);try{await qe.sendMedia(o),alert("All videos sent to Telegram successfully!")}catch(t){const i=t instanceof Error?t.message:"Failed to send videos to Telegram.";m(i),alert(i)}finally{ze(!1)}},[c]),Sa=n.useCallback(async()=>{q(!0);try{await Ta(c)}catch(a){m(a instanceof Error?a.message:"Failed to download images.")}finally{q(!1)}},[c]),wa=n.useCallback(async()=>{W(!0);try{await Ea(c)}catch(a){m(a instanceof Error?a.message:"Failed to download videos.")}finally{W(!1)}},[c]),ja=(a,s)=>{d(o=>o.map(t=>t.id===a?{...t,includeDialogueInPrompt:s}:t))},Ia=async(a,s)=>{alert("Enhanced prompt generation is not yet implemented for the Podcast module.")},Na=a=>{window.confirm("Are you sure you want to delete this scene?")&&d(s=>s.filter(o=>o.id!==a))},Va=(a,s)=>{d(o=>o.map(t=>t.id===a?{...t,voiceoverScript:s}:t))},ka=n.useCallback(async()=>{Me(!0),m(null);try{const a=await D();if(a.length===0)throw new Error("Please upload at least one host image.");const s=await $a(a,J,ve,A,v);Be(s),s.length>0&&xe(s[0])}catch(a){m(a instanceof Error?a.message:"Failed to generate background scenes.")}finally{Me(!1)}},[D,J,ve,A,v]);return e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"py-4 px-8 bg-gray-800 shadow-lg border-b border-gray-700 shrink-0 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-blue-400",children:[e.jsx("i",{className:"fas fa-podcast mr-3"}),"Podcast Video Designer"]}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Turn your podcast into visually engaging videos."})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("label",{htmlFor:"import-project-podcast",className:`text-center bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-full transition-all duration-300 flex items-center justify-center gap-2 text-sm shadow-sm ${fe?"cursor-not-allowed opacity-50":"cursor-pointer"}`,children:fe?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"}),"Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-folder-open"}),"Import"]})}),e.jsx("input",{id:"import-project-podcast",type:"file",accept:".pvdproj",className:"hidden",onChange:sa,disabled:fe}),e.jsx("button",{onClick:ta,disabled:Ae||G==="input",className:"bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-sm shadow-sm",children:Ae?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-save"}),"Save"]})})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"text-gray-300 font-medium",children:["Welcome, ",e.jsx("span",{className:"font-bold text-blue-400",children:u}),"!"]}),e.jsxs("div",{className:"text-xs text-gray-400 bg-gray-700 px-2 py-1 rounded-md mt-1 flex gap-x-2",children:["Daily Usage:",e.jsxs("span",{className:"font-bold text-blue-400",title:"Storyboard Generations",children:[" ",e.jsx("i",{className:"fas fa-file-alt"})," ",l.storyboard,"/",B.generateStoryboard]})," |",e.jsxs("span",{className:"font-bold text-green-400",title:"Image Generations",children:[" ",e.jsx("i",{className:"fas fa-image"})," ",l.image,"/",B.generateImage]})," |",e.jsxs("span",{className:"font-bold text-red-400",title:"Video Generations",children:[" ",e.jsx("i",{className:"fas fa-video"})," ",l.video,"/",B.generateVideo]})]})]}),e.jsx("button",{onClick:y,className:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-full",children:"Logout"})]})]})]}),e.jsx("main",{className:"flex-1 overflow-x-hidden overflow-y-auto p-4 md:p-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 xl:grid-cols-4 gap-8 items-start",children:[e.jsx("div",{className:"lg:sticky lg:top-8 xl:col-span-1",children:e.jsx(La,{numHosts:p,setNumHosts:N,hostOneImage:b,setHostOneImage:P,hostTwoImage:x,setHostTwoImage:M,podcastTopic:V,setPodcastTopic:L,pastedScript:k,setPastedScript:T,onGenerateScript:ea,isGeneratingScript:se,onAnalyzeScript:Re,isAnalyzingScript:ne,reporterVoice:Y,setReporterVoice:Ee,intervieweeVoice:O,setIntervieweeVoice:Fe,environmentImage:Z,setEnvironmentImage:De,environmentVariationsCount:ve,setEnvironmentVariationsCount:Ze,onGenerateEnvironments:ka,isGeneratingEnvironments:Je,globalVoiceInstruction:K,setGlobalVoiceInstruction:Ue,videoAspectRatio:v,setVideoAspectRatio:He,singleHostSetting:A,setSingleHostSetting:Oe,backgroundPrompt:J,setBackgroundPrompt:$e,onViewImage:R})}),e.jsx("div",{className:"lg:col-span-2 xl:col-span-3",children:e.jsx(Fa,{generationStep:G,scenes:c,isLoading:se||ne,isGeneratingPrompts:!1,error:te,voiceoverScript:k,onVoiceoverScriptChange:T,onGeneratePrompts:Re,sceneOverrides:C,onGenerateImage:ye,onSceneImagePromptChange:na,onSceneVideoPromptChange:ra,onSceneVoiceoverGuideChange:ia,onSceneEnhancementChange:la,onSceneOverrideChange:oa,onDeleteImage:ca,onViewImage:R,onUploadImageForVideo:ma,onGenerateAllImages:ua,isBatchGenerating:ce,onViewStoryboard:()=>F(!0),onDownloadAllImages:Sa,isDownloadingImages:U,onDownloadAllVideos:wa,isDownloadingVideos:he,onSelectImageForVideo:da,onGenerateVideo:we,onToggleVideoUpscale:ga,onUpscaleVideo:Se,onGenerateAllVideos:pa,isBatchGeneratingVideos:pe,onUpscaleAllVideos:ha,isBatchUpscalingVideos:S,generatedEnvironments:be,activeModule:"podcast",numHosts:p,onGenerateAudio:je,onGenerateAllAudio:fa,isBatchGeneratingAudio:Ge,onAddScene:ba,onPickAllImages:xa,onSelectEnvironment:xe,selectedEnvironment:Q,onSendAllImagesToTelegram:va,isSendingImagesToTelegram:Qe,onSendAllVideosToTelegram:ya,isSendingVideosToTelegram:Xe,videoAspectRatio:v,onToggleDialogueInPrompt:ja,onGenerateEnhancedPrompt:Ia,onSceneVoiceoverScriptChange:Va,onDeleteScene:Na,onDeleteVideo:aa})})]})}),le&&e.jsx(Ba,{imageUrl:le,onClose:()=>R(null)}),me&&e.jsx(Ua,{scenes:c,onClose:()=>F(!1),videoAspectRatio:v})]})};export{Za as default};

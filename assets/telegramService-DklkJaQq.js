import{c as ge,g as Re,r as Se,j as i,R as Ze}from"./index-DX2mtma_.js";import{s as Me}from"./settingsService-Tte2DU1T.js";var je={exports:{}},$e=je.exports,ze;function He(){return ze||(ze=1,(function(N,H){(function(f,j){j()})($e,function(){function f(p,b){return typeof b>"u"?b={autoBom:!1}:typeof b!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),b={autoBom:!b}),b.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(p.type)?new Blob(["\uFEFF",p],{type:p.type}):p}function j(p,b,v){var u=new XMLHttpRequest;u.open("GET",p),u.responseType="blob",u.onload=function(){l(u.response,b,v)},u.onerror=function(){console.error("could not download file")},u.send()}function y(p){var b=new XMLHttpRequest;b.open("HEAD",p,!1);try{b.send()}catch{}return 200<=b.status&&299>=b.status}function o(p){try{p.dispatchEvent(new MouseEvent("click"))}catch{var b=document.createEvent("MouseEvents");b.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),p.dispatchEvent(b)}}var n=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof ge=="object"&&ge.global===ge?ge:void 0,r=n.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),l=n.saveAs||(typeof window!="object"||window!==n?function(){}:"download"in HTMLAnchorElement.prototype&&!r?function(p,b,v){var u=n.URL||n.webkitURL,s=document.createElement("a");b=b||p.name||"download",s.download=b,s.rel="noopener",typeof p=="string"?(s.href=p,s.origin===location.origin?o(s):y(s.href)?j(p,b,v):o(s,s.target="_blank")):(s.href=u.createObjectURL(p),setTimeout(function(){u.revokeObjectURL(s.href)},4e4),setTimeout(function(){o(s)},0))}:"msSaveOrOpenBlob"in navigator?function(p,b,v){if(b=b||p.name||"download",typeof p!="string")navigator.msSaveOrOpenBlob(f(p,v),b);else if(y(p))j(p,b,v);else{var u=document.createElement("a");u.href=p,u.target="_blank",setTimeout(function(){o(u)})}}:function(p,b,v,u){if(u=u||open("","_blank"),u&&(u.document.title=u.document.body.innerText="downloading..."),typeof p=="string")return j(p,b,v);var s=p.type==="application/octet-stream",g=/constructor/i.test(n.HTMLElement)||n.safari,a=/CriOS\/[\d]+/.test(navigator.userAgent);if((a||s&&g||r)&&typeof FileReader<"u"){var h=new FileReader;h.onloadend=function(){var w=h.result;w=a?w:w.replace(/^data:[^;]*;/,"data:attachment/file;"),u?u.location.href=w:location=w,u=null},h.readAsDataURL(p)}else{var d=n.URL||n.webkitURL,x=d.createObjectURL(p);u?u.location=x:location.href=x,u=null,setTimeout(function(){d.revokeObjectURL(x)},4e4)}});n.saveAs=l.saveAs=l,N.exports=l})})(je)),je.exports}var Ke=He();const De=Re(Ke),Ye=["Eye Level","High Angle","Low Angle","Dutch Angle","Bird's-Eye View","Worm's-Eye View","Over-the-Shoulder"],qe=["Static","Pan Left","Pan Right","Tilt Up","Tilt Down","Zoom In","Zoom Out","Dolly In","Dolly Out","Crane Up","Crane Down","Tracking Shot"],Xe=["Normal Speed","Slow Motion","Fast Motion (Timelapse)","Bullet Time","Split Screen","Rack Focus"],Je=({scene:N,onImagePromptChange:H,onVideoPromptChange:f,onSceneVoiceoverGuideChange:j,onSceneEnhancementChange:y,onGenerateAudio:o,onToggleDialogueInPrompt:n,onGenerateEnhancedPrompt:r,onSceneVoiceoverScriptChange:l})=>{const[p,b]=Se.useState({image:!1,video:!1}),v=(u,s)=>{navigator.clipboard.writeText(u),b({image:s==="image",video:s==="video"}),setTimeout(()=>b({image:!1,video:!1}),2e3)};return i.jsxs("div",{className:"bg-slate-800 p-4 rounded-lg border border-slate-700 flex flex-col gap-4 h-full",children:[i.jsxs("div",{className:"bg-gray-800 p-3 rounded-md border border-gray-700",children:[i.jsxs("h4",{className:"font-bold text-sm text-blue-400 mb-2",children:[i.jsx("i",{className:"fas fa-microphone-alt mr-2"}),"Voiceover"]}),l?i.jsx("textarea",{value:N.voiceoverScript,onChange:u=>l(N.id,u.target.value),placeholder:"Edit voiceover script...",className:"w-full bg-gray-700 border border-gray-600 rounded-md p-2 text-gray-300 italic mb-2 focus:ring-2 focus:ring-blue-500",rows:3}):i.jsxs("blockquote",{className:"border-l-4 border-blue-500 pl-3 text-gray-300 italic mb-2",children:['"',N.voiceoverScript,'"']}),i.jsx("textarea",{value:N.voiceoverGuide,onChange:u=>j(N.id,u.target.value),placeholder:"Edit voiceover delivery guide...",className:"w-full bg-gray-700 border border-gray-600 rounded-md p-2 text-gray-300 text-xs focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 resize-y",rows:2}),i.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-700/50",children:[N.isGeneratingAudio?i.jsxs("div",{className:"flex items-center justify-center text-sm text-gray-400",children:[i.jsx("i",{className:"fas fa-spinner fa-spin mr-2"})," Generating audio..."]}):N.audioUrl?i.jsx("audio",{controls:!0,src:N.audioUrl,className:"w-full h-8"}):i.jsxs("button",{onClick:()=>o(N.id),className:"w-full bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-1 px-2 rounded-md text-xs flex items-center justify-center gap-1 transition-colors",children:[i.jsx("i",{className:"fas fa-volume-up"})," Generate Audio"]}),N.audioGenerationError&&i.jsx("p",{className:"text-red-400 text-xs mt-1 text-center",children:N.audioGenerationError})]})]}),i.jsxs("div",{className:"space-y-4 flex-grow flex flex-col",children:[i.jsxs("div",{className:"bg-gray-800 p-3 rounded-md border border-gray-700 flex-grow flex flex-col gap-2",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsxs("h4",{className:"font-bold text-sm text-blue-400",children:[i.jsx("i",{className:"fas fa-image mr-2"}),"Image Prompt (Start Frame)"]}),i.jsx("button",{onClick:()=>r(N.id,"image"),disabled:N.isGeneratingImagePrompt,className:"text-xs font-semibold text-purple-400 hover:text-purple-300 disabled:text-gray-500 disabled:cursor-not-allowed transition-colors flex items-center gap-1",title:"Use AI to suggest a better prompt",children:N.isGeneratingImagePrompt?i.jsxs(i.Fragment,{children:[i.jsx("i",{className:"fas fa-spinner fa-spin"}),"Suggesting..."]}):i.jsxs(i.Fragment,{children:[i.jsx("i",{className:"fas fa-wand-magic-sparkles"}),"AI Prompt"]})})]}),i.jsxs("div",{className:"relative group flex-grow",children:[i.jsx("textarea",{value:N.imagePrompt,onChange:u=>H(N.id,u.target.value),placeholder:"Edit image prompt...",className:"w-full h-full bg-gray-700 border border-gray-600 rounded-md p-2 text-gray-200 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 resize-none"}),i.jsx("button",{onClick:()=>v(N.imagePrompt,"image"),className:"absolute top-2 right-2 bg-blue-600 hover:bg-blue-700 text-white rounded-full px-3 py-1 text-xs font-semibold opacity-0 group-hover:opacity-100 transition-all duration-300",children:p.image?i.jsxs(i.Fragment,{children:[i.jsx("i",{className:"fas fa-check mr-1"}),"Copied!"]}):i.jsxs(i.Fragment,{children:[i.jsx("i",{className:"fas fa-copy mr-1"}),"Copy"]})})]}),i.jsxs("div",{className:"border-t border-gray-700 pt-2",children:[i.jsx("h5",{className:"text-xs font-bold text-gray-300 mb-2",children:"Enhancements"}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex-grow",children:[i.jsx("label",{htmlFor:`focus-${N.id}`,className:"text-xs text-gray-400 font-semibold mb-1 block",children:"Focus Object"}),i.jsx("input",{id:`focus-${N.id}`,type:"text",value:N.imageFocusObject||"",onChange:u=>y(N.id,"imageFocusObject",u.target.value),placeholder:"e.g., a red apple",className:"w-full bg-gray-600 border border-gray-500 rounded-md p-1.5 text-gray-200 text-xs focus:ring-1 focus:ring-blue-500 focus:border-blue-500 transition"})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:`angle-${N.id}`,className:"text-xs text-gray-400 font-semibold mb-1 block",children:"Camera Angle"}),i.jsxs("select",{id:`angle-${N.id}`,value:N.imageCameraAngle||"",onChange:u=>y(N.id,"imageCameraAngle",u.target.value),className:"w-full bg-gray-600 border border-gray-500 rounded-md p-1.5 text-gray-200 text-xs focus:ring-1 focus:ring-blue-500 focus:border-blue-500 transition duration-200",children:[i.jsx("option",{value:"",children:"-- Select Angle --"}),Ye.map(u=>i.jsx("option",{value:u,children:u},u))]})]})]})]})]}),i.jsxs("div",{className:"bg-gray-800 p-3 rounded-md border border-gray-700 flex-grow flex flex-col gap-2",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsxs("h4",{className:"font-bold text-sm text-green-400",children:[i.jsx("i",{className:"fas fa-video mr-2"}),"Video Motion Prompt"]}),i.jsx("button",{onClick:()=>r(N.id,"video"),disabled:N.isGeneratingVideoPrompt,className:"text-xs font-semibold text-purple-400 hover:text-purple-300 disabled:text-gray-500 disabled:cursor-not-allowed transition-colors flex items-center gap-1",title:"Use AI to suggest a better prompt",children:N.isGeneratingVideoPrompt?i.jsxs(i.Fragment,{children:[i.jsx("i",{className:"fas fa-spinner fa-spin"}),"Suggesting..."]}):i.jsxs(i.Fragment,{children:[i.jsx("i",{className:"fas fa-wand-magic-sparkles"}),"AI Prompt"]})})]}),i.jsxs("div",{className:"relative group flex-grow",children:[i.jsx("textarea",{value:N.videoPrompt,onChange:u=>f(N.id,u.target.value),placeholder:"Edit video motion prompt...",className:"w-full h-full bg-gray-700 border border-gray-600 rounded-md p-2 text-gray-200 text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500 transition duration-200 resize-none"}),i.jsx("button",{onClick:()=>v(N.videoPrompt,"video"),className:"absolute top-2 right-2 bg-blue-600 hover:bg-blue-700 text-white rounded-full px-3 py-1 text-xs font-semibold opacity-0 group-hover:opacity-100 transition-all duration-300",children:p.video?i.jsxs(i.Fragment,{children:[i.jsx("i",{className:"fas fa-check mr-1"}),"Copied!"]}):i.jsxs(i.Fragment,{children:[i.jsx("i",{className:"fas fa-copy mr-1"}),"Copy"]})})]}),i.jsxs("div",{className:"border-t border-gray-700 pt-2 space-y-2",children:[i.jsx("h5",{className:"text-xs font-bold text-gray-300",children:"Enhancements"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("label",{htmlFor:`movement-${N.id}`,className:"text-xs text-gray-400 font-semibold mb-1 block",children:"Camera Movement"}),i.jsxs("select",{id:`movement-${N.id}`,value:N.videoCameraMovement||"",onChange:u=>y(N.id,"videoCameraMovement",u.target.value),className:"w-full bg-gray-600 border border-gray-500 rounded-md p-1.5 text-gray-200 text-xs focus:ring-1 focus:ring-blue-500 focus:border-blue-500 transition duration-200",children:[i.jsx("option",{value:"",children:"-- Select Movement --"}),qe.map(u=>i.jsx("option",{value:u,children:u},u))]})]}),i.jsxs("div",{className:"flex-1",children:[i.jsx("label",{htmlFor:`effect-${N.id}`,className:"text-xs text-gray-400 font-semibold mb-1 block",children:"Shooting Effect"}),i.jsxs("select",{id:`effect-${N.id}`,value:N.videoShootingEffect||"",onChange:u=>y(N.id,"videoShootingEffect",u.target.value),className:"w-full bg-gray-600 border border-gray-500 rounded-md p-1.5 text-gray-200 text-xs focus:ring-1 focus:ring-blue-500 focus:border-blue-500 transition duration-200",children:[i.jsx("option",{value:"",children:"-- Select Effect --"}),Xe.map(u=>i.jsx("option",{value:u,children:u},u))]})]})]}),i.jsxs("div",{className:"flex items-start pt-1",children:[i.jsx("div",{className:"flex items-center h-5",children:i.jsx("input",{id:`include-dialogue-${N.id}`,type:"checkbox",checked:N.includeDialogueInPrompt,onChange:u=>n(N.id,u.target.checked),className:"focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-500 rounded bg-gray-700"})}),i.jsx("div",{className:"ml-2 text-xs",children:i.jsx("label",{htmlFor:`include-dialogue-${N.id}`,className:"font-medium text-gray-300 cursor-pointer",children:"Include dialogue in prompt"})})]})]})]})]})]})},Qe=({scene:N,overrides:H,onGenerateImage:f,onOverrideChange:j,onDeleteImage:y,onViewImage:o,onSelectImageForVideo:n,onUploadImageForVideo:r,activeModule:l,numHosts:p,generatedEnvironments:b=[],videoAspectRatio:v})=>{const u=(B,z)=>{if(B.target.files){const G=Array.from(B.target.files),q=H[z]||[];j(N.id,z,[...q,...G])}B.target.value=""},s=(B,z)=>{const G=H[z]||[];j(N.id,z,G.filter((q,_)=>_!==B))},g=(B,z)=>i.jsx("div",{className:"grid grid-cols-4 gap-1.5 mt-2",children:B.map((G,q)=>{const _=URL.createObjectURL(G);return i.jsxs("div",{className:"relative aspect-square",children:[i.jsx("img",{src:_,alt:"Preview",className:"w-full h-full object-cover rounded"}),i.jsx("button",{onClick:()=>s(q,z),className:"absolute -top-1 -right-1 bg-red-500 text-white rounded-full h-4 w-4 flex items-center justify-center text-xs font-bold leading-none hover:bg-red-600 transition-transform transform hover:scale-110",children:"×"})]},`${G.name}-${q}`)})}),a=H.subjects||[],h=H.referenceImages||[],d=H.useProjectCharacter!==!1,x=l==="podcast"&&N.imagePrompt.toLowerCase().includes("studio"),w=l==="street-interview",[C,S]=Se.useState(!N.selectedImageForVideo);Se.useEffect(()=>{N.selectedImageForVideo&&S(!1)},[N.selectedImageForVideo]);const U=H.imageProvider||"lehuyducanh",T=v==="9:16"?"aspect-[9/16]":"aspect-video";return i.jsx("div",{className:"bg-slate-800 p-4 rounded-lg border border-slate-700 space-y-3 h-full flex flex-col",children:x||w?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"flex-shrink-0",children:i.jsx("h5",{className:"font-bold text-sm text-blue-400",children:w?"Interview Background":"Studio Scene Selection"})}),w?N.selectedImageForVideo?i.jsxs("div",{className:`relative group ${T} flex-grow`,children:[i.jsx("img",{src:N.selectedImageForVideo,alt:"Selected background scene",className:"w-full h-full object-cover rounded-md border-2 border-blue-500",onClick:()=>o(N.selectedImageForVideo)}),i.jsxs("div",{className:"absolute bottom-1 left-1 bg-green-600 text-white rounded-full px-2 py-1 text-xs font-bold flex items-center gap-1 cursor-default",children:[i.jsx("i",{className:"fas fa-check"})," Video Base"]})]}):i.jsx("div",{className:"text-center text-xs text-yellow-300 flex-grow flex items-center justify-center h-full p-4 bg-gray-900/50 rounded-lg",children:i.jsxs("p",{children:[i.jsx("i",{className:"fas fa-info-circle mr-1"}),"Background not set. Please generate and select a background in the input panel."]})}):i.jsx(i.Fragment,{children:N.selectedImageForVideo&&!C?i.jsxs("div",{className:`relative group ${T}`,children:[i.jsx("img",{src:N.selectedImageForVideo,alt:"Selected studio scene",className:"w-full h-full object-cover rounded-md border-2 border-blue-500",onClick:()=>o(N.selectedImageForVideo)}),i.jsx("button",{onClick:()=>S(!0),className:"absolute top-2 right-2 bg-gray-900/80 hover:bg-black/80 text-white font-bold py-1 px-3 rounded-full text-xs",children:"Change"})]}):i.jsx("div",{className:"flex-grow min-h-[150px] bg-gray-900/50 rounded-lg p-2 overflow-y-auto",children:b&&b.length>0?i.jsx("div",{className:"grid grid-cols-2 gap-2",children:b.map((B,z)=>{const G=N.selectedImageForVideo===B;return i.jsxs("div",{className:`relative group ${T}`,onClick:()=>n(N.id,B),children:[i.jsx("img",{src:B,alt:`Studio Shot ${z+1}`,className:`w-full h-full object-cover rounded-md cursor-pointer transition-all ${G?"ring-4 ring-blue-500":"hover:ring-2 hover:ring-blue-400"}`}),G&&i.jsx("div",{className:"absolute inset-0 bg-blue-500/60 flex items-center justify-center rounded-md",children:i.jsx("i",{className:"fas fa-check-circle text-white text-3xl"})})]},z)})}):i.jsx("div",{className:"text-center text-xs text-yellow-300 flex-grow flex items-center justify-center h-full p-4",children:i.jsxs("p",{children:[i.jsx("i",{className:"fas fa-info-circle mr-1"}),"Generate studio scenes in the main input panel to select one here."]})})})})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex-shrink-0 space-y-3",children:[i.jsx("h5",{className:"font-bold text-sm text-blue-400",children:"Scene-Specific Visuals"}),["ugc","supplements","video-cloner"].includes(l||"")&&i.jsxs("div",{className:"bg-gray-800/60 p-2 rounded-md border border-gray-700",children:[i.jsx("div",{className:"flex items-center justify-between mb-2",children:i.jsxs("label",{htmlFor:`use-proj-char-${N.id}`,className:"flex items-center gap-2 text-sm font-semibold text-gray-300 cursor-pointer",children:[i.jsx("input",{type:"checkbox",id:`use-proj-char-${N.id}`,checked:d,onChange:B=>j(N.id,"useProjectCharacter",B.target.checked),className:"h-4 w-4 rounded border-gray-500 bg-gray-700 text-blue-600 focus:ring-blue-500"}),"Use Project Creator/Character"]})}),i.jsxs("div",{children:[i.jsxs("label",{htmlFor:`subjects-upload-${N.id}`,className:"cursor-pointer text-xs font-semibold text-gray-200 bg-gray-600 hover:bg-gray-500 px-2 py-1 rounded-md border border-gray-500 inline-flex items-center gap-1.5 transition-colors",children:[i.jsx("i",{className:"fas fa-puzzle-piece"})," Add Accessories/Subjects"]}),i.jsx("input",{id:`subjects-upload-${N.id}`,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:B=>u(B,"subjects")}),a.length>0&&g(a,"subjects")]})]}),i.jsx("div",{className:"bg-gray-800/60 p-2 rounded-md border border-gray-700",children:i.jsxs("div",{children:[i.jsxs("label",{htmlFor:`ref-images-upload-${N.id}`,className:"cursor-pointer text-xs font-semibold text-gray-200 bg-teal-600 hover:bg-teal-500 px-2 py-1 rounded-md border border-teal-500 inline-flex items-center gap-1.5 transition-colors",children:[i.jsx("i",{className:"fas fa-camera"})," Add Scene Reference Image"]}),i.jsx("input",{id:`ref-images-upload-${N.id}`,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:B=>u(B,"referenceImages")}),h.length>0&&g(h,"referenceImages")]})}),i.jsxs("div",{className:"text-center",children:[i.jsxs("label",{htmlFor:`upload-base-${N.id}`,className:"cursor-pointer w-full text-center block px-3 py-1.5 rounded-md text-xs font-semibold border-2 transition-colors bg-blue-600 border-blue-500 text-white hover:bg-blue-500",children:[i.jsx("i",{className:"fas fa-upload mr-1.5"}),"Upload Base Image for Video"]}),i.jsx("input",{id:`upload-base-${N.id}`,type:"file",accept:"image/*",className:"hidden",onChange:B=>{var z;(z=B.target.files)!=null&&z[0]&&r(N.id,B.target.files[0])}})]})]}),i.jsxs("div",{className:"mt-auto pt-3 border-t border-slate-700 space-y-2",children:[i.jsxs("div",{className:"bg-gray-800/60 p-2 rounded-md border border-gray-700",children:[i.jsx("label",{htmlFor:`provider-select-${N.id}`,className:"block text-xs font-bold text-gray-400 mb-1",children:"Image Provider"}),i.jsxs("select",{id:`provider-select-${N.id}`,value:U,onChange:B=>j(N.id,"imageProvider",B.target.value),className:"w-full bg-gray-700 border border-gray-600 rounded-md p-1.5 text-gray-200 text-xs focus:ring-1 focus:ring-blue-500",children:[i.jsx("option",{value:"lehuyducanh",children:"LeHuyDucAnh API"}),i.jsx("option",{value:"gemini",children:"Gemini API"})]})]}),i.jsx("button",{onClick:()=>f(N.id),disabled:N.isGeneratingImage,className:"w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-3 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-sm",children:N.isGeneratingImage?i.jsxs(i.Fragment,{children:[i.jsx("i",{className:"fas fa-spinner fa-spin"}),"Generating..."]}):i.jsxs(i.Fragment,{children:[i.jsx("i",{className:"fas fa-camera-retro"}),N.images.length>0?"Generate More":"Generate B-Roll"]})}),N.imageGenerationError&&i.jsxs("p",{className:"text-red-300 text-xs text-center bg-red-900/50 p-2 rounded-md",children:["Error: ",N.imageGenerationError]})]}),i.jsxs("div",{className:"flex-grow min-h-[90px]",children:[N.isGeneratingImage&&N.images.length===0&&i.jsx("div",{className:`w-full bg-gray-700 rounded-md flex items-center justify-center animate-pulse ${T}`,children:i.jsx("i",{className:"fas fa-image text-gray-500 text-3xl"})}),N.images.length>0&&i.jsx("div",{className:"grid grid-cols-2 gap-2",children:N.images.map((B,z)=>{const G=N.selectedImageForVideo===B;return i.jsxs("div",{className:`relative group ${T}`,children:[i.jsx("img",{src:B,alt:`Generated scene ${z+1}`,className:`w-full h-full object-cover rounded-md cursor-pointer transition-all duration-200 ${G?"border-4 border-blue-500 ring-2 ring-blue-500 p-0.5":"border-2 border-gray-600 hover:border-blue-500"}`,onClick:()=>o(B),onError:q=>{q.target.src="https://via.placeholder.com/160x90.png?text=Error"}}),i.jsx("button",{onClick:()=>y(N.id,B),className:"absolute -top-2 -right-2 bg-red-600 text-white rounded-full h-6 w-6 flex items-center justify-center text-xs font-bold hover:bg-red-700 transition-transform transform hover:scale-110 opacity-0 group-hover:opacity-100 focus:opacity-100","aria-label":"Delete image",children:"×"}),!G&&i.jsx("button",{onClick:()=>n(N.id,B),className:"absolute bottom-1 left-1 bg-blue-600 text-white rounded-full h-6 w-6 flex items-center justify-center text-xs font-bold hover:bg-blue-700 transition-transform transform hover:scale-110 opacity-0 group-hover:opacity-100 focus:opacity-100",title:"Use as video base","aria-label":"Use for video",children:i.jsx("i",{className:"fas fa-film"})}),G&&i.jsxs("div",{className:"absolute bottom-1 left-1 bg-green-600 text-white rounded-full px-2 py-1 text-xs font-bold flex items-center gap-1 cursor-default",children:[i.jsx("i",{className:"fas fa-check"})," Video Base"]})]},z)})})]})]})})},et=({scene:N,onGenerateVideo:H,videoAspectRatio:f,onDeleteVideo:j})=>{const y=!!N.selectedImageForVideo,o=y&&!N.isGeneratingVideo,n=f==="9:16"?"aspect-[9/16]":"aspect-video";return i.jsxs("div",{className:"bg-slate-800 p-4 rounded-lg border border-slate-700 space-y-3 h-full flex flex-col",children:[i.jsxs("div",{className:"flex-shrink-0",children:[i.jsx("h5",{className:"font-bold text-sm text-blue-400",children:"Video Generation"}),!y&&i.jsxs("div",{className:"text-center text-xs text-yellow-300 bg-yellow-900/50 p-3 rounded-md mt-2",children:[i.jsx("i",{className:"fas fa-info-circle mr-1"}),'Select an image from the "Image Generation" panel to use as the base for your video.']})]}),i.jsxs("div",{className:"mt-auto pt-3 border-t border-slate-700 space-y-2",children:[i.jsx("button",{onClick:()=>H(N.id),disabled:!o,className:"w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-3 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-sm",children:N.isGeneratingVideo?i.jsxs(i.Fragment,{children:[i.jsx("i",{className:"fas fa-spinner fa-spin"}),"Generating..."]}):i.jsxs(i.Fragment,{children:[i.jsx("i",{className:"fas fa-film"}),(N.videos||[]).length>0?"Generate More":"Generate Video"]})}),N.videoGenerationError&&i.jsxs("p",{className:"text-red-300 text-xs text-center bg-red-900/50 p-2 rounded-md",children:["Error: ",N.videoGenerationError]})]}),i.jsxs("div",{className:"flex-grow min-h-[90px] overflow-y-auto space-y-4 pr-2 -mr-2",children:[N.isGeneratingVideo&&(N.videos||[]).length===0&&i.jsx("div",{className:`w-full bg-gray-700 rounded-md flex items-center justify-center animate-pulse ${n}`,children:i.jsx("i",{className:"fas fa-video text-gray-500 text-3xl"})}),(N.videos||[]).map((r,l)=>i.jsx("div",{className:"space-y-2",children:i.jsxs("div",{className:`relative group ${n}`,children:[i.jsx("video",{src:r.url,controls:!0,loop:!0,className:"w-full h-full object-cover rounded-md bg-black"},r.url),i.jsx("button",{onClick:p=>{p.stopPropagation(),j(N.id,l)},className:"absolute -top-2 -right-2 bg-red-600 text-white rounded-full h-6 w-6 flex items-center justify-center text-xs font-bold hover:bg-red-700 transition-transform transform hover:scale-110 opacity-0 group-hover:opacity-100 focus:opacity-100","aria-label":"Delete video",children:"×"})]})},`${r.mediaGenerationId}-${l}`))]})]})},tt=N=>{const{scene:H,sceneOverrides:f,onGenerateImage:j,onSceneImagePromptChange:y,onSceneVideoPromptChange:o,onSceneVoiceoverGuideChange:n,onSceneEnhancementChange:r,onSceneOverrideChange:l,onDeleteImage:p,onViewImage:b,onUploadImageForVideo:v,onSelectImageForVideo:u,onGenerateVideo:s,activeModule:g,numHosts:a,onGenerateAudio:h,generatedEnvironments:d,videoAspectRatio:x,onToggleDialogueInPrompt:w,onGenerateEnhancedPrompt:C,onSceneVoiceoverScriptChange:S,onDeleteVideo:U}=N;return i.jsxs("div",{className:"bg-gray-800 p-4 rounded-xl border border-gray-700 shadow-lg grid grid-cols-1 md:grid-cols-3 gap-4 items-start",children:[i.jsx("div",{className:"md:col-span-1 h-full",children:i.jsx(Je,{scene:H,onImagePromptChange:y,onVideoPromptChange:o,onSceneVoiceoverGuideChange:n,onSceneEnhancementChange:r,onGenerateAudio:h,onToggleDialogueInPrompt:w,onGenerateEnhancedPrompt:C,onSceneVoiceoverScriptChange:S})}),i.jsx("div",{className:"md:col-span-1 h-full",children:i.jsx(Qe,{scene:H,overrides:f[H.id]||{},onGenerateImage:j,onOverrideChange:l,onDeleteImage:p,onViewImage:b,onSelectImageForVideo:u,onUploadImageForVideo:v,activeModule:g,numHosts:a,generatedEnvironments:d,videoAspectRatio:x})}),i.jsx("div",{className:"md:col-span-1 h-full",children:i.jsx(et,{scene:H,onGenerateVideo:s,videoAspectRatio:x,onDeleteVideo:U})})]})},rt=({script:N,onScriptChange:H,onGenerate:f,isGenerating:j})=>{const y=N.split(`
`).filter(o=>o.trim()!=="").length;return i.jsxs("div",{className:"bg-gray-800 p-6 rounded-2xl border border-blue-600 shadow-lg flex flex-col gap-4",children:[i.jsxs("div",{children:[i.jsxs("h2",{className:"text-xl font-bold text-blue-300",children:[i.jsx("i",{className:"fas fa-microphone-alt mr-2"}),"Review Your Voiceover Script"]}),i.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Edit the script below as needed. Each line will become a new scene in your video."})]}),i.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-lg border border-gray-700",children:[i.jsx("textarea",{value:N,onChange:o=>H(o.target.value),placeholder:"Your generated script will appear here...",className:"w-full bg-gray-700 border border-gray-600 rounded-md p-3 text-gray-200 text-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 resize-y",rows:10}),i.jsxs("p",{className:"text-right text-xs text-gray-500 mt-1 font-mono",children:[y," scenes"]})]}),i.jsx("button",{onClick:f,disabled:j||N.trim()==="",className:"w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-lg shadow-md hover:shadow-lg transform hover:-translate-y-0.5",title:N.trim()===""?"Script cannot be empty":"Generate visual prompts for each line",children:j?i.jsxs(i.Fragment,{children:[i.jsx("i",{className:"fas fa-spinner fa-spin"}),"Generating Prompts..."]}):i.jsxs(i.Fragment,{children:[i.jsx("i",{className:"fas fa-magic"}),"Generate Scene Prompts"]})})]})},ut=N=>{const{generationStep:H,scenes:f,isLoading:j,isGeneratingPrompts:y,error:o,voiceoverScript:n,onVoiceoverScriptChange:r,onGeneratePrompts:l,sceneOverrides:p,onGenerateImage:b,onSceneImagePromptChange:v,onSceneVideoPromptChange:u,onSceneVoiceoverGuideChange:s,onSceneEnhancementChange:g,onSceneOverrideChange:a,onDeleteImage:h,onViewImage:d,onUploadImageForVideo:x,onGenerateAllImages:w,isBatchGenerating:C,onViewStoryboard:S,onDownloadAllImages:U,isDownloadingImages:T,onDownloadAllVideos:B,isDownloadingVideos:z,onSelectImageForVideo:G,onGenerateVideo:q,onGenerateAllVideos:_,isBatchGeneratingVideos:R,generatedEnvironments:t,activeModule:P,numHosts:ee,onGenerateAudio:V,onGenerateAllAudio:te,isBatchGeneratingAudio:W,onAddScene:Q,onPickAllImages:I,onSelectEnvironment:E,selectedEnvironment:X,onSendAllImagesToTelegram:K,isSendingImagesToTelegram:$,onSendAllVideosToTelegram:se,isSendingVideosToTelegram:ce,videoAspectRatio:re,onToggleDialogueInPrompt:ie,onGenerateEnhancedPrompt:de,onSceneVoiceoverScriptChange:oe,onDeleteScene:he,onDeleteVideo:ue}=N;if(j)return i.jsxs("div",{className:"bg-gray-800 p-6 rounded-2xl border border-blue-600 shadow-lg flex flex-col items-center justify-center min-h-[300px]",children:[i.jsx("i",{className:"fas fa-spinner fa-spin text-blue-500 text-5xl mb-4"}),i.jsx("h2",{className:"text-xl font-bold text-blue-300",children:"Generating..."}),i.jsx("p",{className:"text-gray-400 mt-2",children:"Director AI is working its magic!"})]});if(o)return i.jsxs("div",{className:"bg-red-900/50 p-6 rounded-2xl border border-red-600 shadow-lg",children:[i.jsxs("h2",{className:"text-xl font-bold text-red-300 mb-2",children:[i.jsx("i",{className:"fas fa-exclamation-triangle mr-2"}),"An Error Occurred"]}),i.jsx("p",{className:"text-red-200 bg-red-900/70 p-3 rounded-md font-mono text-sm break-words",children:o})]});if(H==="script_generated")return i.jsx(rt,{script:n,onScriptChange:r,onGenerate:l,isGenerating:y});if(H==="input"&&f.length===0&&t.length===0)return i.jsxs("div",{className:"bg-gray-800 p-6 rounded-2xl border-2 border-dashed border-gray-700 shadow-lg text-center min-h-[300px] flex flex-col justify-center items-center",children:[i.jsx("i",{className:"fas fa-pencil-ruler text-6xl text-blue-500 mb-4"}),i.jsx("h2",{className:"text-2xl font-bold text-blue-300",children:"Your Storyboard Awaits"}),i.jsx("p",{className:"text-gray-400 mt-2",children:'Provide your inputs and click a "Generate" button to begin.'})]});const e=f.some(O=>O.images.length>0||!!O.selectedImageForVideo),D=f.some(O=>O.videos&&O.videos.length>0),F=f.some(O=>O.images.length===0&&!(P==="podcast"&&O.imagePrompt.toLowerCase().includes("studio"))),m=f.some(O=>O.selectedImageForVideo),c=f.some(O=>O.selectedImageForVideo&&(!O.videos||O.videos.length===0)),k=f.some(O=>!O.audioUrl),L=({onClick:O})=>i.jsx("div",{className:"flex justify-center my-4",children:i.jsxs("button",{onClick:O,className:"w-full text-gray-500 hover:text-blue-400 hover:border-blue-500 border-2 border-dashed border-gray-700 rounded-lg py-2 transition-all flex items-center justify-center gap-2 font-semibold text-sm",children:[i.jsx("i",{className:"fas fa-plus"})," Add Scene"]})});return i.jsxs("div",{className:"space-y-6",children:[t.length>0&&i.jsxs("details",{open:!0,className:"bg-gray-800 p-4 rounded-xl border border-gray-700 shadow-md",children:[i.jsxs("summary",{className:"cursor-pointer font-bold text-lg text-blue-300 hover:text-white transition-colors",children:[i.jsx("i",{className:"fas fa-images mr-2"}),"Generated Backgrounds (",t.length,")"]}),i.jsx("div",{className:"mt-4 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-2",children:t.map((O,A)=>{const Z=X===O;return i.jsxs("div",{className:`relative group ${re==="9:16"?"aspect-[9/16]":"aspect-video"}`,onClick:()=>d(O),children:[i.jsx("img",{src:O,alt:`Environment ${A+1}`,className:`w-full h-full object-cover rounded-md cursor-pointer transition-all duration-200 ${Z?"ring-4 ring-blue-500":""}`}),Z&&i.jsx("div",{className:"absolute inset-0 bg-blue-500/60 flex items-center justify-center rounded-md pointer-events-none",children:i.jsx("i",{className:"fas fa-check-circle text-white text-4xl"})}),i.jsx("div",{className:"absolute top-1 left-1 bg-black bg-opacity-60 text-white text-xs font-bold px-1.5 py-0.5 rounded",children:P==="podcast"?`Scene ${A+1}`:A===0?"Original":`Var ${A}`}),E&&i.jsx("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:i.jsx("button",{onClick:Y=>{Y.stopPropagation(),E(O)},className:"text-white bg-blue-600 hover:bg-blue-700 font-bold py-1 px-3 rounded-full text-xs",children:Z?"Selected":"Select"})})]},O)})})]}),f.length>0&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"bg-gray-800 p-4 rounded-xl border border-gray-700 shadow-md sticky top-4 z-[5] space-y-3",children:[i.jsxs("div",{className:"flex flex-wrap gap-2 items-center justify-between",children:[i.jsxs("h2",{className:"text-xl font-bold text-blue-300 shrink-0",children:[i.jsx("i",{className:"fas fa-stream mr-2"}),"Storyboard Scenes (",f.length,")"]}),i.jsxs("div",{className:"flex gap-2 flex-wrap justify-end flex-grow",children:[i.jsxs("button",{onClick:S,disabled:!e,className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-3 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-xs shadow-sm",title:e?"View Full Storyboard":"Generate at least one image to view the storyboard",children:[i.jsx("i",{className:"fas fa-grip-horizontal"}),"View"]}),i.jsx("button",{onClick:U,disabled:!e||T,className:"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-3 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-xs shadow-sm",title:e?"Download All Images as .zip":"Generate at least one image to download",children:T?i.jsxs(i.Fragment,{children:[i.jsx("i",{className:"fas fa-spinner fa-spin"}),"Zipping..."]}):i.jsxs(i.Fragment,{children:[i.jsx("i",{className:"fas fa-download"}),"Images"]})}),i.jsx("button",{onClick:B,disabled:!D||z,className:"bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-3 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-xs shadow-sm",title:D?"Download All Videos as .zip":"Generate at least one video to download",children:z?i.jsxs(i.Fragment,{children:[i.jsx("i",{className:"fas fa-spinner fa-spin"}),"Zipping..."]}):i.jsxs(i.Fragment,{children:[i.jsx("i",{className:"fas fa-video"}),"Videos"]})})]})]}),i.jsxs("div",{className:"border-t border-gray-700 pt-3 flex items-center gap-x-4 gap-y-2 flex-wrap",children:[i.jsx("span",{className:"text-sm font-bold text-gray-300",children:"Batch Actions:"}),i.jsxs("div",{className:"flex gap-2 flex-wrap",children:[i.jsx("button",{onClick:te,disabled:W||!k,className:"bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-2 px-3 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-xs shadow-sm",title:k?"Generate audio for all scenes that don't have it":"All scenes already have audio",children:W?i.jsxs(i.Fragment,{children:[i.jsx("i",{className:"fas fa-spinner fa-spin"}),"Working..."]}):i.jsxs(i.Fragment,{children:[i.jsx("i",{className:"fas fa-volume-up"}),"Generate All Audio"]})}),i.jsx("button",{onClick:w,disabled:C||!F,className:"bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-3 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-xs shadow-sm",title:F?"Generate images for all B-roll scenes that don't have one":"All scenes already have images or are studio scenes",children:C?i.jsxs(i.Fragment,{children:[i.jsx("i",{className:"fas fa-spinner fa-spin"}),"Working..."]}):i.jsxs(i.Fragment,{children:[i.jsx("i",{className:"fas fa-images"}),"Generate All Images"]})}),i.jsxs("button",{onClick:I,disabled:!e,className:"bg-teal-600 hover:bg-teal-700 text-white font-bold py-2 px-3 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-xs shadow-sm",title:e?"Pick the first image of every scene as the video base":"Generate some images first",children:[i.jsx("i",{className:"fas fa-check-double"}),"Pick All Images"]}),i.jsx("button",{onClick:_,disabled:R||!c,className:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-3 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-xs shadow-sm",title:m?c?"Generate video for all scenes with a selected image that don't have a video yet":"All scenes with a selected image already have videos":"Select a base image for one or more scenes to enable",children:R?i.jsxs(i.Fragment,{children:[i.jsx("i",{className:"fas fa-spinner fa-spin"}),"Working..."]}):i.jsxs(i.Fragment,{children:[i.jsx("i",{className:"fas fa-film"}),"Generate All Videos"]})}),i.jsx("button",{onClick:K,disabled:$||!e,className:"bg-sky-600 hover:bg-sky-700 text-white font-bold py-2 px-3 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-xs shadow-sm",title:e?"Send All Images to Telegram":"Generate at least one image to send",children:$?i.jsxs(i.Fragment,{children:[i.jsx("i",{className:"fas fa-spinner fa-spin"}),"Sending..."]}):i.jsxs(i.Fragment,{children:[i.jsx("i",{className:"fab fa-telegram-plane"}),"Send Images"]})}),i.jsx("button",{onClick:se,disabled:ce||!D,className:"bg-sky-600 hover:bg-sky-700 text-white font-bold py-2 px-3 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-xs shadow-sm",title:D?"Send All Videos to Telegram":"Generate at least one video to send",children:ce?i.jsxs(i.Fragment,{children:[i.jsx("i",{className:"fas fa-spinner fa-spin"}),"Sending..."]}):i.jsxs(i.Fragment,{children:[i.jsx("i",{className:"fab fa-telegram-plane"}),"Send Videos"]})})]})]})]}),i.jsx(L,{onClick:()=>Q(0)}),f.map((O,A)=>i.jsxs(Ze.Fragment,{children:[i.jsxs("div",{className:"relative group",children:[i.jsx("span",{className:"absolute -top-3 -left-3 bg-blue-600 text-white font-bold rounded-full h-8 w-8 flex items-center justify-center text-md z-10 shadow-md",children:A+1}),i.jsx("button",{onClick:()=>he(O.id),className:"absolute -top-3 -right-3 z-10 w-8 h-8 flex items-center justify-center bg-red-600 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity shadow-md hover:bg-red-700 focus:opacity-100",title:"Delete Scene",children:i.jsx("i",{className:"fas fa-trash-alt"})}),i.jsx(tt,{scene:O,sceneOverrides:p,onGenerateImage:b,onSceneImagePromptChange:v,onSceneVideoPromptChange:u,onSceneVoiceoverGuideChange:s,onSceneEnhancementChange:g,onSceneOverrideChange:a,onDeleteImage:h,onViewImage:d,onUploadImageForVideo:x,onSelectImageForVideo:G,onGenerateVideo:q,activeModule:P,numHosts:ee,onGenerateAudio:V,generatedEnvironments:t,videoAspectRatio:re,onToggleDialogueInPrompt:ie,onGenerateEnhancedPrompt:de,onSceneVoiceoverScriptChange:oe,onDeleteVideo:ue})]}),i.jsx(L,{onClick:()=>Q(A+1)})]},O.id))]})]})},ht=({scenes:N,onClose:H,videoAspectRatio:f})=>{Se.useEffect(()=>{const o=n=>{n.key==="Escape"&&H()};return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[H]);const j=N.flatMap(o=>o.images.map(n=>({id:`${o.id}-${n}`,voiceoverScript:o.voiceoverScript,imageUrl:n}))),y=f==="9:16"?"aspect-[9/16]":"aspect-video";return i.jsxs("div",{className:"fixed inset-0 bg-gray-900 bg-opacity-95 flex flex-col z-50 p-0 transition-opacity duration-300",role:"dialog","aria-modal":"true",onClick:H,children:[i.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center p-4 border-b border-gray-700 bg-gray-900",onClick:o=>o.stopPropagation(),children:[i.jsxs("h2",{className:"text-xl md:text-2xl font-bold text-white",children:[i.jsx("i",{className:"fas fa-grip-horizontal mr-3"}),"Full Storyboard View"]}),i.jsx("button",{onClick:H,"aria-label":"Close storyboard viewer",className:"text-gray-400 hover:text-white text-4xl transition-colors",children:"×"})]}),i.jsx("div",{className:"flex-grow overflow-y-auto p-4 md:p-8",onClick:o=>o.stopPropagation(),children:j.length>0?i.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 md:gap-6",children:j.map(o=>i.jsxs("div",{className:"flex flex-col bg-gray-800 text-gray-200 rounded-lg shadow-lg overflow-hidden transform hover:scale-[1.02] transition-transform duration-300",children:[i.jsx("div",{className:`w-full bg-gray-700 ${y}`,children:i.jsx("img",{src:o.imageUrl,alt:`Scene for "${o.voiceoverScript}"`,className:"w-full h-full object-cover",onError:n=>{n.target.src="https://via.placeholder.com/384x216.png?text=Image+Failed+to+Load"}})}),i.jsx("div",{className:"p-3 md:p-4 border-t border-gray-700",children:i.jsxs("p",{className:"text-sm text-gray-300 italic",children:['"',o.voiceoverScript,'"']})})]},o.id))}):i.jsx("div",{className:"flex items-center justify-center h-full w-full",children:i.jsxs("div",{className:"text-center",children:[i.jsx("i",{className:"fas fa-images text-6xl text-gray-600 mb-4"}),i.jsx("p",{className:"text-gray-500 text-lg",children:"No images have been generated yet."})]})})})]})},Pe="userUsageData",Ie={generateStoryboard:100,generateImage:500,generateVideo:500},nt=()=>{const N=new Date;return N.setHours(0,0,0,0),N.toISOString().split("T")[0]},Fe=()=>{try{const N=localStorage.getItem(Pe);return N?JSON.parse(N):{}}catch(N){return console.error("Failed to parse usage data from localStorage",N),{}}},Oe=N=>{try{localStorage.setItem(Pe,JSON.stringify(N))}catch(H){console.error("Failed to write usage data to localStorage",H)}},ft={getUsage(N){const H=Fe(),f=H[N]||{},j=nt(),y={generateStoryboard:{count:0,lastReset:j},generateImage:{count:0,lastReset:j},generateVideo:{count:0,lastReset:j}};for(const o in Ie){const n=o,r=f[n];r&&r.lastReset===j&&(y[n]=r)}return H[N]=y,Oe(H),y},logAction(N,H){const f=Fe(),j=this.getUsage(N);j[H].count+=1,f[N]=j,Oe(f)},canPerformAction(N,H){var o;const j=((o=this.getUsage(N)[H])==null?void 0:o.count)||0,y=Ie[H];return j<y}};async function pt(N,H){const f=[],j=new Set;let y=0;const o=async l=>{const p=(async()=>{try{const b=await l();f.push(b)}catch(b){f.push({error:b})}})();j.add(p),await p,j.delete(p)},n=()=>{if(y<N.length&&j.size<H){const l=N[y++];return o(l).then(()=>n())}},r=Array.from({length:Math.min(N.length,H)},n);return await Promise.all(r),f}function we(N){throw new Error('Could not dynamically require "'+N+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ce={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var Te;function it(){return Te||(Te=1,(function(N,H){(function(f){N.exports=f()})(function(){return(function f(j,y,o){function n(p,b){if(!y[p]){if(!j[p]){var v=typeof we=="function"&&we;if(!b&&v)return v(p,!0);if(r)return r(p,!0);var u=new Error("Cannot find module '"+p+"'");throw u.code="MODULE_NOT_FOUND",u}var s=y[p]={exports:{}};j[p][0].call(s.exports,function(g){var a=j[p][1][g];return n(a||g)},s,s.exports,f,j,y,o)}return y[p].exports}for(var r=typeof we=="function"&&we,l=0;l<o.length;l++)n(o[l]);return n})({1:[function(f,j,y){var o=f("./utils"),n=f("./support"),r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";y.encode=function(l){for(var p,b,v,u,s,g,a,h=[],d=0,x=l.length,w=x,C=o.getTypeOf(l)!=="string";d<l.length;)w=x-d,v=C?(p=l[d++],b=d<x?l[d++]:0,d<x?l[d++]:0):(p=l.charCodeAt(d++),b=d<x?l.charCodeAt(d++):0,d<x?l.charCodeAt(d++):0),u=p>>2,s=(3&p)<<4|b>>4,g=1<w?(15&b)<<2|v>>6:64,a=2<w?63&v:64,h.push(r.charAt(u)+r.charAt(s)+r.charAt(g)+r.charAt(a));return h.join("")},y.decode=function(l){var p,b,v,u,s,g,a=0,h=0,d="data:";if(l.substr(0,d.length)===d)throw new Error("Invalid base64 input, it looks like a data url.");var x,w=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===r.charAt(64)&&w--,l.charAt(l.length-2)===r.charAt(64)&&w--,w%1!=0)throw new Error("Invalid base64 input, bad content length.");for(x=n.uint8array?new Uint8Array(0|w):new Array(0|w);a<l.length;)p=r.indexOf(l.charAt(a++))<<2|(u=r.indexOf(l.charAt(a++)))>>4,b=(15&u)<<4|(s=r.indexOf(l.charAt(a++)))>>2,v=(3&s)<<6|(g=r.indexOf(l.charAt(a++))),x[h++]=p,s!==64&&(x[h++]=b),g!==64&&(x[h++]=v);return x}},{"./support":30,"./utils":32}],2:[function(f,j,y){var o=f("./external"),n=f("./stream/DataWorker"),r=f("./stream/Crc32Probe"),l=f("./stream/DataLengthProbe");function p(b,v,u,s,g){this.compressedSize=b,this.uncompressedSize=v,this.crc32=u,this.compression=s,this.compressedContent=g}p.prototype={getContentWorker:function(){var b=new n(o.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),v=this;return b.on("end",function(){if(this.streamInfo.data_length!==v.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),b},getCompressedWorker:function(){return new n(o.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},p.createWorkerFrom=function(b,v,u){return b.pipe(new r).pipe(new l("uncompressedSize")).pipe(v.compressWorker(u)).pipe(new l("compressedSize")).withStreamInfo("compression",v)},j.exports=p},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(f,j,y){var o=f("./stream/GenericWorker");y.STORE={magic:"\0\0",compressWorker:function(){return new o("STORE compression")},uncompressWorker:function(){return new o("STORE decompression")}},y.DEFLATE=f("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(f,j,y){var o=f("./utils"),n=(function(){for(var r,l=[],p=0;p<256;p++){r=p;for(var b=0;b<8;b++)r=1&r?3988292384^r>>>1:r>>>1;l[p]=r}return l})();j.exports=function(r,l){return r!==void 0&&r.length?o.getTypeOf(r)!=="string"?(function(p,b,v,u){var s=n,g=u+v;p^=-1;for(var a=u;a<g;a++)p=p>>>8^s[255&(p^b[a])];return-1^p})(0|l,r,r.length,0):(function(p,b,v,u){var s=n,g=u+v;p^=-1;for(var a=u;a<g;a++)p=p>>>8^s[255&(p^b.charCodeAt(a))];return-1^p})(0|l,r,r.length,0):0}},{"./utils":32}],5:[function(f,j,y){y.base64=!1,y.binary=!1,y.dir=!1,y.createFolders=!0,y.date=null,y.compression=null,y.compressionOptions=null,y.comment=null,y.unixPermissions=null,y.dosPermissions=null},{}],6:[function(f,j,y){var o=null;o=typeof Promise<"u"?Promise:f("lie"),j.exports={Promise:o}},{lie:37}],7:[function(f,j,y){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",n=f("pako"),r=f("./utils"),l=f("./stream/GenericWorker"),p=o?"uint8array":"array";function b(v,u){l.call(this,"FlateWorker/"+v),this._pako=null,this._pakoAction=v,this._pakoOptions=u,this.meta={}}y.magic="\b\0",r.inherits(b,l),b.prototype.processChunk=function(v){this.meta=v.meta,this._pako===null&&this._createPako(),this._pako.push(r.transformTo(p,v.data),!1)},b.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},b.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},b.prototype._createPako=function(){this._pako=new n[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var v=this;this._pako.onData=function(u){v.push({data:u,meta:v.meta})}},y.compressWorker=function(v){return new b("Deflate",v)},y.uncompressWorker=function(){return new b("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(f,j,y){function o(s,g){var a,h="";for(a=0;a<g;a++)h+=String.fromCharCode(255&s),s>>>=8;return h}function n(s,g,a,h,d,x){var w,C,S=s.file,U=s.compression,T=x!==p.utf8encode,B=r.transformTo("string",x(S.name)),z=r.transformTo("string",p.utf8encode(S.name)),G=S.comment,q=r.transformTo("string",x(G)),_=r.transformTo("string",p.utf8encode(G)),R=z.length!==S.name.length,t=_.length!==G.length,P="",ee="",V="",te=S.dir,W=S.date,Q={crc32:0,compressedSize:0,uncompressedSize:0};g&&!a||(Q.crc32=s.crc32,Q.compressedSize=s.compressedSize,Q.uncompressedSize=s.uncompressedSize);var I=0;g&&(I|=8),T||!R&&!t||(I|=2048);var E=0,X=0;te&&(E|=16),d==="UNIX"?(X=798,E|=(function($,se){var ce=$;return $||(ce=se?16893:33204),(65535&ce)<<16})(S.unixPermissions,te)):(X=20,E|=(function($){return 63&($||0)})(S.dosPermissions)),w=W.getUTCHours(),w<<=6,w|=W.getUTCMinutes(),w<<=5,w|=W.getUTCSeconds()/2,C=W.getUTCFullYear()-1980,C<<=4,C|=W.getUTCMonth()+1,C<<=5,C|=W.getUTCDate(),R&&(ee=o(1,1)+o(b(B),4)+z,P+="up"+o(ee.length,2)+ee),t&&(V=o(1,1)+o(b(q),4)+_,P+="uc"+o(V.length,2)+V);var K="";return K+=`
\0`,K+=o(I,2),K+=U.magic,K+=o(w,2),K+=o(C,2),K+=o(Q.crc32,4),K+=o(Q.compressedSize,4),K+=o(Q.uncompressedSize,4),K+=o(B.length,2),K+=o(P.length,2),{fileRecord:v.LOCAL_FILE_HEADER+K+B+P,dirRecord:v.CENTRAL_FILE_HEADER+o(X,2)+K+o(q.length,2)+"\0\0\0\0"+o(E,4)+o(h,4)+B+P+q}}var r=f("../utils"),l=f("../stream/GenericWorker"),p=f("../utf8"),b=f("../crc32"),v=f("../signature");function u(s,g,a,h){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=g,this.zipPlatform=a,this.encodeFileName=h,this.streamFiles=s,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}r.inherits(u,l),u.prototype.push=function(s){var g=s.meta.percent||0,a=this.entriesCount,h=this._sources.length;this.accumulate?this.contentBuffer.push(s):(this.bytesWritten+=s.data.length,l.prototype.push.call(this,{data:s.data,meta:{currentFile:this.currentFile,percent:a?(g+100*(a-h-1))/a:100}}))},u.prototype.openedSource=function(s){this.currentSourceOffset=this.bytesWritten,this.currentFile=s.file.name;var g=this.streamFiles&&!s.file.dir;if(g){var a=n(s,g,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:a.fileRecord,meta:{percent:0}})}else this.accumulate=!0},u.prototype.closedSource=function(s){this.accumulate=!1;var g=this.streamFiles&&!s.file.dir,a=n(s,g,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(a.dirRecord),g)this.push({data:(function(h){return v.DATA_DESCRIPTOR+o(h.crc32,4)+o(h.compressedSize,4)+o(h.uncompressedSize,4)})(s),meta:{percent:100}});else for(this.push({data:a.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},u.prototype.flush=function(){for(var s=this.bytesWritten,g=0;g<this.dirRecords.length;g++)this.push({data:this.dirRecords[g],meta:{percent:100}});var a=this.bytesWritten-s,h=(function(d,x,w,C,S){var U=r.transformTo("string",S(C));return v.CENTRAL_DIRECTORY_END+"\0\0\0\0"+o(d,2)+o(d,2)+o(x,4)+o(w,4)+o(U.length,2)+U})(this.dirRecords.length,a,s,this.zipComment,this.encodeFileName);this.push({data:h,meta:{percent:100}})},u.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},u.prototype.registerPrevious=function(s){this._sources.push(s);var g=this;return s.on("data",function(a){g.processChunk(a)}),s.on("end",function(){g.closedSource(g.previous.streamInfo),g._sources.length?g.prepareNextSource():g.end()}),s.on("error",function(a){g.error(a)}),this},u.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},u.prototype.error=function(s){var g=this._sources;if(!l.prototype.error.call(this,s))return!1;for(var a=0;a<g.length;a++)try{g[a].error(s)}catch{}return!0},u.prototype.lock=function(){l.prototype.lock.call(this);for(var s=this._sources,g=0;g<s.length;g++)s[g].lock()},j.exports=u},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(f,j,y){var o=f("../compressions"),n=f("./ZipFileWorker");y.generateWorker=function(r,l,p){var b=new n(l.streamFiles,p,l.platform,l.encodeFileName),v=0;try{r.forEach(function(u,s){v++;var g=(function(x,w){var C=x||w,S=o[C];if(!S)throw new Error(C+" is not a valid compression method !");return S})(s.options.compression,l.compression),a=s.options.compressionOptions||l.compressionOptions||{},h=s.dir,d=s.date;s._compressWorker(g,a).withStreamInfo("file",{name:u,dir:h,date:d,comment:s.comment||"",unixPermissions:s.unixPermissions,dosPermissions:s.dosPermissions}).pipe(b)}),b.entriesCount=v}catch(u){b.error(u)}return b}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(f,j,y){function o(){if(!(this instanceof o))return new o;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var n=new o;for(var r in this)typeof this[r]!="function"&&(n[r]=this[r]);return n}}(o.prototype=f("./object")).loadAsync=f("./load"),o.support=f("./support"),o.defaults=f("./defaults"),o.version="3.10.1",o.loadAsync=function(n,r){return new o().loadAsync(n,r)},o.external=f("./external"),j.exports=o},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(f,j,y){var o=f("./utils"),n=f("./external"),r=f("./utf8"),l=f("./zipEntries"),p=f("./stream/Crc32Probe"),b=f("./nodejsUtils");function v(u){return new n.Promise(function(s,g){var a=u.decompressed.getContentWorker().pipe(new p);a.on("error",function(h){g(h)}).on("end",function(){a.streamInfo.crc32!==u.decompressed.crc32?g(new Error("Corrupted zip : CRC32 mismatch")):s()}).resume()})}j.exports=function(u,s){var g=this;return s=o.extend(s||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:r.utf8decode}),b.isNode&&b.isStream(u)?n.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):o.prepareContent("the loaded zip file",u,!0,s.optimizedBinaryString,s.base64).then(function(a){var h=new l(s);return h.load(a),h}).then(function(a){var h=[n.Promise.resolve(a)],d=a.files;if(s.checkCRC32)for(var x=0;x<d.length;x++)h.push(v(d[x]));return n.Promise.all(h)}).then(function(a){for(var h=a.shift(),d=h.files,x=0;x<d.length;x++){var w=d[x],C=w.fileNameStr,S=o.resolve(w.fileNameStr);g.file(S,w.decompressed,{binary:!0,optimizedBinaryString:!0,date:w.date,dir:w.dir,comment:w.fileCommentStr.length?w.fileCommentStr:null,unixPermissions:w.unixPermissions,dosPermissions:w.dosPermissions,createFolders:s.createFolders}),w.dir||(g.file(S).unsafeOriginalName=C)}return h.zipComment.length&&(g.comment=h.zipComment),g})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(f,j,y){var o=f("../utils"),n=f("../stream/GenericWorker");function r(l,p){n.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(p)}o.inherits(r,n),r.prototype._bindStream=function(l){var p=this;(this._stream=l).pause(),l.on("data",function(b){p.push({data:b,meta:{percent:0}})}).on("error",function(b){p.isPaused?this.generatedError=b:p.error(b)}).on("end",function(){p.isPaused?p._upstreamEnded=!0:p.end()})},r.prototype.pause=function(){return!!n.prototype.pause.call(this)&&(this._stream.pause(),!0)},r.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},j.exports=r},{"../stream/GenericWorker":28,"../utils":32}],13:[function(f,j,y){var o=f("readable-stream").Readable;function n(r,l,p){o.call(this,l),this._helper=r;var b=this;r.on("data",function(v,u){b.push(v)||b._helper.pause(),p&&p(u)}).on("error",function(v){b.emit("error",v)}).on("end",function(){b.push(null)})}f("../utils").inherits(n,o),n.prototype._read=function(){this._helper.resume()},j.exports=n},{"../utils":32,"readable-stream":16}],14:[function(f,j,y){j.exports={isNode:typeof Buffer<"u",newBufferFrom:function(o,n){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(o,n);if(typeof o=="number")throw new Error('The "data" argument must not be a number');return new Buffer(o,n)},allocBuffer:function(o){if(Buffer.alloc)return Buffer.alloc(o);var n=new Buffer(o);return n.fill(0),n},isBuffer:function(o){return Buffer.isBuffer(o)},isStream:function(o){return o&&typeof o.on=="function"&&typeof o.pause=="function"&&typeof o.resume=="function"}}},{}],15:[function(f,j,y){function o(S,U,T){var B,z=r.getTypeOf(U),G=r.extend(T||{},b);G.date=G.date||new Date,G.compression!==null&&(G.compression=G.compression.toUpperCase()),typeof G.unixPermissions=="string"&&(G.unixPermissions=parseInt(G.unixPermissions,8)),G.unixPermissions&&16384&G.unixPermissions&&(G.dir=!0),G.dosPermissions&&16&G.dosPermissions&&(G.dir=!0),G.dir&&(S=d(S)),G.createFolders&&(B=h(S))&&x.call(this,B,!0);var q=z==="string"&&G.binary===!1&&G.base64===!1;T&&T.binary!==void 0||(G.binary=!q),(U instanceof v&&U.uncompressedSize===0||G.dir||!U||U.length===0)&&(G.base64=!1,G.binary=!0,U="",G.compression="STORE",z="string");var _=null;_=U instanceof v||U instanceof l?U:g.isNode&&g.isStream(U)?new a(S,U):r.prepareContent(S,U,G.binary,G.optimizedBinaryString,G.base64);var R=new u(S,_,G);this.files[S]=R}var n=f("./utf8"),r=f("./utils"),l=f("./stream/GenericWorker"),p=f("./stream/StreamHelper"),b=f("./defaults"),v=f("./compressedObject"),u=f("./zipObject"),s=f("./generate"),g=f("./nodejsUtils"),a=f("./nodejs/NodejsStreamInputAdapter"),h=function(S){S.slice(-1)==="/"&&(S=S.substring(0,S.length-1));var U=S.lastIndexOf("/");return 0<U?S.substring(0,U):""},d=function(S){return S.slice(-1)!=="/"&&(S+="/"),S},x=function(S,U){return U=U!==void 0?U:b.createFolders,S=d(S),this.files[S]||o.call(this,S,null,{dir:!0,createFolders:U}),this.files[S]};function w(S){return Object.prototype.toString.call(S)==="[object RegExp]"}var C={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(S){var U,T,B;for(U in this.files)B=this.files[U],(T=U.slice(this.root.length,U.length))&&U.slice(0,this.root.length)===this.root&&S(T,B)},filter:function(S){var U=[];return this.forEach(function(T,B){S(T,B)&&U.push(B)}),U},file:function(S,U,T){if(arguments.length!==1)return S=this.root+S,o.call(this,S,U,T),this;if(w(S)){var B=S;return this.filter(function(G,q){return!q.dir&&B.test(G)})}var z=this.files[this.root+S];return z&&!z.dir?z:null},folder:function(S){if(!S)return this;if(w(S))return this.filter(function(z,G){return G.dir&&S.test(z)});var U=this.root+S,T=x.call(this,U),B=this.clone();return B.root=T.name,B},remove:function(S){S=this.root+S;var U=this.files[S];if(U||(S.slice(-1)!=="/"&&(S+="/"),U=this.files[S]),U&&!U.dir)delete this.files[S];else for(var T=this.filter(function(z,G){return G.name.slice(0,S.length)===S}),B=0;B<T.length;B++)delete this.files[T[B].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(S){var U,T={};try{if((T=r.extend(S||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:n.utf8encode})).type=T.type.toLowerCase(),T.compression=T.compression.toUpperCase(),T.type==="binarystring"&&(T.type="string"),!T.type)throw new Error("No output type specified.");r.checkSupport(T.type),T.platform!=="darwin"&&T.platform!=="freebsd"&&T.platform!=="linux"&&T.platform!=="sunos"||(T.platform="UNIX"),T.platform==="win32"&&(T.platform="DOS");var B=T.comment||this.comment||"";U=s.generateWorker(this,T,B)}catch(z){(U=new l("error")).error(z)}return new p(U,T.type||"string",T.mimeType)},generateAsync:function(S,U){return this.generateInternalStream(S).accumulate(U)},generateNodeStream:function(S,U){return(S=S||{}).type||(S.type="nodebuffer"),this.generateInternalStream(S).toNodejsStream(U)}};j.exports=C},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(f,j,y){j.exports=f("stream")},{stream:void 0}],17:[function(f,j,y){var o=f("./DataReader");function n(r){o.call(this,r);for(var l=0;l<this.data.length;l++)r[l]=255&r[l]}f("../utils").inherits(n,o),n.prototype.byteAt=function(r){return this.data[this.zero+r]},n.prototype.lastIndexOfSignature=function(r){for(var l=r.charCodeAt(0),p=r.charCodeAt(1),b=r.charCodeAt(2),v=r.charCodeAt(3),u=this.length-4;0<=u;--u)if(this.data[u]===l&&this.data[u+1]===p&&this.data[u+2]===b&&this.data[u+3]===v)return u-this.zero;return-1},n.prototype.readAndCheckSignature=function(r){var l=r.charCodeAt(0),p=r.charCodeAt(1),b=r.charCodeAt(2),v=r.charCodeAt(3),u=this.readData(4);return l===u[0]&&p===u[1]&&b===u[2]&&v===u[3]},n.prototype.readData=function(r){if(this.checkOffset(r),r===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,l},j.exports=n},{"../utils":32,"./DataReader":18}],18:[function(f,j,y){var o=f("../utils");function n(r){this.data=r,this.length=r.length,this.index=0,this.zero=0}n.prototype={checkOffset:function(r){this.checkIndex(this.index+r)},checkIndex:function(r){if(this.length<this.zero+r||r<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+r+"). Corrupted zip ?")},setIndex:function(r){this.checkIndex(r),this.index=r},skip:function(r){this.setIndex(this.index+r)},byteAt:function(){},readInt:function(r){var l,p=0;for(this.checkOffset(r),l=this.index+r-1;l>=this.index;l--)p=(p<<8)+this.byteAt(l);return this.index+=r,p},readString:function(r){return o.transformTo("string",this.readData(r))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var r=this.readInt(4);return new Date(Date.UTC(1980+(r>>25&127),(r>>21&15)-1,r>>16&31,r>>11&31,r>>5&63,(31&r)<<1))}},j.exports=n},{"../utils":32}],19:[function(f,j,y){var o=f("./Uint8ArrayReader");function n(r){o.call(this,r)}f("../utils").inherits(n,o),n.prototype.readData=function(r){this.checkOffset(r);var l=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,l},j.exports=n},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(f,j,y){var o=f("./DataReader");function n(r){o.call(this,r)}f("../utils").inherits(n,o),n.prototype.byteAt=function(r){return this.data.charCodeAt(this.zero+r)},n.prototype.lastIndexOfSignature=function(r){return this.data.lastIndexOf(r)-this.zero},n.prototype.readAndCheckSignature=function(r){return r===this.readData(4)},n.prototype.readData=function(r){this.checkOffset(r);var l=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,l},j.exports=n},{"../utils":32,"./DataReader":18}],21:[function(f,j,y){var o=f("./ArrayReader");function n(r){o.call(this,r)}f("../utils").inherits(n,o),n.prototype.readData=function(r){if(this.checkOffset(r),r===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+r);return this.index+=r,l},j.exports=n},{"../utils":32,"./ArrayReader":17}],22:[function(f,j,y){var o=f("../utils"),n=f("../support"),r=f("./ArrayReader"),l=f("./StringReader"),p=f("./NodeBufferReader"),b=f("./Uint8ArrayReader");j.exports=function(v){var u=o.getTypeOf(v);return o.checkSupport(u),u!=="string"||n.uint8array?u==="nodebuffer"?new p(v):n.uint8array?new b(o.transformTo("uint8array",v)):new r(o.transformTo("array",v)):new l(v)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(f,j,y){y.LOCAL_FILE_HEADER="PK",y.CENTRAL_FILE_HEADER="PK",y.CENTRAL_DIRECTORY_END="PK",y.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",y.ZIP64_CENTRAL_DIRECTORY_END="PK",y.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(f,j,y){var o=f("./GenericWorker"),n=f("../utils");function r(l){o.call(this,"ConvertWorker to "+l),this.destType=l}n.inherits(r,o),r.prototype.processChunk=function(l){this.push({data:n.transformTo(this.destType,l.data),meta:l.meta})},j.exports=r},{"../utils":32,"./GenericWorker":28}],25:[function(f,j,y){var o=f("./GenericWorker"),n=f("../crc32");function r(){o.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}f("../utils").inherits(r,o),r.prototype.processChunk=function(l){this.streamInfo.crc32=n(l.data,this.streamInfo.crc32||0),this.push(l)},j.exports=r},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(f,j,y){var o=f("../utils"),n=f("./GenericWorker");function r(l){n.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}o.inherits(r,n),r.prototype.processChunk=function(l){if(l){var p=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=p+l.data.length}n.prototype.processChunk.call(this,l)},j.exports=r},{"../utils":32,"./GenericWorker":28}],27:[function(f,j,y){var o=f("../utils"),n=f("./GenericWorker");function r(l){n.call(this,"DataWorker");var p=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(b){p.dataIsReady=!0,p.data=b,p.max=b&&b.length||0,p.type=o.getTypeOf(b),p.isPaused||p._tickAndRepeat()},function(b){p.error(b)})}o.inherits(r,n),r.prototype.cleanUp=function(){n.prototype.cleanUp.call(this),this.data=null},r.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,o.delay(this._tickAndRepeat,[],this)),!0)},r.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(o.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},r.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,p=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,p);break;case"uint8array":l=this.data.subarray(this.index,p);break;case"array":case"nodebuffer":l=this.data.slice(this.index,p)}return this.index=p,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},j.exports=r},{"../utils":32,"./GenericWorker":28}],28:[function(f,j,y){function o(n){this.name=n||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}o.prototype={push:function(n){this.emit("data",n)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(n){this.emit("error",n)}return!0},error:function(n){return!this.isFinished&&(this.isPaused?this.generatedError=n:(this.isFinished=!0,this.emit("error",n),this.previous&&this.previous.error(n),this.cleanUp()),!0)},on:function(n,r){return this._listeners[n].push(r),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(n,r){if(this._listeners[n])for(var l=0;l<this._listeners[n].length;l++)this._listeners[n][l].call(this,r)},pipe:function(n){return n.registerPrevious(this)},registerPrevious:function(n){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=n.streamInfo,this.mergeStreamInfo(),this.previous=n;var r=this;return n.on("data",function(l){r.processChunk(l)}),n.on("end",function(){r.end()}),n.on("error",function(l){r.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var n=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),n=!0),this.previous&&this.previous.resume(),!n},flush:function(){},processChunk:function(n){this.push(n)},withStreamInfo:function(n,r){return this.extraStreamInfo[n]=r,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var n in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,n)&&(this.streamInfo[n]=this.extraStreamInfo[n])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var n="Worker "+this.name;return this.previous?this.previous+" -> "+n:n}},j.exports=o},{}],29:[function(f,j,y){var o=f("../utils"),n=f("./ConvertWorker"),r=f("./GenericWorker"),l=f("../base64"),p=f("../support"),b=f("../external"),v=null;if(p.nodestream)try{v=f("../nodejs/NodejsStreamOutputAdapter")}catch{}function u(g,a){return new b.Promise(function(h,d){var x=[],w=g._internalType,C=g._outputType,S=g._mimeType;g.on("data",function(U,T){x.push(U),a&&a(T)}).on("error",function(U){x=[],d(U)}).on("end",function(){try{var U=(function(T,B,z){switch(T){case"blob":return o.newBlob(o.transformTo("arraybuffer",B),z);case"base64":return l.encode(B);default:return o.transformTo(T,B)}})(C,(function(T,B){var z,G=0,q=null,_=0;for(z=0;z<B.length;z++)_+=B[z].length;switch(T){case"string":return B.join("");case"array":return Array.prototype.concat.apply([],B);case"uint8array":for(q=new Uint8Array(_),z=0;z<B.length;z++)q.set(B[z],G),G+=B[z].length;return q;case"nodebuffer":return Buffer.concat(B);default:throw new Error("concat : unsupported type '"+T+"'")}})(w,x),S);h(U)}catch(T){d(T)}x=[]}).resume()})}function s(g,a,h){var d=a;switch(a){case"blob":case"arraybuffer":d="uint8array";break;case"base64":d="string"}try{this._internalType=d,this._outputType=a,this._mimeType=h,o.checkSupport(d),this._worker=g.pipe(new n(d)),g.lock()}catch(x){this._worker=new r("error"),this._worker.error(x)}}s.prototype={accumulate:function(g){return u(this,g)},on:function(g,a){var h=this;return g==="data"?this._worker.on(g,function(d){a.call(h,d.data,d.meta)}):this._worker.on(g,function(){o.delay(a,arguments,h)}),this},resume:function(){return o.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(g){if(o.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new v(this,{objectMode:this._outputType!=="nodebuffer"},g)}},j.exports=s},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(f,j,y){if(y.base64=!0,y.array=!0,y.string=!0,y.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",y.nodebuffer=typeof Buffer<"u",y.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")y.blob=!1;else{var o=new ArrayBuffer(0);try{y.blob=new Blob([o],{type:"application/zip"}).size===0}catch{try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);n.append(o),y.blob=n.getBlob("application/zip").size===0}catch{y.blob=!1}}}try{y.nodestream=!!f("readable-stream").Readable}catch{y.nodestream=!1}},{"readable-stream":16}],31:[function(f,j,y){for(var o=f("./utils"),n=f("./support"),r=f("./nodejsUtils"),l=f("./stream/GenericWorker"),p=new Array(256),b=0;b<256;b++)p[b]=252<=b?6:248<=b?5:240<=b?4:224<=b?3:192<=b?2:1;p[254]=p[254]=1;function v(){l.call(this,"utf-8 decode"),this.leftOver=null}function u(){l.call(this,"utf-8 encode")}y.utf8encode=function(s){return n.nodebuffer?r.newBufferFrom(s,"utf-8"):(function(g){var a,h,d,x,w,C=g.length,S=0;for(x=0;x<C;x++)(64512&(h=g.charCodeAt(x)))==55296&&x+1<C&&(64512&(d=g.charCodeAt(x+1)))==56320&&(h=65536+(h-55296<<10)+(d-56320),x++),S+=h<128?1:h<2048?2:h<65536?3:4;for(a=n.uint8array?new Uint8Array(S):new Array(S),x=w=0;w<S;x++)(64512&(h=g.charCodeAt(x)))==55296&&x+1<C&&(64512&(d=g.charCodeAt(x+1)))==56320&&(h=65536+(h-55296<<10)+(d-56320),x++),h<128?a[w++]=h:(h<2048?a[w++]=192|h>>>6:(h<65536?a[w++]=224|h>>>12:(a[w++]=240|h>>>18,a[w++]=128|h>>>12&63),a[w++]=128|h>>>6&63),a[w++]=128|63&h);return a})(s)},y.utf8decode=function(s){return n.nodebuffer?o.transformTo("nodebuffer",s).toString("utf-8"):(function(g){var a,h,d,x,w=g.length,C=new Array(2*w);for(a=h=0;a<w;)if((d=g[a++])<128)C[h++]=d;else if(4<(x=p[d]))C[h++]=65533,a+=x-1;else{for(d&=x===2?31:x===3?15:7;1<x&&a<w;)d=d<<6|63&g[a++],x--;1<x?C[h++]=65533:d<65536?C[h++]=d:(d-=65536,C[h++]=55296|d>>10&1023,C[h++]=56320|1023&d)}return C.length!==h&&(C.subarray?C=C.subarray(0,h):C.length=h),o.applyFromCharCode(C)})(s=o.transformTo(n.uint8array?"uint8array":"array",s))},o.inherits(v,l),v.prototype.processChunk=function(s){var g=o.transformTo(n.uint8array?"uint8array":"array",s.data);if(this.leftOver&&this.leftOver.length){if(n.uint8array){var a=g;(g=new Uint8Array(a.length+this.leftOver.length)).set(this.leftOver,0),g.set(a,this.leftOver.length)}else g=this.leftOver.concat(g);this.leftOver=null}var h=(function(x,w){var C;for((w=w||x.length)>x.length&&(w=x.length),C=w-1;0<=C&&(192&x[C])==128;)C--;return C<0||C===0?w:C+p[x[C]]>w?C:w})(g),d=g;h!==g.length&&(n.uint8array?(d=g.subarray(0,h),this.leftOver=g.subarray(h,g.length)):(d=g.slice(0,h),this.leftOver=g.slice(h,g.length))),this.push({data:y.utf8decode(d),meta:s.meta})},v.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:y.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},y.Utf8DecodeWorker=v,o.inherits(u,l),u.prototype.processChunk=function(s){this.push({data:y.utf8encode(s.data),meta:s.meta})},y.Utf8EncodeWorker=u},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(f,j,y){var o=f("./support"),n=f("./base64"),r=f("./nodejsUtils"),l=f("./external");function p(a){return a}function b(a,h){for(var d=0;d<a.length;++d)h[d]=255&a.charCodeAt(d);return h}f("setimmediate"),y.newBlob=function(a,h){y.checkSupport("blob");try{return new Blob([a],{type:h})}catch{try{var d=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return d.append(a),d.getBlob(h)}catch{throw new Error("Bug : can't construct the Blob.")}}};var v={stringifyByChunk:function(a,h,d){var x=[],w=0,C=a.length;if(C<=d)return String.fromCharCode.apply(null,a);for(;w<C;)h==="array"||h==="nodebuffer"?x.push(String.fromCharCode.apply(null,a.slice(w,Math.min(w+d,C)))):x.push(String.fromCharCode.apply(null,a.subarray(w,Math.min(w+d,C)))),w+=d;return x.join("")},stringifyByChar:function(a){for(var h="",d=0;d<a.length;d++)h+=String.fromCharCode(a[d]);return h},applyCanBeUsed:{uint8array:(function(){try{return o.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return o.nodebuffer&&String.fromCharCode.apply(null,r.allocBuffer(1)).length===1}catch{return!1}})()}};function u(a){var h=65536,d=y.getTypeOf(a),x=!0;if(d==="uint8array"?x=v.applyCanBeUsed.uint8array:d==="nodebuffer"&&(x=v.applyCanBeUsed.nodebuffer),x)for(;1<h;)try{return v.stringifyByChunk(a,d,h)}catch{h=Math.floor(h/2)}return v.stringifyByChar(a)}function s(a,h){for(var d=0;d<a.length;d++)h[d]=a[d];return h}y.applyFromCharCode=u;var g={};g.string={string:p,array:function(a){return b(a,new Array(a.length))},arraybuffer:function(a){return g.string.uint8array(a).buffer},uint8array:function(a){return b(a,new Uint8Array(a.length))},nodebuffer:function(a){return b(a,r.allocBuffer(a.length))}},g.array={string:u,array:p,arraybuffer:function(a){return new Uint8Array(a).buffer},uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return r.newBufferFrom(a)}},g.arraybuffer={string:function(a){return u(new Uint8Array(a))},array:function(a){return s(new Uint8Array(a),new Array(a.byteLength))},arraybuffer:p,uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return r.newBufferFrom(new Uint8Array(a))}},g.uint8array={string:u,array:function(a){return s(a,new Array(a.length))},arraybuffer:function(a){return a.buffer},uint8array:p,nodebuffer:function(a){return r.newBufferFrom(a)}},g.nodebuffer={string:u,array:function(a){return s(a,new Array(a.length))},arraybuffer:function(a){return g.nodebuffer.uint8array(a).buffer},uint8array:function(a){return s(a,new Uint8Array(a.length))},nodebuffer:p},y.transformTo=function(a,h){if(h=h||"",!a)return h;y.checkSupport(a);var d=y.getTypeOf(h);return g[d][a](h)},y.resolve=function(a){for(var h=a.split("/"),d=[],x=0;x<h.length;x++){var w=h[x];w==="."||w===""&&x!==0&&x!==h.length-1||(w===".."?d.pop():d.push(w))}return d.join("/")},y.getTypeOf=function(a){return typeof a=="string"?"string":Object.prototype.toString.call(a)==="[object Array]"?"array":o.nodebuffer&&r.isBuffer(a)?"nodebuffer":o.uint8array&&a instanceof Uint8Array?"uint8array":o.arraybuffer&&a instanceof ArrayBuffer?"arraybuffer":void 0},y.checkSupport=function(a){if(!o[a.toLowerCase()])throw new Error(a+" is not supported by this platform")},y.MAX_VALUE_16BITS=65535,y.MAX_VALUE_32BITS=-1,y.pretty=function(a){var h,d,x="";for(d=0;d<(a||"").length;d++)x+="\\x"+((h=a.charCodeAt(d))<16?"0":"")+h.toString(16).toUpperCase();return x},y.delay=function(a,h,d){setImmediate(function(){a.apply(d||null,h||[])})},y.inherits=function(a,h){function d(){}d.prototype=h.prototype,a.prototype=new d},y.extend=function(){var a,h,d={};for(a=0;a<arguments.length;a++)for(h in arguments[a])Object.prototype.hasOwnProperty.call(arguments[a],h)&&d[h]===void 0&&(d[h]=arguments[a][h]);return d},y.prepareContent=function(a,h,d,x,w){return l.Promise.resolve(h).then(function(C){return o.blob&&(C instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(C))!==-1)&&typeof FileReader<"u"?new l.Promise(function(S,U){var T=new FileReader;T.onload=function(B){S(B.target.result)},T.onerror=function(B){U(B.target.error)},T.readAsArrayBuffer(C)}):C}).then(function(C){var S=y.getTypeOf(C);return S?(S==="arraybuffer"?C=y.transformTo("uint8array",C):S==="string"&&(w?C=n.decode(C):d&&x!==!0&&(C=(function(U){return b(U,o.uint8array?new Uint8Array(U.length):new Array(U.length))})(C))),C):l.Promise.reject(new Error("Can't read the data of '"+a+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(f,j,y){var o=f("./reader/readerFor"),n=f("./utils"),r=f("./signature"),l=f("./zipEntry"),p=f("./support");function b(v){this.files=[],this.loadOptions=v}b.prototype={checkSignature:function(v){if(!this.reader.readAndCheckSignature(v)){this.reader.index-=4;var u=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+n.pretty(u)+", expected "+n.pretty(v)+")")}},isSignature:function(v,u){var s=this.reader.index;this.reader.setIndex(v);var g=this.reader.readString(4)===u;return this.reader.setIndex(s),g},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var v=this.reader.readData(this.zipCommentLength),u=p.uint8array?"uint8array":"array",s=n.transformTo(u,v);this.zipComment=this.loadOptions.decodeFileName(s)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var v,u,s,g=this.zip64EndOfCentralSize-44;0<g;)v=this.reader.readInt(2),u=this.reader.readInt(4),s=this.reader.readData(u),this.zip64ExtensibleData[v]={id:v,length:u,value:s}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var v,u;for(v=0;v<this.files.length;v++)u=this.files[v],this.reader.setIndex(u.localHeaderOffset),this.checkSignature(r.LOCAL_FILE_HEADER),u.readLocalPart(this.reader),u.handleUTF8(),u.processAttributes()},readCentralDir:function(){var v;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(r.CENTRAL_FILE_HEADER);)(v=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(v);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var v=this.reader.lastIndexOfSignature(r.CENTRAL_DIRECTORY_END);if(v<0)throw this.isSignature(0,r.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(v);var u=v;if(this.checkSignature(r.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===n.MAX_VALUE_16BITS||this.diskWithCentralDirStart===n.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===n.MAX_VALUE_16BITS||this.centralDirRecords===n.MAX_VALUE_16BITS||this.centralDirSize===n.MAX_VALUE_32BITS||this.centralDirOffset===n.MAX_VALUE_32BITS){if(this.zip64=!0,(v=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(v),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,r.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var s=this.centralDirOffset+this.centralDirSize;this.zip64&&(s+=20,s+=12+this.zip64EndOfCentralSize);var g=u-s;if(0<g)this.isSignature(u,r.CENTRAL_FILE_HEADER)||(this.reader.zero=g);else if(g<0)throw new Error("Corrupted zip: missing "+Math.abs(g)+" bytes.")},prepareReader:function(v){this.reader=o(v)},load:function(v){this.prepareReader(v),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},j.exports=b},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(f,j,y){var o=f("./reader/readerFor"),n=f("./utils"),r=f("./compressedObject"),l=f("./crc32"),p=f("./utf8"),b=f("./compressions"),v=f("./support");function u(s,g){this.options=s,this.loadOptions=g}u.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(s){var g,a;if(s.skip(22),this.fileNameLength=s.readInt(2),a=s.readInt(2),this.fileName=s.readData(this.fileNameLength),s.skip(a),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((g=(function(h){for(var d in b)if(Object.prototype.hasOwnProperty.call(b,d)&&b[d].magic===h)return b[d];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+n.pretty(this.compressionMethod)+" unknown (inner file : "+n.transformTo("string",this.fileName)+")");this.decompressed=new r(this.compressedSize,this.uncompressedSize,this.crc32,g,s.readData(this.compressedSize))},readCentralPart:function(s){this.versionMadeBy=s.readInt(2),s.skip(2),this.bitFlag=s.readInt(2),this.compressionMethod=s.readString(2),this.date=s.readDate(),this.crc32=s.readInt(4),this.compressedSize=s.readInt(4),this.uncompressedSize=s.readInt(4);var g=s.readInt(2);if(this.extraFieldsLength=s.readInt(2),this.fileCommentLength=s.readInt(2),this.diskNumberStart=s.readInt(2),this.internalFileAttributes=s.readInt(2),this.externalFileAttributes=s.readInt(4),this.localHeaderOffset=s.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");s.skip(g),this.readExtraFields(s),this.parseZIP64ExtraField(s),this.fileComment=s.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var s=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),s==0&&(this.dosPermissions=63&this.externalFileAttributes),s==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var s=o(this.extraFields[1].value);this.uncompressedSize===n.MAX_VALUE_32BITS&&(this.uncompressedSize=s.readInt(8)),this.compressedSize===n.MAX_VALUE_32BITS&&(this.compressedSize=s.readInt(8)),this.localHeaderOffset===n.MAX_VALUE_32BITS&&(this.localHeaderOffset=s.readInt(8)),this.diskNumberStart===n.MAX_VALUE_32BITS&&(this.diskNumberStart=s.readInt(4))}},readExtraFields:function(s){var g,a,h,d=s.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});s.index+4<d;)g=s.readInt(2),a=s.readInt(2),h=s.readData(a),this.extraFields[g]={id:g,length:a,value:h};s.setIndex(d)},handleUTF8:function(){var s=v.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=p.utf8decode(this.fileName),this.fileCommentStr=p.utf8decode(this.fileComment);else{var g=this.findExtraFieldUnicodePath();if(g!==null)this.fileNameStr=g;else{var a=n.transformTo(s,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(a)}var h=this.findExtraFieldUnicodeComment();if(h!==null)this.fileCommentStr=h;else{var d=n.transformTo(s,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(d)}}},findExtraFieldUnicodePath:function(){var s=this.extraFields[28789];if(s){var g=o(s.value);return g.readInt(1)!==1||l(this.fileName)!==g.readInt(4)?null:p.utf8decode(g.readData(s.length-5))}return null},findExtraFieldUnicodeComment:function(){var s=this.extraFields[25461];if(s){var g=o(s.value);return g.readInt(1)!==1||l(this.fileComment)!==g.readInt(4)?null:p.utf8decode(g.readData(s.length-5))}return null}},j.exports=u},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(f,j,y){function o(g,a,h){this.name=g,this.dir=h.dir,this.date=h.date,this.comment=h.comment,this.unixPermissions=h.unixPermissions,this.dosPermissions=h.dosPermissions,this._data=a,this._dataBinary=h.binary,this.options={compression:h.compression,compressionOptions:h.compressionOptions}}var n=f("./stream/StreamHelper"),r=f("./stream/DataWorker"),l=f("./utf8"),p=f("./compressedObject"),b=f("./stream/GenericWorker");o.prototype={internalStream:function(g){var a=null,h="string";try{if(!g)throw new Error("No output type specified.");var d=(h=g.toLowerCase())==="string"||h==="text";h!=="binarystring"&&h!=="text"||(h="string"),a=this._decompressWorker();var x=!this._dataBinary;x&&!d&&(a=a.pipe(new l.Utf8EncodeWorker)),!x&&d&&(a=a.pipe(new l.Utf8DecodeWorker))}catch(w){(a=new b("error")).error(w)}return new n(a,h,"")},async:function(g,a){return this.internalStream(g).accumulate(a)},nodeStream:function(g,a){return this.internalStream(g||"nodebuffer").toNodejsStream(a)},_compressWorker:function(g,a){if(this._data instanceof p&&this._data.compression.magic===g.magic)return this._data.getCompressedWorker();var h=this._decompressWorker();return this._dataBinary||(h=h.pipe(new l.Utf8EncodeWorker)),p.createWorkerFrom(h,g,a)},_decompressWorker:function(){return this._data instanceof p?this._data.getContentWorker():this._data instanceof b?this._data:new r(this._data)}};for(var v=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],u=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},s=0;s<v.length;s++)o.prototype[v[s]]=u;j.exports=o},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(f,j,y){(function(o){var n,r,l=o.MutationObserver||o.WebKitMutationObserver;if(l){var p=0,b=new l(g),v=o.document.createTextNode("");b.observe(v,{characterData:!0}),n=function(){v.data=p=++p%2}}else if(o.setImmediate||o.MessageChannel===void 0)n="document"in o&&"onreadystatechange"in o.document.createElement("script")?function(){var a=o.document.createElement("script");a.onreadystatechange=function(){g(),a.onreadystatechange=null,a.parentNode.removeChild(a),a=null},o.document.documentElement.appendChild(a)}:function(){setTimeout(g,0)};else{var u=new o.MessageChannel;u.port1.onmessage=g,n=function(){u.port2.postMessage(0)}}var s=[];function g(){var a,h;r=!0;for(var d=s.length;d;){for(h=s,s=[],a=-1;++a<d;)h[a]();d=s.length}r=!1}j.exports=function(a){s.push(a)!==1||r||n()}}).call(this,typeof ge<"u"?ge:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(f,j,y){var o=f("immediate");function n(){}var r={},l=["REJECTED"],p=["FULFILLED"],b=["PENDING"];function v(d){if(typeof d!="function")throw new TypeError("resolver must be a function");this.state=b,this.queue=[],this.outcome=void 0,d!==n&&a(this,d)}function u(d,x,w){this.promise=d,typeof x=="function"&&(this.onFulfilled=x,this.callFulfilled=this.otherCallFulfilled),typeof w=="function"&&(this.onRejected=w,this.callRejected=this.otherCallRejected)}function s(d,x,w){o(function(){var C;try{C=x(w)}catch(S){return r.reject(d,S)}C===d?r.reject(d,new TypeError("Cannot resolve promise with itself")):r.resolve(d,C)})}function g(d){var x=d&&d.then;if(d&&(typeof d=="object"||typeof d=="function")&&typeof x=="function")return function(){x.apply(d,arguments)}}function a(d,x){var w=!1;function C(T){w||(w=!0,r.reject(d,T))}function S(T){w||(w=!0,r.resolve(d,T))}var U=h(function(){x(S,C)});U.status==="error"&&C(U.value)}function h(d,x){var w={};try{w.value=d(x),w.status="success"}catch(C){w.status="error",w.value=C}return w}(j.exports=v).prototype.finally=function(d){if(typeof d!="function")return this;var x=this.constructor;return this.then(function(w){return x.resolve(d()).then(function(){return w})},function(w){return x.resolve(d()).then(function(){throw w})})},v.prototype.catch=function(d){return this.then(null,d)},v.prototype.then=function(d,x){if(typeof d!="function"&&this.state===p||typeof x!="function"&&this.state===l)return this;var w=new this.constructor(n);return this.state!==b?s(w,this.state===p?d:x,this.outcome):this.queue.push(new u(w,d,x)),w},u.prototype.callFulfilled=function(d){r.resolve(this.promise,d)},u.prototype.otherCallFulfilled=function(d){s(this.promise,this.onFulfilled,d)},u.prototype.callRejected=function(d){r.reject(this.promise,d)},u.prototype.otherCallRejected=function(d){s(this.promise,this.onRejected,d)},r.resolve=function(d,x){var w=h(g,x);if(w.status==="error")return r.reject(d,w.value);var C=w.value;if(C)a(d,C);else{d.state=p,d.outcome=x;for(var S=-1,U=d.queue.length;++S<U;)d.queue[S].callFulfilled(x)}return d},r.reject=function(d,x){d.state=l,d.outcome=x;for(var w=-1,C=d.queue.length;++w<C;)d.queue[w].callRejected(x);return d},v.resolve=function(d){return d instanceof this?d:r.resolve(new this(n),d)},v.reject=function(d){var x=new this(n);return r.reject(x,d)},v.all=function(d){var x=this;if(Object.prototype.toString.call(d)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=d.length,C=!1;if(!w)return this.resolve([]);for(var S=new Array(w),U=0,T=-1,B=new this(n);++T<w;)z(d[T],T);return B;function z(G,q){x.resolve(G).then(function(_){S[q]=_,++U!==w||C||(C=!0,r.resolve(B,S))},function(_){C||(C=!0,r.reject(B,_))})}},v.race=function(d){var x=this;if(Object.prototype.toString.call(d)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=d.length,C=!1;if(!w)return this.resolve([]);for(var S=-1,U=new this(n);++S<w;)T=d[S],x.resolve(T).then(function(B){C||(C=!0,r.resolve(U,B))},function(B){C||(C=!0,r.reject(U,B))});var T;return U}},{immediate:36}],38:[function(f,j,y){var o={};(0,f("./lib/utils/common").assign)(o,f("./lib/deflate"),f("./lib/inflate"),f("./lib/zlib/constants")),j.exports=o},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(f,j,y){var o=f("./zlib/deflate"),n=f("./utils/common"),r=f("./utils/strings"),l=f("./zlib/messages"),p=f("./zlib/zstream"),b=Object.prototype.toString,v=0,u=-1,s=0,g=8;function a(d){if(!(this instanceof a))return new a(d);this.options=n.assign({level:u,method:g,chunkSize:16384,windowBits:15,memLevel:8,strategy:s,to:""},d||{});var x=this.options;x.raw&&0<x.windowBits?x.windowBits=-x.windowBits:x.gzip&&0<x.windowBits&&x.windowBits<16&&(x.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;var w=o.deflateInit2(this.strm,x.level,x.method,x.windowBits,x.memLevel,x.strategy);if(w!==v)throw new Error(l[w]);if(x.header&&o.deflateSetHeader(this.strm,x.header),x.dictionary){var C;if(C=typeof x.dictionary=="string"?r.string2buf(x.dictionary):b.call(x.dictionary)==="[object ArrayBuffer]"?new Uint8Array(x.dictionary):x.dictionary,(w=o.deflateSetDictionary(this.strm,C))!==v)throw new Error(l[w]);this._dict_set=!0}}function h(d,x){var w=new a(x);if(w.push(d,!0),w.err)throw w.msg||l[w.err];return w.result}a.prototype.push=function(d,x){var w,C,S=this.strm,U=this.options.chunkSize;if(this.ended)return!1;C=x===~~x?x:x===!0?4:0,typeof d=="string"?S.input=r.string2buf(d):b.call(d)==="[object ArrayBuffer]"?S.input=new Uint8Array(d):S.input=d,S.next_in=0,S.avail_in=S.input.length;do{if(S.avail_out===0&&(S.output=new n.Buf8(U),S.next_out=0,S.avail_out=U),(w=o.deflate(S,C))!==1&&w!==v)return this.onEnd(w),!(this.ended=!0);S.avail_out!==0&&(S.avail_in!==0||C!==4&&C!==2)||(this.options.to==="string"?this.onData(r.buf2binstring(n.shrinkBuf(S.output,S.next_out))):this.onData(n.shrinkBuf(S.output,S.next_out)))}while((0<S.avail_in||S.avail_out===0)&&w!==1);return C===4?(w=o.deflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===v):C!==2||(this.onEnd(v),!(S.avail_out=0))},a.prototype.onData=function(d){this.chunks.push(d)},a.prototype.onEnd=function(d){d===v&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=d,this.msg=this.strm.msg},y.Deflate=a,y.deflate=h,y.deflateRaw=function(d,x){return(x=x||{}).raw=!0,h(d,x)},y.gzip=function(d,x){return(x=x||{}).gzip=!0,h(d,x)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(f,j,y){var o=f("./zlib/inflate"),n=f("./utils/common"),r=f("./utils/strings"),l=f("./zlib/constants"),p=f("./zlib/messages"),b=f("./zlib/zstream"),v=f("./zlib/gzheader"),u=Object.prototype.toString;function s(a){if(!(this instanceof s))return new s(a);this.options=n.assign({chunkSize:16384,windowBits:0,to:""},a||{});var h=this.options;h.raw&&0<=h.windowBits&&h.windowBits<16&&(h.windowBits=-h.windowBits,h.windowBits===0&&(h.windowBits=-15)),!(0<=h.windowBits&&h.windowBits<16)||a&&a.windowBits||(h.windowBits+=32),15<h.windowBits&&h.windowBits<48&&(15&h.windowBits)==0&&(h.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new b,this.strm.avail_out=0;var d=o.inflateInit2(this.strm,h.windowBits);if(d!==l.Z_OK)throw new Error(p[d]);this.header=new v,o.inflateGetHeader(this.strm,this.header)}function g(a,h){var d=new s(h);if(d.push(a,!0),d.err)throw d.msg||p[d.err];return d.result}s.prototype.push=function(a,h){var d,x,w,C,S,U,T=this.strm,B=this.options.chunkSize,z=this.options.dictionary,G=!1;if(this.ended)return!1;x=h===~~h?h:h===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof a=="string"?T.input=r.binstring2buf(a):u.call(a)==="[object ArrayBuffer]"?T.input=new Uint8Array(a):T.input=a,T.next_in=0,T.avail_in=T.input.length;do{if(T.avail_out===0&&(T.output=new n.Buf8(B),T.next_out=0,T.avail_out=B),(d=o.inflate(T,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&z&&(U=typeof z=="string"?r.string2buf(z):u.call(z)==="[object ArrayBuffer]"?new Uint8Array(z):z,d=o.inflateSetDictionary(this.strm,U)),d===l.Z_BUF_ERROR&&G===!0&&(d=l.Z_OK,G=!1),d!==l.Z_STREAM_END&&d!==l.Z_OK)return this.onEnd(d),!(this.ended=!0);T.next_out&&(T.avail_out!==0&&d!==l.Z_STREAM_END&&(T.avail_in!==0||x!==l.Z_FINISH&&x!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(w=r.utf8border(T.output,T.next_out),C=T.next_out-w,S=r.buf2string(T.output,w),T.next_out=C,T.avail_out=B-C,C&&n.arraySet(T.output,T.output,w,C,0),this.onData(S)):this.onData(n.shrinkBuf(T.output,T.next_out)))),T.avail_in===0&&T.avail_out===0&&(G=!0)}while((0<T.avail_in||T.avail_out===0)&&d!==l.Z_STREAM_END);return d===l.Z_STREAM_END&&(x=l.Z_FINISH),x===l.Z_FINISH?(d=o.inflateEnd(this.strm),this.onEnd(d),this.ended=!0,d===l.Z_OK):x!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(T.avail_out=0))},s.prototype.onData=function(a){this.chunks.push(a)},s.prototype.onEnd=function(a){a===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg},y.Inflate=s,y.inflate=g,y.inflateRaw=function(a,h){return(h=h||{}).raw=!0,g(a,h)},y.ungzip=g},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(f,j,y){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";y.assign=function(l){for(var p=Array.prototype.slice.call(arguments,1);p.length;){var b=p.shift();if(b){if(typeof b!="object")throw new TypeError(b+"must be non-object");for(var v in b)b.hasOwnProperty(v)&&(l[v]=b[v])}}return l},y.shrinkBuf=function(l,p){return l.length===p?l:l.subarray?l.subarray(0,p):(l.length=p,l)};var n={arraySet:function(l,p,b,v,u){if(p.subarray&&l.subarray)l.set(p.subarray(b,b+v),u);else for(var s=0;s<v;s++)l[u+s]=p[b+s]},flattenChunks:function(l){var p,b,v,u,s,g;for(p=v=0,b=l.length;p<b;p++)v+=l[p].length;for(g=new Uint8Array(v),p=u=0,b=l.length;p<b;p++)s=l[p],g.set(s,u),u+=s.length;return g}},r={arraySet:function(l,p,b,v,u){for(var s=0;s<v;s++)l[u+s]=p[b+s]},flattenChunks:function(l){return[].concat.apply([],l)}};y.setTyped=function(l){l?(y.Buf8=Uint8Array,y.Buf16=Uint16Array,y.Buf32=Int32Array,y.assign(y,n)):(y.Buf8=Array,y.Buf16=Array,y.Buf32=Array,y.assign(y,r))},y.setTyped(o)},{}],42:[function(f,j,y){var o=f("./common"),n=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch{n=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{r=!1}for(var l=new o.Buf8(256),p=0;p<256;p++)l[p]=252<=p?6:248<=p?5:240<=p?4:224<=p?3:192<=p?2:1;function b(v,u){if(u<65537&&(v.subarray&&r||!v.subarray&&n))return String.fromCharCode.apply(null,o.shrinkBuf(v,u));for(var s="",g=0;g<u;g++)s+=String.fromCharCode(v[g]);return s}l[254]=l[254]=1,y.string2buf=function(v){var u,s,g,a,h,d=v.length,x=0;for(a=0;a<d;a++)(64512&(s=v.charCodeAt(a)))==55296&&a+1<d&&(64512&(g=v.charCodeAt(a+1)))==56320&&(s=65536+(s-55296<<10)+(g-56320),a++),x+=s<128?1:s<2048?2:s<65536?3:4;for(u=new o.Buf8(x),a=h=0;h<x;a++)(64512&(s=v.charCodeAt(a)))==55296&&a+1<d&&(64512&(g=v.charCodeAt(a+1)))==56320&&(s=65536+(s-55296<<10)+(g-56320),a++),s<128?u[h++]=s:(s<2048?u[h++]=192|s>>>6:(s<65536?u[h++]=224|s>>>12:(u[h++]=240|s>>>18,u[h++]=128|s>>>12&63),u[h++]=128|s>>>6&63),u[h++]=128|63&s);return u},y.buf2binstring=function(v){return b(v,v.length)},y.binstring2buf=function(v){for(var u=new o.Buf8(v.length),s=0,g=u.length;s<g;s++)u[s]=v.charCodeAt(s);return u},y.buf2string=function(v,u){var s,g,a,h,d=u||v.length,x=new Array(2*d);for(s=g=0;s<d;)if((a=v[s++])<128)x[g++]=a;else if(4<(h=l[a]))x[g++]=65533,s+=h-1;else{for(a&=h===2?31:h===3?15:7;1<h&&s<d;)a=a<<6|63&v[s++],h--;1<h?x[g++]=65533:a<65536?x[g++]=a:(a-=65536,x[g++]=55296|a>>10&1023,x[g++]=56320|1023&a)}return b(x,g)},y.utf8border=function(v,u){var s;for((u=u||v.length)>v.length&&(u=v.length),s=u-1;0<=s&&(192&v[s])==128;)s--;return s<0||s===0?u:s+l[v[s]]>u?s:u}},{"./common":41}],43:[function(f,j,y){j.exports=function(o,n,r,l){for(var p=65535&o|0,b=o>>>16&65535|0,v=0;r!==0;){for(r-=v=2e3<r?2e3:r;b=b+(p=p+n[l++]|0)|0,--v;);p%=65521,b%=65521}return p|b<<16|0}},{}],44:[function(f,j,y){j.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(f,j,y){var o=(function(){for(var n,r=[],l=0;l<256;l++){n=l;for(var p=0;p<8;p++)n=1&n?3988292384^n>>>1:n>>>1;r[l]=n}return r})();j.exports=function(n,r,l,p){var b=o,v=p+l;n^=-1;for(var u=p;u<v;u++)n=n>>>8^b[255&(n^r[u])];return-1^n}},{}],46:[function(f,j,y){var o,n=f("../utils/common"),r=f("./trees"),l=f("./adler32"),p=f("./crc32"),b=f("./messages"),v=0,u=4,s=0,g=-2,a=-1,h=4,d=2,x=8,w=9,C=286,S=30,U=19,T=2*C+1,B=15,z=3,G=258,q=G+z+1,_=42,R=113,t=1,P=2,ee=3,V=4;function te(e,D){return e.msg=b[D],D}function W(e){return(e<<1)-(4<e?9:0)}function Q(e){for(var D=e.length;0<=--D;)e[D]=0}function I(e){var D=e.state,F=D.pending;F>e.avail_out&&(F=e.avail_out),F!==0&&(n.arraySet(e.output,D.pending_buf,D.pending_out,F,e.next_out),e.next_out+=F,D.pending_out+=F,e.total_out+=F,e.avail_out-=F,D.pending-=F,D.pending===0&&(D.pending_out=0))}function E(e,D){r._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,D),e.block_start=e.strstart,I(e.strm)}function X(e,D){e.pending_buf[e.pending++]=D}function K(e,D){e.pending_buf[e.pending++]=D>>>8&255,e.pending_buf[e.pending++]=255&D}function $(e,D){var F,m,c=e.max_chain_length,k=e.strstart,L=e.prev_length,O=e.nice_match,A=e.strstart>e.w_size-q?e.strstart-(e.w_size-q):0,Z=e.window,Y=e.w_mask,M=e.prev,J=e.strstart+G,ae=Z[k+L-1],ne=Z[k+L];e.prev_length>=e.good_match&&(c>>=2),O>e.lookahead&&(O=e.lookahead);do if(Z[(F=D)+L]===ne&&Z[F+L-1]===ae&&Z[F]===Z[k]&&Z[++F]===Z[k+1]){k+=2,F++;do;while(Z[++k]===Z[++F]&&Z[++k]===Z[++F]&&Z[++k]===Z[++F]&&Z[++k]===Z[++F]&&Z[++k]===Z[++F]&&Z[++k]===Z[++F]&&Z[++k]===Z[++F]&&Z[++k]===Z[++F]&&k<J);if(m=G-(J-k),k=J-G,L<m){if(e.match_start=D,O<=(L=m))break;ae=Z[k+L-1],ne=Z[k+L]}}while((D=M[D&Y])>A&&--c!=0);return L<=e.lookahead?L:e.lookahead}function se(e){var D,F,m,c,k,L,O,A,Z,Y,M=e.w_size;do{if(c=e.window_size-e.lookahead-e.strstart,e.strstart>=M+(M-q)){for(n.arraySet(e.window,e.window,M,M,0),e.match_start-=M,e.strstart-=M,e.block_start-=M,D=F=e.hash_size;m=e.head[--D],e.head[D]=M<=m?m-M:0,--F;);for(D=F=M;m=e.prev[--D],e.prev[D]=M<=m?m-M:0,--F;);c+=M}if(e.strm.avail_in===0)break;if(L=e.strm,O=e.window,A=e.strstart+e.lookahead,Z=c,Y=void 0,Y=L.avail_in,Z<Y&&(Y=Z),F=Y===0?0:(L.avail_in-=Y,n.arraySet(O,L.input,L.next_in,Y,A),L.state.wrap===1?L.adler=l(L.adler,O,Y,A):L.state.wrap===2&&(L.adler=p(L.adler,O,Y,A)),L.next_in+=Y,L.total_in+=Y,Y),e.lookahead+=F,e.lookahead+e.insert>=z)for(k=e.strstart-e.insert,e.ins_h=e.window[k],e.ins_h=(e.ins_h<<e.hash_shift^e.window[k+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[k+z-1])&e.hash_mask,e.prev[k&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=k,k++,e.insert--,!(e.lookahead+e.insert<z)););}while(e.lookahead<q&&e.strm.avail_in!==0)}function ce(e,D){for(var F,m;;){if(e.lookahead<q){if(se(e),e.lookahead<q&&D===v)return t;if(e.lookahead===0)break}if(F=0,e.lookahead>=z&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+z-1])&e.hash_mask,F=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),F!==0&&e.strstart-F<=e.w_size-q&&(e.match_length=$(e,F)),e.match_length>=z)if(m=r._tr_tally(e,e.strstart-e.match_start,e.match_length-z),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=z){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+z-1])&e.hash_mask,F=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,--e.match_length!=0;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else m=r._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(m&&(E(e,!1),e.strm.avail_out===0))return t}return e.insert=e.strstart<z-1?e.strstart:z-1,D===u?(E(e,!0),e.strm.avail_out===0?ee:V):e.last_lit&&(E(e,!1),e.strm.avail_out===0)?t:P}function re(e,D){for(var F,m,c;;){if(e.lookahead<q){if(se(e),e.lookahead<q&&D===v)return t;if(e.lookahead===0)break}if(F=0,e.lookahead>=z&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+z-1])&e.hash_mask,F=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=z-1,F!==0&&e.prev_length<e.max_lazy_match&&e.strstart-F<=e.w_size-q&&(e.match_length=$(e,F),e.match_length<=5&&(e.strategy===1||e.match_length===z&&4096<e.strstart-e.match_start)&&(e.match_length=z-1)),e.prev_length>=z&&e.match_length<=e.prev_length){for(c=e.strstart+e.lookahead-z,m=r._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-z),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=c&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+z-1])&e.hash_mask,F=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),--e.prev_length!=0;);if(e.match_available=0,e.match_length=z-1,e.strstart++,m&&(E(e,!1),e.strm.avail_out===0))return t}else if(e.match_available){if((m=r._tr_tally(e,0,e.window[e.strstart-1]))&&E(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return t}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(m=r._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<z-1?e.strstart:z-1,D===u?(E(e,!0),e.strm.avail_out===0?ee:V):e.last_lit&&(E(e,!1),e.strm.avail_out===0)?t:P}function ie(e,D,F,m,c){this.good_length=e,this.max_lazy=D,this.nice_length=F,this.max_chain=m,this.func=c}function de(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=x,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new n.Buf16(2*T),this.dyn_dtree=new n.Buf16(2*(2*S+1)),this.bl_tree=new n.Buf16(2*(2*U+1)),Q(this.dyn_ltree),Q(this.dyn_dtree),Q(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new n.Buf16(B+1),this.heap=new n.Buf16(2*C+1),Q(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new n.Buf16(2*C+1),Q(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function oe(e){var D;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=d,(D=e.state).pending=0,D.pending_out=0,D.wrap<0&&(D.wrap=-D.wrap),D.status=D.wrap?_:R,e.adler=D.wrap===2?0:1,D.last_flush=v,r._tr_init(D),s):te(e,g)}function he(e){var D=oe(e);return D===s&&(function(F){F.window_size=2*F.w_size,Q(F.head),F.max_lazy_match=o[F.level].max_lazy,F.good_match=o[F.level].good_length,F.nice_match=o[F.level].nice_length,F.max_chain_length=o[F.level].max_chain,F.strstart=0,F.block_start=0,F.lookahead=0,F.insert=0,F.match_length=F.prev_length=z-1,F.match_available=0,F.ins_h=0})(e.state),D}function ue(e,D,F,m,c,k){if(!e)return g;var L=1;if(D===a&&(D=6),m<0?(L=0,m=-m):15<m&&(L=2,m-=16),c<1||w<c||F!==x||m<8||15<m||D<0||9<D||k<0||h<k)return te(e,g);m===8&&(m=9);var O=new de;return(e.state=O).strm=e,O.wrap=L,O.gzhead=null,O.w_bits=m,O.w_size=1<<O.w_bits,O.w_mask=O.w_size-1,O.hash_bits=c+7,O.hash_size=1<<O.hash_bits,O.hash_mask=O.hash_size-1,O.hash_shift=~~((O.hash_bits+z-1)/z),O.window=new n.Buf8(2*O.w_size),O.head=new n.Buf16(O.hash_size),O.prev=new n.Buf16(O.w_size),O.lit_bufsize=1<<c+6,O.pending_buf_size=4*O.lit_bufsize,O.pending_buf=new n.Buf8(O.pending_buf_size),O.d_buf=1*O.lit_bufsize,O.l_buf=3*O.lit_bufsize,O.level=D,O.strategy=k,O.method=F,he(e)}o=[new ie(0,0,0,0,function(e,D){var F=65535;for(F>e.pending_buf_size-5&&(F=e.pending_buf_size-5);;){if(e.lookahead<=1){if(se(e),e.lookahead===0&&D===v)return t;if(e.lookahead===0)break}e.strstart+=e.lookahead,e.lookahead=0;var m=e.block_start+F;if((e.strstart===0||e.strstart>=m)&&(e.lookahead=e.strstart-m,e.strstart=m,E(e,!1),e.strm.avail_out===0)||e.strstart-e.block_start>=e.w_size-q&&(E(e,!1),e.strm.avail_out===0))return t}return e.insert=0,D===u?(E(e,!0),e.strm.avail_out===0?ee:V):(e.strstart>e.block_start&&(E(e,!1),e.strm.avail_out),t)}),new ie(4,4,8,4,ce),new ie(4,5,16,8,ce),new ie(4,6,32,32,ce),new ie(4,4,16,16,re),new ie(8,16,32,32,re),new ie(8,16,128,128,re),new ie(8,32,128,256,re),new ie(32,128,258,1024,re),new ie(32,258,258,4096,re)],y.deflateInit=function(e,D){return ue(e,D,x,15,8,0)},y.deflateInit2=ue,y.deflateReset=he,y.deflateResetKeep=oe,y.deflateSetHeader=function(e,D){return e&&e.state?e.state.wrap!==2?g:(e.state.gzhead=D,s):g},y.deflate=function(e,D){var F,m,c,k;if(!e||!e.state||5<D||D<0)return e?te(e,g):g;if(m=e.state,!e.output||!e.input&&e.avail_in!==0||m.status===666&&D!==u)return te(e,e.avail_out===0?-5:g);if(m.strm=e,F=m.last_flush,m.last_flush=D,m.status===_)if(m.wrap===2)e.adler=0,X(m,31),X(m,139),X(m,8),m.gzhead?(X(m,(m.gzhead.text?1:0)+(m.gzhead.hcrc?2:0)+(m.gzhead.extra?4:0)+(m.gzhead.name?8:0)+(m.gzhead.comment?16:0)),X(m,255&m.gzhead.time),X(m,m.gzhead.time>>8&255),X(m,m.gzhead.time>>16&255),X(m,m.gzhead.time>>24&255),X(m,m.level===9?2:2<=m.strategy||m.level<2?4:0),X(m,255&m.gzhead.os),m.gzhead.extra&&m.gzhead.extra.length&&(X(m,255&m.gzhead.extra.length),X(m,m.gzhead.extra.length>>8&255)),m.gzhead.hcrc&&(e.adler=p(e.adler,m.pending_buf,m.pending,0)),m.gzindex=0,m.status=69):(X(m,0),X(m,0),X(m,0),X(m,0),X(m,0),X(m,m.level===9?2:2<=m.strategy||m.level<2?4:0),X(m,3),m.status=R);else{var L=x+(m.w_bits-8<<4)<<8;L|=(2<=m.strategy||m.level<2?0:m.level<6?1:m.level===6?2:3)<<6,m.strstart!==0&&(L|=32),L+=31-L%31,m.status=R,K(m,L),m.strstart!==0&&(K(m,e.adler>>>16),K(m,65535&e.adler)),e.adler=1}if(m.status===69)if(m.gzhead.extra){for(c=m.pending;m.gzindex<(65535&m.gzhead.extra.length)&&(m.pending!==m.pending_buf_size||(m.gzhead.hcrc&&m.pending>c&&(e.adler=p(e.adler,m.pending_buf,m.pending-c,c)),I(e),c=m.pending,m.pending!==m.pending_buf_size));)X(m,255&m.gzhead.extra[m.gzindex]),m.gzindex++;m.gzhead.hcrc&&m.pending>c&&(e.adler=p(e.adler,m.pending_buf,m.pending-c,c)),m.gzindex===m.gzhead.extra.length&&(m.gzindex=0,m.status=73)}else m.status=73;if(m.status===73)if(m.gzhead.name){c=m.pending;do{if(m.pending===m.pending_buf_size&&(m.gzhead.hcrc&&m.pending>c&&(e.adler=p(e.adler,m.pending_buf,m.pending-c,c)),I(e),c=m.pending,m.pending===m.pending_buf_size)){k=1;break}k=m.gzindex<m.gzhead.name.length?255&m.gzhead.name.charCodeAt(m.gzindex++):0,X(m,k)}while(k!==0);m.gzhead.hcrc&&m.pending>c&&(e.adler=p(e.adler,m.pending_buf,m.pending-c,c)),k===0&&(m.gzindex=0,m.status=91)}else m.status=91;if(m.status===91)if(m.gzhead.comment){c=m.pending;do{if(m.pending===m.pending_buf_size&&(m.gzhead.hcrc&&m.pending>c&&(e.adler=p(e.adler,m.pending_buf,m.pending-c,c)),I(e),c=m.pending,m.pending===m.pending_buf_size)){k=1;break}k=m.gzindex<m.gzhead.comment.length?255&m.gzhead.comment.charCodeAt(m.gzindex++):0,X(m,k)}while(k!==0);m.gzhead.hcrc&&m.pending>c&&(e.adler=p(e.adler,m.pending_buf,m.pending-c,c)),k===0&&(m.status=103)}else m.status=103;if(m.status===103&&(m.gzhead.hcrc?(m.pending+2>m.pending_buf_size&&I(e),m.pending+2<=m.pending_buf_size&&(X(m,255&e.adler),X(m,e.adler>>8&255),e.adler=0,m.status=R)):m.status=R),m.pending!==0){if(I(e),e.avail_out===0)return m.last_flush=-1,s}else if(e.avail_in===0&&W(D)<=W(F)&&D!==u)return te(e,-5);if(m.status===666&&e.avail_in!==0)return te(e,-5);if(e.avail_in!==0||m.lookahead!==0||D!==v&&m.status!==666){var O=m.strategy===2?(function(A,Z){for(var Y;;){if(A.lookahead===0&&(se(A),A.lookahead===0)){if(Z===v)return t;break}if(A.match_length=0,Y=r._tr_tally(A,0,A.window[A.strstart]),A.lookahead--,A.strstart++,Y&&(E(A,!1),A.strm.avail_out===0))return t}return A.insert=0,Z===u?(E(A,!0),A.strm.avail_out===0?ee:V):A.last_lit&&(E(A,!1),A.strm.avail_out===0)?t:P})(m,D):m.strategy===3?(function(A,Z){for(var Y,M,J,ae,ne=A.window;;){if(A.lookahead<=G){if(se(A),A.lookahead<=G&&Z===v)return t;if(A.lookahead===0)break}if(A.match_length=0,A.lookahead>=z&&0<A.strstart&&(M=ne[J=A.strstart-1])===ne[++J]&&M===ne[++J]&&M===ne[++J]){ae=A.strstart+G;do;while(M===ne[++J]&&M===ne[++J]&&M===ne[++J]&&M===ne[++J]&&M===ne[++J]&&M===ne[++J]&&M===ne[++J]&&M===ne[++J]&&J<ae);A.match_length=G-(ae-J),A.match_length>A.lookahead&&(A.match_length=A.lookahead)}if(A.match_length>=z?(Y=r._tr_tally(A,1,A.match_length-z),A.lookahead-=A.match_length,A.strstart+=A.match_length,A.match_length=0):(Y=r._tr_tally(A,0,A.window[A.strstart]),A.lookahead--,A.strstart++),Y&&(E(A,!1),A.strm.avail_out===0))return t}return A.insert=0,Z===u?(E(A,!0),A.strm.avail_out===0?ee:V):A.last_lit&&(E(A,!1),A.strm.avail_out===0)?t:P})(m,D):o[m.level].func(m,D);if(O!==ee&&O!==V||(m.status=666),O===t||O===ee)return e.avail_out===0&&(m.last_flush=-1),s;if(O===P&&(D===1?r._tr_align(m):D!==5&&(r._tr_stored_block(m,0,0,!1),D===3&&(Q(m.head),m.lookahead===0&&(m.strstart=0,m.block_start=0,m.insert=0))),I(e),e.avail_out===0))return m.last_flush=-1,s}return D!==u?s:m.wrap<=0?1:(m.wrap===2?(X(m,255&e.adler),X(m,e.adler>>8&255),X(m,e.adler>>16&255),X(m,e.adler>>24&255),X(m,255&e.total_in),X(m,e.total_in>>8&255),X(m,e.total_in>>16&255),X(m,e.total_in>>24&255)):(K(m,e.adler>>>16),K(m,65535&e.adler)),I(e),0<m.wrap&&(m.wrap=-m.wrap),m.pending!==0?s:1)},y.deflateEnd=function(e){var D;return e&&e.state?(D=e.state.status)!==_&&D!==69&&D!==73&&D!==91&&D!==103&&D!==R&&D!==666?te(e,g):(e.state=null,D===R?te(e,-3):s):g},y.deflateSetDictionary=function(e,D){var F,m,c,k,L,O,A,Z,Y=D.length;if(!e||!e.state||(k=(F=e.state).wrap)===2||k===1&&F.status!==_||F.lookahead)return g;for(k===1&&(e.adler=l(e.adler,D,Y,0)),F.wrap=0,Y>=F.w_size&&(k===0&&(Q(F.head),F.strstart=0,F.block_start=0,F.insert=0),Z=new n.Buf8(F.w_size),n.arraySet(Z,D,Y-F.w_size,F.w_size,0),D=Z,Y=F.w_size),L=e.avail_in,O=e.next_in,A=e.input,e.avail_in=Y,e.next_in=0,e.input=D,se(F);F.lookahead>=z;){for(m=F.strstart,c=F.lookahead-(z-1);F.ins_h=(F.ins_h<<F.hash_shift^F.window[m+z-1])&F.hash_mask,F.prev[m&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=m,m++,--c;);F.strstart=m,F.lookahead=z-1,se(F)}return F.strstart+=F.lookahead,F.block_start=F.strstart,F.insert=F.lookahead,F.lookahead=0,F.match_length=F.prev_length=z-1,F.match_available=0,e.next_in=O,e.input=A,e.avail_in=L,F.wrap=k,s},y.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(f,j,y){j.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(f,j,y){j.exports=function(o,n){var r,l,p,b,v,u,s,g,a,h,d,x,w,C,S,U,T,B,z,G,q,_,R,t,P;r=o.state,l=o.next_in,t=o.input,p=l+(o.avail_in-5),b=o.next_out,P=o.output,v=b-(n-o.avail_out),u=b+(o.avail_out-257),s=r.dmax,g=r.wsize,a=r.whave,h=r.wnext,d=r.window,x=r.hold,w=r.bits,C=r.lencode,S=r.distcode,U=(1<<r.lenbits)-1,T=(1<<r.distbits)-1;e:do{w<15&&(x+=t[l++]<<w,w+=8,x+=t[l++]<<w,w+=8),B=C[x&U];t:for(;;){if(x>>>=z=B>>>24,w-=z,(z=B>>>16&255)===0)P[b++]=65535&B;else{if(!(16&z)){if((64&z)==0){B=C[(65535&B)+(x&(1<<z)-1)];continue t}if(32&z){r.mode=12;break e}o.msg="invalid literal/length code",r.mode=30;break e}G=65535&B,(z&=15)&&(w<z&&(x+=t[l++]<<w,w+=8),G+=x&(1<<z)-1,x>>>=z,w-=z),w<15&&(x+=t[l++]<<w,w+=8,x+=t[l++]<<w,w+=8),B=S[x&T];r:for(;;){if(x>>>=z=B>>>24,w-=z,!(16&(z=B>>>16&255))){if((64&z)==0){B=S[(65535&B)+(x&(1<<z)-1)];continue r}o.msg="invalid distance code",r.mode=30;break e}if(q=65535&B,w<(z&=15)&&(x+=t[l++]<<w,(w+=8)<z&&(x+=t[l++]<<w,w+=8)),s<(q+=x&(1<<z)-1)){o.msg="invalid distance too far back",r.mode=30;break e}if(x>>>=z,w-=z,(z=b-v)<q){if(a<(z=q-z)&&r.sane){o.msg="invalid distance too far back",r.mode=30;break e}if(R=d,(_=0)===h){if(_+=g-z,z<G){for(G-=z;P[b++]=d[_++],--z;);_=b-q,R=P}}else if(h<z){if(_+=g+h-z,(z-=h)<G){for(G-=z;P[b++]=d[_++],--z;);if(_=0,h<G){for(G-=z=h;P[b++]=d[_++],--z;);_=b-q,R=P}}}else if(_+=h-z,z<G){for(G-=z;P[b++]=d[_++],--z;);_=b-q,R=P}for(;2<G;)P[b++]=R[_++],P[b++]=R[_++],P[b++]=R[_++],G-=3;G&&(P[b++]=R[_++],1<G&&(P[b++]=R[_++]))}else{for(_=b-q;P[b++]=P[_++],P[b++]=P[_++],P[b++]=P[_++],2<(G-=3););G&&(P[b++]=P[_++],1<G&&(P[b++]=P[_++]))}break}}break}}while(l<p&&b<u);l-=G=w>>3,x&=(1<<(w-=G<<3))-1,o.next_in=l,o.next_out=b,o.avail_in=l<p?p-l+5:5-(l-p),o.avail_out=b<u?u-b+257:257-(b-u),r.hold=x,r.bits=w}},{}],49:[function(f,j,y){var o=f("../utils/common"),n=f("./adler32"),r=f("./crc32"),l=f("./inffast"),p=f("./inftrees"),b=1,v=2,u=0,s=-2,g=1,a=852,h=592;function d(_){return(_>>>24&255)+(_>>>8&65280)+((65280&_)<<8)+((255&_)<<24)}function x(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new o.Buf16(320),this.work=new o.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function w(_){var R;return _&&_.state?(R=_.state,_.total_in=_.total_out=R.total=0,_.msg="",R.wrap&&(_.adler=1&R.wrap),R.mode=g,R.last=0,R.havedict=0,R.dmax=32768,R.head=null,R.hold=0,R.bits=0,R.lencode=R.lendyn=new o.Buf32(a),R.distcode=R.distdyn=new o.Buf32(h),R.sane=1,R.back=-1,u):s}function C(_){var R;return _&&_.state?((R=_.state).wsize=0,R.whave=0,R.wnext=0,w(_)):s}function S(_,R){var t,P;return _&&_.state?(P=_.state,R<0?(t=0,R=-R):(t=1+(R>>4),R<48&&(R&=15)),R&&(R<8||15<R)?s:(P.window!==null&&P.wbits!==R&&(P.window=null),P.wrap=t,P.wbits=R,C(_))):s}function U(_,R){var t,P;return _?(P=new x,(_.state=P).window=null,(t=S(_,R))!==u&&(_.state=null),t):s}var T,B,z=!0;function G(_){if(z){var R;for(T=new o.Buf32(512),B=new o.Buf32(32),R=0;R<144;)_.lens[R++]=8;for(;R<256;)_.lens[R++]=9;for(;R<280;)_.lens[R++]=7;for(;R<288;)_.lens[R++]=8;for(p(b,_.lens,0,288,T,0,_.work,{bits:9}),R=0;R<32;)_.lens[R++]=5;p(v,_.lens,0,32,B,0,_.work,{bits:5}),z=!1}_.lencode=T,_.lenbits=9,_.distcode=B,_.distbits=5}function q(_,R,t,P){var ee,V=_.state;return V.window===null&&(V.wsize=1<<V.wbits,V.wnext=0,V.whave=0,V.window=new o.Buf8(V.wsize)),P>=V.wsize?(o.arraySet(V.window,R,t-V.wsize,V.wsize,0),V.wnext=0,V.whave=V.wsize):(P<(ee=V.wsize-V.wnext)&&(ee=P),o.arraySet(V.window,R,t-P,ee,V.wnext),(P-=ee)?(o.arraySet(V.window,R,t-P,P,0),V.wnext=P,V.whave=V.wsize):(V.wnext+=ee,V.wnext===V.wsize&&(V.wnext=0),V.whave<V.wsize&&(V.whave+=ee))),0}y.inflateReset=C,y.inflateReset2=S,y.inflateResetKeep=w,y.inflateInit=function(_){return U(_,15)},y.inflateInit2=U,y.inflate=function(_,R){var t,P,ee,V,te,W,Q,I,E,X,K,$,se,ce,re,ie,de,oe,he,ue,e,D,F,m,c=0,k=new o.Buf8(4),L=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!_||!_.state||!_.output||!_.input&&_.avail_in!==0)return s;(t=_.state).mode===12&&(t.mode=13),te=_.next_out,ee=_.output,Q=_.avail_out,V=_.next_in,P=_.input,W=_.avail_in,I=t.hold,E=t.bits,X=W,K=Q,D=u;e:for(;;)switch(t.mode){case g:if(t.wrap===0){t.mode=13;break}for(;E<16;){if(W===0)break e;W--,I+=P[V++]<<E,E+=8}if(2&t.wrap&&I===35615){k[t.check=0]=255&I,k[1]=I>>>8&255,t.check=r(t.check,k,2,0),E=I=0,t.mode=2;break}if(t.flags=0,t.head&&(t.head.done=!1),!(1&t.wrap)||(((255&I)<<8)+(I>>8))%31){_.msg="incorrect header check",t.mode=30;break}if((15&I)!=8){_.msg="unknown compression method",t.mode=30;break}if(E-=4,e=8+(15&(I>>>=4)),t.wbits===0)t.wbits=e;else if(e>t.wbits){_.msg="invalid window size",t.mode=30;break}t.dmax=1<<e,_.adler=t.check=1,t.mode=512&I?10:12,E=I=0;break;case 2:for(;E<16;){if(W===0)break e;W--,I+=P[V++]<<E,E+=8}if(t.flags=I,(255&t.flags)!=8){_.msg="unknown compression method",t.mode=30;break}if(57344&t.flags){_.msg="unknown header flags set",t.mode=30;break}t.head&&(t.head.text=I>>8&1),512&t.flags&&(k[0]=255&I,k[1]=I>>>8&255,t.check=r(t.check,k,2,0)),E=I=0,t.mode=3;case 3:for(;E<32;){if(W===0)break e;W--,I+=P[V++]<<E,E+=8}t.head&&(t.head.time=I),512&t.flags&&(k[0]=255&I,k[1]=I>>>8&255,k[2]=I>>>16&255,k[3]=I>>>24&255,t.check=r(t.check,k,4,0)),E=I=0,t.mode=4;case 4:for(;E<16;){if(W===0)break e;W--,I+=P[V++]<<E,E+=8}t.head&&(t.head.xflags=255&I,t.head.os=I>>8),512&t.flags&&(k[0]=255&I,k[1]=I>>>8&255,t.check=r(t.check,k,2,0)),E=I=0,t.mode=5;case 5:if(1024&t.flags){for(;E<16;){if(W===0)break e;W--,I+=P[V++]<<E,E+=8}t.length=I,t.head&&(t.head.extra_len=I),512&t.flags&&(k[0]=255&I,k[1]=I>>>8&255,t.check=r(t.check,k,2,0)),E=I=0}else t.head&&(t.head.extra=null);t.mode=6;case 6:if(1024&t.flags&&(W<($=t.length)&&($=W),$&&(t.head&&(e=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Array(t.head.extra_len)),o.arraySet(t.head.extra,P,V,$,e)),512&t.flags&&(t.check=r(t.check,P,$,V)),W-=$,V+=$,t.length-=$),t.length))break e;t.length=0,t.mode=7;case 7:if(2048&t.flags){if(W===0)break e;for($=0;e=P[V+$++],t.head&&e&&t.length<65536&&(t.head.name+=String.fromCharCode(e)),e&&$<W;);if(512&t.flags&&(t.check=r(t.check,P,$,V)),W-=$,V+=$,e)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=8;case 8:if(4096&t.flags){if(W===0)break e;for($=0;e=P[V+$++],t.head&&e&&t.length<65536&&(t.head.comment+=String.fromCharCode(e)),e&&$<W;);if(512&t.flags&&(t.check=r(t.check,P,$,V)),W-=$,V+=$,e)break e}else t.head&&(t.head.comment=null);t.mode=9;case 9:if(512&t.flags){for(;E<16;){if(W===0)break e;W--,I+=P[V++]<<E,E+=8}if(I!==(65535&t.check)){_.msg="header crc mismatch",t.mode=30;break}E=I=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),_.adler=t.check=0,t.mode=12;break;case 10:for(;E<32;){if(W===0)break e;W--,I+=P[V++]<<E,E+=8}_.adler=t.check=d(I),E=I=0,t.mode=11;case 11:if(t.havedict===0)return _.next_out=te,_.avail_out=Q,_.next_in=V,_.avail_in=W,t.hold=I,t.bits=E,2;_.adler=t.check=1,t.mode=12;case 12:if(R===5||R===6)break e;case 13:if(t.last){I>>>=7&E,E-=7&E,t.mode=27;break}for(;E<3;){if(W===0)break e;W--,I+=P[V++]<<E,E+=8}switch(t.last=1&I,E-=1,3&(I>>>=1)){case 0:t.mode=14;break;case 1:if(G(t),t.mode=20,R!==6)break;I>>>=2,E-=2;break e;case 2:t.mode=17;break;case 3:_.msg="invalid block type",t.mode=30}I>>>=2,E-=2;break;case 14:for(I>>>=7&E,E-=7&E;E<32;){if(W===0)break e;W--,I+=P[V++]<<E,E+=8}if((65535&I)!=(I>>>16^65535)){_.msg="invalid stored block lengths",t.mode=30;break}if(t.length=65535&I,E=I=0,t.mode=15,R===6)break e;case 15:t.mode=16;case 16:if($=t.length){if(W<$&&($=W),Q<$&&($=Q),$===0)break e;o.arraySet(ee,P,V,$,te),W-=$,V+=$,Q-=$,te+=$,t.length-=$;break}t.mode=12;break;case 17:for(;E<14;){if(W===0)break e;W--,I+=P[V++]<<E,E+=8}if(t.nlen=257+(31&I),I>>>=5,E-=5,t.ndist=1+(31&I),I>>>=5,E-=5,t.ncode=4+(15&I),I>>>=4,E-=4,286<t.nlen||30<t.ndist){_.msg="too many length or distance symbols",t.mode=30;break}t.have=0,t.mode=18;case 18:for(;t.have<t.ncode;){for(;E<3;){if(W===0)break e;W--,I+=P[V++]<<E,E+=8}t.lens[L[t.have++]]=7&I,I>>>=3,E-=3}for(;t.have<19;)t.lens[L[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,F={bits:t.lenbits},D=p(0,t.lens,0,19,t.lencode,0,t.work,F),t.lenbits=F.bits,D){_.msg="invalid code lengths set",t.mode=30;break}t.have=0,t.mode=19;case 19:for(;t.have<t.nlen+t.ndist;){for(;ie=(c=t.lencode[I&(1<<t.lenbits)-1])>>>16&255,de=65535&c,!((re=c>>>24)<=E);){if(W===0)break e;W--,I+=P[V++]<<E,E+=8}if(de<16)I>>>=re,E-=re,t.lens[t.have++]=de;else{if(de===16){for(m=re+2;E<m;){if(W===0)break e;W--,I+=P[V++]<<E,E+=8}if(I>>>=re,E-=re,t.have===0){_.msg="invalid bit length repeat",t.mode=30;break}e=t.lens[t.have-1],$=3+(3&I),I>>>=2,E-=2}else if(de===17){for(m=re+3;E<m;){if(W===0)break e;W--,I+=P[V++]<<E,E+=8}E-=re,e=0,$=3+(7&(I>>>=re)),I>>>=3,E-=3}else{for(m=re+7;E<m;){if(W===0)break e;W--,I+=P[V++]<<E,E+=8}E-=re,e=0,$=11+(127&(I>>>=re)),I>>>=7,E-=7}if(t.have+$>t.nlen+t.ndist){_.msg="invalid bit length repeat",t.mode=30;break}for(;$--;)t.lens[t.have++]=e}}if(t.mode===30)break;if(t.lens[256]===0){_.msg="invalid code -- missing end-of-block",t.mode=30;break}if(t.lenbits=9,F={bits:t.lenbits},D=p(b,t.lens,0,t.nlen,t.lencode,0,t.work,F),t.lenbits=F.bits,D){_.msg="invalid literal/lengths set",t.mode=30;break}if(t.distbits=6,t.distcode=t.distdyn,F={bits:t.distbits},D=p(v,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,F),t.distbits=F.bits,D){_.msg="invalid distances set",t.mode=30;break}if(t.mode=20,R===6)break e;case 20:t.mode=21;case 21:if(6<=W&&258<=Q){_.next_out=te,_.avail_out=Q,_.next_in=V,_.avail_in=W,t.hold=I,t.bits=E,l(_,K),te=_.next_out,ee=_.output,Q=_.avail_out,V=_.next_in,P=_.input,W=_.avail_in,I=t.hold,E=t.bits,t.mode===12&&(t.back=-1);break}for(t.back=0;ie=(c=t.lencode[I&(1<<t.lenbits)-1])>>>16&255,de=65535&c,!((re=c>>>24)<=E);){if(W===0)break e;W--,I+=P[V++]<<E,E+=8}if(ie&&(240&ie)==0){for(oe=re,he=ie,ue=de;ie=(c=t.lencode[ue+((I&(1<<oe+he)-1)>>oe)])>>>16&255,de=65535&c,!(oe+(re=c>>>24)<=E);){if(W===0)break e;W--,I+=P[V++]<<E,E+=8}I>>>=oe,E-=oe,t.back+=oe}if(I>>>=re,E-=re,t.back+=re,t.length=de,ie===0){t.mode=26;break}if(32&ie){t.back=-1,t.mode=12;break}if(64&ie){_.msg="invalid literal/length code",t.mode=30;break}t.extra=15&ie,t.mode=22;case 22:if(t.extra){for(m=t.extra;E<m;){if(W===0)break e;W--,I+=P[V++]<<E,E+=8}t.length+=I&(1<<t.extra)-1,I>>>=t.extra,E-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=23;case 23:for(;ie=(c=t.distcode[I&(1<<t.distbits)-1])>>>16&255,de=65535&c,!((re=c>>>24)<=E);){if(W===0)break e;W--,I+=P[V++]<<E,E+=8}if((240&ie)==0){for(oe=re,he=ie,ue=de;ie=(c=t.distcode[ue+((I&(1<<oe+he)-1)>>oe)])>>>16&255,de=65535&c,!(oe+(re=c>>>24)<=E);){if(W===0)break e;W--,I+=P[V++]<<E,E+=8}I>>>=oe,E-=oe,t.back+=oe}if(I>>>=re,E-=re,t.back+=re,64&ie){_.msg="invalid distance code",t.mode=30;break}t.offset=de,t.extra=15&ie,t.mode=24;case 24:if(t.extra){for(m=t.extra;E<m;){if(W===0)break e;W--,I+=P[V++]<<E,E+=8}t.offset+=I&(1<<t.extra)-1,I>>>=t.extra,E-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){_.msg="invalid distance too far back",t.mode=30;break}t.mode=25;case 25:if(Q===0)break e;if($=K-Q,t.offset>$){if(($=t.offset-$)>t.whave&&t.sane){_.msg="invalid distance too far back",t.mode=30;break}se=$>t.wnext?($-=t.wnext,t.wsize-$):t.wnext-$,$>t.length&&($=t.length),ce=t.window}else ce=ee,se=te-t.offset,$=t.length;for(Q<$&&($=Q),Q-=$,t.length-=$;ee[te++]=ce[se++],--$;);t.length===0&&(t.mode=21);break;case 26:if(Q===0)break e;ee[te++]=t.length,Q--,t.mode=21;break;case 27:if(t.wrap){for(;E<32;){if(W===0)break e;W--,I|=P[V++]<<E,E+=8}if(K-=Q,_.total_out+=K,t.total+=K,K&&(_.adler=t.check=t.flags?r(t.check,ee,K,te-K):n(t.check,ee,K,te-K)),K=Q,(t.flags?I:d(I))!==t.check){_.msg="incorrect data check",t.mode=30;break}E=I=0}t.mode=28;case 28:if(t.wrap&&t.flags){for(;E<32;){if(W===0)break e;W--,I+=P[V++]<<E,E+=8}if(I!==(4294967295&t.total)){_.msg="incorrect length check",t.mode=30;break}E=I=0}t.mode=29;case 29:D=1;break e;case 30:D=-3;break e;case 31:return-4;case 32:default:return s}return _.next_out=te,_.avail_out=Q,_.next_in=V,_.avail_in=W,t.hold=I,t.bits=E,(t.wsize||K!==_.avail_out&&t.mode<30&&(t.mode<27||R!==4))&&q(_,_.output,_.next_out,K-_.avail_out)?(t.mode=31,-4):(X-=_.avail_in,K-=_.avail_out,_.total_in+=X,_.total_out+=K,t.total+=K,t.wrap&&K&&(_.adler=t.check=t.flags?r(t.check,ee,K,_.next_out-K):n(t.check,ee,K,_.next_out-K)),_.data_type=t.bits+(t.last?64:0)+(t.mode===12?128:0)+(t.mode===20||t.mode===15?256:0),(X==0&&K===0||R===4)&&D===u&&(D=-5),D)},y.inflateEnd=function(_){if(!_||!_.state)return s;var R=_.state;return R.window&&(R.window=null),_.state=null,u},y.inflateGetHeader=function(_,R){var t;return _&&_.state?(2&(t=_.state).wrap)==0?s:((t.head=R).done=!1,u):s},y.inflateSetDictionary=function(_,R){var t,P=R.length;return _&&_.state?(t=_.state).wrap!==0&&t.mode!==11?s:t.mode===11&&n(1,R,P,0)!==t.check?-3:q(_,R,P,P)?(t.mode=31,-4):(t.havedict=1,u):s},y.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(f,j,y){var o=f("../utils/common"),n=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],r=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],p=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];j.exports=function(b,v,u,s,g,a,h,d){var x,w,C,S,U,T,B,z,G,q=d.bits,_=0,R=0,t=0,P=0,ee=0,V=0,te=0,W=0,Q=0,I=0,E=null,X=0,K=new o.Buf16(16),$=new o.Buf16(16),se=null,ce=0;for(_=0;_<=15;_++)K[_]=0;for(R=0;R<s;R++)K[v[u+R]]++;for(ee=q,P=15;1<=P&&K[P]===0;P--);if(P<ee&&(ee=P),P===0)return g[a++]=20971520,g[a++]=20971520,d.bits=1,0;for(t=1;t<P&&K[t]===0;t++);for(ee<t&&(ee=t),_=W=1;_<=15;_++)if(W<<=1,(W-=K[_])<0)return-1;if(0<W&&(b===0||P!==1))return-1;for($[1]=0,_=1;_<15;_++)$[_+1]=$[_]+K[_];for(R=0;R<s;R++)v[u+R]!==0&&(h[$[v[u+R]]++]=R);if(T=b===0?(E=se=h,19):b===1?(E=n,X-=257,se=r,ce-=257,256):(E=l,se=p,-1),_=t,U=a,te=R=I=0,C=-1,S=(Q=1<<(V=ee))-1,b===1&&852<Q||b===2&&592<Q)return 1;for(;;){for(B=_-te,G=h[R]<T?(z=0,h[R]):h[R]>T?(z=se[ce+h[R]],E[X+h[R]]):(z=96,0),x=1<<_-te,t=w=1<<V;g[U+(I>>te)+(w-=x)]=B<<24|z<<16|G|0,w!==0;);for(x=1<<_-1;I&x;)x>>=1;if(x!==0?(I&=x-1,I+=x):I=0,R++,--K[_]==0){if(_===P)break;_=v[u+h[R]]}if(ee<_&&(I&S)!==C){for(te===0&&(te=ee),U+=t,W=1<<(V=_-te);V+te<P&&!((W-=K[V+te])<=0);)V++,W<<=1;if(Q+=1<<V,b===1&&852<Q||b===2&&592<Q)return 1;g[C=I&S]=ee<<24|V<<16|U-a|0}}return I!==0&&(g[U+I]=_-te<<24|64<<16|0),d.bits=ee,0}},{"../utils/common":41}],51:[function(f,j,y){j.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(f,j,y){var o=f("../utils/common"),n=0,r=1;function l(c){for(var k=c.length;0<=--k;)c[k]=0}var p=0,b=29,v=256,u=v+1+b,s=30,g=19,a=2*u+1,h=15,d=16,x=7,w=256,C=16,S=17,U=18,T=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],B=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],z=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],q=new Array(2*(u+2));l(q);var _=new Array(2*s);l(_);var R=new Array(512);l(R);var t=new Array(256);l(t);var P=new Array(b);l(P);var ee,V,te,W=new Array(s);function Q(c,k,L,O,A){this.static_tree=c,this.extra_bits=k,this.extra_base=L,this.elems=O,this.max_length=A,this.has_stree=c&&c.length}function I(c,k){this.dyn_tree=c,this.max_code=0,this.stat_desc=k}function E(c){return c<256?R[c]:R[256+(c>>>7)]}function X(c,k){c.pending_buf[c.pending++]=255&k,c.pending_buf[c.pending++]=k>>>8&255}function K(c,k,L){c.bi_valid>d-L?(c.bi_buf|=k<<c.bi_valid&65535,X(c,c.bi_buf),c.bi_buf=k>>d-c.bi_valid,c.bi_valid+=L-d):(c.bi_buf|=k<<c.bi_valid&65535,c.bi_valid+=L)}function $(c,k,L){K(c,L[2*k],L[2*k+1])}function se(c,k){for(var L=0;L|=1&c,c>>>=1,L<<=1,0<--k;);return L>>>1}function ce(c,k,L){var O,A,Z=new Array(h+1),Y=0;for(O=1;O<=h;O++)Z[O]=Y=Y+L[O-1]<<1;for(A=0;A<=k;A++){var M=c[2*A+1];M!==0&&(c[2*A]=se(Z[M]++,M))}}function re(c){var k;for(k=0;k<u;k++)c.dyn_ltree[2*k]=0;for(k=0;k<s;k++)c.dyn_dtree[2*k]=0;for(k=0;k<g;k++)c.bl_tree[2*k]=0;c.dyn_ltree[2*w]=1,c.opt_len=c.static_len=0,c.last_lit=c.matches=0}function ie(c){8<c.bi_valid?X(c,c.bi_buf):0<c.bi_valid&&(c.pending_buf[c.pending++]=c.bi_buf),c.bi_buf=0,c.bi_valid=0}function de(c,k,L,O){var A=2*k,Z=2*L;return c[A]<c[Z]||c[A]===c[Z]&&O[k]<=O[L]}function oe(c,k,L){for(var O=c.heap[L],A=L<<1;A<=c.heap_len&&(A<c.heap_len&&de(k,c.heap[A+1],c.heap[A],c.depth)&&A++,!de(k,O,c.heap[A],c.depth));)c.heap[L]=c.heap[A],L=A,A<<=1;c.heap[L]=O}function he(c,k,L){var O,A,Z,Y,M=0;if(c.last_lit!==0)for(;O=c.pending_buf[c.d_buf+2*M]<<8|c.pending_buf[c.d_buf+2*M+1],A=c.pending_buf[c.l_buf+M],M++,O===0?$(c,A,k):($(c,(Z=t[A])+v+1,k),(Y=T[Z])!==0&&K(c,A-=P[Z],Y),$(c,Z=E(--O),L),(Y=B[Z])!==0&&K(c,O-=W[Z],Y)),M<c.last_lit;);$(c,w,k)}function ue(c,k){var L,O,A,Z=k.dyn_tree,Y=k.stat_desc.static_tree,M=k.stat_desc.has_stree,J=k.stat_desc.elems,ae=-1;for(c.heap_len=0,c.heap_max=a,L=0;L<J;L++)Z[2*L]!==0?(c.heap[++c.heap_len]=ae=L,c.depth[L]=0):Z[2*L+1]=0;for(;c.heap_len<2;)Z[2*(A=c.heap[++c.heap_len]=ae<2?++ae:0)]=1,c.depth[A]=0,c.opt_len--,M&&(c.static_len-=Y[2*A+1]);for(k.max_code=ae,L=c.heap_len>>1;1<=L;L--)oe(c,Z,L);for(A=J;L=c.heap[1],c.heap[1]=c.heap[c.heap_len--],oe(c,Z,1),O=c.heap[1],c.heap[--c.heap_max]=L,c.heap[--c.heap_max]=O,Z[2*A]=Z[2*L]+Z[2*O],c.depth[A]=(c.depth[L]>=c.depth[O]?c.depth[L]:c.depth[O])+1,Z[2*L+1]=Z[2*O+1]=A,c.heap[1]=A++,oe(c,Z,1),2<=c.heap_len;);c.heap[--c.heap_max]=c.heap[1],(function(ne,fe){var be,pe,xe,le,ye,Ne,me=fe.dyn_tree,Ae=fe.max_code,Ge=fe.stat_desc.static_tree,Ve=fe.stat_desc.has_stree,We=fe.stat_desc.extra_bits,Ee=fe.stat_desc.extra_base,ve=fe.stat_desc.max_length,_e=0;for(le=0;le<=h;le++)ne.bl_count[le]=0;for(me[2*ne.heap[ne.heap_max]+1]=0,be=ne.heap_max+1;be<a;be++)ve<(le=me[2*me[2*(pe=ne.heap[be])+1]+1]+1)&&(le=ve,_e++),me[2*pe+1]=le,Ae<pe||(ne.bl_count[le]++,ye=0,Ee<=pe&&(ye=We[pe-Ee]),Ne=me[2*pe],ne.opt_len+=Ne*(le+ye),Ve&&(ne.static_len+=Ne*(Ge[2*pe+1]+ye)));if(_e!==0){do{for(le=ve-1;ne.bl_count[le]===0;)le--;ne.bl_count[le]--,ne.bl_count[le+1]+=2,ne.bl_count[ve]--,_e-=2}while(0<_e);for(le=ve;le!==0;le--)for(pe=ne.bl_count[le];pe!==0;)Ae<(xe=ne.heap[--be])||(me[2*xe+1]!==le&&(ne.opt_len+=(le-me[2*xe+1])*me[2*xe],me[2*xe+1]=le),pe--)}})(c,k),ce(Z,ae,c.bl_count)}function e(c,k,L){var O,A,Z=-1,Y=k[1],M=0,J=7,ae=4;for(Y===0&&(J=138,ae=3),k[2*(L+1)+1]=65535,O=0;O<=L;O++)A=Y,Y=k[2*(O+1)+1],++M<J&&A===Y||(M<ae?c.bl_tree[2*A]+=M:A!==0?(A!==Z&&c.bl_tree[2*A]++,c.bl_tree[2*C]++):M<=10?c.bl_tree[2*S]++:c.bl_tree[2*U]++,Z=A,ae=(M=0)===Y?(J=138,3):A===Y?(J=6,3):(J=7,4))}function D(c,k,L){var O,A,Z=-1,Y=k[1],M=0,J=7,ae=4;for(Y===0&&(J=138,ae=3),O=0;O<=L;O++)if(A=Y,Y=k[2*(O+1)+1],!(++M<J&&A===Y)){if(M<ae)for(;$(c,A,c.bl_tree),--M!=0;);else A!==0?(A!==Z&&($(c,A,c.bl_tree),M--),$(c,C,c.bl_tree),K(c,M-3,2)):M<=10?($(c,S,c.bl_tree),K(c,M-3,3)):($(c,U,c.bl_tree),K(c,M-11,7));Z=A,ae=(M=0)===Y?(J=138,3):A===Y?(J=6,3):(J=7,4)}}l(W);var F=!1;function m(c,k,L,O){K(c,(p<<1)+(O?1:0),3),(function(A,Z,Y,M){ie(A),X(A,Y),X(A,~Y),o.arraySet(A.pending_buf,A.window,Z,Y,A.pending),A.pending+=Y})(c,k,L)}y._tr_init=function(c){F||((function(){var k,L,O,A,Z,Y=new Array(h+1);for(A=O=0;A<b-1;A++)for(P[A]=O,k=0;k<1<<T[A];k++)t[O++]=A;for(t[O-1]=A,A=Z=0;A<16;A++)for(W[A]=Z,k=0;k<1<<B[A];k++)R[Z++]=A;for(Z>>=7;A<s;A++)for(W[A]=Z<<7,k=0;k<1<<B[A]-7;k++)R[256+Z++]=A;for(L=0;L<=h;L++)Y[L]=0;for(k=0;k<=143;)q[2*k+1]=8,k++,Y[8]++;for(;k<=255;)q[2*k+1]=9,k++,Y[9]++;for(;k<=279;)q[2*k+1]=7,k++,Y[7]++;for(;k<=287;)q[2*k+1]=8,k++,Y[8]++;for(ce(q,u+1,Y),k=0;k<s;k++)_[2*k+1]=5,_[2*k]=se(k,5);ee=new Q(q,T,v+1,u,h),V=new Q(_,B,0,s,h),te=new Q(new Array(0),z,0,g,x)})(),F=!0),c.l_desc=new I(c.dyn_ltree,ee),c.d_desc=new I(c.dyn_dtree,V),c.bl_desc=new I(c.bl_tree,te),c.bi_buf=0,c.bi_valid=0,re(c)},y._tr_stored_block=m,y._tr_flush_block=function(c,k,L,O){var A,Z,Y=0;0<c.level?(c.strm.data_type===2&&(c.strm.data_type=(function(M){var J,ae=4093624447;for(J=0;J<=31;J++,ae>>>=1)if(1&ae&&M.dyn_ltree[2*J]!==0)return n;if(M.dyn_ltree[18]!==0||M.dyn_ltree[20]!==0||M.dyn_ltree[26]!==0)return r;for(J=32;J<v;J++)if(M.dyn_ltree[2*J]!==0)return r;return n})(c)),ue(c,c.l_desc),ue(c,c.d_desc),Y=(function(M){var J;for(e(M,M.dyn_ltree,M.l_desc.max_code),e(M,M.dyn_dtree,M.d_desc.max_code),ue(M,M.bl_desc),J=g-1;3<=J&&M.bl_tree[2*G[J]+1]===0;J--);return M.opt_len+=3*(J+1)+5+5+4,J})(c),A=c.opt_len+3+7>>>3,(Z=c.static_len+3+7>>>3)<=A&&(A=Z)):A=Z=L+5,L+4<=A&&k!==-1?m(c,k,L,O):c.strategy===4||Z===A?(K(c,2+(O?1:0),3),he(c,q,_)):(K(c,4+(O?1:0),3),(function(M,J,ae,ne){var fe;for(K(M,J-257,5),K(M,ae-1,5),K(M,ne-4,4),fe=0;fe<ne;fe++)K(M,M.bl_tree[2*G[fe]+1],3);D(M,M.dyn_ltree,J-1),D(M,M.dyn_dtree,ae-1)})(c,c.l_desc.max_code+1,c.d_desc.max_code+1,Y+1),he(c,c.dyn_ltree,c.dyn_dtree)),re(c),O&&ie(c)},y._tr_tally=function(c,k,L){return c.pending_buf[c.d_buf+2*c.last_lit]=k>>>8&255,c.pending_buf[c.d_buf+2*c.last_lit+1]=255&k,c.pending_buf[c.l_buf+c.last_lit]=255&L,c.last_lit++,k===0?c.dyn_ltree[2*L]++:(c.matches++,k--,c.dyn_ltree[2*(t[L]+v+1)]++,c.dyn_dtree[2*E(k)]++),c.last_lit===c.lit_bufsize-1},y._tr_align=function(c){K(c,2,3),$(c,w,q),(function(k){k.bi_valid===16?(X(k,k.bi_buf),k.bi_buf=0,k.bi_valid=0):8<=k.bi_valid&&(k.pending_buf[k.pending++]=255&k.bi_buf,k.bi_buf>>=8,k.bi_valid-=8)})(c)}},{"../utils/common":41}],53:[function(f,j,y){j.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(f,j,y){(function(o){(function(n,r){if(!n.setImmediate){var l,p,b,v,u=1,s={},g=!1,a=n.document,h=Object.getPrototypeOf&&Object.getPrototypeOf(n);h=h&&h.setTimeout?h:n,l={}.toString.call(n.process)==="[object process]"?function(C){process.nextTick(function(){x(C)})}:(function(){if(n.postMessage&&!n.importScripts){var C=!0,S=n.onmessage;return n.onmessage=function(){C=!1},n.postMessage("","*"),n.onmessage=S,C}})()?(v="setImmediate$"+Math.random()+"$",n.addEventListener?n.addEventListener("message",w,!1):n.attachEvent("onmessage",w),function(C){n.postMessage(v+C,"*")}):n.MessageChannel?((b=new MessageChannel).port1.onmessage=function(C){x(C.data)},function(C){b.port2.postMessage(C)}):a&&"onreadystatechange"in a.createElement("script")?(p=a.documentElement,function(C){var S=a.createElement("script");S.onreadystatechange=function(){x(C),S.onreadystatechange=null,p.removeChild(S),S=null},p.appendChild(S)}):function(C){setTimeout(x,0,C)},h.setImmediate=function(C){typeof C!="function"&&(C=new Function(""+C));for(var S=new Array(arguments.length-1),U=0;U<S.length;U++)S[U]=arguments[U+1];var T={callback:C,args:S};return s[u]=T,l(u),u++},h.clearImmediate=d}function d(C){delete s[C]}function x(C){if(g)setTimeout(x,0,C);else{var S=s[C];if(S){g=!0;try{(function(U){var T=U.callback,B=U.args;switch(B.length){case 0:T();break;case 1:T(B[0]);break;case 2:T(B[0],B[1]);break;case 3:T(B[0],B[1],B[2]);break;default:T.apply(r,B)}})(S)}finally{d(C),g=!1}}}}function w(C){C.source===n&&typeof C.data=="string"&&C.data.indexOf(v)===0&&x(+C.data.slice(v.length))}})(typeof self>"u"?o===void 0?this:o:self)}).call(this,typeof ge<"u"?ge:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Ce)),Ce.exports}var at=it();const Ue=Re(at),mt=async N=>{const H=N.flatMap((n,r)=>n.images.map((l,p)=>({url:l,filename:`${String(r+1).padStart(3,"0")}_${String(p+1).padStart(2,"0")}`})));if(H.length===0){alert("No images to download.");return}const f=new Ue;let j=0,y=0;if(await Promise.all(H.map(async n=>{var r;try{const l=await fetch(n.url);if(!l.ok)throw new Error(`Failed to fetch image: ${n.url} with status ${l.status}`);const p=await l.blob(),b=((r=n.url.split(".").pop())==null?void 0:r.split("?")[0])||"jpg";f.file(`${n.filename}.${b}`,p),j++}catch(l){console.error(`Skipping file due to error: ${n.url}`,l),y++}})),j===0)throw new Error("All image downloads failed.");y>0&&alert(`Warning: Could not download ${y} images.`);const o=await f.generateAsync({type:"blob"});De(o,"storyboard-images.zip")},gt=async N=>{const H=N.flatMap((n,r)=>{const l=String(r+1).padStart(3,"0");return(n.videos||[]).map((p,b)=>{const v=(n.videos||[]).length>1?`_v${b+1}`:"";return{url:p.url,filename:`${l}${v}`}})});if(H.length===0){alert("No videos to download.");return}const f=new Ue;let j=0,y=0;if(await Promise.all(H.map(async n=>{var r;try{const l=await fetch(n.url);if(!l.ok)throw new Error(`Fetch failed with status ${l.status}`);const p=await l.blob(),b=((r=n.url.split(".").pop())==null?void 0:r.split("?")[0])||"mp4";f.file(`${n.filename}.${b}`,p),j++}catch(l){console.error(`Skipping video due to error: ${n.url}`,l),y++}})),j===0)throw new Error("All video downloads failed.");y>0&&alert(`Warning: Could not download ${y} videos.`);const o=await f.generateAsync({type:"blob"});De(o,"storyboard-videos.zip")};function ke(N,H,f){for(let j=0;j<f.length;j++)N.setUint8(H+j,f.charCodeAt(j))}function st(N,H,f,j){const y=N.length,o=new ArrayBuffer(44+y),n=new DataView(o);ke(n,0,"RIFF"),n.setUint32(4,36+y,!0),ke(n,8,"WAVE"),ke(n,12,"fmt "),n.setUint32(16,16,!0),n.setUint16(20,1,!0),n.setUint16(22,H,!0),n.setUint32(24,f,!0);const r=f*H*(j/8);n.setUint32(28,r,!0);const l=H*(j/8);return n.setUint16(32,l,!0),n.setUint16(34,j,!0),ke(n,36,"data"),n.setUint32(40,y,!0),new Uint8Array(o,44).set(N),new Blob([n],{type:"audio/wav"})}function ot(N){const H=atob(N),f=H.length,j=new Uint8Array(f);for(let y=0;y<f;y++)j[y]=H.charCodeAt(y);return j}function bt(N){const H=ot(N);return st(H,1,24e3,16)}const Le=async N=>await(await fetch(N)).blob(),lt=async(N,H)=>{const f=new FormData,j=[];await Promise.all(N.map(async(n,r)=>{const l=await Le(n.url),p=`file_${r}`,b=n.fileName||`${n.type}_${Date.now()}.${l.type.split("/")[1]||"tmp"}`;f.append(p,l,b),j.push({type:n.type,media:`attach://${p}`,caption:r===0?n.caption:void 0})})),f.append("chat_id",H.chatId),H.topicId&&f.append("message_thread_id",H.topicId),f.append("media",JSON.stringify(j));const y=`https://api.telegram.org/bot${H.botToken}/sendMediaGroup`,o=await fetch(y,{method:"POST",body:f});if(!o.ok){const n=await o.json();throw new Error(`Telegram API Error: ${n.description||o.statusText}`)}return o.json()},Be=async(N,H)=>{const f=new FormData,j=await Le(N.url),y=N.fileName||`${N.type}_${Date.now()}.${j.type.split("/")[1]||"tmp"}`;f.append(N.type,j,y),f.append("chat_id",H.chatId),H.topicId&&f.append("message_thread_id",H.topicId),f.append("caption",N.caption);const o=N.type==="photo"?"sendPhoto":"sendVideo",n=`https://api.telegram.org/bot${H.botToken}/${o}`,r=await fetch(n,{method:"POST",body:f});if(!r.ok){const l=await r.json();throw new Error(`Telegram API Error: ${l.description||r.statusText}`)}return r.json()},xt={async sendMedia(N){const H=Me.getTelegramConfig();if(!H.botToken||!H.chatId)throw new Error("Telegram Bot Token and Chat ID must be configured in Settings.");if(N.length===0)return;if(N.length===1){await Be(N[0],H);return}const f=[];for(let j=0;j<N.length;j+=10)f.push(N.slice(j,j+10));for(const j of f)j.length>1?await lt(j,H):j.length===1&&await Be(j[0],H)}};export{ut as O,ht as S,Ie as U,rt as V,gt as a,bt as c,mt as d,pt as r,De as s,xt as t,ft as u};

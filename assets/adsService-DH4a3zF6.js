import{M as y,T as h}from"./streetInterviewPrompts-Dzu83YwK.js";import{k as p,l as k}from"./lehuyducanhService-B9F-RCut.js";var m=(e=>(e.Face="Face",e.Back="Back",e.Stomach="Stomach",e))(m||{}),I=(e=>(e.Female="Female",e.Male="Male",e))(I||{});const A="cdNTtad8Utz3UZaTJPVbQCwL",S={type:h.OBJECT,properties:{imageType:{type:h.STRING,description:"Type of image (e.g., static, carousel screenshot, lifestyle, product-focused)."},layout:{type:h.STRING,description:"Composition and layout (e.g., rule of thirds, centered, asymmetrical)."},tone:{type:h.STRING,description:"Overall mood and tone (e.g., vibrant, professional, minimalist, urgent)."},lighting:{type:h.STRING,description:"Lighting style (e.g., high-key, dramatic shadows, soft natural light)."},subjectRatio:{type:h.STRING,description:"Ratio of main subject to background (e.g., 70% subject, 30% background)."},background:{type:h.STRING,description:"Detailed description of the background elements, colors, and textures."},mainSubject:{type:h.STRING,description:"Detailed description of the main subject (person or object), including appearance, clothing, pose, action, and facial expression if applicable."},textLayer:{type:h.STRING,description:"Analysis of any text, including content, font style, color, and placement."}},required:["imageType","layout","tone","lighting","subjectRatio","background","mainSubject","textLayer"]},P=async e=>{const o=p(),n={inlineData:{mimeType:"image/jpeg",data:e.split(",")[1]}},t={text:"Analyze this advertising image in detail based on the provided schema. Provide a comprehensive analysis for each field. If the main subject is a person, pay special attention to their gestures, actions, and facial expressions, describing them in detail to allow for the most accurate recreation possible."};try{const r=(await o.models.generateContent({model:"gemini-2.5-pro",contents:{parts:[n,t]},config:{responseMimeType:"application/json",responseSchema:S}})).text.trim();return JSON.parse(r)}catch(a){throw console.error("Error analyzing ad image:",a),new Error("Failed to analyze image. The model may have returned an invalid format.")}},v=async(e,o)=>{const n=p();try{const t=await n.models.generateImages({model:"imagen-4.0-generate-001",prompt:e,config:{numberOfImages:1,outputMimeType:"image/png",aspectRatio:o||"1:1"}});if(t.generatedImages&&t.generatedImages.length>0)return`data:image/png;base64,${t.generatedImages[0].image.imageBytes}`;throw new Error("No image data found in Imagen response.")}catch(t){throw console.error("Error generating image with Imagen:",t),new Error("Failed to generate image from prompt.")}},E=async(e,o,n)=>{if(e==="gemini")return v(o,n);{const t={"1:1":"IMAGE_ASPECT_RATIO_SQUARE","9:16":"IMAGE_ASPECT_RATIO_PORTRAIT","16:9":"IMAGE_ASPECT_RATIO_LANDSCAPE"},[a]=await k({prompt:o,aspectRatio:n?t[n]:"IMAGE_ASPECT_RATIO_SQUARE"});if(!a)throw new Error("Lehuyducanh API did not return an image URL.");return a}},B=(e,o,n)=>E(e,o,n),N=(e,o)=>E(e,o,"1:1"),O=async(e,o)=>{var t;const n=p();try{const[a,r]=e.split(",");if(!a||!r)throw new Error("Invalid Data URL format");const c=(t=a.split(":")[1])==null?void 0:t.split(";")[0];if(!c)throw new Error("Could not determine MIME type from Data URL");const d=[{inlineData:{mimeType:c,data:r}},{text:o}],l=await n.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:d},config:{responseModalities:[y.IMAGE]}});for(const i of l.candidates[0].content.parts)if(i.inlineData)return`data:${i.inlineData.mimeType};base64,${i.inlineData.data}`;throw new Error("No edited image data found in response.")}catch(a){throw console.error("Error editing image:",a),new Error("Failed to edit image.")}},F=async e=>{const o=p(),n=`Based on the following landing page content, generate 5 compelling and concise ad headlines or calls-to-action (CTAs). Each should be on a new line.

Landing Page Content:
---
${e}
---`;try{return(await o.models.generateContent({model:"gemini-2.5-flash",contents:{parts:[{text:n}]}})).text.trim().split(`
`).map(r=>r.replace(/^- /,"")).filter(r=>r)}catch(t){throw console.error("Error generating ad copy:",t),new Error("Failed to generate ad copy.")}},$=(e,o)=>{const n=atob(e),t=new Array(n.length);for(let r=0;r<n.length;r++)t[r]=n.charCodeAt(r);const a=new Uint8Array(t);return new Blob([a],{type:o})},x=e=>{let o="";const n=new Uint8Array(e),t=n.byteLength;for(let a=0;a<t;a++)o+=String.fromCharCode(n[a]);return window.btoa(o)},L=async e=>{var c,d,l;const[o,n]=e.split(",");if(!o||!n)throw new Error("Invalid Data URL format");const t=(c=o.split(":")[1])==null?void 0:c.split(";")[0];if(!t)throw new Error("Could not determine MIME type from Data URL");const a=$(n,t),r=new FormData;r.append("size","auto"),r.append("image_file",a,"image.png");try{const i=await fetch("https://api.remove.bg/v1.0/removebg",{method:"POST",headers:{"X-Api-Key":A},body:r});if(i.ok){const s=await i.arrayBuffer();return x(s)}else{const s=await i.text();console.error("Failed to remove background using remove.bg. API Response:",s);try{const g=((l=(d=JSON.parse(s).errors)==null?void 0:d[0])==null?void 0:l.title)||`Status: ${i.status}`;throw new Error(`Failed to remove background. ${g}`)}catch{throw new Error(`Failed to remove background. Status: ${i.status} ${i.statusText}`)}}}catch(i){throw console.error("Error calling remove.bg API:",i),i instanceof Error?i:new Error("Failed to remove background due to a network or API error.")}},U=async(e,o,n,t,a)=>{const r=p();try{const c={inlineData:{mimeType:"image/jpeg",data:e.split(",")[1]}},d={inlineData:{mimeType:"image/jpeg",data:o.split(",")[1]}},l=`You are a professional ad designer. Your task is to create a new, complete advertisement image with a strict ${a} aspect ratio.

**INSTRUCTIONS:**

1.  **STYLE REFERENCE (First Image):** The first image is a competitor's ad. Use it as a style reference. Analyze its background style, color palette, lighting, and typography style. The new ad's background and text MUST match this style.
    *   **Background Style Hint:** ${t.background}
    *   **Lighting Style Hint:** ${t.lighting}
    *   **Typography Style Hint:** ${t.textLayer}

2.  **NEW SUBJECT (Second Image):** The second image is the new product. This is the HERO of the new ad. Place this product prominently in the new composition.

3.  **NEW HEADLINE:** The main headline on the new ad MUST be exactly: "${n}"

4.  **COMPOSITION:** Create a clean, visually appealing composition that combines the new product and the new headline, all within the aesthetic of the competitor's ad. The final result must be a single, cohesive advertisement image with a ${a} aspect ratio. Do NOT include any subjects or products from the first reference image.
`,i=await r.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:[c,d,{text:l}]},config:{responseModalities:[y.IMAGE]}});for(const s of i.candidates[0].content.parts)if(s.inlineData)return`data:${s.inlineData.mimeType};base64,${s.inlineData.data}`;throw new Error("No composite image data found in response.")}catch(c){throw console.error("Error generating composite ad:",c),new Error("Failed to generate composite ad.")}},T=e=>new Promise((o,n)=>{const t=new FileReader;t.readAsDataURL(e),t.onload=()=>o(t.result.split(",")[1]),t.onerror=a=>n(a)}),R=(e,o,n,t,a,r)=>{const c=t?"the person from the second provided image (the character reference)":n===I.Male?"a male model":"a female model",l=`Generate a photorealistic image for a social media ad.
Instructions:
- The scene must feature a person holding the product from the first provided image.
${a?`- The product's size is described as: ${a}. Ensure it's held realistically according to this size.`:""}
- The person in the image should be ${c}.
- The overall style should be clean, professional, and photorealistic, with a minimalist indoor setting and soft, natural lighting.
- Ensure the product is clearly visible.
`,i=`as if written directly onto the skin. The writing must look hyper-realistic and seamlessly integrated with the skin:
- The color of the text should be a dark, natural-looking ink (like a dark brown or slightly faded black), not a harsh, pure black. The color should subtly blend with the skin tone and the overall lighting of the image.
- The writing must follow the natural contours, curves, and texture of the skin perfectly.
- The ink should have slight variations in density and feathering at the edges, just like real ink would on skin.
- It must absolutely avoid looking like a flat, digital graphic pasted on top.`;let s="";if(r==="Holding Product Over Shoulder"&&o===m.Back)return s=`The image is shot from behind the person's back, focusing on their shoulder and upper back. They are holding the product bottle up over their shoulder with one hand, so the bottle is visible next to their head and neck. On their shoulder blade, the words "${e}" are written ${i}.`,`${s} ${l}`;switch(o){case m.Face:return`On the person's cheek, the words "${e}" are written ${i}. The person is shown in a profile view to clearly display the text and the product. ${l}`;case m.Back:return`The image shows the person's back. On their shoulder blade, the words "${e}" are written ${i}. The product is held in a way that it's visible next to them. ${l}`;case m.Stomach:return`The image focuses on the person's midsection. On their stomach, the words "${e}" are written ${i}. The product is held near their waist. ${l}`;default:return`On the person's cheek, the words "${e}" are written ${i}. ${l}`}},G=async(e,o,n,t,a,r,c)=>{var g,w,b;const d=p(),l=R(o,n,t,!!a,r,c),s=[{inlineData:{data:await T(e),mimeType:e.type}}];if(a){const u=await T(a);s.push({inlineData:{data:u,mimeType:a.type}})}s.push({text:l});const f=await d.models.generateContent({model:"gemini-2.5-flash-image",contents:{parts:s},config:{responseModalities:[y.IMAGE]}});for(const u of((b=(w=(g=f.candidates)==null?void 0:g[0])==null?void 0:w.content)==null?void 0:b.parts)||[])if(u.inlineData)return`data:image/png;base64,${u.inlineData.data}`;throw new Error("No image was generated by the API.")};export{m as B,I as G,B as a,N as b,F as c,U as d,O as e,P as f,G as g,L as r};

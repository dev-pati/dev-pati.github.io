import{r as i,j as e}from"./index-WZ944UgW.js";import{u as N,U as M,g as qe,a as Ca,b as Ga,s as Aa,r as ue,c as Pa,t as _e,d as Ta,e as Ea,O as Ua,S as Fa}from"./telegramService-Ba9-Zoq2.js";import{I as Ne}from"./ImageUpload-DksvPInp.js";import{h as Ha,i as Da,m as We,c as Oa,j as $a,I as Ba}from"./lehuyducanhService-p9mbsEAy.js";import{r as ae,i as La,f as Ve,d as ke}from"./media-CDZXYBSY.js";import{s as Ye}from"./settingsService-CbIZ9NBp.js";import"./streetInterviewPrompts-Dzu83YwK.js";const Ce=[{value:"Kore",label:"Kore (Female)"},{value:"Puck",label:"Puck (Male)"},{value:"Charon",label:"Charon (Male)"},{value:"Fenrir",label:"Fenrir (Male)"},{value:"Zephyr",label:"Zephyr (Male)"}],Ma=u=>{const{numHosts:S,setNumHosts:x,hostOneImage:V,setHostOneImage:f,hostTwoImage:T,setHostTwoImage:b,podcastTopic:z,setPodcastTopic:k,pastedScript:R,setPastedScript:C,onGenerateScript:E,isGeneratingScript:c,onAnalyzeScript:d,isAnalyzingScript:q,reporterVoice:te,setReporterVoice:oe,intervieweeVoice:m,setIntervieweeVoice:A,environmentImage:U,setEnvironmentImage:se,environmentVariationsCount:ne,setEnvironmentVariationsCount:re,onGenerateEnvironments:ie,isGeneratingEnvironments:G,globalVoiceInstruction:le,setGlobalVoiceInstruction:ce,videoAspectRatio:F,setVideoAspectRatio:de,singleHostSetting:H,setSingleHostSetting:ge,backgroundPrompt:pe,setBackgroundPrompt:he,onViewImage:_}=u,[w,me]=i.useState("custom"),[D,W]=i.useState("generate"),fe=!!V&&(S===1||!!T)&&!!z,Y=(!!V&&(S===1||!!T)||!!U)&&!!R,O=S===1&&H==="stage"?"Stage":"Studio";return e.jsxs("div",{className:"bg-gray-800 p-6 rounded-2xl border border-gray-700 shadow-lg flex flex-col gap-6",children:[e.jsxs("div",{className:"flex mb-2 border-b-2 border-gray-700",children:[e.jsxs("button",{onClick:()=>me("custom"),className:`flex-1 text-center font-bold py-3 transition-all duration-300 flex items-center justify-center gap-2 ${w==="custom"?"text-blue-400 border-b-4 border-blue-500":"text-gray-400 hover:text-white"}`,children:[e.jsx("i",{className:"fas fa-tools"})," Custom Setup"]}),e.jsxs("button",{onClick:()=>me("quick-start"),className:`flex-1 text-center font-bold py-3 transition-all duration-300 flex items-center justify-center gap-2 ${w==="quick-start"?"text-yellow-400 border-b-4 border-yellow-500":"text-gray-400 hover:text-white"}`,children:[e.jsx("i",{className:"fas fa-bolt"})," Quick Start"]})]}),w==="custom"&&e.jsxs("div",{className:"flex flex-col gap-6 animate-fade-in",children:[e.jsxs("h3",{className:"text-xl font-bold text-blue-400 -mb-2",children:[e.jsx("i",{className:"fas fa-users mr-2"}),"Cast"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-md font-bold text-gray-300 mb-2",children:"Number of Hosts"}),e.jsxs("div",{className:"flex gap-2 bg-gray-900 border-2 border-gray-600 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>x(1),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${S===1?"bg-blue-600":"bg-transparent text-gray-400 hover:bg-gray-700"}`,children:"1 Host"}),e.jsx("button",{onClick:()=>x(2),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${S===2?"bg-blue-600":"bg-transparent text-gray-400 hover:bg-gray-700"}`,children:"2 Hosts"})]})]}),S===1&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-md font-bold text-gray-300 mb-2",children:"Host Setting"}),e.jsxs("div",{className:"flex gap-2 bg-gray-900 border-2 border-gray-600 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>ge("studio"),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${H==="studio"?"bg-blue-600":"bg-transparent text-gray-400 hover:bg-gray-700"}`,children:"In Studio"}),e.jsx("button",{onClick:()=>ge("stage"),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${H==="stage"?"bg-blue-600":"bg-transparent text-gray-400 hover:bg-gray-700"}`,children:"On Stage"})]})]}),e.jsx(Ne,{id:"podcast-host-1-image",label:S===1?"Host Image":"Host 1 Image",file:V,onFileChange:f,onViewImage:_}),S===2&&e.jsx(Ne,{id:"podcast-host-2-image",label:"Host 2 Image",file:T,onFileChange:b,onViewImage:_}),e.jsx("div",{className:"border-t-2 border-gray-700 -mx-6"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-400 mb-2",children:[e.jsx("i",{className:"fas fa-image mr-2"}),O," / Set"]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"background-prompt",className:"block text-sm font-bold text-gray-300 mb-1",children:"Generate with AI using a prompt"}),e.jsx("input",{id:"background-prompt",type:"text",value:pe,onChange:l=>he(l.target.value),placeholder:"e.g., minimalist, wooden textures...",className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-2 text-gray-200"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"env-count",className:"block text-sm font-bold text-gray-300 mb-1",children:"Number of Camera Angles"}),e.jsx("input",{id:"env-count",type:"number",min:"1",max:"10",value:ne,onChange:l=>re(parseInt(l.target.value,10)),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-2 text-gray-200"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"aspect-ratio-podcast",className:"block text-sm font-bold text-gray-300 mb-1",children:"Video Aspect Ratio"}),e.jsxs("select",{id:"aspect-ratio-podcast",value:F,onChange:l=>de(l.target.value),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-2 text-gray-200",children:[e.jsx("option",{value:"16:9",children:"16:9 (Landscape)"}),e.jsx("option",{value:"9:16",children:"9:16 (Portrait)"})]})]}),e.jsx("button",{onClick:ie,disabled:G||!V,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-full disabled:opacity-50",title:V?`Generate ${O} Scene Variations`:"Please upload at least one host image",children:G?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"})," Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-camera-retro"})," Generate ",O," Scenes"]})})]})]}),w==="quick-start"&&e.jsxs("div",{className:"flex flex-col gap-6 animate-fade-in",children:[e.jsx("div",{className:"bg-yellow-900/30 border border-yellow-700/50 p-3 rounded-lg text-center text-yellow-200 text-sm",children:e.jsxs("p",{children:[e.jsx("i",{className:"fas fa-bolt mr-2"}),"Upload a finalized photo of you in the studio. We'll use it for everything."]})}),e.jsx(Ne,{id:"environment-image",label:"Master Shot (You in Studio)",file:U,onFileChange:se,onViewImage:_}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"aspect-ratio-podcast-quick",className:"block text-sm font-bold text-gray-300 mb-1",children:"Video Size"}),e.jsxs("select",{id:"aspect-ratio-podcast-quick",value:F,onChange:l=>de(l.target.value),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-2 text-gray-200",children:[e.jsx("option",{value:"16:9",children:"16:9 (Landscape)"}),e.jsx("option",{value:"9:16",children:"9:16 (Portrait)"})]})]})]}),e.jsx("div",{className:"border-t-2 border-gray-700 -mx-6"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-400 mb-2",children:[e.jsx("i",{className:"fas fa-cog mr-2"}),"Audio & Video"]}),S===1?e.jsxs("div",{children:[e.jsx("label",{htmlFor:"podcast-tts-voice",className:"block text-md font-bold text-gray-300 mb-2",children:"Host's Voice"}),e.jsx("select",{id:"podcast-tts-voice",value:te,onChange:l=>oe(l.target.value),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200",children:Ce.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"reporter-voice",className:"block text-md font-bold text-gray-300 mb-2",children:"Host 1's Voice"}),e.jsx("select",{id:"reporter-voice",value:te,onChange:l=>oe(l.target.value),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200",children:Ce.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"interviewee-voice",className:"block text-md font-bold text-gray-300 mb-2",children:"Host 2's Voice"}),e.jsx("select",{id:"interviewee-voice",value:m,onChange:l=>A(l.target.value),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200",children:Ce.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"global-voice-instruction",className:"block text-md font-bold text-gray-300 mb-2",children:"Global Voice Instruction (Optional)"}),e.jsx("textarea",{id:"global-voice-instruction",value:le,onChange:l=>ce(l.target.value),placeholder:"e.g., Speak in a warm, friendly, and engaging tone.",className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200",rows:2})]})]}),e.jsx("div",{className:"border-t-2 border-gray-700 -mx-6"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-400 mb-4",children:[e.jsx("i",{className:"fas fa-file-alt mr-2"}),"Scripting"]}),e.jsxs("div",{className:"flex gap-1 bg-gray-900 border-2 border-gray-600 rounded-lg p-1 mb-4",children:[e.jsx("button",{onClick:()=>W("generate"),disabled:w==="quick-start",className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${D==="generate"&&w!=="quick-start"?"bg-blue-600":"bg-transparent text-gray-400 hover:bg-gray-700"} ${w==="quick-start"?"opacity-50 cursor-not-allowed":""}`,children:"Generate"}),e.jsx("button",{onClick:()=>W("paste"),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${D==="paste"?"bg-blue-600":"bg-transparent text-gray-400 hover:bg-gray-700"}`,children:"Paste"})]}),D==="generate"&&w==="custom"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{htmlFor:"podcast-topic",className:"block text-md font-bold text-gray-300",children:"Podcast Topic"}),e.jsx("input",{id:"podcast-topic",type:"text",value:z,onChange:l=>k(l.target.value),placeholder:"e.g., The future of AI",className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200"}),e.jsx("button",{onClick:E,disabled:c||!fe,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-full disabled:opacity-50 flex items-center justify-center gap-2",children:c?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"})," Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-wand-magic-sparkles"})," Generate Script"]})})]}),D==="paste"&&e.jsx("textarea",{id:"pasted-script",value:R,onChange:l=>C(l.target.value),placeholder:"Paste your full podcast script here. Each new line or paragraph will be treated as a scene.",className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200",rows:8})]}),e.jsx("div",{className:"border-t-2 border-gray-700 -mx-6 pt-6",children:e.jsx("button",{onClick:d,disabled:q||!Y,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-full disabled:opacity-50 text-lg flex items-center justify-center gap-2",title:Y?"Generate Storyboard":"Please provide required inputs",children:q?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"})," Analyzing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-cogs"})," Generate Storyboard"]})})})]})},Za=({currentUser:u,onLogout:S})=>{const[x,V]=i.useState(1),[f,T]=i.useState(null),[b,z]=i.useState(null),[k,R]=i.useState(""),[C,E]=i.useState(""),[c,d]=i.useState([]),[q,te]=i.useState(null),[oe,m]=i.useState(null),[A,U]=i.useState("input"),[se,ne]=i.useState(!1),[re,ie]=i.useState(!1),[G,le]=i.useState({}),[ce,F]=i.useState(null),[de,H]=i.useState(!1),[ge,pe]=i.useState(!1),[he,_]=i.useState(!1),[w,me]=i.useState(!1),[D,W]=i.useState(!1),[fe,Y]=i.useState(!1),[Ge,O]=i.useState(!1),[l,Ke]=i.useState({storyboard:0,image:0,video:0}),[Ae,Pe]=i.useState(!1),[be,Te]=i.useState(!1),[K,Ee]=i.useState("Puck"),[$,Ue]=i.useState("Kore"),[Z,Fe]=i.useState(""),[v,He]=i.useState("16:9"),[P,De]=i.useState("studio"),[y,Oe]=i.useState(null),[J,$e]=i.useState("a modern, professional podcast studio interior"),[xe,Be]=i.useState([]),[Q,ve]=i.useState(),[ye,Ze]=i.useState(4),[Je,Le]=i.useState(!1),[Qe,Me]=i.useState(!1),[Xe,ze]=i.useState(!1),j=i.useCallback(()=>{const a=N.getUsage(u);Ke({storyboard:a.generateStoryboard.count,image:a.generateImage.count,video:a.generateVideo.count})},[u]);i.useEffect(()=>{j()},[j]);const B=i.useCallback(async()=>{const a=[];return f&&a.push(await ae(f)),x===2&&b&&a.push(await ae(b)),a.length===0&&y&&a.push(await ae(y)),a},[f,b,x,y]),ea=i.useCallback(async()=>{if(!N.canPerformAction(u,"generateStoryboard")){alert(`You have reached your daily limit of ${M.generateStoryboard} storyboard generations.`);return}ne(!0),m(null);try{const a=await B();if(a.length===0)throw new Error("Please upload at least one image (host or master shot).");const o=a.length,s=await Ha(k,o,a);E(s),U("script_generated"),N.logAction(u,"generateStoryboard"),j()}catch(a){m(a instanceof Error?a.message:"An unknown error occurred.")}finally{ne(!1)}},[u,B,x,k,j]),Re=i.useCallback(async()=>{ie(!0),m(null),d([]);try{const a=await B();if(a.length===0)throw new Error("Please upload at least one image (host or master shot).");const o=a.length;if(!N.canPerformAction(u,"generateImage"))throw new Error("You have reached your daily limit for image generations and cannot create the initial studio image.");const s=o===1?"A realistic photo of a person in a modern podcast studio, sitting at a table with a professional microphone. The shot is a medium wide shot.":"A realistic photo of two people sitting across from each other in a modern podcast studio, at a table with professional microphones. The shot is a medium wide shot.",[t]=await qe({provider:"gemini",prompt:s,subjectUrls:a,aspectRatio:v});te(t),N.logAction(u,"generateImage"),j();const r=await Da(C,a,P);if(y){const n=await ae(y);d(r.map(g=>({...g,images:[n],selectedImageForVideo:n})))}else d(r);U("prompts_generated")}catch(a){m(a instanceof Error?a.message:"An unknown error occurred.")}finally{ie(!1)}},[B,x,C,u,j,v,P]),Se=i.useCallback(async a=>{if(!N.canPerformAction(u,"generateImage"))throw new Error(`You have reached your daily limit of ${M.generateImage} image generations.`);const o=c.find(s=>s.id===a);if(o){d(s=>s.map(t=>t.id===a?{...t,isGeneratingImage:!0,imageGenerationError:null}:t));try{const s=G[a]||{},t=s.imageProvider||"lehuyducanh",r=s.selectedHost,n=[];r==="host1"?f&&n.push(f):r==="host2"?b&&n.push(b):(f&&n.push(f),x===2&&b&&n.push(b)),n.length===0&&y&&n.push(y);const g=await Promise.all(n.map(ee=>ae(ee))),p=o.imagePrompt.toLowerCase().includes("studio"),h=p?g:[],L=p?q??void 0:void 0,X=await qe({provider:t,prompt:o.imagePrompt,subjectUrls:h,sceneUrl:L,aspectRatio:v});d(ee=>ee.map(I=>I.id===a?{...I,images:[...I.images,...X],isGeneratingImage:!1}:I)),N.logAction(u,"generateImage"),j()}catch(s){throw d(t=>t.map(r=>r.id===a?{...r,isGeneratingImage:!1,imageGenerationError:s instanceof Error?s.message:"Unknown error"}:r)),s}}},[c,u,j,G,f,b,x,q,v]),we=i.useCallback(async(a,o)=>{const s=c.find(r=>r.id===a),t=s==null?void 0:s.videos[o];if(t){d(r=>r.map(n=>n.id===a?{...n,videos:n.videos.map((g,p)=>p===o?{...g,isUpscaling:!0,upscaleError:null}:g)}:n));try{const{videoUrl:r,publicUrl:n}=await Ca({provider:"lehuyducanh",mediaGenerationId:t.mediaGenerationId,seed:t.seed}),g=n||r;d(p=>p.map(h=>h.id===a?{...h,videos:h.videos.map((L,X)=>X===o?{...L,upscaledUrl:g,isUpscaling:!1}:L)}:h))}catch(r){throw d(n=>n.map(g=>g.id===a?{...g,videos:g.videos.map((p,h)=>h===o?{...p,isUpscaling:!1,upscaleError:r instanceof Error?r.message:"Unknown error"}:p)}:g)),r}}},[c]),aa=(a,o)=>{d(s=>s.map(t=>{if(t.id!==a)return t;const r=[...t.videos];return r.splice(o,1),{...t,videos:r}}))},je=i.useCallback(async a=>{if(!N.canPerformAction(u,"generateVideo"))throw new Error(`You have reached your daily limit of ${M.generateVideo} video generations.`);const o=c.find(s=>s.id===a);if(!o||!o.selectedImageForVideo)throw new Error("No image selected for video generation.");d(s=>s.map(t=>t.id===a?{...t,isGeneratingVideo:!0,videoGenerationError:null}:t));try{const s=await La(o.selectedImageForVideo),t=`Voiceover: "${o.voiceoverScript}".
Motion: ${o.videoPrompt}`,{videoUrl:r,upscaledUrl:n,mediaGenerationId:g,seed:p,publicUrl:h,upscaledPublicUrl:L}=await Ga({provider:"lehuyducanh",prompt:t,imageUrl:s,upscale:o.shouldUpscaleVideo,aspectRatio:v}),X={url:h||r,upscaledUrl:L||n,mediaGenerationId:g,seed:p};d(ee=>ee.map(I=>I.id!==a?I:{...I,videos:[...I.videos||[],X],isGeneratingVideo:!1})),N.logAction(u,"generateVideo"),j()}catch(s){throw d(t=>t.map(r=>r.id===a?{...r,isGeneratingVideo:!1,videoGenerationError:s instanceof Error?s.message:"Unknown error"}:r)),s}},[c,u,j,v]),ta=i.useCallback(async()=>{if(A==="input"){alert("Please generate a script or storyboard before saving.");return}Pe(!0),m(null);try{const a=f?{name:f.name,data:await Ve(f)}:void 0,o=b?{name:b.name,data:await Ve(b)}:void 0,s=y?{name:y.name,data:await Ve(y)}:void 0,t={version:"1.0.0-podcast",numHosts:x,hostOneImage:a,hostTwoImage:o,podcastTopic:k,pastedScript:C,reporterVoice:K,intervieweeVoice:$,globalVoiceInstruction:Z,videoAspectRatio:v,singleHostSetting:P,environmentImage:s,backgroundPrompt:J,generatedEnvironments:xe,selectedBackground:Q,scenes:c,sceneOverrides:G,generationStep:A},r=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=(k.trim().replace(/\s+/g,"-").substring(0,20)||"podcast-project").toLowerCase();Aa(r,`${n}.pvdproj`)}catch(a){m(a instanceof Error?a.message:"An unknown error occurred during saving.")}finally{Pe(!1)}},[A,x,f,b,k,C,K,$,Z,v,P,y,J,xe,Q,c,G]),oa=i.useCallback(async a=>{var s,t;const o=(s=a.target.files)==null?void 0:s[0];if(o){Te(!0),m(null);try{const r=await o.text(),n=JSON.parse(r);if(!((t=n.version)!=null&&t.includes("-podcast")))throw new Error("Invalid project file. Please import a .pvdproj file.");V(n.numHosts||1),T(n.hostOneImage?await ke(n.hostOneImage.data,n.hostOneImage.name):null),z(n.hostTwoImage?await ke(n.hostTwoImage.data,n.hostTwoImage.name):null),R(n.podcastTopic||""),E(n.pastedScript||""),Ee(n.reporterVoice||"Puck"),Ue(n.intervieweeVoice||"Kore"),Fe(n.globalVoiceInstruction||""),He(n.videoAspectRatio||"16:9"),De(n.singleHostSetting||"studio"),Oe(n.environmentImage?await ke(n.environmentImage.data,n.environmentImage.name):null),$e(n.backgroundPrompt||"a modern, professional podcast studio interior"),Be(n.generatedEnvironments||[]),ve(n.selectedBackground||void 0),le(n.sceneOverrides||{});const p=(n.scenes||[]).map(h=>({...We({}),...h,videos:h.videos||[]}));d(p),U(n.generationStep||"input"),alert("Project imported successfully!")}catch(r){m(r instanceof Error?r.message:"An unknown error occurred during import.")}finally{Te(!1),a.target.value=""}}},[]),sa=i.useCallback((a,o,s)=>{le(t=>{const n={...t[a]||{},[o]:s};if((o==="selectedHost"&&s==="auto"||o==="imageProvider"&&s==="lehuyducanh")&&delete n[o],Object.keys(n).length===0){const{[a]:g,...p}=t;return p}return{...t,[a]:n}})},[]),na=(a,o)=>d(s=>s.map(t=>t.id===a?{...t,imagePrompt:o}:t)),ra=(a,o)=>d(s=>s.map(t=>t.id===a?{...t,videoPrompt:o}:t)),ia=(a,o)=>d(s=>s.map(t=>t.id===a?{...t,voiceoverGuide:o}:t)),la=(a,o,s)=>d(t=>t.map(r=>r.id===a?{...r,[o]:s}:r)),ca=(a,o)=>d(s=>s.map(t=>t.id!==a?t:{...t,images:t.images.filter(r=>r!==o),selectedImageForVideo:t.selectedImageForVideo===o?void 0:t.selectedImageForVideo})),da=(a,o)=>d(s=>s.map(t=>t.id===a?{...t,selectedImageForVideo:o,videos:[],videoGenerationError:null}:t)),ga=a=>d(o=>o.map(s=>s.id===a?{...s,shouldUpscaleVideo:!s.shouldUpscaleVideo}:s)),ma=async(a,o)=>{},ua=i.useCallback(async()=>ue(c.filter(a=>a.images.length===0&&!a.imagePrompt.toLowerCase().includes("studio")).map(a=>()=>Se(a.id)),5).finally(()=>pe(!1)),[c,Se]),pa=i.useCallback(async()=>ue(c.filter(a=>a.selectedImageForVideo&&(!a.videos||a.videos.length===0)).map(a=>()=>je(a.id)),5).finally(()=>_(!1)),[c,je]),ha=i.useCallback(async()=>ue(c.flatMap(a=>(a.videos||[]).map((o,s)=>({scene:a,video:o,index:s})).filter(o=>o.video.url&&o.video.mediaGenerationId&&!o.video.upscaledUrl).map(o=>()=>we(o.scene.id,o.index))),5).finally(()=>me(!1)),[c,we]),Ie=i.useCallback(async a=>{const o=c.find(s=>s.id===a);if(o){d(s=>s.map(t=>t.id===a?{...t,isGeneratingAudio:!0,audioGenerationError:null}:t));try{let s=$,t=o.voiceoverScript;t.toLowerCase().startsWith("host 1:")||t.toLowerCase().startsWith("reporter:")?(s=K,t=t.replace(/^(host 1:|reporter:)\s*/i,"")):(t.toLowerCase().startsWith("host 2:")||t.toLowerCase().startsWith("interviewee:"))&&(s=$,t=t.replace(/^(host 2:|interviewee:)\s*/i,""));const r=await Oa(t,o.voiceoverGuide,s,Z),n=Pa(r),g=URL.createObjectURL(n);d(p=>p.map(h=>h.id===a?{...h,audioUrl:g,isGeneratingAudio:!1}:h))}catch(s){const t=s instanceof Error?s.message:"An unknown audio generation error occurred.";d(r=>r.map(n=>n.id===a?{...n,isGeneratingAudio:!1,audioGenerationError:t}:n))}}},[c,K,$,Z]),fa=i.useCallback(async()=>{O(!0);const a=c.filter(o=>!o.audioUrl).map(o=>()=>Ie(o.id));await ue(a,5),O(!1)},[c,Ie]),ba=a=>{d(o=>{const s=o.length?o[Math.max(0,Math.min(a-1,o.length-1))]:void 0,t=s?{...s,id:crypto.randomUUID?crypto.randomUUID():`scene-${Date.now()}`,images:[...s.images],videos:(s.videos||[]).map(n=>({...n,isUpscaling:!1,upscaleError:null})),isGeneratingImage:!1,imageGenerationError:null,isGeneratingVideo:!1,videoGenerationError:null,isGeneratingAudio:!1,audioGenerationError:null,audioUrl:s.audioUrl}:We({voiceoverScript:"New scene..."}),r=[...o];return r.splice(a,0,t),r})},xa=i.useCallback(()=>{d(a=>a.map(o=>o.imagePrompt.toLowerCase().includes("studio")||o.imagePrompt.toLowerCase().includes("stage")?{...o,selectedImageForVideo:Q}:o.images.length>0?{...o,selectedImageForVideo:o.images[0]}:o)),alert("Set studio scenes to the selected background and picked the first image for all B-roll scenes!")},[Q]),va=i.useCallback(async()=>{const{botToken:a,chatId:o}=Ye.getTelegramConfig();if(!a||!o){alert("Please configure Telegram settings first in the Settings page.");return}const s=c.flatMap((t,r)=>t.images.map((n,g)=>({type:"photo",url:n,caption:`Scene ${r+1}: ${t.voiceoverScript}`,fileName:`${String(r+1).padStart(3,"0")}_image_${String(g+1).padStart(2,"0")}.jpg`})));if(s.length===0){alert("No generated images found to send.");return}Me(!0),m(null);try{await _e.sendMedia(s),alert("All images sent to Telegram successfully!")}catch(t){const r=t instanceof Error?t.message:"Failed to send images to Telegram.";m(r),alert(r)}finally{Me(!1)}},[c]),ya=i.useCallback(async()=>{const{botToken:a,chatId:o}=Ye.getTelegramConfig();if(!a||!o){alert("Please configure Telegram settings first in the Settings page.");return}const s=c.flatMap((t,r)=>(t.videos||[]).map((n,g)=>({type:"video",url:n.upscaledUrl||n.url,caption:`Scene ${r+1}: ${t.voiceoverScript}`,fileName:`${String(r+1).padStart(3,"0")}_video_${String(g+1).padStart(2,"0")}.mp4`}))).filter(t=>t.url);if(s.length===0){alert("No videos found to send.");return}ze(!0),m(null);try{await _e.sendMedia(s),alert("All videos sent to Telegram successfully!")}catch(t){const r=t instanceof Error?t.message:"Failed to send videos to Telegram.";m(r),alert(r)}finally{ze(!1)}},[c]),Sa=i.useCallback(async()=>{W(!0);try{await Ta(c)}catch(a){m(a instanceof Error?a.message:"Failed to download images.")}finally{W(!1)}},[c]),wa=i.useCallback(async()=>{Y(!0);try{await Ea(c)}catch(a){m(a instanceof Error?a.message:"Failed to download videos.")}finally{Y(!1)}},[c]),ja=(a,o)=>{d(s=>s.map(t=>t.id===a?{...t,includeDialogueInPrompt:o}:t))},Ia=async(a,o)=>{alert("Enhanced prompt generation is not yet implemented for the Podcast module.")},Na=a=>{window.confirm("Are you sure you want to delete this scene?")&&d(o=>o.filter(s=>s.id!==a))},Va=(a,o)=>{d(s=>s.map(t=>t.id===a?{...t,voiceoverScript:o}:t))},ka=i.useCallback(async()=>{Le(!0),m(null);try{const a=await B();if(a.length===0)throw new Error("Please upload at least one host image or a master shot.");const o=await $a(a,J,ye,P,v);Be(o),o.length>0&&ve(o[0])}catch(a){m(a instanceof Error?a.message:"Failed to generate background scenes.")}finally{Le(!1)}},[B,J,ye,P,v]);return e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"py-4 px-8 bg-gray-800 shadow-lg border-b border-gray-700 shrink-0 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-blue-400",children:[e.jsx("i",{className:"fas fa-podcast mr-3"}),"Podcast Video Designer"]}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Turn your podcast into visually engaging videos."})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("label",{htmlFor:"import-project-podcast",className:`text-center bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-full transition-all duration-300 flex items-center justify-center gap-2 text-sm shadow-sm ${be?"cursor-not-allowed opacity-50":"cursor-pointer"}`,children:be?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"}),"Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-folder-open"}),"Import"]})}),e.jsx("input",{id:"import-project-podcast",type:"file",accept:".pvdproj",className:"hidden",onChange:oa,disabled:be}),e.jsx("button",{onClick:ta,disabled:Ae||A==="input",className:"bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-sm shadow-sm",children:Ae?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-save"}),"Save"]})})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"text-gray-300 font-medium",children:["Welcome, ",e.jsx("span",{className:"font-bold text-blue-400",children:u}),"!"]}),e.jsxs("div",{className:"text-xs text-gray-400 bg-gray-700 px-2 py-1 rounded-md mt-1 flex gap-x-2",children:["Daily Usage:",e.jsxs("span",{className:"font-bold text-blue-400",title:"Storyboard Generations",children:[" ",e.jsx("i",{className:"fas fa-file-alt"})," ",l.storyboard,"/",M.generateStoryboard]})," |",e.jsxs("span",{className:"font-bold text-green-400",title:"Image Generations",children:[" ",e.jsx("i",{className:"fas fa-image"})," ",l.image,"/",M.generateImage]})," |",e.jsxs("span",{className:"font-bold text-red-400",title:"Video Generations",children:[" ",e.jsx("i",{className:"fas fa-video"})," ",l.video,"/",M.generateVideo]})]})]}),e.jsx("button",{onClick:S,className:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-full",children:"Logout"})]})]})]}),e.jsx("main",{className:"flex-1 overflow-x-hidden overflow-y-auto p-4 md:p-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 xl:grid-cols-4 gap-8 items-start",children:[e.jsx("div",{className:"lg:sticky lg:top-8 xl:col-span-1",children:e.jsx(Ma,{numHosts:x,setNumHosts:V,hostOneImage:f,setHostOneImage:T,hostTwoImage:b,setHostTwoImage:z,podcastTopic:k,setPodcastTopic:R,pastedScript:C,setPastedScript:E,onGenerateScript:ea,isGeneratingScript:se,onAnalyzeScript:Re,isAnalyzingScript:re,reporterVoice:K,setReporterVoice:Ee,intervieweeVoice:$,setIntervieweeVoice:Ue,environmentImage:y,setEnvironmentImage:Oe,environmentVariationsCount:ye,setEnvironmentVariationsCount:Ze,onGenerateEnvironments:ka,isGeneratingEnvironments:Je,globalVoiceInstruction:Z,setGlobalVoiceInstruction:Fe,videoAspectRatio:v,setVideoAspectRatio:He,singleHostSetting:P,setSingleHostSetting:De,backgroundPrompt:J,setBackgroundPrompt:$e,onViewImage:F})}),e.jsx("div",{className:"lg:col-span-2 xl:col-span-3",children:e.jsx(Ua,{generationStep:A,scenes:c,isLoading:se||re,isGeneratingPrompts:!1,error:oe,voiceoverScript:C,onVoiceoverScriptChange:E,onGeneratePrompts:Re,sceneOverrides:G,onGenerateImage:Se,onSceneImagePromptChange:na,onSceneVideoPromptChange:ra,onSceneVoiceoverGuideChange:ia,onSceneEnhancementChange:la,onSceneOverrideChange:sa,onDeleteImage:ca,onViewImage:F,onUploadImageForVideo:ma,onGenerateAllImages:ua,isBatchGenerating:ge,onViewStoryboard:()=>H(!0),onDownloadAllImages:Sa,isDownloadingImages:D,onDownloadAllVideos:wa,isDownloadingVideos:fe,onSelectImageForVideo:da,onGenerateVideo:je,onToggleVideoUpscale:ga,onUpscaleVideo:we,onGenerateAllVideos:pa,isBatchGeneratingVideos:he,onUpscaleAllVideos:ha,isBatchUpscalingVideos:w,generatedEnvironments:xe,activeModule:"podcast",numHosts:x,onGenerateAudio:Ie,onGenerateAllAudio:fa,isBatchGeneratingAudio:Ge,onAddScene:ba,onPickAllImages:xa,onSelectEnvironment:ve,selectedEnvironment:Q,onSendAllImagesToTelegram:va,isSendingImagesToTelegram:Qe,onSendAllVideosToTelegram:ya,isSendingVideosToTelegram:Xe,videoAspectRatio:v,onToggleDialogueInPrompt:ja,onGenerateEnhancedPrompt:Ia,onSceneVoiceoverScriptChange:Va,onDeleteScene:Na,onDeleteVideo:aa})})]})}),ce&&e.jsx(Ba,{imageUrl:ce,onClose:()=>F(null)}),de&&e.jsx(Fa,{scenes:c,onClose:()=>H(!1),videoAspectRatio:v})]})};export{Za as default};

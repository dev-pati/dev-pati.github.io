import{r,j as e}from"./index-BLbhO8kS.js";import{u as N,U as L,g as _e,a as Ca,b as Ga,s as Aa,r as ge,c as Pa,t as qe,d as Ta,e as Ea,O as Fa,S as Ua}from"./telegramService-DUvg5A-E.js";import{I as Ne}from"./ImageUpload-D540goV8.js";import{h as Ha,i as Oa,m as We,c as Da,j as $a,I as Ba}from"./lehuyducanhService-_rl_0G0R.js";import{r as me,i as La,f as Ve,d as ke}from"./media-CDZXYBSY.js";import{s as Ye}from"./settingsService-CbIZ9NBp.js";import"./streetInterviewPrompts-Dzu83YwK.js";const Ce=[{value:"Kore",label:"Kore (Female)"},{value:"Puck",label:"Puck (Male)"},{value:"Charon",label:"Charon (Male)"},{value:"Fenrir",label:"Fenrir (Male)"},{value:"Zephyr",label:"Zephyr (Male)"}],Ma=u=>{const{numHosts:y,setNumHosts:x,hostOneImage:V,setHostOneImage:f,hostTwoImage:T,setHostTwoImage:b,podcastTopic:M,setPodcastTopic:k,pastedScript:z,setPastedScript:C,onGenerateScript:E,isGeneratingScript:c,onAnalyzeScript:d,isAnalyzingScript:R,reporterVoice:ae,setReporterVoice:te,intervieweeVoice:m,setIntervieweeVoice:A,environmentImage:F,setEnvironmentImage:se,environmentVariationsCount:oe,setEnvironmentVariationsCount:ne,onGenerateEnvironments:re,isGeneratingEnvironments:G,globalVoiceInstruction:ie,setGlobalVoiceInstruction:le,videoAspectRatio:_,setVideoAspectRatio:ue,singleHostSetting:U,setSingleHostSetting:ce,backgroundPrompt:pe,setBackgroundPrompt:he,onViewImage:q}=u,[S,de]=r.useState("custom"),[H,W]=r.useState("generate"),fe=!!V&&(y===1||!!T)&&!!M,Y=(!!V&&(y===1||!!T)||!!F)&&!!z,O=y===1&&U==="stage"?"Stage":"Studio";return e.jsxs("div",{className:"bg-gray-800 p-6 rounded-2xl border border-gray-700 shadow-lg flex flex-col gap-6",children:[e.jsxs("div",{className:"flex mb-2 border-b-2 border-gray-700",children:[e.jsxs("button",{onClick:()=>de("custom"),className:`flex-1 text-center font-bold py-3 transition-all duration-300 flex items-center justify-center gap-2 ${S==="custom"?"text-blue-400 border-b-4 border-blue-500":"text-gray-400 hover:text-white"}`,children:[e.jsx("i",{className:"fas fa-tools"})," Custom Setup"]}),e.jsxs("button",{onClick:()=>de("quick-start"),className:`flex-1 text-center font-bold py-3 transition-all duration-300 flex items-center justify-center gap-2 ${S==="quick-start"?"text-yellow-400 border-b-4 border-yellow-500":"text-gray-400 hover:text-white"}`,children:[e.jsx("i",{className:"fas fa-bolt"})," Quick Start"]})]}),S==="custom"&&e.jsxs("div",{className:"flex flex-col gap-6 animate-fade-in",children:[e.jsxs("h3",{className:"text-xl font-bold text-blue-400 -mb-2",children:[e.jsx("i",{className:"fas fa-users mr-2"}),"Cast"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-md font-bold text-gray-300 mb-2",children:"Number of Hosts"}),e.jsxs("div",{className:"flex gap-2 bg-gray-900 border-2 border-gray-600 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>x(1),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${y===1?"bg-blue-600":"bg-transparent text-gray-400 hover:bg-gray-700"}`,children:"1 Host"}),e.jsx("button",{onClick:()=>x(2),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${y===2?"bg-blue-600":"bg-transparent text-gray-400 hover:bg-gray-700"}`,children:"2 Hosts"})]})]}),y===1&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-md font-bold text-gray-300 mb-2",children:"Host Setting"}),e.jsxs("div",{className:"flex gap-2 bg-gray-900 border-2 border-gray-600 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>ce("studio"),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${U==="studio"?"bg-blue-600":"bg-transparent text-gray-400 hover:bg-gray-700"}`,children:"In Studio"}),e.jsx("button",{onClick:()=>ce("stage"),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${U==="stage"?"bg-blue-600":"bg-transparent text-gray-400 hover:bg-gray-700"}`,children:"On Stage"})]})]}),e.jsx(Ne,{id:"podcast-host-1-image",label:y===1?"Host Image":"Host 1 Image",file:V,onFileChange:f,onViewImage:q}),y===2&&e.jsx(Ne,{id:"podcast-host-2-image",label:"Host 2 Image",file:T,onFileChange:b,onViewImage:q}),e.jsx("div",{className:"border-t-2 border-gray-700 -mx-6"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-400 mb-2",children:[e.jsx("i",{className:"fas fa-image mr-2"}),O," / Set"]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"background-prompt",className:"block text-sm font-bold text-gray-300 mb-1",children:"Generate with AI using a prompt"}),e.jsx("input",{id:"background-prompt",type:"text",value:pe,onChange:l=>he(l.target.value),placeholder:"e.g., minimalist, wooden textures...",className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-2 text-gray-200"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"env-count",className:"block text-sm font-bold text-gray-300 mb-1",children:"Number of Camera Angles"}),e.jsx("input",{id:"env-count",type:"number",min:"1",max:"10",value:oe,onChange:l=>ne(parseInt(l.target.value,10)),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-2 text-gray-200"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"aspect-ratio-podcast",className:"block text-sm font-bold text-gray-300 mb-1",children:"Video Aspect Ratio"}),e.jsxs("select",{id:"aspect-ratio-podcast",value:_,onChange:l=>ue(l.target.value),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-2 text-gray-200",children:[e.jsx("option",{value:"16:9",children:"16:9 (Landscape)"}),e.jsx("option",{value:"9:16",children:"9:16 (Portrait)"})]})]}),e.jsx("button",{onClick:re,disabled:G||!V,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-full disabled:opacity-50",title:V?`Generate ${O} Scene Variations`:"Please upload at least one host image",children:G?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"})," Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-camera-retro"})," Generate ",O," Scenes"]})})]})]}),S==="quick-start"&&e.jsxs("div",{className:"flex flex-col gap-6 animate-fade-in",children:[e.jsx("div",{className:"bg-yellow-900/30 border border-yellow-700/50 p-3 rounded-lg text-center text-yellow-200 text-sm",children:e.jsxs("p",{children:[e.jsx("i",{className:"fas fa-bolt mr-2"}),"Upload a finalized photo of you in the studio. We'll use it for everything."]})}),e.jsx(Ne,{id:"environment-image",label:"Master Shot (You in Studio)",file:F,onFileChange:se,onViewImage:q})]}),e.jsx("div",{className:"border-t-2 border-gray-700 -mx-6"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-400 mb-2",children:[e.jsx("i",{className:"fas fa-cog mr-2"}),"Audio & Video"]}),y===1?e.jsxs("div",{children:[e.jsx("label",{htmlFor:"podcast-tts-voice",className:"block text-md font-bold text-gray-300 mb-2",children:"Host's Voice"}),e.jsx("select",{id:"podcast-tts-voice",value:ae,onChange:l=>te(l.target.value),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200",children:Ce.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"reporter-voice",className:"block text-md font-bold text-gray-300 mb-2",children:"Host 1's Voice"}),e.jsx("select",{id:"reporter-voice",value:ae,onChange:l=>te(l.target.value),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200",children:Ce.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"interviewee-voice",className:"block text-md font-bold text-gray-300 mb-2",children:"Host 2's Voice"}),e.jsx("select",{id:"interviewee-voice",value:m,onChange:l=>A(l.target.value),className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200",children:Ce.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"global-voice-instruction",className:"block text-md font-bold text-gray-300 mb-2",children:"Global Voice Instruction (Optional)"}),e.jsx("textarea",{id:"global-voice-instruction",value:ie,onChange:l=>le(l.target.value),placeholder:"e.g., Speak in a warm, friendly, and engaging tone.",className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200",rows:2})]})]}),e.jsx("div",{className:"border-t-2 border-gray-700 -mx-6"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-400 mb-4",children:[e.jsx("i",{className:"fas fa-file-alt mr-2"}),"Scripting"]}),e.jsxs("div",{className:"flex gap-1 bg-gray-900 border-2 border-gray-600 rounded-lg p-1 mb-4",children:[e.jsx("button",{onClick:()=>W("generate"),disabled:S==="quick-start",className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${H==="generate"&&S!=="quick-start"?"bg-blue-600":"bg-transparent text-gray-400 hover:bg-gray-700"} ${S==="quick-start"?"opacity-50 cursor-not-allowed":""}`,children:"Generate"}),e.jsx("button",{onClick:()=>W("paste"),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${H==="paste"?"bg-blue-600":"bg-transparent text-gray-400 hover:bg-gray-700"}`,children:"Paste"})]}),H==="generate"&&S==="custom"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{htmlFor:"podcast-topic",className:"block text-md font-bold text-gray-300",children:"Podcast Topic"}),e.jsx("input",{id:"podcast-topic",type:"text",value:M,onChange:l=>k(l.target.value),placeholder:"e.g., The future of AI",className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200"}),e.jsx("button",{onClick:E,disabled:c||!fe,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-full disabled:opacity-50 flex items-center justify-center gap-2",children:c?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"})," Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-wand-magic-sparkles"})," Generate Script"]})})]}),H==="paste"&&e.jsx("textarea",{id:"pasted-script",value:z,onChange:l=>C(l.target.value),placeholder:"Paste your full podcast script here. Each new line or paragraph will be treated as a scene.",className:"w-full bg-gray-700 border-2 border-gray-600 rounded-lg p-3 text-gray-200",rows:8})]}),e.jsx("div",{className:"border-t-2 border-gray-700 -mx-6 pt-6",children:e.jsx("button",{onClick:d,disabled:R||!Y,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-full disabled:opacity-50 text-lg flex items-center justify-center gap-2",title:Y?"Generate Storyboard":"Please provide required inputs",children:R?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"})," Analyzing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-cogs"})," Generate Storyboard"]})})})]})},Za=({currentUser:u,onLogout:y})=>{const[x,V]=r.useState(1),[f,T]=r.useState(null),[b,M]=r.useState(null),[k,z]=r.useState(""),[C,E]=r.useState(""),[c,d]=r.useState([]),[R,ae]=r.useState(null),[te,m]=r.useState(null),[A,F]=r.useState("input"),[se,oe]=r.useState(!1),[ne,re]=r.useState(!1),[G,ie]=r.useState({}),[le,_]=r.useState(null),[ue,U]=r.useState(!1),[ce,pe]=r.useState(!1),[he,q]=r.useState(!1),[S,de]=r.useState(!1),[H,W]=r.useState(!1),[fe,Y]=r.useState(!1),[Ge,O]=r.useState(!1),[l,Ke]=r.useState({storyboard:0,image:0,video:0}),[Ae,Pe]=r.useState(!1),[be,Te]=r.useState(!1),[K,Ee]=r.useState("Puck"),[D,Fe]=r.useState("Kore"),[Z,Ue]=r.useState(""),[v,He]=r.useState("16:9"),[P,Oe]=r.useState("studio"),[w,De]=r.useState(null),[J,$e]=r.useState("a modern, professional podcast studio interior"),[xe,Be]=r.useState([]),[Q,ve]=r.useState(),[ye,Ze]=r.useState(4),[Je,Le]=r.useState(!1),[Qe,Me]=r.useState(!1),[Xe,ze]=r.useState(!1),j=r.useCallback(()=>{const a=N.getUsage(u);Ke({storyboard:a.generateStoryboard.count,image:a.generateImage.count,video:a.generateVideo.count})},[u]);r.useEffect(()=>{j()},[j]);const $=r.useCallback(async()=>{const a=[];return f&&a.push(await me(f)),x===2&&b&&a.push(await me(b)),a.length===0&&w&&a.push(await me(w)),a},[f,b,x,w]),ea=r.useCallback(async()=>{if(!N.canPerformAction(u,"generateStoryboard")){alert(`You have reached your daily limit of ${L.generateStoryboard} storyboard generations.`);return}oe(!0),m(null);try{const a=await $();if(a.length===0)throw new Error("Please upload at least one image (host or master shot).");const s=a.length,o=await Ha(k,s,a);E(o),F("script_generated"),N.logAction(u,"generateStoryboard"),j()}catch(a){m(a instanceof Error?a.message:"An unknown error occurred.")}finally{oe(!1)}},[u,$,x,k,j]),Re=r.useCallback(async()=>{re(!0),m(null),d([]);try{const a=await $();if(a.length===0)throw new Error("Please upload at least one image (host or master shot).");const s=a.length;if(!N.canPerformAction(u,"generateImage"))throw new Error("You have reached your daily limit for image generations and cannot create the initial studio image.");const o=s===1?"A realistic photo of a person in a modern podcast studio, sitting at a table with a professional microphone. The shot is a medium wide shot.":"A realistic photo of two people sitting across from each other in a modern podcast studio, at a table with professional microphones. The shot is a medium wide shot.",[t]=await _e({provider:"gemini",prompt:o,subjectUrls:a,aspectRatio:v});ae(t),N.logAction(u,"generateImage"),j();const i=await Oa(C,a,P);d(i),F("prompts_generated")}catch(a){m(a instanceof Error?a.message:"An unknown error occurred.")}finally{re(!1)}},[$,x,C,u,j,v,P]),Se=r.useCallback(async a=>{if(!N.canPerformAction(u,"generateImage"))throw new Error(`You have reached your daily limit of ${L.generateImage} image generations.`);const s=c.find(o=>o.id===a);if(s){d(o=>o.map(t=>t.id===a?{...t,isGeneratingImage:!0,imageGenerationError:null}:t));try{const o=G[a]||{},t=o.imageProvider||"lehuyducanh",i=o.selectedHost,n=[];i==="host1"?f&&n.push(f):i==="host2"?b&&n.push(b):(f&&n.push(f),x===2&&b&&n.push(b)),n.length===0&&w&&n.push(w);const g=await Promise.all(n.map(ee=>me(ee))),p=s.imagePrompt.toLowerCase().includes("studio"),h=p?g:[],B=p?R??void 0:void 0,X=await _e({provider:t,prompt:s.imagePrompt,subjectUrls:h,sceneUrl:B,aspectRatio:v});d(ee=>ee.map(I=>I.id===a?{...I,images:[...I.images,...X],isGeneratingImage:!1}:I)),N.logAction(u,"generateImage"),j()}catch(o){throw d(t=>t.map(i=>i.id===a?{...i,isGeneratingImage:!1,imageGenerationError:o instanceof Error?o.message:"Unknown error"}:i)),o}}},[c,u,j,G,f,b,x,R,v]),we=r.useCallback(async(a,s)=>{const o=c.find(i=>i.id===a),t=o==null?void 0:o.videos[s];if(t){d(i=>i.map(n=>n.id===a?{...n,videos:n.videos.map((g,p)=>p===s?{...g,isUpscaling:!0,upscaleError:null}:g)}:n));try{const{videoUrl:i,publicUrl:n}=await Ca({provider:"lehuyducanh",mediaGenerationId:t.mediaGenerationId,seed:t.seed}),g=n||i;d(p=>p.map(h=>h.id===a?{...h,videos:h.videos.map((B,X)=>X===s?{...B,upscaledUrl:g,isUpscaling:!1}:B)}:h))}catch(i){throw d(n=>n.map(g=>g.id===a?{...g,videos:g.videos.map((p,h)=>h===s?{...p,isUpscaling:!1,upscaleError:i instanceof Error?i.message:"Unknown error"}:p)}:g)),i}}},[c]),aa=(a,s)=>{d(o=>o.map(t=>{if(t.id!==a)return t;const i=[...t.videos];return i.splice(s,1),{...t,videos:i}}))},je=r.useCallback(async a=>{if(!N.canPerformAction(u,"generateVideo"))throw new Error(`You have reached your daily limit of ${L.generateVideo} video generations.`);const s=c.find(o=>o.id===a);if(!s||!s.selectedImageForVideo)throw new Error("No image selected for video generation.");d(o=>o.map(t=>t.id===a?{...t,isGeneratingVideo:!0,videoGenerationError:null}:t));try{const o=await La(s.selectedImageForVideo),t=`Voiceover: "${s.voiceoverScript}".
Motion: ${s.videoPrompt}`,{videoUrl:i,upscaledUrl:n,mediaGenerationId:g,seed:p,publicUrl:h,upscaledPublicUrl:B}=await Ga({provider:"lehuyducanh",prompt:t,imageUrl:o,upscale:s.shouldUpscaleVideo,aspectRatio:v}),X={url:h||i,upscaledUrl:B||n,mediaGenerationId:g,seed:p};d(ee=>ee.map(I=>I.id!==a?I:{...I,videos:[...I.videos||[],X],isGeneratingVideo:!1})),N.logAction(u,"generateVideo"),j()}catch(o){throw d(t=>t.map(i=>i.id===a?{...i,isGeneratingVideo:!1,videoGenerationError:o instanceof Error?o.message:"Unknown error"}:i)),o}},[c,u,j,v]),ta=r.useCallback(async()=>{if(A==="input"){alert("Please generate a script or storyboard before saving.");return}Pe(!0),m(null);try{const a=f?{name:f.name,data:await Ve(f)}:void 0,s=b?{name:b.name,data:await Ve(b)}:void 0,o=w?{name:w.name,data:await Ve(w)}:void 0,t={version:"1.0.0-podcast",numHosts:x,hostOneImage:a,hostTwoImage:s,podcastTopic:k,pastedScript:C,reporterVoice:K,intervieweeVoice:D,globalVoiceInstruction:Z,videoAspectRatio:v,singleHostSetting:P,environmentImage:o,backgroundPrompt:J,generatedEnvironments:xe,selectedBackground:Q,scenes:c,sceneOverrides:G,generationStep:A},i=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=(k.trim().replace(/\s+/g,"-").substring(0,20)||"podcast-project").toLowerCase();Aa(i,`${n}.pvdproj`)}catch(a){m(a instanceof Error?a.message:"An unknown error occurred during saving.")}finally{Pe(!1)}},[A,x,f,b,k,C,K,D,Z,v,P,w,J,xe,Q,c,G]),sa=r.useCallback(async a=>{var o,t;const s=(o=a.target.files)==null?void 0:o[0];if(s){Te(!0),m(null);try{const i=await s.text(),n=JSON.parse(i);if(!((t=n.version)!=null&&t.includes("-podcast")))throw new Error("Invalid project file. Please import a .pvdproj file.");V(n.numHosts||1),T(n.hostOneImage?await ke(n.hostOneImage.data,n.hostOneImage.name):null),M(n.hostTwoImage?await ke(n.hostTwoImage.data,n.hostTwoImage.name):null),z(n.podcastTopic||""),E(n.pastedScript||""),Ee(n.reporterVoice||"Puck"),Fe(n.intervieweeVoice||"Kore"),Ue(n.globalVoiceInstruction||""),He(n.videoAspectRatio||"16:9"),Oe(n.singleHostSetting||"studio"),De(n.environmentImage?await ke(n.environmentImage.data,n.environmentImage.name):null),$e(n.backgroundPrompt||"a modern, professional podcast studio interior"),Be(n.generatedEnvironments||[]),ve(n.selectedBackground||void 0),ie(n.sceneOverrides||{});const p=(n.scenes||[]).map(h=>({...We({}),...h,videos:h.videos||[]}));d(p),F(n.generationStep||"input"),alert("Project imported successfully!")}catch(i){m(i instanceof Error?i.message:"An unknown error occurred during import.")}finally{Te(!1),a.target.value=""}}},[]),oa=r.useCallback((a,s,o)=>{ie(t=>{const n={...t[a]||{},[s]:o};if((s==="selectedHost"&&o==="auto"||s==="imageProvider"&&o==="lehuyducanh")&&delete n[s],Object.keys(n).length===0){const{[a]:g,...p}=t;return p}return{...t,[a]:n}})},[]),na=(a,s)=>d(o=>o.map(t=>t.id===a?{...t,imagePrompt:s}:t)),ra=(a,s)=>d(o=>o.map(t=>t.id===a?{...t,videoPrompt:s}:t)),ia=(a,s)=>d(o=>o.map(t=>t.id===a?{...t,voiceoverGuide:s}:t)),la=(a,s,o)=>d(t=>t.map(i=>i.id===a?{...i,[s]:o}:i)),ca=(a,s)=>d(o=>o.map(t=>t.id!==a?t:{...t,images:t.images.filter(i=>i!==s),selectedImageForVideo:t.selectedImageForVideo===s?void 0:t.selectedImageForVideo})),da=(a,s)=>d(o=>o.map(t=>t.id===a?{...t,selectedImageForVideo:s,videos:[],videoGenerationError:null}:t)),ga=a=>d(s=>s.map(o=>o.id===a?{...o,shouldUpscaleVideo:!o.shouldUpscaleVideo}:o)),ma=async(a,s)=>{},ua=r.useCallback(async()=>ge(c.filter(a=>a.images.length===0&&!a.imagePrompt.toLowerCase().includes("studio")).map(a=>()=>Se(a.id)),5).finally(()=>pe(!1)),[c,Se]),pa=r.useCallback(async()=>ge(c.filter(a=>a.selectedImageForVideo&&(!a.videos||a.videos.length===0)).map(a=>()=>je(a.id)),5).finally(()=>q(!1)),[c,je]),ha=r.useCallback(async()=>ge(c.flatMap(a=>(a.videos||[]).map((s,o)=>({scene:a,video:s,index:o})).filter(s=>s.video.url&&s.video.mediaGenerationId&&!s.video.upscaledUrl).map(s=>()=>we(s.scene.id,s.index))),5).finally(()=>de(!1)),[c,we]),Ie=r.useCallback(async a=>{const s=c.find(o=>o.id===a);if(s){d(o=>o.map(t=>t.id===a?{...t,isGeneratingAudio:!0,audioGenerationError:null}:t));try{let o=D,t=s.voiceoverScript;t.toLowerCase().startsWith("host 1:")||t.toLowerCase().startsWith("reporter:")?(o=K,t=t.replace(/^(host 1:|reporter:)\s*/i,"")):(t.toLowerCase().startsWith("host 2:")||t.toLowerCase().startsWith("interviewee:"))&&(o=D,t=t.replace(/^(host 2:|interviewee:)\s*/i,""));const i=await Da(t,s.voiceoverGuide,o,Z),n=Pa(i),g=URL.createObjectURL(n);d(p=>p.map(h=>h.id===a?{...h,audioUrl:g,isGeneratingAudio:!1}:h))}catch(o){const t=o instanceof Error?o.message:"An unknown audio generation error occurred.";d(i=>i.map(n=>n.id===a?{...n,isGeneratingAudio:!1,audioGenerationError:t}:n))}}},[c,K,D,Z]),fa=r.useCallback(async()=>{O(!0);const a=c.filter(s=>!s.audioUrl).map(s=>()=>Ie(s.id));await ge(a,5),O(!1)},[c,Ie]),ba=a=>{const s=We({voiceoverScript:"New scene..."});d(o=>{const t=[...o];return t.splice(a,0,s),t})},xa=r.useCallback(()=>{d(a=>a.map(s=>s.imagePrompt.toLowerCase().includes("studio")||s.imagePrompt.toLowerCase().includes("stage")?{...s,selectedImageForVideo:Q}:s.images.length>0?{...s,selectedImageForVideo:s.images[0]}:s)),alert("Set studio scenes to the selected background and picked the first image for all B-roll scenes!")},[Q]),va=r.useCallback(async()=>{const{botToken:a,chatId:s}=Ye.getTelegramConfig();if(!a||!s){alert("Please configure Telegram settings first in the Settings page.");return}const o=c.flatMap((t,i)=>t.images.map((n,g)=>({type:"photo",url:n,caption:`Scene ${i+1}: ${t.voiceoverScript}`,fileName:`${String(i+1).padStart(3,"0")}_image_${String(g+1).padStart(2,"0")}.jpg`})));if(o.length===0){alert("No generated images found to send.");return}Me(!0),m(null);try{await qe.sendMedia(o),alert("All images sent to Telegram successfully!")}catch(t){const i=t instanceof Error?t.message:"Failed to send images to Telegram.";m(i),alert(i)}finally{Me(!1)}},[c]),ya=r.useCallback(async()=>{const{botToken:a,chatId:s}=Ye.getTelegramConfig();if(!a||!s){alert("Please configure Telegram settings first in the Settings page.");return}const o=c.flatMap((t,i)=>(t.videos||[]).map((n,g)=>({type:"video",url:n.upscaledUrl||n.url,caption:`Scene ${i+1}: ${t.voiceoverScript}`,fileName:`${String(i+1).padStart(3,"0")}_video_${String(g+1).padStart(2,"0")}.mp4`}))).filter(t=>t.url);if(o.length===0){alert("No videos found to send.");return}ze(!0),m(null);try{await qe.sendMedia(o),alert("All videos sent to Telegram successfully!")}catch(t){const i=t instanceof Error?t.message:"Failed to send videos to Telegram.";m(i),alert(i)}finally{ze(!1)}},[c]),Sa=r.useCallback(async()=>{W(!0);try{await Ta(c)}catch(a){m(a instanceof Error?a.message:"Failed to download images.")}finally{W(!1)}},[c]),wa=r.useCallback(async()=>{Y(!0);try{await Ea(c)}catch(a){m(a instanceof Error?a.message:"Failed to download videos.")}finally{Y(!1)}},[c]),ja=(a,s)=>{d(o=>o.map(t=>t.id===a?{...t,includeDialogueInPrompt:s}:t))},Ia=async(a,s)=>{alert("Enhanced prompt generation is not yet implemented for the Podcast module.")},Na=a=>{window.confirm("Are you sure you want to delete this scene?")&&d(s=>s.filter(o=>o.id!==a))},Va=(a,s)=>{d(o=>o.map(t=>t.id===a?{...t,voiceoverScript:s}:t))},ka=r.useCallback(async()=>{Le(!0),m(null);try{const a=await $();if(a.length===0)throw new Error("Please upload at least one host image or a master shot.");const s=await $a(a,J,ye,P,v);Be(s),s.length>0&&ve(s[0])}catch(a){m(a instanceof Error?a.message:"Failed to generate background scenes.")}finally{Le(!1)}},[$,J,ye,P,v]);return e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"py-4 px-8 bg-gray-800 shadow-lg border-b border-gray-700 shrink-0 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-blue-400",children:[e.jsx("i",{className:"fas fa-podcast mr-3"}),"Podcast Video Designer"]}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Turn your podcast into visually engaging videos."})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("label",{htmlFor:"import-project-podcast",className:`text-center bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-full transition-all duration-300 flex items-center justify-center gap-2 text-sm shadow-sm ${be?"cursor-not-allowed opacity-50":"cursor-pointer"}`,children:be?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"}),"Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-folder-open"}),"Import"]})}),e.jsx("input",{id:"import-project-podcast",type:"file",accept:".pvdproj",className:"hidden",onChange:sa,disabled:be}),e.jsx("button",{onClick:ta,disabled:Ae||A==="input",className:"bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-full disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 flex items-center justify-center gap-2 text-sm shadow-sm",children:Ae?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-save"}),"Save"]})})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"text-gray-300 font-medium",children:["Welcome, ",e.jsx("span",{className:"font-bold text-blue-400",children:u}),"!"]}),e.jsxs("div",{className:"text-xs text-gray-400 bg-gray-700 px-2 py-1 rounded-md mt-1 flex gap-x-2",children:["Daily Usage:",e.jsxs("span",{className:"font-bold text-blue-400",title:"Storyboard Generations",children:[" ",e.jsx("i",{className:"fas fa-file-alt"})," ",l.storyboard,"/",L.generateStoryboard]})," |",e.jsxs("span",{className:"font-bold text-green-400",title:"Image Generations",children:[" ",e.jsx("i",{className:"fas fa-image"})," ",l.image,"/",L.generateImage]})," |",e.jsxs("span",{className:"font-bold text-red-400",title:"Video Generations",children:[" ",e.jsx("i",{className:"fas fa-video"})," ",l.video,"/",L.generateVideo]})]})]}),e.jsx("button",{onClick:y,className:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-full",children:"Logout"})]})]})]}),e.jsx("main",{className:"flex-1 overflow-x-hidden overflow-y-auto p-4 md:p-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 xl:grid-cols-4 gap-8 items-start",children:[e.jsx("div",{className:"lg:sticky lg:top-8 xl:col-span-1",children:e.jsx(Ma,{numHosts:x,setNumHosts:V,hostOneImage:f,setHostOneImage:T,hostTwoImage:b,setHostTwoImage:M,podcastTopic:k,setPodcastTopic:z,pastedScript:C,setPastedScript:E,onGenerateScript:ea,isGeneratingScript:se,onAnalyzeScript:Re,isAnalyzingScript:ne,reporterVoice:K,setReporterVoice:Ee,intervieweeVoice:D,setIntervieweeVoice:Fe,environmentImage:w,setEnvironmentImage:De,environmentVariationsCount:ye,setEnvironmentVariationsCount:Ze,onGenerateEnvironments:ka,isGeneratingEnvironments:Je,globalVoiceInstruction:Z,setGlobalVoiceInstruction:Ue,videoAspectRatio:v,setVideoAspectRatio:He,singleHostSetting:P,setSingleHostSetting:Oe,backgroundPrompt:J,setBackgroundPrompt:$e,onViewImage:_})}),e.jsx("div",{className:"lg:col-span-2 xl:col-span-3",children:e.jsx(Fa,{generationStep:A,scenes:c,isLoading:se||ne,isGeneratingPrompts:!1,error:te,voiceoverScript:C,onVoiceoverScriptChange:E,onGeneratePrompts:Re,sceneOverrides:G,onGenerateImage:Se,onSceneImagePromptChange:na,onSceneVideoPromptChange:ra,onSceneVoiceoverGuideChange:ia,onSceneEnhancementChange:la,onSceneOverrideChange:oa,onDeleteImage:ca,onViewImage:_,onUploadImageForVideo:ma,onGenerateAllImages:ua,isBatchGenerating:ce,onViewStoryboard:()=>U(!0),onDownloadAllImages:Sa,isDownloadingImages:H,onDownloadAllVideos:wa,isDownloadingVideos:fe,onSelectImageForVideo:da,onGenerateVideo:je,onToggleVideoUpscale:ga,onUpscaleVideo:we,onGenerateAllVideos:pa,isBatchGeneratingVideos:he,onUpscaleAllVideos:ha,isBatchUpscalingVideos:S,generatedEnvironments:xe,activeModule:"podcast",numHosts:x,onGenerateAudio:Ie,onGenerateAllAudio:fa,isBatchGeneratingAudio:Ge,onAddScene:ba,onPickAllImages:xa,onSelectEnvironment:ve,selectedEnvironment:Q,onSendAllImagesToTelegram:va,isSendingImagesToTelegram:Qe,onSendAllVideosToTelegram:ya,isSendingVideosToTelegram:Xe,videoAspectRatio:v,onToggleDialogueInPrompt:ja,onGenerateEnhancedPrompt:Ia,onSceneVoiceoverScriptChange:Va,onDeleteScene:Na,onDeleteVideo:aa})})]})}),le&&e.jsx(Ba,{imageUrl:le,onClose:()=>_(null)}),ue&&e.jsx(Ua,{scenes:c,onClose:()=>U(!1),videoAspectRatio:v})]})};export{Za as default};
